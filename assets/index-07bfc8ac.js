var sm=Object.defineProperty;var lm=(n,i,a)=>i in n?sm(n,i,{enumerable:!0,configurable:!0,writable:!0,value:a}):n[i]=a;var Kr=(n,i,a)=>(lm(n,typeof i!="symbol"?i+"":i,a),a);(function(){const i=document.createElement("link").relList;if(i&&i.supports&&i.supports("modulepreload"))return;for(const e of document.querySelectorAll('link[rel="modulepreload"]'))t(e);new MutationObserver(e=>{for(const r of e)if(r.type==="childList")for(const o of r.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&t(o)}).observe(document,{childList:!0,subtree:!0});function a(e){const r={};return e.integrity&&(r.integrity=e.integrity),e.referrerpolicy&&(r.referrerPolicy=e.referrerpolicy),e.crossorigin==="use-credentials"?r.credentials="include":e.crossorigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function t(e){if(e.ep)return;e.ep=!0;const r=a(e);fetch(e.href,r)}})();var bl={},um={get exports(){return bl},set exports(n){bl=n}},fu={},Ko={},cm={get exports(){return Ko},set exports(n){Ko=n}},Se={};/**
 * @license React
 * react.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Es=Symbol.for("react.element"),dm=Symbol.for("react.portal"),_m=Symbol.for("react.fragment"),hm=Symbol.for("react.strict_mode"),fm=Symbol.for("react.profiler"),vm=Symbol.for("react.provider"),pm=Symbol.for("react.context"),gm=Symbol.for("react.forward_ref"),mm=Symbol.for("react.suspense"),ym=Symbol.for("react.memo"),xm=Symbol.for("react.lazy"),sh=Symbol.iterator;function wm(n){return n===null||typeof n!="object"?null:(n=sh&&n[sh]||n["@@iterator"],typeof n=="function"?n:null)}var op={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},sp=Object.assign,lp={};function ao(n,i,a){this.props=n,this.context=i,this.refs=lp,this.updater=a||op}ao.prototype.isReactComponent={};ao.prototype.setState=function(n,i){if(typeof n!="object"&&typeof n!="function"&&n!=null)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,n,i,"setState")};ao.prototype.forceUpdate=function(n){this.updater.enqueueForceUpdate(this,n,"forceUpdate")};function up(){}up.prototype=ao.prototype;function Gd(n,i,a){this.props=n,this.context=i,this.refs=lp,this.updater=a||op}var Wd=Gd.prototype=new up;Wd.constructor=Gd;sp(Wd,ao.prototype);Wd.isPureReactComponent=!0;var lh=Array.isArray,cp=Object.prototype.hasOwnProperty,Xd={current:null},dp={key:!0,ref:!0,__self:!0,__source:!0};function _p(n,i,a){var t,e={},r=null,o=null;if(i!=null)for(t in i.ref!==void 0&&(o=i.ref),i.key!==void 0&&(r=""+i.key),i)cp.call(i,t)&&!dp.hasOwnProperty(t)&&(e[t]=i[t]);var s=arguments.length-2;if(s===1)e.children=a;else if(1<s){for(var l=Array(s),u=0;u<s;u++)l[u]=arguments[u+2];e.children=l}if(n&&n.defaultProps)for(t in s=n.defaultProps,s)e[t]===void 0&&(e[t]=s[t]);return{$$typeof:Es,type:n,key:r,ref:o,props:e,_owner:Xd.current}}function Sm(n,i){return{$$typeof:Es,type:n.type,key:i,ref:n.ref,props:n.props,_owner:n._owner}}function jd(n){return typeof n=="object"&&n!==null&&n.$$typeof===Es}function Cm(n){var i={"=":"=0",":":"=2"};return"$"+n.replace(/[=:]/g,function(a){return i[a]})}var uh=/\/+/g;function ku(n,i){return typeof n=="object"&&n!==null&&n.key!=null?Cm(""+n.key):i.toString(36)}function hl(n,i,a,t,e){var r=typeof n;(r==="undefined"||r==="boolean")&&(n=null);var o=!1;if(n===null)o=!0;else switch(r){case"string":case"number":o=!0;break;case"object":switch(n.$$typeof){case Es:case dm:o=!0}}if(o)return o=n,e=e(o),n=t===""?"."+ku(o,0):t,lh(e)?(a="",n!=null&&(a=n.replace(uh,"$&/")+"/"),hl(e,i,a,"",function(u){return u})):e!=null&&(jd(e)&&(e=Sm(e,a+(!e.key||o&&o.key===e.key?"":(""+e.key).replace(uh,"$&/")+"/")+n)),i.push(e)),1;if(o=0,t=t===""?".":t+":",lh(n))for(var s=0;s<n.length;s++){r=n[s];var l=t+ku(r,s);o+=hl(r,i,a,l,e)}else if(l=wm(n),typeof l=="function")for(n=l.call(n),s=0;!(r=n.next()).done;)r=r.value,l=t+ku(r,s++),o+=hl(r,i,a,l,e);else if(r==="object")throw i=String(n),Error("Objects are not valid as a React child (found: "+(i==="[object Object]"?"object with keys {"+Object.keys(n).join(", ")+"}":i)+"). If you meant to render a collection of children, use an array instead.");return o}function Os(n,i,a){if(n==null)return n;var t=[],e=0;return hl(n,t,"","",function(r){return i.call(a,r,e++)}),t}function Am(n){if(n._status===-1){var i=n._result;i=i(),i.then(function(a){(n._status===0||n._status===-1)&&(n._status=1,n._result=a)},function(a){(n._status===0||n._status===-1)&&(n._status=2,n._result=a)}),n._status===-1&&(n._status=0,n._result=i)}if(n._status===1)return n._result.default;throw n._result}var Jt={current:null},fl={transition:null},Tm={ReactCurrentDispatcher:Jt,ReactCurrentBatchConfig:fl,ReactCurrentOwner:Xd};Se.Children={map:Os,forEach:function(n,i,a){Os(n,function(){i.apply(this,arguments)},a)},count:function(n){var i=0;return Os(n,function(){i++}),i},toArray:function(n){return Os(n,function(i){return i})||[]},only:function(n){if(!jd(n))throw Error("React.Children.only expected to receive a single React element child.");return n}};Se.Component=ao;Se.Fragment=_m;Se.Profiler=fm;Se.PureComponent=Gd;Se.StrictMode=hm;Se.Suspense=mm;Se.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=Tm;Se.cloneElement=function(n,i,a){if(n==null)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+n+".");var t=sp({},n.props),e=n.key,r=n.ref,o=n._owner;if(i!=null){if(i.ref!==void 0&&(r=i.ref,o=Xd.current),i.key!==void 0&&(e=""+i.key),n.type&&n.type.defaultProps)var s=n.type.defaultProps;for(l in i)cp.call(i,l)&&!dp.hasOwnProperty(l)&&(t[l]=i[l]===void 0&&s!==void 0?s[l]:i[l])}var l=arguments.length-2;if(l===1)t.children=a;else if(1<l){s=Array(l);for(var u=0;u<l;u++)s[u]=arguments[u+2];t.children=s}return{$$typeof:Es,type:n.type,key:e,ref:r,props:t,_owner:o}};Se.createContext=function(n){return n={$$typeof:pm,_currentValue:n,_currentValue2:n,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null},n.Provider={$$typeof:vm,_context:n},n.Consumer=n};Se.createElement=_p;Se.createFactory=function(n){var i=_p.bind(null,n);return i.type=n,i};Se.createRef=function(){return{current:null}};Se.forwardRef=function(n){return{$$typeof:gm,render:n}};Se.isValidElement=jd;Se.lazy=function(n){return{$$typeof:xm,_payload:{_status:-1,_result:n},_init:Am}};Se.memo=function(n,i){return{$$typeof:ym,type:n,compare:i===void 0?null:i}};Se.startTransition=function(n){var i=fl.transition;fl.transition={};try{n()}finally{fl.transition=i}};Se.unstable_act=function(){throw Error("act(...) is not supported in production builds of React.")};Se.useCallback=function(n,i){return Jt.current.useCallback(n,i)};Se.useContext=function(n){return Jt.current.useContext(n)};Se.useDebugValue=function(){};Se.useDeferredValue=function(n){return Jt.current.useDeferredValue(n)};Se.useEffect=function(n,i){return Jt.current.useEffect(n,i)};Se.useId=function(){return Jt.current.useId()};Se.useImperativeHandle=function(n,i,a){return Jt.current.useImperativeHandle(n,i,a)};Se.useInsertionEffect=function(n,i){return Jt.current.useInsertionEffect(n,i)};Se.useLayoutEffect=function(n,i){return Jt.current.useLayoutEffect(n,i)};Se.useMemo=function(n,i){return Jt.current.useMemo(n,i)};Se.useReducer=function(n,i,a){return Jt.current.useReducer(n,i,a)};Se.useRef=function(n){return Jt.current.useRef(n)};Se.useState=function(n){return Jt.current.useState(n)};Se.useSyncExternalStore=function(n,i,a){return Jt.current.useSyncExternalStore(n,i,a)};Se.useTransition=function(){return Jt.current.useTransition()};Se.version="18.2.0";(function(n){n.exports=Se})(cm);/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Em=Ko,Pm=Symbol.for("react.element"),bm=Symbol.for("react.fragment"),Mm=Object.prototype.hasOwnProperty,Rm=Em.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,Fm={key:!0,ref:!0,__self:!0,__source:!0};function hp(n,i,a){var t,e={},r=null,o=null;a!==void 0&&(r=""+a),i.key!==void 0&&(r=""+i.key),i.ref!==void 0&&(o=i.ref);for(t in i)Mm.call(i,t)&&!Fm.hasOwnProperty(t)&&(e[t]=i[t]);if(n&&n.defaultProps)for(t in i=n.defaultProps,i)e[t]===void 0&&(e[t]=i[t]);return{$$typeof:Pm,type:n,key:r,ref:o,props:e,_owner:Rm.current}}fu.Fragment=bm;fu.jsx=hp;fu.jsxs=hp;(function(n){n.exports=fu})(um);var yc={},xc={},Dm={get exports(){return xc},set exports(n){xc=n}},bn={},wc={},Bm={get exports(){return wc},set exports(n){wc=n}},fp={};/**
 * @license React
 * scheduler.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */(function(n){function i(D,R){var N=D.length;D.push(R);e:for(;0<N;){var X=N-1>>>1,q=D[X];if(0<e(q,R))D[X]=R,D[N]=q,N=X;else break e}}function a(D){return D.length===0?null:D[0]}function t(D){if(D.length===0)return null;var R=D[0],N=D.pop();if(N!==R){D[0]=N;e:for(var X=0,q=D.length,te=q>>>1;X<te;){var ie=2*(X+1)-1,ce=D[ie],le=ie+1,ae=D[le];if(0>e(ce,N))le<q&&0>e(ae,ce)?(D[X]=ae,D[le]=N,X=le):(D[X]=ce,D[ie]=N,X=ie);else if(le<q&&0>e(ae,N))D[X]=ae,D[le]=N,X=le;else break e}}return R}function e(D,R){var N=D.sortIndex-R.sortIndex;return N!==0?N:D.id-R.id}if(typeof performance=="object"&&typeof performance.now=="function"){var r=performance;n.unstable_now=function(){return r.now()}}else{var o=Date,s=o.now();n.unstable_now=function(){return o.now()-s}}var l=[],u=[],c=1,d=null,_=3,h=!1,f=!1,g=!1,y=typeof setTimeout=="function"?setTimeout:null,p=typeof clearTimeout=="function"?clearTimeout:null,v=typeof setImmediate<"u"?setImmediate:null;typeof navigator<"u"&&navigator.scheduling!==void 0&&navigator.scheduling.isInputPending!==void 0&&navigator.scheduling.isInputPending.bind(navigator.scheduling);function m(D){for(var R=a(u);R!==null;){if(R.callback===null)t(u);else if(R.startTime<=D)t(u),R.sortIndex=R.expirationTime,i(l,R);else break;R=a(u)}}function x(D){if(g=!1,m(D),!f)if(a(l)!==null)f=!0,V(S);else{var R=a(u);R!==null&&U(x,R.startTime-D)}}function S(D,R){f=!1,g&&(g=!1,p(T),T=-1),h=!0;var N=_;try{for(m(R),d=a(l);d!==null&&(!(d.expirationTime>R)||D&&!b());){var X=d.callback;if(typeof X=="function"){d.callback=null,_=d.priorityLevel;var q=X(d.expirationTime<=R);R=n.unstable_now(),typeof q=="function"?d.callback=q:d===a(l)&&t(l),m(R)}else t(l);d=a(l)}if(d!==null)var te=!0;else{var ie=a(u);ie!==null&&U(x,ie.startTime-R),te=!1}return te}finally{d=null,_=N,h=!1}}var C=!1,A=null,T=-1,E=5,P=-1;function b(){return!(n.unstable_now()-P<E)}function M(){if(A!==null){var D=n.unstable_now();P=D;var R=!0;try{R=A(!0,D)}finally{R?F():(C=!1,A=null)}}else C=!1}var F;if(typeof v=="function")F=function(){v(M)};else if(typeof MessageChannel<"u"){var I=new MessageChannel,L=I.port2;I.port1.onmessage=M,F=function(){L.postMessage(null)}}else F=function(){y(M,0)};function V(D){A=D,C||(C=!0,F())}function U(D,R){T=y(function(){D(n.unstable_now())},R)}n.unstable_IdlePriority=5,n.unstable_ImmediatePriority=1,n.unstable_LowPriority=4,n.unstable_NormalPriority=3,n.unstable_Profiling=null,n.unstable_UserBlockingPriority=2,n.unstable_cancelCallback=function(D){D.callback=null},n.unstable_continueExecution=function(){f||h||(f=!0,V(S))},n.unstable_forceFrameRate=function(D){0>D||125<D?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):E=0<D?Math.floor(1e3/D):5},n.unstable_getCurrentPriorityLevel=function(){return _},n.unstable_getFirstCallbackNode=function(){return a(l)},n.unstable_next=function(D){switch(_){case 1:case 2:case 3:var R=3;break;default:R=_}var N=_;_=R;try{return D()}finally{_=N}},n.unstable_pauseExecution=function(){},n.unstable_requestPaint=function(){},n.unstable_runWithPriority=function(D,R){switch(D){case 1:case 2:case 3:case 4:case 5:break;default:D=3}var N=_;_=D;try{return R()}finally{_=N}},n.unstable_scheduleCallback=function(D,R,N){var X=n.unstable_now();switch(typeof N=="object"&&N!==null?(N=N.delay,N=typeof N=="number"&&0<N?X+N:X):N=X,D){case 1:var q=-1;break;case 2:q=250;break;case 5:q=1073741823;break;case 4:q=1e4;break;default:q=5e3}return q=N+q,D={id:c++,callback:R,priorityLevel:D,startTime:N,expirationTime:q,sortIndex:-1},N>X?(D.sortIndex=N,i(u,D),a(l)===null&&D===a(u)&&(g?(p(T),T=-1):g=!0,U(x,N-X))):(D.sortIndex=q,i(l,D),f||h||(f=!0,V(S))),D},n.unstable_shouldYield=b,n.unstable_wrapCallback=function(D){var R=_;return function(){var N=_;_=R;try{return D.apply(this,arguments)}finally{_=N}}}})(fp);(function(n){n.exports=fp})(Bm);/**
 * @license React
 * react-dom.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var vp=Ko,An=wc;function G(n){for(var i="https://reactjs.org/docs/error-decoder.html?invariant="+n,a=1;a<arguments.length;a++)i+="&args[]="+encodeURIComponent(arguments[a]);return"Minified React error #"+n+"; visit "+i+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var pp=new Set,Jo={};function sa(n,i){Ga(n,i),Ga(n+"Capture",i)}function Ga(n,i){for(Jo[n]=i,n=0;n<i.length;n++)pp.add(i[n])}var Or=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),Sc=Object.prototype.hasOwnProperty,Im=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,ch={},dh={};function Lm(n){return Sc.call(dh,n)?!0:Sc.call(ch,n)?!1:Im.test(n)?dh[n]=!0:(ch[n]=!0,!1)}function zm(n,i,a,t){if(a!==null&&a.type===0)return!1;switch(typeof i){case"function":case"symbol":return!0;case"boolean":return t?!1:a!==null?!a.acceptsBooleans:(n=n.toLowerCase().slice(0,5),n!=="data-"&&n!=="aria-");default:return!1}}function Om(n,i,a,t){if(i===null||typeof i>"u"||zm(n,i,a,t))return!0;if(t)return!1;if(a!==null)switch(a.type){case 3:return!i;case 4:return i===!1;case 5:return isNaN(i);case 6:return isNaN(i)||1>i}return!1}function Zt(n,i,a,t,e,r,o){this.acceptsBooleans=i===2||i===3||i===4,this.attributeName=t,this.attributeNamespace=e,this.mustUseProperty=a,this.propertyName=n,this.type=i,this.sanitizeURL=r,this.removeEmptyString=o}var Rt={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach(function(n){Rt[n]=new Zt(n,0,!1,n,null,!1,!1)});[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach(function(n){var i=n[0];Rt[i]=new Zt(i,1,!1,n[1],null,!1,!1)});["contentEditable","draggable","spellCheck","value"].forEach(function(n){Rt[n]=new Zt(n,2,!1,n.toLowerCase(),null,!1,!1)});["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach(function(n){Rt[n]=new Zt(n,2,!1,n,null,!1,!1)});"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach(function(n){Rt[n]=new Zt(n,3,!1,n.toLowerCase(),null,!1,!1)});["checked","multiple","muted","selected"].forEach(function(n){Rt[n]=new Zt(n,3,!0,n,null,!1,!1)});["capture","download"].forEach(function(n){Rt[n]=new Zt(n,4,!1,n,null,!1,!1)});["cols","rows","size","span"].forEach(function(n){Rt[n]=new Zt(n,6,!1,n,null,!1,!1)});["rowSpan","start"].forEach(function(n){Rt[n]=new Zt(n,5,!1,n.toLowerCase(),null,!1,!1)});var Yd=/[\-:]([a-z])/g;function qd(n){return n[1].toUpperCase()}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach(function(n){var i=n.replace(Yd,qd);Rt[i]=new Zt(i,1,!1,n,null,!1,!1)});"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach(function(n){var i=n.replace(Yd,qd);Rt[i]=new Zt(i,1,!1,n,"http://www.w3.org/1999/xlink",!1,!1)});["xml:base","xml:lang","xml:space"].forEach(function(n){var i=n.replace(Yd,qd);Rt[i]=new Zt(i,1,!1,n,"http://www.w3.org/XML/1998/namespace",!1,!1)});["tabIndex","crossOrigin"].forEach(function(n){Rt[n]=new Zt(n,1,!1,n.toLowerCase(),null,!1,!1)});Rt.xlinkHref=new Zt("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1);["src","href","action","formAction"].forEach(function(n){Rt[n]=new Zt(n,1,!1,n.toLowerCase(),null,!0,!0)});function Qd(n,i,a,t){var e=Rt.hasOwnProperty(i)?Rt[i]:null;(e!==null?e.type!==0:t||!(2<i.length)||i[0]!=="o"&&i[0]!=="O"||i[1]!=="n"&&i[1]!=="N")&&(Om(i,a,e,t)&&(a=null),t||e===null?Lm(i)&&(a===null?n.removeAttribute(i):n.setAttribute(i,""+a)):e.mustUseProperty?n[e.propertyName]=a===null?e.type===3?!1:"":a:(i=e.attributeName,t=e.attributeNamespace,a===null?n.removeAttribute(i):(e=e.type,a=e===3||e===4&&a===!0?"":""+a,t?n.setAttributeNS(t,i,a):n.setAttribute(i,a))))}var Wr=vp.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,Ns=Symbol.for("react.element"),xa=Symbol.for("react.portal"),wa=Symbol.for("react.fragment"),$d=Symbol.for("react.strict_mode"),Cc=Symbol.for("react.profiler"),gp=Symbol.for("react.provider"),mp=Symbol.for("react.context"),Kd=Symbol.for("react.forward_ref"),Ac=Symbol.for("react.suspense"),Tc=Symbol.for("react.suspense_list"),Jd=Symbol.for("react.memo"),ti=Symbol.for("react.lazy"),yp=Symbol.for("react.offscreen"),_h=Symbol.iterator;function go(n){return n===null||typeof n!="object"?null:(n=_h&&n[_h]||n["@@iterator"],typeof n=="function"?n:null)}var We=Object.assign,Hu;function Ro(n){if(Hu===void 0)try{throw Error()}catch(a){var i=a.stack.trim().match(/\n( *(at )?)/);Hu=i&&i[1]||""}return`
`+Hu+n}var Gu=!1;function Wu(n,i){if(!n||Gu)return"";Gu=!0;var a=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(i)if(i=function(){throw Error()},Object.defineProperty(i.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(i,[])}catch(u){var t=u}Reflect.construct(n,[],i)}else{try{i.call()}catch(u){t=u}n.call(i.prototype)}else{try{throw Error()}catch(u){t=u}n()}}catch(u){if(u&&t&&typeof u.stack=="string"){for(var e=u.stack.split(`
`),r=t.stack.split(`
`),o=e.length-1,s=r.length-1;1<=o&&0<=s&&e[o]!==r[s];)s--;for(;1<=o&&0<=s;o--,s--)if(e[o]!==r[s]){if(o!==1||s!==1)do if(o--,s--,0>s||e[o]!==r[s]){var l=`
`+e[o].replace(" at new "," at ");return n.displayName&&l.includes("<anonymous>")&&(l=l.replace("<anonymous>",n.displayName)),l}while(1<=o&&0<=s);break}}}finally{Gu=!1,Error.prepareStackTrace=a}return(n=n?n.displayName||n.name:"")?Ro(n):""}function Nm(n){switch(n.tag){case 5:return Ro(n.type);case 16:return Ro("Lazy");case 13:return Ro("Suspense");case 19:return Ro("SuspenseList");case 0:case 2:case 15:return n=Wu(n.type,!1),n;case 11:return n=Wu(n.type.render,!1),n;case 1:return n=Wu(n.type,!0),n;default:return""}}function Ec(n){if(n==null)return null;if(typeof n=="function")return n.displayName||n.name||null;if(typeof n=="string")return n;switch(n){case wa:return"Fragment";case xa:return"Portal";case Cc:return"Profiler";case $d:return"StrictMode";case Ac:return"Suspense";case Tc:return"SuspenseList"}if(typeof n=="object")switch(n.$$typeof){case mp:return(n.displayName||"Context")+".Consumer";case gp:return(n._context.displayName||"Context")+".Provider";case Kd:var i=n.render;return n=n.displayName,n||(n=i.displayName||i.name||"",n=n!==""?"ForwardRef("+n+")":"ForwardRef"),n;case Jd:return i=n.displayName||null,i!==null?i:Ec(n.type)||"Memo";case ti:i=n._payload,n=n._init;try{return Ec(n(i))}catch{}}return null}function Vm(n){var i=n.type;switch(n.tag){case 24:return"Cache";case 9:return(i.displayName||"Context")+".Consumer";case 10:return(i._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return n=i.render,n=n.displayName||n.name||"",i.displayName||(n!==""?"ForwardRef("+n+")":"ForwardRef");case 7:return"Fragment";case 5:return i;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return Ec(i);case 8:return i===$d?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if(typeof i=="function")return i.displayName||i.name||null;if(typeof i=="string")return i}return null}function Ci(n){switch(typeof n){case"boolean":case"number":case"string":case"undefined":return n;case"object":return n;default:return""}}function xp(n){var i=n.type;return(n=n.nodeName)&&n.toLowerCase()==="input"&&(i==="checkbox"||i==="radio")}function Um(n){var i=xp(n)?"checked":"value",a=Object.getOwnPropertyDescriptor(n.constructor.prototype,i),t=""+n[i];if(!n.hasOwnProperty(i)&&typeof a<"u"&&typeof a.get=="function"&&typeof a.set=="function"){var e=a.get,r=a.set;return Object.defineProperty(n,i,{configurable:!0,get:function(){return e.call(this)},set:function(o){t=""+o,r.call(this,o)}}),Object.defineProperty(n,i,{enumerable:a.enumerable}),{getValue:function(){return t},setValue:function(o){t=""+o},stopTracking:function(){n._valueTracker=null,delete n[i]}}}}function Vs(n){n._valueTracker||(n._valueTracker=Um(n))}function wp(n){if(!n)return!1;var i=n._valueTracker;if(!i)return!0;var a=i.getValue(),t="";return n&&(t=xp(n)?n.checked?"true":"false":n.value),n=t,n!==a?(i.setValue(n),!0):!1}function Ml(n){if(n=n||(typeof document<"u"?document:void 0),typeof n>"u")return null;try{return n.activeElement||n.body}catch{return n.body}}function Pc(n,i){var a=i.checked;return We({},i,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:a??n._wrapperState.initialChecked})}function hh(n,i){var a=i.defaultValue==null?"":i.defaultValue,t=i.checked!=null?i.checked:i.defaultChecked;a=Ci(i.value!=null?i.value:a),n._wrapperState={initialChecked:t,initialValue:a,controlled:i.type==="checkbox"||i.type==="radio"?i.checked!=null:i.value!=null}}function Sp(n,i){i=i.checked,i!=null&&Qd(n,"checked",i,!1)}function bc(n,i){Sp(n,i);var a=Ci(i.value),t=i.type;if(a!=null)t==="number"?(a===0&&n.value===""||n.value!=a)&&(n.value=""+a):n.value!==""+a&&(n.value=""+a);else if(t==="submit"||t==="reset"){n.removeAttribute("value");return}i.hasOwnProperty("value")?Mc(n,i.type,a):i.hasOwnProperty("defaultValue")&&Mc(n,i.type,Ci(i.defaultValue)),i.checked==null&&i.defaultChecked!=null&&(n.defaultChecked=!!i.defaultChecked)}function fh(n,i,a){if(i.hasOwnProperty("value")||i.hasOwnProperty("defaultValue")){var t=i.type;if(!(t!=="submit"&&t!=="reset"||i.value!==void 0&&i.value!==null))return;i=""+n._wrapperState.initialValue,a||i===n.value||(n.value=i),n.defaultValue=i}a=n.name,a!==""&&(n.name=""),n.defaultChecked=!!n._wrapperState.initialChecked,a!==""&&(n.name=a)}function Mc(n,i,a){(i!=="number"||Ml(n.ownerDocument)!==n)&&(a==null?n.defaultValue=""+n._wrapperState.initialValue:n.defaultValue!==""+a&&(n.defaultValue=""+a))}var Fo=Array.isArray;function La(n,i,a,t){if(n=n.options,i){i={};for(var e=0;e<a.length;e++)i["$"+a[e]]=!0;for(a=0;a<n.length;a++)e=i.hasOwnProperty("$"+n[a].value),n[a].selected!==e&&(n[a].selected=e),e&&t&&(n[a].defaultSelected=!0)}else{for(a=""+Ci(a),i=null,e=0;e<n.length;e++){if(n[e].value===a){n[e].selected=!0,t&&(n[e].defaultSelected=!0);return}i!==null||n[e].disabled||(i=n[e])}i!==null&&(i.selected=!0)}}function Rc(n,i){if(i.dangerouslySetInnerHTML!=null)throw Error(G(91));return We({},i,{value:void 0,defaultValue:void 0,children:""+n._wrapperState.initialValue})}function vh(n,i){var a=i.value;if(a==null){if(a=i.children,i=i.defaultValue,a!=null){if(i!=null)throw Error(G(92));if(Fo(a)){if(1<a.length)throw Error(G(93));a=a[0]}i=a}i==null&&(i=""),a=i}n._wrapperState={initialValue:Ci(a)}}function Cp(n,i){var a=Ci(i.value),t=Ci(i.defaultValue);a!=null&&(a=""+a,a!==n.value&&(n.value=a),i.defaultValue==null&&n.defaultValue!==a&&(n.defaultValue=a)),t!=null&&(n.defaultValue=""+t)}function ph(n){var i=n.textContent;i===n._wrapperState.initialValue&&i!==""&&i!==null&&(n.value=i)}function Ap(n){switch(n){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function Fc(n,i){return n==null||n==="http://www.w3.org/1999/xhtml"?Ap(i):n==="http://www.w3.org/2000/svg"&&i==="foreignObject"?"http://www.w3.org/1999/xhtml":n}var Us,Tp=function(n){return typeof MSApp<"u"&&MSApp.execUnsafeLocalFunction?function(i,a,t,e){MSApp.execUnsafeLocalFunction(function(){return n(i,a,t,e)})}:n}(function(n,i){if(n.namespaceURI!=="http://www.w3.org/2000/svg"||"innerHTML"in n)n.innerHTML=i;else{for(Us=Us||document.createElement("div"),Us.innerHTML="<svg>"+i.valueOf().toString()+"</svg>",i=Us.firstChild;n.firstChild;)n.removeChild(n.firstChild);for(;i.firstChild;)n.appendChild(i.firstChild)}});function Zo(n,i){if(i){var a=n.firstChild;if(a&&a===n.lastChild&&a.nodeType===3){a.nodeValue=i;return}}n.textContent=i}var zo={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},km=["Webkit","ms","Moz","O"];Object.keys(zo).forEach(function(n){km.forEach(function(i){i=i+n.charAt(0).toUpperCase()+n.substring(1),zo[i]=zo[n]})});function Ep(n,i,a){return i==null||typeof i=="boolean"||i===""?"":a||typeof i!="number"||i===0||zo.hasOwnProperty(n)&&zo[n]?(""+i).trim():i+"px"}function Pp(n,i){n=n.style;for(var a in i)if(i.hasOwnProperty(a)){var t=a.indexOf("--")===0,e=Ep(a,i[a],t);a==="float"&&(a="cssFloat"),t?n.setProperty(a,e):n[a]=e}}var Hm=We({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function Dc(n,i){if(i){if(Hm[n]&&(i.children!=null||i.dangerouslySetInnerHTML!=null))throw Error(G(137,n));if(i.dangerouslySetInnerHTML!=null){if(i.children!=null)throw Error(G(60));if(typeof i.dangerouslySetInnerHTML!="object"||!("__html"in i.dangerouslySetInnerHTML))throw Error(G(61))}if(i.style!=null&&typeof i.style!="object")throw Error(G(62))}}function Bc(n,i){if(n.indexOf("-")===-1)return typeof i.is=="string";switch(n){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var Ic=null;function Zd(n){return n=n.target||n.srcElement||window,n.correspondingUseElement&&(n=n.correspondingUseElement),n.nodeType===3?n.parentNode:n}var Lc=null,za=null,Oa=null;function gh(n){if(n=Ms(n)){if(typeof Lc!="function")throw Error(G(280));var i=n.stateNode;i&&(i=yu(i),Lc(n.stateNode,n.type,i))}}function bp(n){za?Oa?Oa.push(n):Oa=[n]:za=n}function Mp(){if(za){var n=za,i=Oa;if(Oa=za=null,gh(n),i)for(n=0;n<i.length;n++)gh(i[n])}}function Rp(n,i){return n(i)}function Fp(){}var Xu=!1;function Dp(n,i,a){if(Xu)return n(i,a);Xu=!0;try{return Rp(n,i,a)}finally{Xu=!1,(za!==null||Oa!==null)&&(Fp(),Mp())}}function es(n,i){var a=n.stateNode;if(a===null)return null;var t=yu(a);if(t===null)return null;a=t[i];e:switch(i){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(t=!t.disabled)||(n=n.type,t=!(n==="button"||n==="input"||n==="select"||n==="textarea")),n=!t;break e;default:n=!1}if(n)return null;if(a&&typeof a!="function")throw Error(G(231,i,typeof a));return a}var zc=!1;if(Or)try{var mo={};Object.defineProperty(mo,"passive",{get:function(){zc=!0}}),window.addEventListener("test",mo,mo),window.removeEventListener("test",mo,mo)}catch{zc=!1}function Gm(n,i,a,t,e,r,o,s,l){var u=Array.prototype.slice.call(arguments,3);try{i.apply(a,u)}catch(c){this.onError(c)}}var Oo=!1,Rl=null,Fl=!1,Oc=null,Wm={onError:function(n){Oo=!0,Rl=n}};function Xm(n,i,a,t,e,r,o,s,l){Oo=!1,Rl=null,Gm.apply(Wm,arguments)}function jm(n,i,a,t,e,r,o,s,l){if(Xm.apply(this,arguments),Oo){if(Oo){var u=Rl;Oo=!1,Rl=null}else throw Error(G(198));Fl||(Fl=!0,Oc=u)}}function la(n){var i=n,a=n;if(n.alternate)for(;i.return;)i=i.return;else{n=i;do i=n,i.flags&4098&&(a=i.return),n=i.return;while(n)}return i.tag===3?a:null}function Bp(n){if(n.tag===13){var i=n.memoizedState;if(i===null&&(n=n.alternate,n!==null&&(i=n.memoizedState)),i!==null)return i.dehydrated}return null}function mh(n){if(la(n)!==n)throw Error(G(188))}function Ym(n){var i=n.alternate;if(!i){if(i=la(n),i===null)throw Error(G(188));return i!==n?null:n}for(var a=n,t=i;;){var e=a.return;if(e===null)break;var r=e.alternate;if(r===null){if(t=e.return,t!==null){a=t;continue}break}if(e.child===r.child){for(r=e.child;r;){if(r===a)return mh(e),n;if(r===t)return mh(e),i;r=r.sibling}throw Error(G(188))}if(a.return!==t.return)a=e,t=r;else{for(var o=!1,s=e.child;s;){if(s===a){o=!0,a=e,t=r;break}if(s===t){o=!0,t=e,a=r;break}s=s.sibling}if(!o){for(s=r.child;s;){if(s===a){o=!0,a=r,t=e;break}if(s===t){o=!0,t=r,a=e;break}s=s.sibling}if(!o)throw Error(G(189))}}if(a.alternate!==t)throw Error(G(190))}if(a.tag!==3)throw Error(G(188));return a.stateNode.current===a?n:i}function Ip(n){return n=Ym(n),n!==null?Lp(n):null}function Lp(n){if(n.tag===5||n.tag===6)return n;for(n=n.child;n!==null;){var i=Lp(n);if(i!==null)return i;n=n.sibling}return null}var zp=An.unstable_scheduleCallback,yh=An.unstable_cancelCallback,qm=An.unstable_shouldYield,Qm=An.unstable_requestPaint,Ze=An.unstable_now,$m=An.unstable_getCurrentPriorityLevel,e_=An.unstable_ImmediatePriority,Op=An.unstable_UserBlockingPriority,Dl=An.unstable_NormalPriority,Km=An.unstable_LowPriority,Np=An.unstable_IdlePriority,vu=null,gr=null;function Jm(n){if(gr&&typeof gr.onCommitFiberRoot=="function")try{gr.onCommitFiberRoot(vu,n,void 0,(n.current.flags&128)===128)}catch{}}var tr=Math.clz32?Math.clz32:ty,Zm=Math.log,ey=Math.LN2;function ty(n){return n>>>=0,n===0?32:31-(Zm(n)/ey|0)|0}var ks=64,Hs=4194304;function Do(n){switch(n&-n){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return n&4194240;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return n&130023424;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return n}}function Bl(n,i){var a=n.pendingLanes;if(a===0)return 0;var t=0,e=n.suspendedLanes,r=n.pingedLanes,o=a&268435455;if(o!==0){var s=o&~e;s!==0?t=Do(s):(r&=o,r!==0&&(t=Do(r)))}else o=a&~e,o!==0?t=Do(o):r!==0&&(t=Do(r));if(t===0)return 0;if(i!==0&&i!==t&&!(i&e)&&(e=t&-t,r=i&-i,e>=r||e===16&&(r&4194240)!==0))return i;if(t&4&&(t|=a&16),i=n.entangledLanes,i!==0)for(n=n.entanglements,i&=t;0<i;)a=31-tr(i),e=1<<a,t|=n[a],i&=~e;return t}function ny(n,i){switch(n){case 1:case 2:case 4:return i+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return i+5e3;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return-1;case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function ry(n,i){for(var a=n.suspendedLanes,t=n.pingedLanes,e=n.expirationTimes,r=n.pendingLanes;0<r;){var o=31-tr(r),s=1<<o,l=e[o];l===-1?(!(s&a)||s&t)&&(e[o]=ny(s,i)):l<=i&&(n.expiredLanes|=s),r&=~s}}function Nc(n){return n=n.pendingLanes&-1073741825,n!==0?n:n&1073741824?1073741824:0}function Vp(){var n=ks;return ks<<=1,!(ks&4194240)&&(ks=64),n}function ju(n){for(var i=[],a=0;31>a;a++)i.push(n);return i}function Ps(n,i,a){n.pendingLanes|=i,i!==536870912&&(n.suspendedLanes=0,n.pingedLanes=0),n=n.eventTimes,i=31-tr(i),n[i]=a}function iy(n,i){var a=n.pendingLanes&~i;n.pendingLanes=i,n.suspendedLanes=0,n.pingedLanes=0,n.expiredLanes&=i,n.mutableReadLanes&=i,n.entangledLanes&=i,i=n.entanglements;var t=n.eventTimes;for(n=n.expirationTimes;0<a;){var e=31-tr(a),r=1<<e;i[e]=0,t[e]=-1,n[e]=-1,a&=~r}}function t_(n,i){var a=n.entangledLanes|=i;for(n=n.entanglements;a;){var t=31-tr(a),e=1<<t;e&i|n[t]&i&&(n[t]|=i),a&=~e}}var be=0;function Up(n){return n&=-n,1<n?4<n?n&268435455?16:536870912:4:1}var kp,n_,Hp,Gp,Wp,Vc=!1,Gs=[],_i=null,hi=null,fi=null,ts=new Map,ns=new Map,ii=[],ay="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function xh(n,i){switch(n){case"focusin":case"focusout":_i=null;break;case"dragenter":case"dragleave":hi=null;break;case"mouseover":case"mouseout":fi=null;break;case"pointerover":case"pointerout":ts.delete(i.pointerId);break;case"gotpointercapture":case"lostpointercapture":ns.delete(i.pointerId)}}function yo(n,i,a,t,e,r){return n===null||n.nativeEvent!==r?(n={blockedOn:i,domEventName:a,eventSystemFlags:t,nativeEvent:r,targetContainers:[e]},i!==null&&(i=Ms(i),i!==null&&n_(i)),n):(n.eventSystemFlags|=t,i=n.targetContainers,e!==null&&i.indexOf(e)===-1&&i.push(e),n)}function oy(n,i,a,t,e){switch(i){case"focusin":return _i=yo(_i,n,i,a,t,e),!0;case"dragenter":return hi=yo(hi,n,i,a,t,e),!0;case"mouseover":return fi=yo(fi,n,i,a,t,e),!0;case"pointerover":var r=e.pointerId;return ts.set(r,yo(ts.get(r)||null,n,i,a,t,e)),!0;case"gotpointercapture":return r=e.pointerId,ns.set(r,yo(ns.get(r)||null,n,i,a,t,e)),!0}return!1}function Xp(n){var i=Ui(n.target);if(i!==null){var a=la(i);if(a!==null){if(i=a.tag,i===13){if(i=Bp(a),i!==null){n.blockedOn=i,Wp(n.priority,function(){Hp(a)});return}}else if(i===3&&a.stateNode.current.memoizedState.isDehydrated){n.blockedOn=a.tag===3?a.stateNode.containerInfo:null;return}}}n.blockedOn=null}function vl(n){if(n.blockedOn!==null)return!1;for(var i=n.targetContainers;0<i.length;){var a=Uc(n.domEventName,n.eventSystemFlags,i[0],n.nativeEvent);if(a===null){a=n.nativeEvent;var t=new a.constructor(a.type,a);Ic=t,a.target.dispatchEvent(t),Ic=null}else return i=Ms(a),i!==null&&n_(i),n.blockedOn=a,!1;i.shift()}return!0}function wh(n,i,a){vl(n)&&a.delete(i)}function sy(){Vc=!1,_i!==null&&vl(_i)&&(_i=null),hi!==null&&vl(hi)&&(hi=null),fi!==null&&vl(fi)&&(fi=null),ts.forEach(wh),ns.forEach(wh)}function xo(n,i){n.blockedOn===i&&(n.blockedOn=null,Vc||(Vc=!0,An.unstable_scheduleCallback(An.unstable_NormalPriority,sy)))}function rs(n){function i(e){return xo(e,n)}if(0<Gs.length){xo(Gs[0],n);for(var a=1;a<Gs.length;a++){var t=Gs[a];t.blockedOn===n&&(t.blockedOn=null)}}for(_i!==null&&xo(_i,n),hi!==null&&xo(hi,n),fi!==null&&xo(fi,n),ts.forEach(i),ns.forEach(i),a=0;a<ii.length;a++)t=ii[a],t.blockedOn===n&&(t.blockedOn=null);for(;0<ii.length&&(a=ii[0],a.blockedOn===null);)Xp(a),a.blockedOn===null&&ii.shift()}var Na=Wr.ReactCurrentBatchConfig,Il=!0;function ly(n,i,a,t){var e=be,r=Na.transition;Na.transition=null;try{be=1,r_(n,i,a,t)}finally{be=e,Na.transition=r}}function uy(n,i,a,t){var e=be,r=Na.transition;Na.transition=null;try{be=4,r_(n,i,a,t)}finally{be=e,Na.transition=r}}function r_(n,i,a,t){if(Il){var e=Uc(n,i,a,t);if(e===null)nc(n,i,t,Ll,a),xh(n,t);else if(oy(e,n,i,a,t))t.stopPropagation();else if(xh(n,t),i&4&&-1<ay.indexOf(n)){for(;e!==null;){var r=Ms(e);if(r!==null&&kp(r),r=Uc(n,i,a,t),r===null&&nc(n,i,t,Ll,a),r===e)break;e=r}e!==null&&t.stopPropagation()}else nc(n,i,t,null,a)}}var Ll=null;function Uc(n,i,a,t){if(Ll=null,n=Zd(t),n=Ui(n),n!==null)if(i=la(n),i===null)n=null;else if(a=i.tag,a===13){if(n=Bp(i),n!==null)return n;n=null}else if(a===3){if(i.stateNode.current.memoizedState.isDehydrated)return i.tag===3?i.stateNode.containerInfo:null;n=null}else i!==n&&(n=null);return Ll=n,null}function jp(n){switch(n){case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 1;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"toggle":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 4;case"message":switch($m()){case e_:return 1;case Op:return 4;case Dl:case Km:return 16;case Np:return 536870912;default:return 16}default:return 16}}var si=null,i_=null,pl=null;function Yp(){if(pl)return pl;var n,i=i_,a=i.length,t,e="value"in si?si.value:si.textContent,r=e.length;for(n=0;n<a&&i[n]===e[n];n++);var o=a-n;for(t=1;t<=o&&i[a-t]===e[r-t];t++);return pl=e.slice(n,1<t?1-t:void 0)}function gl(n){var i=n.keyCode;return"charCode"in n?(n=n.charCode,n===0&&i===13&&(n=13)):n=i,n===10&&(n=13),32<=n||n===13?n:0}function Ws(){return!0}function Sh(){return!1}function Mn(n){function i(a,t,e,r,o){this._reactName=a,this._targetInst=e,this.type=t,this.nativeEvent=r,this.target=o,this.currentTarget=null;for(var s in n)n.hasOwnProperty(s)&&(a=n[s],this[s]=a?a(r):r[s]);return this.isDefaultPrevented=(r.defaultPrevented!=null?r.defaultPrevented:r.returnValue===!1)?Ws:Sh,this.isPropagationStopped=Sh,this}return We(i.prototype,{preventDefault:function(){this.defaultPrevented=!0;var a=this.nativeEvent;a&&(a.preventDefault?a.preventDefault():typeof a.returnValue!="unknown"&&(a.returnValue=!1),this.isDefaultPrevented=Ws)},stopPropagation:function(){var a=this.nativeEvent;a&&(a.stopPropagation?a.stopPropagation():typeof a.cancelBubble!="unknown"&&(a.cancelBubble=!0),this.isPropagationStopped=Ws)},persist:function(){},isPersistent:Ws}),i}var oo={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(n){return n.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},a_=Mn(oo),bs=We({},oo,{view:0,detail:0}),cy=Mn(bs),Yu,qu,wo,pu=We({},bs,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:o_,button:0,buttons:0,relatedTarget:function(n){return n.relatedTarget===void 0?n.fromElement===n.srcElement?n.toElement:n.fromElement:n.relatedTarget},movementX:function(n){return"movementX"in n?n.movementX:(n!==wo&&(wo&&n.type==="mousemove"?(Yu=n.screenX-wo.screenX,qu=n.screenY-wo.screenY):qu=Yu=0,wo=n),Yu)},movementY:function(n){return"movementY"in n?n.movementY:qu}}),Ch=Mn(pu),dy=We({},pu,{dataTransfer:0}),_y=Mn(dy),hy=We({},bs,{relatedTarget:0}),Qu=Mn(hy),fy=We({},oo,{animationName:0,elapsedTime:0,pseudoElement:0}),vy=Mn(fy),py=We({},oo,{clipboardData:function(n){return"clipboardData"in n?n.clipboardData:window.clipboardData}}),gy=Mn(py),my=We({},oo,{data:0}),Ah=Mn(my),yy={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},xy={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},wy={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function Sy(n){var i=this.nativeEvent;return i.getModifierState?i.getModifierState(n):(n=wy[n])?!!i[n]:!1}function o_(){return Sy}var Cy=We({},bs,{key:function(n){if(n.key){var i=yy[n.key]||n.key;if(i!=="Unidentified")return i}return n.type==="keypress"?(n=gl(n),n===13?"Enter":String.fromCharCode(n)):n.type==="keydown"||n.type==="keyup"?xy[n.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:o_,charCode:function(n){return n.type==="keypress"?gl(n):0},keyCode:function(n){return n.type==="keydown"||n.type==="keyup"?n.keyCode:0},which:function(n){return n.type==="keypress"?gl(n):n.type==="keydown"||n.type==="keyup"?n.keyCode:0}}),Ay=Mn(Cy),Ty=We({},pu,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),Th=Mn(Ty),Ey=We({},bs,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:o_}),Py=Mn(Ey),by=We({},oo,{propertyName:0,elapsedTime:0,pseudoElement:0}),My=Mn(by),Ry=We({},pu,{deltaX:function(n){return"deltaX"in n?n.deltaX:"wheelDeltaX"in n?-n.wheelDeltaX:0},deltaY:function(n){return"deltaY"in n?n.deltaY:"wheelDeltaY"in n?-n.wheelDeltaY:"wheelDelta"in n?-n.wheelDelta:0},deltaZ:0,deltaMode:0}),Fy=Mn(Ry),Dy=[9,13,27,32],s_=Or&&"CompositionEvent"in window,No=null;Or&&"documentMode"in document&&(No=document.documentMode);var By=Or&&"TextEvent"in window&&!No,qp=Or&&(!s_||No&&8<No&&11>=No),Eh=String.fromCharCode(32),Ph=!1;function Qp(n,i){switch(n){case"keyup":return Dy.indexOf(i.keyCode)!==-1;case"keydown":return i.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function $p(n){return n=n.detail,typeof n=="object"&&"data"in n?n.data:null}var Sa=!1;function Iy(n,i){switch(n){case"compositionend":return $p(i);case"keypress":return i.which!==32?null:(Ph=!0,Eh);case"textInput":return n=i.data,n===Eh&&Ph?null:n;default:return null}}function Ly(n,i){if(Sa)return n==="compositionend"||!s_&&Qp(n,i)?(n=Yp(),pl=i_=si=null,Sa=!1,n):null;switch(n){case"paste":return null;case"keypress":if(!(i.ctrlKey||i.altKey||i.metaKey)||i.ctrlKey&&i.altKey){if(i.char&&1<i.char.length)return i.char;if(i.which)return String.fromCharCode(i.which)}return null;case"compositionend":return qp&&i.locale!=="ko"?null:i.data;default:return null}}var zy={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function bh(n){var i=n&&n.nodeName&&n.nodeName.toLowerCase();return i==="input"?!!zy[n.type]:i==="textarea"}function Kp(n,i,a,t){bp(t),i=zl(i,"onChange"),0<i.length&&(a=new a_("onChange","change",null,a,t),n.push({event:a,listeners:i}))}var Vo=null,is=null;function Oy(n){lg(n,0)}function gu(n){var i=Ta(n);if(wp(i))return n}function Ny(n,i){if(n==="change")return i}var Jp=!1;if(Or){var $u;if(Or){var Ku="oninput"in document;if(!Ku){var Mh=document.createElement("div");Mh.setAttribute("oninput","return;"),Ku=typeof Mh.oninput=="function"}$u=Ku}else $u=!1;Jp=$u&&(!document.documentMode||9<document.documentMode)}function Rh(){Vo&&(Vo.detachEvent("onpropertychange",Zp),is=Vo=null)}function Zp(n){if(n.propertyName==="value"&&gu(is)){var i=[];Kp(i,is,n,Zd(n)),Dp(Oy,i)}}function Vy(n,i,a){n==="focusin"?(Rh(),Vo=i,is=a,Vo.attachEvent("onpropertychange",Zp)):n==="focusout"&&Rh()}function Uy(n){if(n==="selectionchange"||n==="keyup"||n==="keydown")return gu(is)}function ky(n,i){if(n==="click")return gu(i)}function Hy(n,i){if(n==="input"||n==="change")return gu(i)}function Gy(n,i){return n===i&&(n!==0||1/n===1/i)||n!==n&&i!==i}var rr=typeof Object.is=="function"?Object.is:Gy;function as(n,i){if(rr(n,i))return!0;if(typeof n!="object"||n===null||typeof i!="object"||i===null)return!1;var a=Object.keys(n),t=Object.keys(i);if(a.length!==t.length)return!1;for(t=0;t<a.length;t++){var e=a[t];if(!Sc.call(i,e)||!rr(n[e],i[e]))return!1}return!0}function Fh(n){for(;n&&n.firstChild;)n=n.firstChild;return n}function Dh(n,i){var a=Fh(n);n=0;for(var t;a;){if(a.nodeType===3){if(t=n+a.textContent.length,n<=i&&t>=i)return{node:a,offset:i-n};n=t}e:{for(;a;){if(a.nextSibling){a=a.nextSibling;break e}a=a.parentNode}a=void 0}a=Fh(a)}}function eg(n,i){return n&&i?n===i?!0:n&&n.nodeType===3?!1:i&&i.nodeType===3?eg(n,i.parentNode):"contains"in n?n.contains(i):n.compareDocumentPosition?!!(n.compareDocumentPosition(i)&16):!1:!1}function tg(){for(var n=window,i=Ml();i instanceof n.HTMLIFrameElement;){try{var a=typeof i.contentWindow.location.href=="string"}catch{a=!1}if(a)n=i.contentWindow;else break;i=Ml(n.document)}return i}function l_(n){var i=n&&n.nodeName&&n.nodeName.toLowerCase();return i&&(i==="input"&&(n.type==="text"||n.type==="search"||n.type==="tel"||n.type==="url"||n.type==="password")||i==="textarea"||n.contentEditable==="true")}function Wy(n){var i=tg(),a=n.focusedElem,t=n.selectionRange;if(i!==a&&a&&a.ownerDocument&&eg(a.ownerDocument.documentElement,a)){if(t!==null&&l_(a)){if(i=t.start,n=t.end,n===void 0&&(n=i),"selectionStart"in a)a.selectionStart=i,a.selectionEnd=Math.min(n,a.value.length);else if(n=(i=a.ownerDocument||document)&&i.defaultView||window,n.getSelection){n=n.getSelection();var e=a.textContent.length,r=Math.min(t.start,e);t=t.end===void 0?r:Math.min(t.end,e),!n.extend&&r>t&&(e=t,t=r,r=e),e=Dh(a,r);var o=Dh(a,t);e&&o&&(n.rangeCount!==1||n.anchorNode!==e.node||n.anchorOffset!==e.offset||n.focusNode!==o.node||n.focusOffset!==o.offset)&&(i=i.createRange(),i.setStart(e.node,e.offset),n.removeAllRanges(),r>t?(n.addRange(i),n.extend(o.node,o.offset)):(i.setEnd(o.node,o.offset),n.addRange(i)))}}for(i=[],n=a;n=n.parentNode;)n.nodeType===1&&i.push({element:n,left:n.scrollLeft,top:n.scrollTop});for(typeof a.focus=="function"&&a.focus(),a=0;a<i.length;a++)n=i[a],n.element.scrollLeft=n.left,n.element.scrollTop=n.top}}var Xy=Or&&"documentMode"in document&&11>=document.documentMode,Ca=null,kc=null,Uo=null,Hc=!1;function Bh(n,i,a){var t=a.window===a?a.document:a.nodeType===9?a:a.ownerDocument;Hc||Ca==null||Ca!==Ml(t)||(t=Ca,"selectionStart"in t&&l_(t)?t={start:t.selectionStart,end:t.selectionEnd}:(t=(t.ownerDocument&&t.ownerDocument.defaultView||window).getSelection(),t={anchorNode:t.anchorNode,anchorOffset:t.anchorOffset,focusNode:t.focusNode,focusOffset:t.focusOffset}),Uo&&as(Uo,t)||(Uo=t,t=zl(kc,"onSelect"),0<t.length&&(i=new a_("onSelect","select",null,i,a),n.push({event:i,listeners:t}),i.target=Ca)))}function Xs(n,i){var a={};return a[n.toLowerCase()]=i.toLowerCase(),a["Webkit"+n]="webkit"+i,a["Moz"+n]="moz"+i,a}var Aa={animationend:Xs("Animation","AnimationEnd"),animationiteration:Xs("Animation","AnimationIteration"),animationstart:Xs("Animation","AnimationStart"),transitionend:Xs("Transition","TransitionEnd")},Ju={},ng={};Or&&(ng=document.createElement("div").style,"AnimationEvent"in window||(delete Aa.animationend.animation,delete Aa.animationiteration.animation,delete Aa.animationstart.animation),"TransitionEvent"in window||delete Aa.transitionend.transition);function mu(n){if(Ju[n])return Ju[n];if(!Aa[n])return n;var i=Aa[n],a;for(a in i)if(i.hasOwnProperty(a)&&a in ng)return Ju[n]=i[a];return n}var rg=mu("animationend"),ig=mu("animationiteration"),ag=mu("animationstart"),og=mu("transitionend"),sg=new Map,Ih="abort auxClick cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function Pi(n,i){sg.set(n,i),sa(i,[n])}for(var Zu=0;Zu<Ih.length;Zu++){var ec=Ih[Zu],jy=ec.toLowerCase(),Yy=ec[0].toUpperCase()+ec.slice(1);Pi(jy,"on"+Yy)}Pi(rg,"onAnimationEnd");Pi(ig,"onAnimationIteration");Pi(ag,"onAnimationStart");Pi("dblclick","onDoubleClick");Pi("focusin","onFocus");Pi("focusout","onBlur");Pi(og,"onTransitionEnd");Ga("onMouseEnter",["mouseout","mouseover"]);Ga("onMouseLeave",["mouseout","mouseover"]);Ga("onPointerEnter",["pointerout","pointerover"]);Ga("onPointerLeave",["pointerout","pointerover"]);sa("onChange","change click focusin focusout input keydown keyup selectionchange".split(" "));sa("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" "));sa("onBeforeInput",["compositionend","keypress","textInput","paste"]);sa("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" "));sa("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" "));sa("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var Bo="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),qy=new Set("cancel close invalid load scroll toggle".split(" ").concat(Bo));function Lh(n,i,a){var t=n.type||"unknown-event";n.currentTarget=a,jm(t,i,void 0,n),n.currentTarget=null}function lg(n,i){i=(i&4)!==0;for(var a=0;a<n.length;a++){var t=n[a],e=t.event;t=t.listeners;e:{var r=void 0;if(i)for(var o=t.length-1;0<=o;o--){var s=t[o],l=s.instance,u=s.currentTarget;if(s=s.listener,l!==r&&e.isPropagationStopped())break e;Lh(e,s,u),r=l}else for(o=0;o<t.length;o++){if(s=t[o],l=s.instance,u=s.currentTarget,s=s.listener,l!==r&&e.isPropagationStopped())break e;Lh(e,s,u),r=l}}}if(Fl)throw n=Oc,Fl=!1,Oc=null,n}function Ie(n,i){var a=i[Yc];a===void 0&&(a=i[Yc]=new Set);var t=n+"__bubble";a.has(t)||(ug(i,n,2,!1),a.add(t))}function tc(n,i,a){var t=0;i&&(t|=4),ug(a,n,t,i)}var js="_reactListening"+Math.random().toString(36).slice(2);function os(n){if(!n[js]){n[js]=!0,pp.forEach(function(a){a!=="selectionchange"&&(qy.has(a)||tc(a,!1,n),tc(a,!0,n))});var i=n.nodeType===9?n:n.ownerDocument;i===null||i[js]||(i[js]=!0,tc("selectionchange",!1,i))}}function ug(n,i,a,t){switch(jp(i)){case 1:var e=ly;break;case 4:e=uy;break;default:e=r_}a=e.bind(null,i,a,n),e=void 0,!zc||i!=="touchstart"&&i!=="touchmove"&&i!=="wheel"||(e=!0),t?e!==void 0?n.addEventListener(i,a,{capture:!0,passive:e}):n.addEventListener(i,a,!0):e!==void 0?n.addEventListener(i,a,{passive:e}):n.addEventListener(i,a,!1)}function nc(n,i,a,t,e){var r=t;if(!(i&1)&&!(i&2)&&t!==null)e:for(;;){if(t===null)return;var o=t.tag;if(o===3||o===4){var s=t.stateNode.containerInfo;if(s===e||s.nodeType===8&&s.parentNode===e)break;if(o===4)for(o=t.return;o!==null;){var l=o.tag;if((l===3||l===4)&&(l=o.stateNode.containerInfo,l===e||l.nodeType===8&&l.parentNode===e))return;o=o.return}for(;s!==null;){if(o=Ui(s),o===null)return;if(l=o.tag,l===5||l===6){t=r=o;continue e}s=s.parentNode}}t=t.return}Dp(function(){var u=r,c=Zd(a),d=[];e:{var _=sg.get(n);if(_!==void 0){var h=a_,f=n;switch(n){case"keypress":if(gl(a)===0)break e;case"keydown":case"keyup":h=Ay;break;case"focusin":f="focus",h=Qu;break;case"focusout":f="blur",h=Qu;break;case"beforeblur":case"afterblur":h=Qu;break;case"click":if(a.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":h=Ch;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":h=_y;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":h=Py;break;case rg:case ig:case ag:h=vy;break;case og:h=My;break;case"scroll":h=cy;break;case"wheel":h=Fy;break;case"copy":case"cut":case"paste":h=gy;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":h=Th}var g=(i&4)!==0,y=!g&&n==="scroll",p=g?_!==null?_+"Capture":null:_;g=[];for(var v=u,m;v!==null;){m=v;var x=m.stateNode;if(m.tag===5&&x!==null&&(m=x,p!==null&&(x=es(v,p),x!=null&&g.push(ss(v,x,m)))),y)break;v=v.return}0<g.length&&(_=new h(_,f,null,a,c),d.push({event:_,listeners:g}))}}if(!(i&7)){e:{if(_=n==="mouseover"||n==="pointerover",h=n==="mouseout"||n==="pointerout",_&&a!==Ic&&(f=a.relatedTarget||a.fromElement)&&(Ui(f)||f[Nr]))break e;if((h||_)&&(_=c.window===c?c:(_=c.ownerDocument)?_.defaultView||_.parentWindow:window,h?(f=a.relatedTarget||a.toElement,h=u,f=f?Ui(f):null,f!==null&&(y=la(f),f!==y||f.tag!==5&&f.tag!==6)&&(f=null)):(h=null,f=u),h!==f)){if(g=Ch,x="onMouseLeave",p="onMouseEnter",v="mouse",(n==="pointerout"||n==="pointerover")&&(g=Th,x="onPointerLeave",p="onPointerEnter",v="pointer"),y=h==null?_:Ta(h),m=f==null?_:Ta(f),_=new g(x,v+"leave",h,a,c),_.target=y,_.relatedTarget=m,x=null,Ui(c)===u&&(g=new g(p,v+"enter",f,a,c),g.target=m,g.relatedTarget=y,x=g),y=x,h&&f)t:{for(g=h,p=f,v=0,m=g;m;m=ha(m))v++;for(m=0,x=p;x;x=ha(x))m++;for(;0<v-m;)g=ha(g),v--;for(;0<m-v;)p=ha(p),m--;for(;v--;){if(g===p||p!==null&&g===p.alternate)break t;g=ha(g),p=ha(p)}g=null}else g=null;h!==null&&zh(d,_,h,g,!1),f!==null&&y!==null&&zh(d,y,f,g,!0)}}e:{if(_=u?Ta(u):window,h=_.nodeName&&_.nodeName.toLowerCase(),h==="select"||h==="input"&&_.type==="file")var S=Ny;else if(bh(_))if(Jp)S=Hy;else{S=Uy;var C=Vy}else(h=_.nodeName)&&h.toLowerCase()==="input"&&(_.type==="checkbox"||_.type==="radio")&&(S=ky);if(S&&(S=S(n,u))){Kp(d,S,a,c);break e}C&&C(n,_,u),n==="focusout"&&(C=_._wrapperState)&&C.controlled&&_.type==="number"&&Mc(_,"number",_.value)}switch(C=u?Ta(u):window,n){case"focusin":(bh(C)||C.contentEditable==="true")&&(Ca=C,kc=u,Uo=null);break;case"focusout":Uo=kc=Ca=null;break;case"mousedown":Hc=!0;break;case"contextmenu":case"mouseup":case"dragend":Hc=!1,Bh(d,a,c);break;case"selectionchange":if(Xy)break;case"keydown":case"keyup":Bh(d,a,c)}var A;if(s_)e:{switch(n){case"compositionstart":var T="onCompositionStart";break e;case"compositionend":T="onCompositionEnd";break e;case"compositionupdate":T="onCompositionUpdate";break e}T=void 0}else Sa?Qp(n,a)&&(T="onCompositionEnd"):n==="keydown"&&a.keyCode===229&&(T="onCompositionStart");T&&(qp&&a.locale!=="ko"&&(Sa||T!=="onCompositionStart"?T==="onCompositionEnd"&&Sa&&(A=Yp()):(si=c,i_="value"in si?si.value:si.textContent,Sa=!0)),C=zl(u,T),0<C.length&&(T=new Ah(T,n,null,a,c),d.push({event:T,listeners:C}),A?T.data=A:(A=$p(a),A!==null&&(T.data=A)))),(A=By?Iy(n,a):Ly(n,a))&&(u=zl(u,"onBeforeInput"),0<u.length&&(c=new Ah("onBeforeInput","beforeinput",null,a,c),d.push({event:c,listeners:u}),c.data=A))}lg(d,i)})}function ss(n,i,a){return{instance:n,listener:i,currentTarget:a}}function zl(n,i){for(var a=i+"Capture",t=[];n!==null;){var e=n,r=e.stateNode;e.tag===5&&r!==null&&(e=r,r=es(n,a),r!=null&&t.unshift(ss(n,r,e)),r=es(n,i),r!=null&&t.push(ss(n,r,e))),n=n.return}return t}function ha(n){if(n===null)return null;do n=n.return;while(n&&n.tag!==5);return n||null}function zh(n,i,a,t,e){for(var r=i._reactName,o=[];a!==null&&a!==t;){var s=a,l=s.alternate,u=s.stateNode;if(l!==null&&l===t)break;s.tag===5&&u!==null&&(s=u,e?(l=es(a,r),l!=null&&o.unshift(ss(a,l,s))):e||(l=es(a,r),l!=null&&o.push(ss(a,l,s)))),a=a.return}o.length!==0&&n.push({event:i,listeners:o})}var Qy=/\r\n?/g,$y=/\u0000|\uFFFD/g;function Oh(n){return(typeof n=="string"?n:""+n).replace(Qy,`
`).replace($y,"")}function Ys(n,i,a){if(i=Oh(i),Oh(n)!==i&&a)throw Error(G(425))}function Ol(){}var Gc=null,Wc=null;function Xc(n,i){return n==="textarea"||n==="noscript"||typeof i.children=="string"||typeof i.children=="number"||typeof i.dangerouslySetInnerHTML=="object"&&i.dangerouslySetInnerHTML!==null&&i.dangerouslySetInnerHTML.__html!=null}var jc=typeof setTimeout=="function"?setTimeout:void 0,Ky=typeof clearTimeout=="function"?clearTimeout:void 0,Nh=typeof Promise=="function"?Promise:void 0,Jy=typeof queueMicrotask=="function"?queueMicrotask:typeof Nh<"u"?function(n){return Nh.resolve(null).then(n).catch(Zy)}:jc;function Zy(n){setTimeout(function(){throw n})}function rc(n,i){var a=i,t=0;do{var e=a.nextSibling;if(n.removeChild(a),e&&e.nodeType===8)if(a=e.data,a==="/$"){if(t===0){n.removeChild(e),rs(i);return}t--}else a!=="$"&&a!=="$?"&&a!=="$!"||t++;a=e}while(a);rs(i)}function vi(n){for(;n!=null;n=n.nextSibling){var i=n.nodeType;if(i===1||i===3)break;if(i===8){if(i=n.data,i==="$"||i==="$!"||i==="$?")break;if(i==="/$")return null}}return n}function Vh(n){n=n.previousSibling;for(var i=0;n;){if(n.nodeType===8){var a=n.data;if(a==="$"||a==="$!"||a==="$?"){if(i===0)return n;i--}else a==="/$"&&i++}n=n.previousSibling}return null}var so=Math.random().toString(36).slice(2),pr="__reactFiber$"+so,ls="__reactProps$"+so,Nr="__reactContainer$"+so,Yc="__reactEvents$"+so,e1="__reactListeners$"+so,t1="__reactHandles$"+so;function Ui(n){var i=n[pr];if(i)return i;for(var a=n.parentNode;a;){if(i=a[Nr]||a[pr]){if(a=i.alternate,i.child!==null||a!==null&&a.child!==null)for(n=Vh(n);n!==null;){if(a=n[pr])return a;n=Vh(n)}return i}n=a,a=n.parentNode}return null}function Ms(n){return n=n[pr]||n[Nr],!n||n.tag!==5&&n.tag!==6&&n.tag!==13&&n.tag!==3?null:n}function Ta(n){if(n.tag===5||n.tag===6)return n.stateNode;throw Error(G(33))}function yu(n){return n[ls]||null}var qc=[],Ea=-1;function bi(n){return{current:n}}function ze(n){0>Ea||(n.current=qc[Ea],qc[Ea]=null,Ea--)}function Fe(n,i){Ea++,qc[Ea]=n.current,n.current=i}var Ai={},Ht=bi(Ai),ln=bi(!1),Zi=Ai;function Wa(n,i){var a=n.type.contextTypes;if(!a)return Ai;var t=n.stateNode;if(t&&t.__reactInternalMemoizedUnmaskedChildContext===i)return t.__reactInternalMemoizedMaskedChildContext;var e={},r;for(r in a)e[r]=i[r];return t&&(n=n.stateNode,n.__reactInternalMemoizedUnmaskedChildContext=i,n.__reactInternalMemoizedMaskedChildContext=e),e}function un(n){return n=n.childContextTypes,n!=null}function Nl(){ze(ln),ze(Ht)}function Uh(n,i,a){if(Ht.current!==Ai)throw Error(G(168));Fe(Ht,i),Fe(ln,a)}function cg(n,i,a){var t=n.stateNode;if(i=i.childContextTypes,typeof t.getChildContext!="function")return a;t=t.getChildContext();for(var e in t)if(!(e in i))throw Error(G(108,Vm(n)||"Unknown",e));return We({},a,t)}function Vl(n){return n=(n=n.stateNode)&&n.__reactInternalMemoizedMergedChildContext||Ai,Zi=Ht.current,Fe(Ht,n),Fe(ln,ln.current),!0}function kh(n,i,a){var t=n.stateNode;if(!t)throw Error(G(169));a?(n=cg(n,i,Zi),t.__reactInternalMemoizedMergedChildContext=n,ze(ln),ze(Ht),Fe(Ht,n)):ze(ln),Fe(ln,a)}var Er=null,xu=!1,ic=!1;function dg(n){Er===null?Er=[n]:Er.push(n)}function n1(n){xu=!0,dg(n)}function Mi(){if(!ic&&Er!==null){ic=!0;var n=0,i=be;try{var a=Er;for(be=1;n<a.length;n++){var t=a[n];do t=t(!0);while(t!==null)}Er=null,xu=!1}catch(e){throw Er!==null&&(Er=Er.slice(n+1)),zp(e_,Mi),e}finally{be=i,ic=!1}}return null}var Pa=[],ba=0,Ul=null,kl=0,Ln=[],zn=0,ea=null,Mr=1,Rr="";function Oi(n,i){Pa[ba++]=kl,Pa[ba++]=Ul,Ul=n,kl=i}function _g(n,i,a){Ln[zn++]=Mr,Ln[zn++]=Rr,Ln[zn++]=ea,ea=n;var t=Mr;n=Rr;var e=32-tr(t)-1;t&=~(1<<e),a+=1;var r=32-tr(i)+e;if(30<r){var o=e-e%5;r=(t&(1<<o)-1).toString(32),t>>=o,e-=o,Mr=1<<32-tr(i)+e|a<<e|t,Rr=r+n}else Mr=1<<r|a<<e|t,Rr=n}function u_(n){n.return!==null&&(Oi(n,1),_g(n,1,0))}function c_(n){for(;n===Ul;)Ul=Pa[--ba],Pa[ba]=null,kl=Pa[--ba],Pa[ba]=null;for(;n===ea;)ea=Ln[--zn],Ln[zn]=null,Rr=Ln[--zn],Ln[zn]=null,Mr=Ln[--zn],Ln[zn]=null}var Sn=null,wn=null,Ve=!1,Jn=null;function hg(n,i){var a=Nn(5,null,null,0);a.elementType="DELETED",a.stateNode=i,a.return=n,i=n.deletions,i===null?(n.deletions=[a],n.flags|=16):i.push(a)}function Hh(n,i){switch(n.tag){case 5:var a=n.type;return i=i.nodeType!==1||a.toLowerCase()!==i.nodeName.toLowerCase()?null:i,i!==null?(n.stateNode=i,Sn=n,wn=vi(i.firstChild),!0):!1;case 6:return i=n.pendingProps===""||i.nodeType!==3?null:i,i!==null?(n.stateNode=i,Sn=n,wn=null,!0):!1;case 13:return i=i.nodeType!==8?null:i,i!==null?(a=ea!==null?{id:Mr,overflow:Rr}:null,n.memoizedState={dehydrated:i,treeContext:a,retryLane:1073741824},a=Nn(18,null,null,0),a.stateNode=i,a.return=n,n.child=a,Sn=n,wn=null,!0):!1;default:return!1}}function Qc(n){return(n.mode&1)!==0&&(n.flags&128)===0}function $c(n){if(Ve){var i=wn;if(i){var a=i;if(!Hh(n,i)){if(Qc(n))throw Error(G(418));i=vi(a.nextSibling);var t=Sn;i&&Hh(n,i)?hg(t,a):(n.flags=n.flags&-4097|2,Ve=!1,Sn=n)}}else{if(Qc(n))throw Error(G(418));n.flags=n.flags&-4097|2,Ve=!1,Sn=n}}}function Gh(n){for(n=n.return;n!==null&&n.tag!==5&&n.tag!==3&&n.tag!==13;)n=n.return;Sn=n}function qs(n){if(n!==Sn)return!1;if(!Ve)return Gh(n),Ve=!0,!1;var i;if((i=n.tag!==3)&&!(i=n.tag!==5)&&(i=n.type,i=i!=="head"&&i!=="body"&&!Xc(n.type,n.memoizedProps)),i&&(i=wn)){if(Qc(n))throw fg(),Error(G(418));for(;i;)hg(n,i),i=vi(i.nextSibling)}if(Gh(n),n.tag===13){if(n=n.memoizedState,n=n!==null?n.dehydrated:null,!n)throw Error(G(317));e:{for(n=n.nextSibling,i=0;n;){if(n.nodeType===8){var a=n.data;if(a==="/$"){if(i===0){wn=vi(n.nextSibling);break e}i--}else a!=="$"&&a!=="$!"&&a!=="$?"||i++}n=n.nextSibling}wn=null}}else wn=Sn?vi(n.stateNode.nextSibling):null;return!0}function fg(){for(var n=wn;n;)n=vi(n.nextSibling)}function Xa(){wn=Sn=null,Ve=!1}function d_(n){Jn===null?Jn=[n]:Jn.push(n)}var r1=Wr.ReactCurrentBatchConfig;function $n(n,i){if(n&&n.defaultProps){i=We({},i),n=n.defaultProps;for(var a in n)i[a]===void 0&&(i[a]=n[a]);return i}return i}var Hl=bi(null),Gl=null,Ma=null,__=null;function h_(){__=Ma=Gl=null}function f_(n){var i=Hl.current;ze(Hl),n._currentValue=i}function Kc(n,i,a){for(;n!==null;){var t=n.alternate;if((n.childLanes&i)!==i?(n.childLanes|=i,t!==null&&(t.childLanes|=i)):t!==null&&(t.childLanes&i)!==i&&(t.childLanes|=i),n===a)break;n=n.return}}function Va(n,i){Gl=n,__=Ma=null,n=n.dependencies,n!==null&&n.firstContext!==null&&(n.lanes&i&&(on=!0),n.firstContext=null)}function kn(n){var i=n._currentValue;if(__!==n)if(n={context:n,memoizedValue:i,next:null},Ma===null){if(Gl===null)throw Error(G(308));Ma=n,Gl.dependencies={lanes:0,firstContext:n}}else Ma=Ma.next=n;return i}var ki=null;function v_(n){ki===null?ki=[n]:ki.push(n)}function vg(n,i,a,t){var e=i.interleaved;return e===null?(a.next=a,v_(i)):(a.next=e.next,e.next=a),i.interleaved=a,Vr(n,t)}function Vr(n,i){n.lanes|=i;var a=n.alternate;for(a!==null&&(a.lanes|=i),a=n,n=n.return;n!==null;)n.childLanes|=i,a=n.alternate,a!==null&&(a.childLanes|=i),a=n,n=n.return;return a.tag===3?a.stateNode:null}var ni=!1;function p_(n){n.updateQueue={baseState:n.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function pg(n,i){n=n.updateQueue,i.updateQueue===n&&(i.updateQueue={baseState:n.baseState,firstBaseUpdate:n.firstBaseUpdate,lastBaseUpdate:n.lastBaseUpdate,shared:n.shared,effects:n.effects})}function Lr(n,i){return{eventTime:n,lane:i,tag:0,payload:null,callback:null,next:null}}function pi(n,i,a){var t=n.updateQueue;if(t===null)return null;if(t=t.shared,Ce&2){var e=t.pending;return e===null?i.next=i:(i.next=e.next,e.next=i),t.pending=i,Vr(n,a)}return e=t.interleaved,e===null?(i.next=i,v_(t)):(i.next=e.next,e.next=i),t.interleaved=i,Vr(n,a)}function ml(n,i,a){if(i=i.updateQueue,i!==null&&(i=i.shared,(a&4194240)!==0)){var t=i.lanes;t&=n.pendingLanes,a|=t,i.lanes=a,t_(n,a)}}function Wh(n,i){var a=n.updateQueue,t=n.alternate;if(t!==null&&(t=t.updateQueue,a===t)){var e=null,r=null;if(a=a.firstBaseUpdate,a!==null){do{var o={eventTime:a.eventTime,lane:a.lane,tag:a.tag,payload:a.payload,callback:a.callback,next:null};r===null?e=r=o:r=r.next=o,a=a.next}while(a!==null);r===null?e=r=i:r=r.next=i}else e=r=i;a={baseState:t.baseState,firstBaseUpdate:e,lastBaseUpdate:r,shared:t.shared,effects:t.effects},n.updateQueue=a;return}n=a.lastBaseUpdate,n===null?a.firstBaseUpdate=i:n.next=i,a.lastBaseUpdate=i}function Wl(n,i,a,t){var e=n.updateQueue;ni=!1;var r=e.firstBaseUpdate,o=e.lastBaseUpdate,s=e.shared.pending;if(s!==null){e.shared.pending=null;var l=s,u=l.next;l.next=null,o===null?r=u:o.next=u,o=l;var c=n.alternate;c!==null&&(c=c.updateQueue,s=c.lastBaseUpdate,s!==o&&(s===null?c.firstBaseUpdate=u:s.next=u,c.lastBaseUpdate=l))}if(r!==null){var d=e.baseState;o=0,c=u=l=null,s=r;do{var _=s.lane,h=s.eventTime;if((t&_)===_){c!==null&&(c=c.next={eventTime:h,lane:0,tag:s.tag,payload:s.payload,callback:s.callback,next:null});e:{var f=n,g=s;switch(_=i,h=a,g.tag){case 1:if(f=g.payload,typeof f=="function"){d=f.call(h,d,_);break e}d=f;break e;case 3:f.flags=f.flags&-65537|128;case 0:if(f=g.payload,_=typeof f=="function"?f.call(h,d,_):f,_==null)break e;d=We({},d,_);break e;case 2:ni=!0}}s.callback!==null&&s.lane!==0&&(n.flags|=64,_=e.effects,_===null?e.effects=[s]:_.push(s))}else h={eventTime:h,lane:_,tag:s.tag,payload:s.payload,callback:s.callback,next:null},c===null?(u=c=h,l=d):c=c.next=h,o|=_;if(s=s.next,s===null){if(s=e.shared.pending,s===null)break;_=s,s=_.next,_.next=null,e.lastBaseUpdate=_,e.shared.pending=null}}while(1);if(c===null&&(l=d),e.baseState=l,e.firstBaseUpdate=u,e.lastBaseUpdate=c,i=e.shared.interleaved,i!==null){e=i;do o|=e.lane,e=e.next;while(e!==i)}else r===null&&(e.shared.lanes=0);na|=o,n.lanes=o,n.memoizedState=d}}function Xh(n,i,a){if(n=i.effects,i.effects=null,n!==null)for(i=0;i<n.length;i++){var t=n[i],e=t.callback;if(e!==null){if(t.callback=null,t=a,typeof e!="function")throw Error(G(191,e));e.call(t)}}}var gg=new vp.Component().refs;function Jc(n,i,a,t){i=n.memoizedState,a=a(t,i),a=a==null?i:We({},i,a),n.memoizedState=a,n.lanes===0&&(n.updateQueue.baseState=a)}var wu={isMounted:function(n){return(n=n._reactInternals)?la(n)===n:!1},enqueueSetState:function(n,i,a){n=n._reactInternals;var t=Qt(),e=mi(n),r=Lr(t,e);r.payload=i,a!=null&&(r.callback=a),i=pi(n,r,e),i!==null&&(nr(i,n,e,t),ml(i,n,e))},enqueueReplaceState:function(n,i,a){n=n._reactInternals;var t=Qt(),e=mi(n),r=Lr(t,e);r.tag=1,r.payload=i,a!=null&&(r.callback=a),i=pi(n,r,e),i!==null&&(nr(i,n,e,t),ml(i,n,e))},enqueueForceUpdate:function(n,i){n=n._reactInternals;var a=Qt(),t=mi(n),e=Lr(a,t);e.tag=2,i!=null&&(e.callback=i),i=pi(n,e,t),i!==null&&(nr(i,n,t,a),ml(i,n,t))}};function jh(n,i,a,t,e,r,o){return n=n.stateNode,typeof n.shouldComponentUpdate=="function"?n.shouldComponentUpdate(t,r,o):i.prototype&&i.prototype.isPureReactComponent?!as(a,t)||!as(e,r):!0}function mg(n,i,a){var t=!1,e=Ai,r=i.contextType;return typeof r=="object"&&r!==null?r=kn(r):(e=un(i)?Zi:Ht.current,t=i.contextTypes,r=(t=t!=null)?Wa(n,e):Ai),i=new i(a,r),n.memoizedState=i.state!==null&&i.state!==void 0?i.state:null,i.updater=wu,n.stateNode=i,i._reactInternals=n,t&&(n=n.stateNode,n.__reactInternalMemoizedUnmaskedChildContext=e,n.__reactInternalMemoizedMaskedChildContext=r),i}function Yh(n,i,a,t){n=i.state,typeof i.componentWillReceiveProps=="function"&&i.componentWillReceiveProps(a,t),typeof i.UNSAFE_componentWillReceiveProps=="function"&&i.UNSAFE_componentWillReceiveProps(a,t),i.state!==n&&wu.enqueueReplaceState(i,i.state,null)}function Zc(n,i,a,t){var e=n.stateNode;e.props=a,e.state=n.memoizedState,e.refs=gg,p_(n);var r=i.contextType;typeof r=="object"&&r!==null?e.context=kn(r):(r=un(i)?Zi:Ht.current,e.context=Wa(n,r)),e.state=n.memoizedState,r=i.getDerivedStateFromProps,typeof r=="function"&&(Jc(n,i,r,a),e.state=n.memoizedState),typeof i.getDerivedStateFromProps=="function"||typeof e.getSnapshotBeforeUpdate=="function"||typeof e.UNSAFE_componentWillMount!="function"&&typeof e.componentWillMount!="function"||(i=e.state,typeof e.componentWillMount=="function"&&e.componentWillMount(),typeof e.UNSAFE_componentWillMount=="function"&&e.UNSAFE_componentWillMount(),i!==e.state&&wu.enqueueReplaceState(e,e.state,null),Wl(n,a,e,t),e.state=n.memoizedState),typeof e.componentDidMount=="function"&&(n.flags|=4194308)}function So(n,i,a){if(n=a.ref,n!==null&&typeof n!="function"&&typeof n!="object"){if(a._owner){if(a=a._owner,a){if(a.tag!==1)throw Error(G(309));var t=a.stateNode}if(!t)throw Error(G(147,n));var e=t,r=""+n;return i!==null&&i.ref!==null&&typeof i.ref=="function"&&i.ref._stringRef===r?i.ref:(i=function(o){var s=e.refs;s===gg&&(s=e.refs={}),o===null?delete s[r]:s[r]=o},i._stringRef=r,i)}if(typeof n!="string")throw Error(G(284));if(!a._owner)throw Error(G(290,n))}return n}function Qs(n,i){throw n=Object.prototype.toString.call(i),Error(G(31,n==="[object Object]"?"object with keys {"+Object.keys(i).join(", ")+"}":n))}function qh(n){var i=n._init;return i(n._payload)}function yg(n){function i(p,v){if(n){var m=p.deletions;m===null?(p.deletions=[v],p.flags|=16):m.push(v)}}function a(p,v){if(!n)return null;for(;v!==null;)i(p,v),v=v.sibling;return null}function t(p,v){for(p=new Map;v!==null;)v.key!==null?p.set(v.key,v):p.set(v.index,v),v=v.sibling;return p}function e(p,v){return p=yi(p,v),p.index=0,p.sibling=null,p}function r(p,v,m){return p.index=m,n?(m=p.alternate,m!==null?(m=m.index,m<v?(p.flags|=2,v):m):(p.flags|=2,v)):(p.flags|=1048576,v)}function o(p){return n&&p.alternate===null&&(p.flags|=2),p}function s(p,v,m,x){return v===null||v.tag!==6?(v=dc(m,p.mode,x),v.return=p,v):(v=e(v,m),v.return=p,v)}function l(p,v,m,x){var S=m.type;return S===wa?c(p,v,m.props.children,x,m.key):v!==null&&(v.elementType===S||typeof S=="object"&&S!==null&&S.$$typeof===ti&&qh(S)===v.type)?(x=e(v,m.props),x.ref=So(p,v,m),x.return=p,x):(x=Al(m.type,m.key,m.props,null,p.mode,x),x.ref=So(p,v,m),x.return=p,x)}function u(p,v,m,x){return v===null||v.tag!==4||v.stateNode.containerInfo!==m.containerInfo||v.stateNode.implementation!==m.implementation?(v=_c(m,p.mode,x),v.return=p,v):(v=e(v,m.children||[]),v.return=p,v)}function c(p,v,m,x,S){return v===null||v.tag!==7?(v=Qi(m,p.mode,x,S),v.return=p,v):(v=e(v,m),v.return=p,v)}function d(p,v,m){if(typeof v=="string"&&v!==""||typeof v=="number")return v=dc(""+v,p.mode,m),v.return=p,v;if(typeof v=="object"&&v!==null){switch(v.$$typeof){case Ns:return m=Al(v.type,v.key,v.props,null,p.mode,m),m.ref=So(p,null,v),m.return=p,m;case xa:return v=_c(v,p.mode,m),v.return=p,v;case ti:var x=v._init;return d(p,x(v._payload),m)}if(Fo(v)||go(v))return v=Qi(v,p.mode,m,null),v.return=p,v;Qs(p,v)}return null}function _(p,v,m,x){var S=v!==null?v.key:null;if(typeof m=="string"&&m!==""||typeof m=="number")return S!==null?null:s(p,v,""+m,x);if(typeof m=="object"&&m!==null){switch(m.$$typeof){case Ns:return m.key===S?l(p,v,m,x):null;case xa:return m.key===S?u(p,v,m,x):null;case ti:return S=m._init,_(p,v,S(m._payload),x)}if(Fo(m)||go(m))return S!==null?null:c(p,v,m,x,null);Qs(p,m)}return null}function h(p,v,m,x,S){if(typeof x=="string"&&x!==""||typeof x=="number")return p=p.get(m)||null,s(v,p,""+x,S);if(typeof x=="object"&&x!==null){switch(x.$$typeof){case Ns:return p=p.get(x.key===null?m:x.key)||null,l(v,p,x,S);case xa:return p=p.get(x.key===null?m:x.key)||null,u(v,p,x,S);case ti:var C=x._init;return h(p,v,m,C(x._payload),S)}if(Fo(x)||go(x))return p=p.get(m)||null,c(v,p,x,S,null);Qs(v,x)}return null}function f(p,v,m,x){for(var S=null,C=null,A=v,T=v=0,E=null;A!==null&&T<m.length;T++){A.index>T?(E=A,A=null):E=A.sibling;var P=_(p,A,m[T],x);if(P===null){A===null&&(A=E);break}n&&A&&P.alternate===null&&i(p,A),v=r(P,v,T),C===null?S=P:C.sibling=P,C=P,A=E}if(T===m.length)return a(p,A),Ve&&Oi(p,T),S;if(A===null){for(;T<m.length;T++)A=d(p,m[T],x),A!==null&&(v=r(A,v,T),C===null?S=A:C.sibling=A,C=A);return Ve&&Oi(p,T),S}for(A=t(p,A);T<m.length;T++)E=h(A,p,T,m[T],x),E!==null&&(n&&E.alternate!==null&&A.delete(E.key===null?T:E.key),v=r(E,v,T),C===null?S=E:C.sibling=E,C=E);return n&&A.forEach(function(b){return i(p,b)}),Ve&&Oi(p,T),S}function g(p,v,m,x){var S=go(m);if(typeof S!="function")throw Error(G(150));if(m=S.call(m),m==null)throw Error(G(151));for(var C=S=null,A=v,T=v=0,E=null,P=m.next();A!==null&&!P.done;T++,P=m.next()){A.index>T?(E=A,A=null):E=A.sibling;var b=_(p,A,P.value,x);if(b===null){A===null&&(A=E);break}n&&A&&b.alternate===null&&i(p,A),v=r(b,v,T),C===null?S=b:C.sibling=b,C=b,A=E}if(P.done)return a(p,A),Ve&&Oi(p,T),S;if(A===null){for(;!P.done;T++,P=m.next())P=d(p,P.value,x),P!==null&&(v=r(P,v,T),C===null?S=P:C.sibling=P,C=P);return Ve&&Oi(p,T),S}for(A=t(p,A);!P.done;T++,P=m.next())P=h(A,p,T,P.value,x),P!==null&&(n&&P.alternate!==null&&A.delete(P.key===null?T:P.key),v=r(P,v,T),C===null?S=P:C.sibling=P,C=P);return n&&A.forEach(function(M){return i(p,M)}),Ve&&Oi(p,T),S}function y(p,v,m,x){if(typeof m=="object"&&m!==null&&m.type===wa&&m.key===null&&(m=m.props.children),typeof m=="object"&&m!==null){switch(m.$$typeof){case Ns:e:{for(var S=m.key,C=v;C!==null;){if(C.key===S){if(S=m.type,S===wa){if(C.tag===7){a(p,C.sibling),v=e(C,m.props.children),v.return=p,p=v;break e}}else if(C.elementType===S||typeof S=="object"&&S!==null&&S.$$typeof===ti&&qh(S)===C.type){a(p,C.sibling),v=e(C,m.props),v.ref=So(p,C,m),v.return=p,p=v;break e}a(p,C);break}else i(p,C);C=C.sibling}m.type===wa?(v=Qi(m.props.children,p.mode,x,m.key),v.return=p,p=v):(x=Al(m.type,m.key,m.props,null,p.mode,x),x.ref=So(p,v,m),x.return=p,p=x)}return o(p);case xa:e:{for(C=m.key;v!==null;){if(v.key===C)if(v.tag===4&&v.stateNode.containerInfo===m.containerInfo&&v.stateNode.implementation===m.implementation){a(p,v.sibling),v=e(v,m.children||[]),v.return=p,p=v;break e}else{a(p,v);break}else i(p,v);v=v.sibling}v=_c(m,p.mode,x),v.return=p,p=v}return o(p);case ti:return C=m._init,y(p,v,C(m._payload),x)}if(Fo(m))return f(p,v,m,x);if(go(m))return g(p,v,m,x);Qs(p,m)}return typeof m=="string"&&m!==""||typeof m=="number"?(m=""+m,v!==null&&v.tag===6?(a(p,v.sibling),v=e(v,m),v.return=p,p=v):(a(p,v),v=dc(m,p.mode,x),v.return=p,p=v),o(p)):a(p,v)}return y}var ja=yg(!0),xg=yg(!1),Rs={},mr=bi(Rs),us=bi(Rs),cs=bi(Rs);function Hi(n){if(n===Rs)throw Error(G(174));return n}function g_(n,i){switch(Fe(cs,i),Fe(us,n),Fe(mr,Rs),n=i.nodeType,n){case 9:case 11:i=(i=i.documentElement)?i.namespaceURI:Fc(null,"");break;default:n=n===8?i.parentNode:i,i=n.namespaceURI||null,n=n.tagName,i=Fc(i,n)}ze(mr),Fe(mr,i)}function Ya(){ze(mr),ze(us),ze(cs)}function wg(n){Hi(cs.current);var i=Hi(mr.current),a=Fc(i,n.type);i!==a&&(Fe(us,n),Fe(mr,a))}function m_(n){us.current===n&&(ze(mr),ze(us))}var Ue=bi(0);function Xl(n){for(var i=n;i!==null;){if(i.tag===13){var a=i.memoizedState;if(a!==null&&(a=a.dehydrated,a===null||a.data==="$?"||a.data==="$!"))return i}else if(i.tag===19&&i.memoizedProps.revealOrder!==void 0){if(i.flags&128)return i}else if(i.child!==null){i.child.return=i,i=i.child;continue}if(i===n)break;for(;i.sibling===null;){if(i.return===null||i.return===n)return null;i=i.return}i.sibling.return=i.return,i=i.sibling}return null}var ac=[];function y_(){for(var n=0;n<ac.length;n++)ac[n]._workInProgressVersionPrimary=null;ac.length=0}var yl=Wr.ReactCurrentDispatcher,oc=Wr.ReactCurrentBatchConfig,ta=0,Ge=null,_t=null,vt=null,jl=!1,ko=!1,ds=0,i1=0;function Dt(){throw Error(G(321))}function x_(n,i){if(i===null)return!1;for(var a=0;a<i.length&&a<n.length;a++)if(!rr(n[a],i[a]))return!1;return!0}function w_(n,i,a,t,e,r){if(ta=r,Ge=i,i.memoizedState=null,i.updateQueue=null,i.lanes=0,yl.current=n===null||n.memoizedState===null?l1:u1,n=a(t,e),ko){r=0;do{if(ko=!1,ds=0,25<=r)throw Error(G(301));r+=1,vt=_t=null,i.updateQueue=null,yl.current=c1,n=a(t,e)}while(ko)}if(yl.current=Yl,i=_t!==null&&_t.next!==null,ta=0,vt=_t=Ge=null,jl=!1,i)throw Error(G(300));return n}function S_(){var n=ds!==0;return ds=0,n}function hr(){var n={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return vt===null?Ge.memoizedState=vt=n:vt=vt.next=n,vt}function Hn(){if(_t===null){var n=Ge.alternate;n=n!==null?n.memoizedState:null}else n=_t.next;var i=vt===null?Ge.memoizedState:vt.next;if(i!==null)vt=i,_t=n;else{if(n===null)throw Error(G(310));_t=n,n={memoizedState:_t.memoizedState,baseState:_t.baseState,baseQueue:_t.baseQueue,queue:_t.queue,next:null},vt===null?Ge.memoizedState=vt=n:vt=vt.next=n}return vt}function _s(n,i){return typeof i=="function"?i(n):i}function sc(n){var i=Hn(),a=i.queue;if(a===null)throw Error(G(311));a.lastRenderedReducer=n;var t=_t,e=t.baseQueue,r=a.pending;if(r!==null){if(e!==null){var o=e.next;e.next=r.next,r.next=o}t.baseQueue=e=r,a.pending=null}if(e!==null){r=e.next,t=t.baseState;var s=o=null,l=null,u=r;do{var c=u.lane;if((ta&c)===c)l!==null&&(l=l.next={lane:0,action:u.action,hasEagerState:u.hasEagerState,eagerState:u.eagerState,next:null}),t=u.hasEagerState?u.eagerState:n(t,u.action);else{var d={lane:c,action:u.action,hasEagerState:u.hasEagerState,eagerState:u.eagerState,next:null};l===null?(s=l=d,o=t):l=l.next=d,Ge.lanes|=c,na|=c}u=u.next}while(u!==null&&u!==r);l===null?o=t:l.next=s,rr(t,i.memoizedState)||(on=!0),i.memoizedState=t,i.baseState=o,i.baseQueue=l,a.lastRenderedState=t}if(n=a.interleaved,n!==null){e=n;do r=e.lane,Ge.lanes|=r,na|=r,e=e.next;while(e!==n)}else e===null&&(a.lanes=0);return[i.memoizedState,a.dispatch]}function lc(n){var i=Hn(),a=i.queue;if(a===null)throw Error(G(311));a.lastRenderedReducer=n;var t=a.dispatch,e=a.pending,r=i.memoizedState;if(e!==null){a.pending=null;var o=e=e.next;do r=n(r,o.action),o=o.next;while(o!==e);rr(r,i.memoizedState)||(on=!0),i.memoizedState=r,i.baseQueue===null&&(i.baseState=r),a.lastRenderedState=r}return[r,t]}function Sg(){}function Cg(n,i){var a=Ge,t=Hn(),e=i(),r=!rr(t.memoizedState,e);if(r&&(t.memoizedState=e,on=!0),t=t.queue,C_(Eg.bind(null,a,t,n),[n]),t.getSnapshot!==i||r||vt!==null&&vt.memoizedState.tag&1){if(a.flags|=2048,hs(9,Tg.bind(null,a,t,e,i),void 0,null),gt===null)throw Error(G(349));ta&30||Ag(a,i,e)}return e}function Ag(n,i,a){n.flags|=16384,n={getSnapshot:i,value:a},i=Ge.updateQueue,i===null?(i={lastEffect:null,stores:null},Ge.updateQueue=i,i.stores=[n]):(a=i.stores,a===null?i.stores=[n]:a.push(n))}function Tg(n,i,a,t){i.value=a,i.getSnapshot=t,Pg(i)&&bg(n)}function Eg(n,i,a){return a(function(){Pg(i)&&bg(n)})}function Pg(n){var i=n.getSnapshot;n=n.value;try{var a=i();return!rr(n,a)}catch{return!0}}function bg(n){var i=Vr(n,1);i!==null&&nr(i,n,1,-1)}function Qh(n){var i=hr();return typeof n=="function"&&(n=n()),i.memoizedState=i.baseState=n,n={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:_s,lastRenderedState:n},i.queue=n,n=n.dispatch=s1.bind(null,Ge,n),[i.memoizedState,n]}function hs(n,i,a,t){return n={tag:n,create:i,destroy:a,deps:t,next:null},i=Ge.updateQueue,i===null?(i={lastEffect:null,stores:null},Ge.updateQueue=i,i.lastEffect=n.next=n):(a=i.lastEffect,a===null?i.lastEffect=n.next=n:(t=a.next,a.next=n,n.next=t,i.lastEffect=n)),n}function Mg(){return Hn().memoizedState}function xl(n,i,a,t){var e=hr();Ge.flags|=n,e.memoizedState=hs(1|i,a,void 0,t===void 0?null:t)}function Su(n,i,a,t){var e=Hn();t=t===void 0?null:t;var r=void 0;if(_t!==null){var o=_t.memoizedState;if(r=o.destroy,t!==null&&x_(t,o.deps)){e.memoizedState=hs(i,a,r,t);return}}Ge.flags|=n,e.memoizedState=hs(1|i,a,r,t)}function $h(n,i){return xl(8390656,8,n,i)}function C_(n,i){return Su(2048,8,n,i)}function Rg(n,i){return Su(4,2,n,i)}function Fg(n,i){return Su(4,4,n,i)}function Dg(n,i){if(typeof i=="function")return n=n(),i(n),function(){i(null)};if(i!=null)return n=n(),i.current=n,function(){i.current=null}}function Bg(n,i,a){return a=a!=null?a.concat([n]):null,Su(4,4,Dg.bind(null,i,n),a)}function A_(){}function Ig(n,i){var a=Hn();i=i===void 0?null:i;var t=a.memoizedState;return t!==null&&i!==null&&x_(i,t[1])?t[0]:(a.memoizedState=[n,i],n)}function Lg(n,i){var a=Hn();i=i===void 0?null:i;var t=a.memoizedState;return t!==null&&i!==null&&x_(i,t[1])?t[0]:(n=n(),a.memoizedState=[n,i],n)}function zg(n,i,a){return ta&21?(rr(a,i)||(a=Vp(),Ge.lanes|=a,na|=a,n.baseState=!0),i):(n.baseState&&(n.baseState=!1,on=!0),n.memoizedState=a)}function a1(n,i){var a=be;be=a!==0&&4>a?a:4,n(!0);var t=oc.transition;oc.transition={};try{n(!1),i()}finally{be=a,oc.transition=t}}function Og(){return Hn().memoizedState}function o1(n,i,a){var t=mi(n);if(a={lane:t,action:a,hasEagerState:!1,eagerState:null,next:null},Ng(n))Vg(i,a);else if(a=vg(n,i,a,t),a!==null){var e=Qt();nr(a,n,t,e),Ug(a,i,t)}}function s1(n,i,a){var t=mi(n),e={lane:t,action:a,hasEagerState:!1,eagerState:null,next:null};if(Ng(n))Vg(i,e);else{var r=n.alternate;if(n.lanes===0&&(r===null||r.lanes===0)&&(r=i.lastRenderedReducer,r!==null))try{var o=i.lastRenderedState,s=r(o,a);if(e.hasEagerState=!0,e.eagerState=s,rr(s,o)){var l=i.interleaved;l===null?(e.next=e,v_(i)):(e.next=l.next,l.next=e),i.interleaved=e;return}}catch{}finally{}a=vg(n,i,e,t),a!==null&&(e=Qt(),nr(a,n,t,e),Ug(a,i,t))}}function Ng(n){var i=n.alternate;return n===Ge||i!==null&&i===Ge}function Vg(n,i){ko=jl=!0;var a=n.pending;a===null?i.next=i:(i.next=a.next,a.next=i),n.pending=i}function Ug(n,i,a){if(a&4194240){var t=i.lanes;t&=n.pendingLanes,a|=t,i.lanes=a,t_(n,a)}}var Yl={readContext:kn,useCallback:Dt,useContext:Dt,useEffect:Dt,useImperativeHandle:Dt,useInsertionEffect:Dt,useLayoutEffect:Dt,useMemo:Dt,useReducer:Dt,useRef:Dt,useState:Dt,useDebugValue:Dt,useDeferredValue:Dt,useTransition:Dt,useMutableSource:Dt,useSyncExternalStore:Dt,useId:Dt,unstable_isNewReconciler:!1},l1={readContext:kn,useCallback:function(n,i){return hr().memoizedState=[n,i===void 0?null:i],n},useContext:kn,useEffect:$h,useImperativeHandle:function(n,i,a){return a=a!=null?a.concat([n]):null,xl(4194308,4,Dg.bind(null,i,n),a)},useLayoutEffect:function(n,i){return xl(4194308,4,n,i)},useInsertionEffect:function(n,i){return xl(4,2,n,i)},useMemo:function(n,i){var a=hr();return i=i===void 0?null:i,n=n(),a.memoizedState=[n,i],n},useReducer:function(n,i,a){var t=hr();return i=a!==void 0?a(i):i,t.memoizedState=t.baseState=i,n={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:n,lastRenderedState:i},t.queue=n,n=n.dispatch=o1.bind(null,Ge,n),[t.memoizedState,n]},useRef:function(n){var i=hr();return n={current:n},i.memoizedState=n},useState:Qh,useDebugValue:A_,useDeferredValue:function(n){return hr().memoizedState=n},useTransition:function(){var n=Qh(!1),i=n[0];return n=a1.bind(null,n[1]),hr().memoizedState=n,[i,n]},useMutableSource:function(){},useSyncExternalStore:function(n,i,a){var t=Ge,e=hr();if(Ve){if(a===void 0)throw Error(G(407));a=a()}else{if(a=i(),gt===null)throw Error(G(349));ta&30||Ag(t,i,a)}e.memoizedState=a;var r={value:a,getSnapshot:i};return e.queue=r,$h(Eg.bind(null,t,r,n),[n]),t.flags|=2048,hs(9,Tg.bind(null,t,r,a,i),void 0,null),a},useId:function(){var n=hr(),i=gt.identifierPrefix;if(Ve){var a=Rr,t=Mr;a=(t&~(1<<32-tr(t)-1)).toString(32)+a,i=":"+i+"R"+a,a=ds++,0<a&&(i+="H"+a.toString(32)),i+=":"}else a=i1++,i=":"+i+"r"+a.toString(32)+":";return n.memoizedState=i},unstable_isNewReconciler:!1},u1={readContext:kn,useCallback:Ig,useContext:kn,useEffect:C_,useImperativeHandle:Bg,useInsertionEffect:Rg,useLayoutEffect:Fg,useMemo:Lg,useReducer:sc,useRef:Mg,useState:function(){return sc(_s)},useDebugValue:A_,useDeferredValue:function(n){var i=Hn();return zg(i,_t.memoizedState,n)},useTransition:function(){var n=sc(_s)[0],i=Hn().memoizedState;return[n,i]},useMutableSource:Sg,useSyncExternalStore:Cg,useId:Og,unstable_isNewReconciler:!1},c1={readContext:kn,useCallback:Ig,useContext:kn,useEffect:C_,useImperativeHandle:Bg,useInsertionEffect:Rg,useLayoutEffect:Fg,useMemo:Lg,useReducer:lc,useRef:Mg,useState:function(){return lc(_s)},useDebugValue:A_,useDeferredValue:function(n){var i=Hn();return _t===null?i.memoizedState=n:zg(i,_t.memoizedState,n)},useTransition:function(){var n=lc(_s)[0],i=Hn().memoizedState;return[n,i]},useMutableSource:Sg,useSyncExternalStore:Cg,useId:Og,unstable_isNewReconciler:!1};function qa(n,i){try{var a="",t=i;do a+=Nm(t),t=t.return;while(t);var e=a}catch(r){e=`
Error generating stack: `+r.message+`
`+r.stack}return{value:n,source:i,stack:e,digest:null}}function uc(n,i,a){return{value:n,source:null,stack:a??null,digest:i??null}}function ed(n,i){try{console.error(i.value)}catch(a){setTimeout(function(){throw a})}}var d1=typeof WeakMap=="function"?WeakMap:Map;function kg(n,i,a){a=Lr(-1,a),a.tag=3,a.payload={element:null};var t=i.value;return a.callback=function(){Ql||(Ql=!0,cd=t),ed(n,i)},a}function Hg(n,i,a){a=Lr(-1,a),a.tag=3;var t=n.type.getDerivedStateFromError;if(typeof t=="function"){var e=i.value;a.payload=function(){return t(e)},a.callback=function(){ed(n,i)}}var r=n.stateNode;return r!==null&&typeof r.componentDidCatch=="function"&&(a.callback=function(){ed(n,i),typeof t!="function"&&(gi===null?gi=new Set([this]):gi.add(this));var o=i.stack;this.componentDidCatch(i.value,{componentStack:o!==null?o:""})}),a}function Kh(n,i,a){var t=n.pingCache;if(t===null){t=n.pingCache=new d1;var e=new Set;t.set(i,e)}else e=t.get(i),e===void 0&&(e=new Set,t.set(i,e));e.has(a)||(e.add(a),n=T1.bind(null,n,i,a),i.then(n,n))}function Jh(n){do{var i;if((i=n.tag===13)&&(i=n.memoizedState,i=i!==null?i.dehydrated!==null:!0),i)return n;n=n.return}while(n!==null);return null}function Zh(n,i,a,t,e){return n.mode&1?(n.flags|=65536,n.lanes=e,n):(n===i?n.flags|=65536:(n.flags|=128,a.flags|=131072,a.flags&=-52805,a.tag===1&&(a.alternate===null?a.tag=17:(i=Lr(-1,1),i.tag=2,pi(a,i,1))),a.lanes|=1),n)}var _1=Wr.ReactCurrentOwner,on=!1;function Yt(n,i,a,t){i.child=n===null?xg(i,null,a,t):ja(i,n.child,a,t)}function ef(n,i,a,t,e){a=a.render;var r=i.ref;return Va(i,e),t=w_(n,i,a,t,r,e),a=S_(),n!==null&&!on?(i.updateQueue=n.updateQueue,i.flags&=-2053,n.lanes&=~e,Ur(n,i,e)):(Ve&&a&&u_(i),i.flags|=1,Yt(n,i,t,e),i.child)}function tf(n,i,a,t,e){if(n===null){var r=a.type;return typeof r=="function"&&!D_(r)&&r.defaultProps===void 0&&a.compare===null&&a.defaultProps===void 0?(i.tag=15,i.type=r,Gg(n,i,r,t,e)):(n=Al(a.type,null,t,i,i.mode,e),n.ref=i.ref,n.return=i,i.child=n)}if(r=n.child,!(n.lanes&e)){var o=r.memoizedProps;if(a=a.compare,a=a!==null?a:as,a(o,t)&&n.ref===i.ref)return Ur(n,i,e)}return i.flags|=1,n=yi(r,t),n.ref=i.ref,n.return=i,i.child=n}function Gg(n,i,a,t,e){if(n!==null){var r=n.memoizedProps;if(as(r,t)&&n.ref===i.ref)if(on=!1,i.pendingProps=t=r,(n.lanes&e)!==0)n.flags&131072&&(on=!0);else return i.lanes=n.lanes,Ur(n,i,e)}return td(n,i,a,t,e)}function Wg(n,i,a){var t=i.pendingProps,e=t.children,r=n!==null?n.memoizedState:null;if(t.mode==="hidden")if(!(i.mode&1))i.memoizedState={baseLanes:0,cachePool:null,transitions:null},Fe(Fa,gn),gn|=a;else{if(!(a&1073741824))return n=r!==null?r.baseLanes|a:a,i.lanes=i.childLanes=1073741824,i.memoizedState={baseLanes:n,cachePool:null,transitions:null},i.updateQueue=null,Fe(Fa,gn),gn|=n,null;i.memoizedState={baseLanes:0,cachePool:null,transitions:null},t=r!==null?r.baseLanes:a,Fe(Fa,gn),gn|=t}else r!==null?(t=r.baseLanes|a,i.memoizedState=null):t=a,Fe(Fa,gn),gn|=t;return Yt(n,i,e,a),i.child}function Xg(n,i){var a=i.ref;(n===null&&a!==null||n!==null&&n.ref!==a)&&(i.flags|=512,i.flags|=2097152)}function td(n,i,a,t,e){var r=un(a)?Zi:Ht.current;return r=Wa(i,r),Va(i,e),a=w_(n,i,a,t,r,e),t=S_(),n!==null&&!on?(i.updateQueue=n.updateQueue,i.flags&=-2053,n.lanes&=~e,Ur(n,i,e)):(Ve&&t&&u_(i),i.flags|=1,Yt(n,i,a,e),i.child)}function nf(n,i,a,t,e){if(un(a)){var r=!0;Vl(i)}else r=!1;if(Va(i,e),i.stateNode===null)wl(n,i),mg(i,a,t),Zc(i,a,t,e),t=!0;else if(n===null){var o=i.stateNode,s=i.memoizedProps;o.props=s;var l=o.context,u=a.contextType;typeof u=="object"&&u!==null?u=kn(u):(u=un(a)?Zi:Ht.current,u=Wa(i,u));var c=a.getDerivedStateFromProps,d=typeof c=="function"||typeof o.getSnapshotBeforeUpdate=="function";d||typeof o.UNSAFE_componentWillReceiveProps!="function"&&typeof o.componentWillReceiveProps!="function"||(s!==t||l!==u)&&Yh(i,o,t,u),ni=!1;var _=i.memoizedState;o.state=_,Wl(i,t,o,e),l=i.memoizedState,s!==t||_!==l||ln.current||ni?(typeof c=="function"&&(Jc(i,a,c,t),l=i.memoizedState),(s=ni||jh(i,a,s,t,_,l,u))?(d||typeof o.UNSAFE_componentWillMount!="function"&&typeof o.componentWillMount!="function"||(typeof o.componentWillMount=="function"&&o.componentWillMount(),typeof o.UNSAFE_componentWillMount=="function"&&o.UNSAFE_componentWillMount()),typeof o.componentDidMount=="function"&&(i.flags|=4194308)):(typeof o.componentDidMount=="function"&&(i.flags|=4194308),i.memoizedProps=t,i.memoizedState=l),o.props=t,o.state=l,o.context=u,t=s):(typeof o.componentDidMount=="function"&&(i.flags|=4194308),t=!1)}else{o=i.stateNode,pg(n,i),s=i.memoizedProps,u=i.type===i.elementType?s:$n(i.type,s),o.props=u,d=i.pendingProps,_=o.context,l=a.contextType,typeof l=="object"&&l!==null?l=kn(l):(l=un(a)?Zi:Ht.current,l=Wa(i,l));var h=a.getDerivedStateFromProps;(c=typeof h=="function"||typeof o.getSnapshotBeforeUpdate=="function")||typeof o.UNSAFE_componentWillReceiveProps!="function"&&typeof o.componentWillReceiveProps!="function"||(s!==d||_!==l)&&Yh(i,o,t,l),ni=!1,_=i.memoizedState,o.state=_,Wl(i,t,o,e);var f=i.memoizedState;s!==d||_!==f||ln.current||ni?(typeof h=="function"&&(Jc(i,a,h,t),f=i.memoizedState),(u=ni||jh(i,a,u,t,_,f,l)||!1)?(c||typeof o.UNSAFE_componentWillUpdate!="function"&&typeof o.componentWillUpdate!="function"||(typeof o.componentWillUpdate=="function"&&o.componentWillUpdate(t,f,l),typeof o.UNSAFE_componentWillUpdate=="function"&&o.UNSAFE_componentWillUpdate(t,f,l)),typeof o.componentDidUpdate=="function"&&(i.flags|=4),typeof o.getSnapshotBeforeUpdate=="function"&&(i.flags|=1024)):(typeof o.componentDidUpdate!="function"||s===n.memoizedProps&&_===n.memoizedState||(i.flags|=4),typeof o.getSnapshotBeforeUpdate!="function"||s===n.memoizedProps&&_===n.memoizedState||(i.flags|=1024),i.memoizedProps=t,i.memoizedState=f),o.props=t,o.state=f,o.context=l,t=u):(typeof o.componentDidUpdate!="function"||s===n.memoizedProps&&_===n.memoizedState||(i.flags|=4),typeof o.getSnapshotBeforeUpdate!="function"||s===n.memoizedProps&&_===n.memoizedState||(i.flags|=1024),t=!1)}return nd(n,i,a,t,r,e)}function nd(n,i,a,t,e,r){Xg(n,i);var o=(i.flags&128)!==0;if(!t&&!o)return e&&kh(i,a,!1),Ur(n,i,r);t=i.stateNode,_1.current=i;var s=o&&typeof a.getDerivedStateFromError!="function"?null:t.render();return i.flags|=1,n!==null&&o?(i.child=ja(i,n.child,null,r),i.child=ja(i,null,s,r)):Yt(n,i,s,r),i.memoizedState=t.state,e&&kh(i,a,!0),i.child}function jg(n){var i=n.stateNode;i.pendingContext?Uh(n,i.pendingContext,i.pendingContext!==i.context):i.context&&Uh(n,i.context,!1),g_(n,i.containerInfo)}function rf(n,i,a,t,e){return Xa(),d_(e),i.flags|=256,Yt(n,i,a,t),i.child}var rd={dehydrated:null,treeContext:null,retryLane:0};function id(n){return{baseLanes:n,cachePool:null,transitions:null}}function Yg(n,i,a){var t=i.pendingProps,e=Ue.current,r=!1,o=(i.flags&128)!==0,s;if((s=o)||(s=n!==null&&n.memoizedState===null?!1:(e&2)!==0),s?(r=!0,i.flags&=-129):(n===null||n.memoizedState!==null)&&(e|=1),Fe(Ue,e&1),n===null)return $c(i),n=i.memoizedState,n!==null&&(n=n.dehydrated,n!==null)?(i.mode&1?n.data==="$!"?i.lanes=8:i.lanes=1073741824:i.lanes=1,null):(o=t.children,n=t.fallback,r?(t=i.mode,r=i.child,o={mode:"hidden",children:o},!(t&1)&&r!==null?(r.childLanes=0,r.pendingProps=o):r=Tu(o,t,0,null),n=Qi(n,t,a,null),r.return=i,n.return=i,r.sibling=n,i.child=r,i.child.memoizedState=id(a),i.memoizedState=rd,n):T_(i,o));if(e=n.memoizedState,e!==null&&(s=e.dehydrated,s!==null))return h1(n,i,o,t,s,e,a);if(r){r=t.fallback,o=i.mode,e=n.child,s=e.sibling;var l={mode:"hidden",children:t.children};return!(o&1)&&i.child!==e?(t=i.child,t.childLanes=0,t.pendingProps=l,i.deletions=null):(t=yi(e,l),t.subtreeFlags=e.subtreeFlags&14680064),s!==null?r=yi(s,r):(r=Qi(r,o,a,null),r.flags|=2),r.return=i,t.return=i,t.sibling=r,i.child=t,t=r,r=i.child,o=n.child.memoizedState,o=o===null?id(a):{baseLanes:o.baseLanes|a,cachePool:null,transitions:o.transitions},r.memoizedState=o,r.childLanes=n.childLanes&~a,i.memoizedState=rd,t}return r=n.child,n=r.sibling,t=yi(r,{mode:"visible",children:t.children}),!(i.mode&1)&&(t.lanes=a),t.return=i,t.sibling=null,n!==null&&(a=i.deletions,a===null?(i.deletions=[n],i.flags|=16):a.push(n)),i.child=t,i.memoizedState=null,t}function T_(n,i){return i=Tu({mode:"visible",children:i},n.mode,0,null),i.return=n,n.child=i}function $s(n,i,a,t){return t!==null&&d_(t),ja(i,n.child,null,a),n=T_(i,i.pendingProps.children),n.flags|=2,i.memoizedState=null,n}function h1(n,i,a,t,e,r,o){if(a)return i.flags&256?(i.flags&=-257,t=uc(Error(G(422))),$s(n,i,o,t)):i.memoizedState!==null?(i.child=n.child,i.flags|=128,null):(r=t.fallback,e=i.mode,t=Tu({mode:"visible",children:t.children},e,0,null),r=Qi(r,e,o,null),r.flags|=2,t.return=i,r.return=i,t.sibling=r,i.child=t,i.mode&1&&ja(i,n.child,null,o),i.child.memoizedState=id(o),i.memoizedState=rd,r);if(!(i.mode&1))return $s(n,i,o,null);if(e.data==="$!"){if(t=e.nextSibling&&e.nextSibling.dataset,t)var s=t.dgst;return t=s,r=Error(G(419)),t=uc(r,t,void 0),$s(n,i,o,t)}if(s=(o&n.childLanes)!==0,on||s){if(t=gt,t!==null){switch(o&-o){case 4:e=2;break;case 16:e=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:e=32;break;case 536870912:e=268435456;break;default:e=0}e=e&(t.suspendedLanes|o)?0:e,e!==0&&e!==r.retryLane&&(r.retryLane=e,Vr(n,e),nr(t,n,e,-1))}return F_(),t=uc(Error(G(421))),$s(n,i,o,t)}return e.data==="$?"?(i.flags|=128,i.child=n.child,i=E1.bind(null,n),e._reactRetry=i,null):(n=r.treeContext,wn=vi(e.nextSibling),Sn=i,Ve=!0,Jn=null,n!==null&&(Ln[zn++]=Mr,Ln[zn++]=Rr,Ln[zn++]=ea,Mr=n.id,Rr=n.overflow,ea=i),i=T_(i,t.children),i.flags|=4096,i)}function af(n,i,a){n.lanes|=i;var t=n.alternate;t!==null&&(t.lanes|=i),Kc(n.return,i,a)}function cc(n,i,a,t,e){var r=n.memoizedState;r===null?n.memoizedState={isBackwards:i,rendering:null,renderingStartTime:0,last:t,tail:a,tailMode:e}:(r.isBackwards=i,r.rendering=null,r.renderingStartTime=0,r.last=t,r.tail=a,r.tailMode=e)}function qg(n,i,a){var t=i.pendingProps,e=t.revealOrder,r=t.tail;if(Yt(n,i,t.children,a),t=Ue.current,t&2)t=t&1|2,i.flags|=128;else{if(n!==null&&n.flags&128)e:for(n=i.child;n!==null;){if(n.tag===13)n.memoizedState!==null&&af(n,a,i);else if(n.tag===19)af(n,a,i);else if(n.child!==null){n.child.return=n,n=n.child;continue}if(n===i)break e;for(;n.sibling===null;){if(n.return===null||n.return===i)break e;n=n.return}n.sibling.return=n.return,n=n.sibling}t&=1}if(Fe(Ue,t),!(i.mode&1))i.memoizedState=null;else switch(e){case"forwards":for(a=i.child,e=null;a!==null;)n=a.alternate,n!==null&&Xl(n)===null&&(e=a),a=a.sibling;a=e,a===null?(e=i.child,i.child=null):(e=a.sibling,a.sibling=null),cc(i,!1,e,a,r);break;case"backwards":for(a=null,e=i.child,i.child=null;e!==null;){if(n=e.alternate,n!==null&&Xl(n)===null){i.child=e;break}n=e.sibling,e.sibling=a,a=e,e=n}cc(i,!0,a,null,r);break;case"together":cc(i,!1,null,null,void 0);break;default:i.memoizedState=null}return i.child}function wl(n,i){!(i.mode&1)&&n!==null&&(n.alternate=null,i.alternate=null,i.flags|=2)}function Ur(n,i,a){if(n!==null&&(i.dependencies=n.dependencies),na|=i.lanes,!(a&i.childLanes))return null;if(n!==null&&i.child!==n.child)throw Error(G(153));if(i.child!==null){for(n=i.child,a=yi(n,n.pendingProps),i.child=a,a.return=i;n.sibling!==null;)n=n.sibling,a=a.sibling=yi(n,n.pendingProps),a.return=i;a.sibling=null}return i.child}function f1(n,i,a){switch(i.tag){case 3:jg(i),Xa();break;case 5:wg(i);break;case 1:un(i.type)&&Vl(i);break;case 4:g_(i,i.stateNode.containerInfo);break;case 10:var t=i.type._context,e=i.memoizedProps.value;Fe(Hl,t._currentValue),t._currentValue=e;break;case 13:if(t=i.memoizedState,t!==null)return t.dehydrated!==null?(Fe(Ue,Ue.current&1),i.flags|=128,null):a&i.child.childLanes?Yg(n,i,a):(Fe(Ue,Ue.current&1),n=Ur(n,i,a),n!==null?n.sibling:null);Fe(Ue,Ue.current&1);break;case 19:if(t=(a&i.childLanes)!==0,n.flags&128){if(t)return qg(n,i,a);i.flags|=128}if(e=i.memoizedState,e!==null&&(e.rendering=null,e.tail=null,e.lastEffect=null),Fe(Ue,Ue.current),t)break;return null;case 22:case 23:return i.lanes=0,Wg(n,i,a)}return Ur(n,i,a)}var Qg,ad,$g,Kg;Qg=function(n,i){for(var a=i.child;a!==null;){if(a.tag===5||a.tag===6)n.appendChild(a.stateNode);else if(a.tag!==4&&a.child!==null){a.child.return=a,a=a.child;continue}if(a===i)break;for(;a.sibling===null;){if(a.return===null||a.return===i)return;a=a.return}a.sibling.return=a.return,a=a.sibling}};ad=function(){};$g=function(n,i,a,t){var e=n.memoizedProps;if(e!==t){n=i.stateNode,Hi(mr.current);var r=null;switch(a){case"input":e=Pc(n,e),t=Pc(n,t),r=[];break;case"select":e=We({},e,{value:void 0}),t=We({},t,{value:void 0}),r=[];break;case"textarea":e=Rc(n,e),t=Rc(n,t),r=[];break;default:typeof e.onClick!="function"&&typeof t.onClick=="function"&&(n.onclick=Ol)}Dc(a,t);var o;a=null;for(u in e)if(!t.hasOwnProperty(u)&&e.hasOwnProperty(u)&&e[u]!=null)if(u==="style"){var s=e[u];for(o in s)s.hasOwnProperty(o)&&(a||(a={}),a[o]="")}else u!=="dangerouslySetInnerHTML"&&u!=="children"&&u!=="suppressContentEditableWarning"&&u!=="suppressHydrationWarning"&&u!=="autoFocus"&&(Jo.hasOwnProperty(u)?r||(r=[]):(r=r||[]).push(u,null));for(u in t){var l=t[u];if(s=e!=null?e[u]:void 0,t.hasOwnProperty(u)&&l!==s&&(l!=null||s!=null))if(u==="style")if(s){for(o in s)!s.hasOwnProperty(o)||l&&l.hasOwnProperty(o)||(a||(a={}),a[o]="");for(o in l)l.hasOwnProperty(o)&&s[o]!==l[o]&&(a||(a={}),a[o]=l[o])}else a||(r||(r=[]),r.push(u,a)),a=l;else u==="dangerouslySetInnerHTML"?(l=l?l.__html:void 0,s=s?s.__html:void 0,l!=null&&s!==l&&(r=r||[]).push(u,l)):u==="children"?typeof l!="string"&&typeof l!="number"||(r=r||[]).push(u,""+l):u!=="suppressContentEditableWarning"&&u!=="suppressHydrationWarning"&&(Jo.hasOwnProperty(u)?(l!=null&&u==="onScroll"&&Ie("scroll",n),r||s===l||(r=[])):(r=r||[]).push(u,l))}a&&(r=r||[]).push("style",a);var u=r;(i.updateQueue=u)&&(i.flags|=4)}};Kg=function(n,i,a,t){a!==t&&(i.flags|=4)};function Co(n,i){if(!Ve)switch(n.tailMode){case"hidden":i=n.tail;for(var a=null;i!==null;)i.alternate!==null&&(a=i),i=i.sibling;a===null?n.tail=null:a.sibling=null;break;case"collapsed":a=n.tail;for(var t=null;a!==null;)a.alternate!==null&&(t=a),a=a.sibling;t===null?i||n.tail===null?n.tail=null:n.tail.sibling=null:t.sibling=null}}function Bt(n){var i=n.alternate!==null&&n.alternate.child===n.child,a=0,t=0;if(i)for(var e=n.child;e!==null;)a|=e.lanes|e.childLanes,t|=e.subtreeFlags&14680064,t|=e.flags&14680064,e.return=n,e=e.sibling;else for(e=n.child;e!==null;)a|=e.lanes|e.childLanes,t|=e.subtreeFlags,t|=e.flags,e.return=n,e=e.sibling;return n.subtreeFlags|=t,n.childLanes=a,i}function v1(n,i,a){var t=i.pendingProps;switch(c_(i),i.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return Bt(i),null;case 1:return un(i.type)&&Nl(),Bt(i),null;case 3:return t=i.stateNode,Ya(),ze(ln),ze(Ht),y_(),t.pendingContext&&(t.context=t.pendingContext,t.pendingContext=null),(n===null||n.child===null)&&(qs(i)?i.flags|=4:n===null||n.memoizedState.isDehydrated&&!(i.flags&256)||(i.flags|=1024,Jn!==null&&(hd(Jn),Jn=null))),ad(n,i),Bt(i),null;case 5:m_(i);var e=Hi(cs.current);if(a=i.type,n!==null&&i.stateNode!=null)$g(n,i,a,t,e),n.ref!==i.ref&&(i.flags|=512,i.flags|=2097152);else{if(!t){if(i.stateNode===null)throw Error(G(166));return Bt(i),null}if(n=Hi(mr.current),qs(i)){t=i.stateNode,a=i.type;var r=i.memoizedProps;switch(t[pr]=i,t[ls]=r,n=(i.mode&1)!==0,a){case"dialog":Ie("cancel",t),Ie("close",t);break;case"iframe":case"object":case"embed":Ie("load",t);break;case"video":case"audio":for(e=0;e<Bo.length;e++)Ie(Bo[e],t);break;case"source":Ie("error",t);break;case"img":case"image":case"link":Ie("error",t),Ie("load",t);break;case"details":Ie("toggle",t);break;case"input":hh(t,r),Ie("invalid",t);break;case"select":t._wrapperState={wasMultiple:!!r.multiple},Ie("invalid",t);break;case"textarea":vh(t,r),Ie("invalid",t)}Dc(a,r),e=null;for(var o in r)if(r.hasOwnProperty(o)){var s=r[o];o==="children"?typeof s=="string"?t.textContent!==s&&(r.suppressHydrationWarning!==!0&&Ys(t.textContent,s,n),e=["children",s]):typeof s=="number"&&t.textContent!==""+s&&(r.suppressHydrationWarning!==!0&&Ys(t.textContent,s,n),e=["children",""+s]):Jo.hasOwnProperty(o)&&s!=null&&o==="onScroll"&&Ie("scroll",t)}switch(a){case"input":Vs(t),fh(t,r,!0);break;case"textarea":Vs(t),ph(t);break;case"select":case"option":break;default:typeof r.onClick=="function"&&(t.onclick=Ol)}t=e,i.updateQueue=t,t!==null&&(i.flags|=4)}else{o=e.nodeType===9?e:e.ownerDocument,n==="http://www.w3.org/1999/xhtml"&&(n=Ap(a)),n==="http://www.w3.org/1999/xhtml"?a==="script"?(n=o.createElement("div"),n.innerHTML="<script><\/script>",n=n.removeChild(n.firstChild)):typeof t.is=="string"?n=o.createElement(a,{is:t.is}):(n=o.createElement(a),a==="select"&&(o=n,t.multiple?o.multiple=!0:t.size&&(o.size=t.size))):n=o.createElementNS(n,a),n[pr]=i,n[ls]=t,Qg(n,i,!1,!1),i.stateNode=n;e:{switch(o=Bc(a,t),a){case"dialog":Ie("cancel",n),Ie("close",n),e=t;break;case"iframe":case"object":case"embed":Ie("load",n),e=t;break;case"video":case"audio":for(e=0;e<Bo.length;e++)Ie(Bo[e],n);e=t;break;case"source":Ie("error",n),e=t;break;case"img":case"image":case"link":Ie("error",n),Ie("load",n),e=t;break;case"details":Ie("toggle",n),e=t;break;case"input":hh(n,t),e=Pc(n,t),Ie("invalid",n);break;case"option":e=t;break;case"select":n._wrapperState={wasMultiple:!!t.multiple},e=We({},t,{value:void 0}),Ie("invalid",n);break;case"textarea":vh(n,t),e=Rc(n,t),Ie("invalid",n);break;default:e=t}Dc(a,e),s=e;for(r in s)if(s.hasOwnProperty(r)){var l=s[r];r==="style"?Pp(n,l):r==="dangerouslySetInnerHTML"?(l=l?l.__html:void 0,l!=null&&Tp(n,l)):r==="children"?typeof l=="string"?(a!=="textarea"||l!=="")&&Zo(n,l):typeof l=="number"&&Zo(n,""+l):r!=="suppressContentEditableWarning"&&r!=="suppressHydrationWarning"&&r!=="autoFocus"&&(Jo.hasOwnProperty(r)?l!=null&&r==="onScroll"&&Ie("scroll",n):l!=null&&Qd(n,r,l,o))}switch(a){case"input":Vs(n),fh(n,t,!1);break;case"textarea":Vs(n),ph(n);break;case"option":t.value!=null&&n.setAttribute("value",""+Ci(t.value));break;case"select":n.multiple=!!t.multiple,r=t.value,r!=null?La(n,!!t.multiple,r,!1):t.defaultValue!=null&&La(n,!!t.multiple,t.defaultValue,!0);break;default:typeof e.onClick=="function"&&(n.onclick=Ol)}switch(a){case"button":case"input":case"select":case"textarea":t=!!t.autoFocus;break e;case"img":t=!0;break e;default:t=!1}}t&&(i.flags|=4)}i.ref!==null&&(i.flags|=512,i.flags|=2097152)}return Bt(i),null;case 6:if(n&&i.stateNode!=null)Kg(n,i,n.memoizedProps,t);else{if(typeof t!="string"&&i.stateNode===null)throw Error(G(166));if(a=Hi(cs.current),Hi(mr.current),qs(i)){if(t=i.stateNode,a=i.memoizedProps,t[pr]=i,(r=t.nodeValue!==a)&&(n=Sn,n!==null))switch(n.tag){case 3:Ys(t.nodeValue,a,(n.mode&1)!==0);break;case 5:n.memoizedProps.suppressHydrationWarning!==!0&&Ys(t.nodeValue,a,(n.mode&1)!==0)}r&&(i.flags|=4)}else t=(a.nodeType===9?a:a.ownerDocument).createTextNode(t),t[pr]=i,i.stateNode=t}return Bt(i),null;case 13:if(ze(Ue),t=i.memoizedState,n===null||n.memoizedState!==null&&n.memoizedState.dehydrated!==null){if(Ve&&wn!==null&&i.mode&1&&!(i.flags&128))fg(),Xa(),i.flags|=98560,r=!1;else if(r=qs(i),t!==null&&t.dehydrated!==null){if(n===null){if(!r)throw Error(G(318));if(r=i.memoizedState,r=r!==null?r.dehydrated:null,!r)throw Error(G(317));r[pr]=i}else Xa(),!(i.flags&128)&&(i.memoizedState=null),i.flags|=4;Bt(i),r=!1}else Jn!==null&&(hd(Jn),Jn=null),r=!0;if(!r)return i.flags&65536?i:null}return i.flags&128?(i.lanes=a,i):(t=t!==null,t!==(n!==null&&n.memoizedState!==null)&&t&&(i.child.flags|=8192,i.mode&1&&(n===null||Ue.current&1?ft===0&&(ft=3):F_())),i.updateQueue!==null&&(i.flags|=4),Bt(i),null);case 4:return Ya(),ad(n,i),n===null&&os(i.stateNode.containerInfo),Bt(i),null;case 10:return f_(i.type._context),Bt(i),null;case 17:return un(i.type)&&Nl(),Bt(i),null;case 19:if(ze(Ue),r=i.memoizedState,r===null)return Bt(i),null;if(t=(i.flags&128)!==0,o=r.rendering,o===null)if(t)Co(r,!1);else{if(ft!==0||n!==null&&n.flags&128)for(n=i.child;n!==null;){if(o=Xl(n),o!==null){for(i.flags|=128,Co(r,!1),t=o.updateQueue,t!==null&&(i.updateQueue=t,i.flags|=4),i.subtreeFlags=0,t=a,a=i.child;a!==null;)r=a,n=t,r.flags&=14680066,o=r.alternate,o===null?(r.childLanes=0,r.lanes=n,r.child=null,r.subtreeFlags=0,r.memoizedProps=null,r.memoizedState=null,r.updateQueue=null,r.dependencies=null,r.stateNode=null):(r.childLanes=o.childLanes,r.lanes=o.lanes,r.child=o.child,r.subtreeFlags=0,r.deletions=null,r.memoizedProps=o.memoizedProps,r.memoizedState=o.memoizedState,r.updateQueue=o.updateQueue,r.type=o.type,n=o.dependencies,r.dependencies=n===null?null:{lanes:n.lanes,firstContext:n.firstContext}),a=a.sibling;return Fe(Ue,Ue.current&1|2),i.child}n=n.sibling}r.tail!==null&&Ze()>Qa&&(i.flags|=128,t=!0,Co(r,!1),i.lanes=4194304)}else{if(!t)if(n=Xl(o),n!==null){if(i.flags|=128,t=!0,a=n.updateQueue,a!==null&&(i.updateQueue=a,i.flags|=4),Co(r,!0),r.tail===null&&r.tailMode==="hidden"&&!o.alternate&&!Ve)return Bt(i),null}else 2*Ze()-r.renderingStartTime>Qa&&a!==1073741824&&(i.flags|=128,t=!0,Co(r,!1),i.lanes=4194304);r.isBackwards?(o.sibling=i.child,i.child=o):(a=r.last,a!==null?a.sibling=o:i.child=o,r.last=o)}return r.tail!==null?(i=r.tail,r.rendering=i,r.tail=i.sibling,r.renderingStartTime=Ze(),i.sibling=null,a=Ue.current,Fe(Ue,t?a&1|2:a&1),i):(Bt(i),null);case 22:case 23:return R_(),t=i.memoizedState!==null,n!==null&&n.memoizedState!==null!==t&&(i.flags|=8192),t&&i.mode&1?gn&1073741824&&(Bt(i),i.subtreeFlags&6&&(i.flags|=8192)):Bt(i),null;case 24:return null;case 25:return null}throw Error(G(156,i.tag))}function p1(n,i){switch(c_(i),i.tag){case 1:return un(i.type)&&Nl(),n=i.flags,n&65536?(i.flags=n&-65537|128,i):null;case 3:return Ya(),ze(ln),ze(Ht),y_(),n=i.flags,n&65536&&!(n&128)?(i.flags=n&-65537|128,i):null;case 5:return m_(i),null;case 13:if(ze(Ue),n=i.memoizedState,n!==null&&n.dehydrated!==null){if(i.alternate===null)throw Error(G(340));Xa()}return n=i.flags,n&65536?(i.flags=n&-65537|128,i):null;case 19:return ze(Ue),null;case 4:return Ya(),null;case 10:return f_(i.type._context),null;case 22:case 23:return R_(),null;case 24:return null;default:return null}}var Ks=!1,Nt=!1,g1=typeof WeakSet=="function"?WeakSet:Set,ee=null;function Ra(n,i){var a=n.ref;if(a!==null)if(typeof a=="function")try{a(null)}catch(t){Qe(n,i,t)}else a.current=null}function od(n,i,a){try{a()}catch(t){Qe(n,i,t)}}var of=!1;function m1(n,i){if(Gc=Il,n=tg(),l_(n)){if("selectionStart"in n)var a={start:n.selectionStart,end:n.selectionEnd};else e:{a=(a=n.ownerDocument)&&a.defaultView||window;var t=a.getSelection&&a.getSelection();if(t&&t.rangeCount!==0){a=t.anchorNode;var e=t.anchorOffset,r=t.focusNode;t=t.focusOffset;try{a.nodeType,r.nodeType}catch{a=null;break e}var o=0,s=-1,l=-1,u=0,c=0,d=n,_=null;t:for(;;){for(var h;d!==a||e!==0&&d.nodeType!==3||(s=o+e),d!==r||t!==0&&d.nodeType!==3||(l=o+t),d.nodeType===3&&(o+=d.nodeValue.length),(h=d.firstChild)!==null;)_=d,d=h;for(;;){if(d===n)break t;if(_===a&&++u===e&&(s=o),_===r&&++c===t&&(l=o),(h=d.nextSibling)!==null)break;d=_,_=d.parentNode}d=h}a=s===-1||l===-1?null:{start:s,end:l}}else a=null}a=a||{start:0,end:0}}else a=null;for(Wc={focusedElem:n,selectionRange:a},Il=!1,ee=i;ee!==null;)if(i=ee,n=i.child,(i.subtreeFlags&1028)!==0&&n!==null)n.return=i,ee=n;else for(;ee!==null;){i=ee;try{var f=i.alternate;if(i.flags&1024)switch(i.tag){case 0:case 11:case 15:break;case 1:if(f!==null){var g=f.memoizedProps,y=f.memoizedState,p=i.stateNode,v=p.getSnapshotBeforeUpdate(i.elementType===i.type?g:$n(i.type,g),y);p.__reactInternalSnapshotBeforeUpdate=v}break;case 3:var m=i.stateNode.containerInfo;m.nodeType===1?m.textContent="":m.nodeType===9&&m.documentElement&&m.removeChild(m.documentElement);break;case 5:case 6:case 4:case 17:break;default:throw Error(G(163))}}catch(x){Qe(i,i.return,x)}if(n=i.sibling,n!==null){n.return=i.return,ee=n;break}ee=i.return}return f=of,of=!1,f}function Ho(n,i,a){var t=i.updateQueue;if(t=t!==null?t.lastEffect:null,t!==null){var e=t=t.next;do{if((e.tag&n)===n){var r=e.destroy;e.destroy=void 0,r!==void 0&&od(i,a,r)}e=e.next}while(e!==t)}}function Cu(n,i){if(i=i.updateQueue,i=i!==null?i.lastEffect:null,i!==null){var a=i=i.next;do{if((a.tag&n)===n){var t=a.create;a.destroy=t()}a=a.next}while(a!==i)}}function sd(n){var i=n.ref;if(i!==null){var a=n.stateNode;switch(n.tag){case 5:n=a;break;default:n=a}typeof i=="function"?i(n):i.current=n}}function Jg(n){var i=n.alternate;i!==null&&(n.alternate=null,Jg(i)),n.child=null,n.deletions=null,n.sibling=null,n.tag===5&&(i=n.stateNode,i!==null&&(delete i[pr],delete i[ls],delete i[Yc],delete i[e1],delete i[t1])),n.stateNode=null,n.return=null,n.dependencies=null,n.memoizedProps=null,n.memoizedState=null,n.pendingProps=null,n.stateNode=null,n.updateQueue=null}function Zg(n){return n.tag===5||n.tag===3||n.tag===4}function sf(n){e:for(;;){for(;n.sibling===null;){if(n.return===null||Zg(n.return))return null;n=n.return}for(n.sibling.return=n.return,n=n.sibling;n.tag!==5&&n.tag!==6&&n.tag!==18;){if(n.flags&2||n.child===null||n.tag===4)continue e;n.child.return=n,n=n.child}if(!(n.flags&2))return n.stateNode}}function ld(n,i,a){var t=n.tag;if(t===5||t===6)n=n.stateNode,i?a.nodeType===8?a.parentNode.insertBefore(n,i):a.insertBefore(n,i):(a.nodeType===8?(i=a.parentNode,i.insertBefore(n,a)):(i=a,i.appendChild(n)),a=a._reactRootContainer,a!=null||i.onclick!==null||(i.onclick=Ol));else if(t!==4&&(n=n.child,n!==null))for(ld(n,i,a),n=n.sibling;n!==null;)ld(n,i,a),n=n.sibling}function ud(n,i,a){var t=n.tag;if(t===5||t===6)n=n.stateNode,i?a.insertBefore(n,i):a.appendChild(n);else if(t!==4&&(n=n.child,n!==null))for(ud(n,i,a),n=n.sibling;n!==null;)ud(n,i,a),n=n.sibling}var Ct=null,Kn=!1;function Jr(n,i,a){for(a=a.child;a!==null;)e0(n,i,a),a=a.sibling}function e0(n,i,a){if(gr&&typeof gr.onCommitFiberUnmount=="function")try{gr.onCommitFiberUnmount(vu,a)}catch{}switch(a.tag){case 5:Nt||Ra(a,i);case 6:var t=Ct,e=Kn;Ct=null,Jr(n,i,a),Ct=t,Kn=e,Ct!==null&&(Kn?(n=Ct,a=a.stateNode,n.nodeType===8?n.parentNode.removeChild(a):n.removeChild(a)):Ct.removeChild(a.stateNode));break;case 18:Ct!==null&&(Kn?(n=Ct,a=a.stateNode,n.nodeType===8?rc(n.parentNode,a):n.nodeType===1&&rc(n,a),rs(n)):rc(Ct,a.stateNode));break;case 4:t=Ct,e=Kn,Ct=a.stateNode.containerInfo,Kn=!0,Jr(n,i,a),Ct=t,Kn=e;break;case 0:case 11:case 14:case 15:if(!Nt&&(t=a.updateQueue,t!==null&&(t=t.lastEffect,t!==null))){e=t=t.next;do{var r=e,o=r.destroy;r=r.tag,o!==void 0&&(r&2||r&4)&&od(a,i,o),e=e.next}while(e!==t)}Jr(n,i,a);break;case 1:if(!Nt&&(Ra(a,i),t=a.stateNode,typeof t.componentWillUnmount=="function"))try{t.props=a.memoizedProps,t.state=a.memoizedState,t.componentWillUnmount()}catch(s){Qe(a,i,s)}Jr(n,i,a);break;case 21:Jr(n,i,a);break;case 22:a.mode&1?(Nt=(t=Nt)||a.memoizedState!==null,Jr(n,i,a),Nt=t):Jr(n,i,a);break;default:Jr(n,i,a)}}function lf(n){var i=n.updateQueue;if(i!==null){n.updateQueue=null;var a=n.stateNode;a===null&&(a=n.stateNode=new g1),i.forEach(function(t){var e=P1.bind(null,n,t);a.has(t)||(a.add(t),t.then(e,e))})}}function qn(n,i){var a=i.deletions;if(a!==null)for(var t=0;t<a.length;t++){var e=a[t];try{var r=n,o=i,s=o;e:for(;s!==null;){switch(s.tag){case 5:Ct=s.stateNode,Kn=!1;break e;case 3:Ct=s.stateNode.containerInfo,Kn=!0;break e;case 4:Ct=s.stateNode.containerInfo,Kn=!0;break e}s=s.return}if(Ct===null)throw Error(G(160));e0(r,o,e),Ct=null,Kn=!1;var l=e.alternate;l!==null&&(l.return=null),e.return=null}catch(u){Qe(e,i,u)}}if(i.subtreeFlags&12854)for(i=i.child;i!==null;)t0(i,n),i=i.sibling}function t0(n,i){var a=n.alternate,t=n.flags;switch(n.tag){case 0:case 11:case 14:case 15:if(qn(i,n),cr(n),t&4){try{Ho(3,n,n.return),Cu(3,n)}catch(g){Qe(n,n.return,g)}try{Ho(5,n,n.return)}catch(g){Qe(n,n.return,g)}}break;case 1:qn(i,n),cr(n),t&512&&a!==null&&Ra(a,a.return);break;case 5:if(qn(i,n),cr(n),t&512&&a!==null&&Ra(a,a.return),n.flags&32){var e=n.stateNode;try{Zo(e,"")}catch(g){Qe(n,n.return,g)}}if(t&4&&(e=n.stateNode,e!=null)){var r=n.memoizedProps,o=a!==null?a.memoizedProps:r,s=n.type,l=n.updateQueue;if(n.updateQueue=null,l!==null)try{s==="input"&&r.type==="radio"&&r.name!=null&&Sp(e,r),Bc(s,o);var u=Bc(s,r);for(o=0;o<l.length;o+=2){var c=l[o],d=l[o+1];c==="style"?Pp(e,d):c==="dangerouslySetInnerHTML"?Tp(e,d):c==="children"?Zo(e,d):Qd(e,c,d,u)}switch(s){case"input":bc(e,r);break;case"textarea":Cp(e,r);break;case"select":var _=e._wrapperState.wasMultiple;e._wrapperState.wasMultiple=!!r.multiple;var h=r.value;h!=null?La(e,!!r.multiple,h,!1):_!==!!r.multiple&&(r.defaultValue!=null?La(e,!!r.multiple,r.defaultValue,!0):La(e,!!r.multiple,r.multiple?[]:"",!1))}e[ls]=r}catch(g){Qe(n,n.return,g)}}break;case 6:if(qn(i,n),cr(n),t&4){if(n.stateNode===null)throw Error(G(162));e=n.stateNode,r=n.memoizedProps;try{e.nodeValue=r}catch(g){Qe(n,n.return,g)}}break;case 3:if(qn(i,n),cr(n),t&4&&a!==null&&a.memoizedState.isDehydrated)try{rs(i.containerInfo)}catch(g){Qe(n,n.return,g)}break;case 4:qn(i,n),cr(n);break;case 13:qn(i,n),cr(n),e=n.child,e.flags&8192&&(r=e.memoizedState!==null,e.stateNode.isHidden=r,!r||e.alternate!==null&&e.alternate.memoizedState!==null||(b_=Ze())),t&4&&lf(n);break;case 22:if(c=a!==null&&a.memoizedState!==null,n.mode&1?(Nt=(u=Nt)||c,qn(i,n),Nt=u):qn(i,n),cr(n),t&8192){if(u=n.memoizedState!==null,(n.stateNode.isHidden=u)&&!c&&n.mode&1)for(ee=n,c=n.child;c!==null;){for(d=ee=c;ee!==null;){switch(_=ee,h=_.child,_.tag){case 0:case 11:case 14:case 15:Ho(4,_,_.return);break;case 1:Ra(_,_.return);var f=_.stateNode;if(typeof f.componentWillUnmount=="function"){t=_,a=_.return;try{i=t,f.props=i.memoizedProps,f.state=i.memoizedState,f.componentWillUnmount()}catch(g){Qe(t,a,g)}}break;case 5:Ra(_,_.return);break;case 22:if(_.memoizedState!==null){cf(d);continue}}h!==null?(h.return=_,ee=h):cf(d)}c=c.sibling}e:for(c=null,d=n;;){if(d.tag===5){if(c===null){c=d;try{e=d.stateNode,u?(r=e.style,typeof r.setProperty=="function"?r.setProperty("display","none","important"):r.display="none"):(s=d.stateNode,l=d.memoizedProps.style,o=l!=null&&l.hasOwnProperty("display")?l.display:null,s.style.display=Ep("display",o))}catch(g){Qe(n,n.return,g)}}}else if(d.tag===6){if(c===null)try{d.stateNode.nodeValue=u?"":d.memoizedProps}catch(g){Qe(n,n.return,g)}}else if((d.tag!==22&&d.tag!==23||d.memoizedState===null||d===n)&&d.child!==null){d.child.return=d,d=d.child;continue}if(d===n)break e;for(;d.sibling===null;){if(d.return===null||d.return===n)break e;c===d&&(c=null),d=d.return}c===d&&(c=null),d.sibling.return=d.return,d=d.sibling}}break;case 19:qn(i,n),cr(n),t&4&&lf(n);break;case 21:break;default:qn(i,n),cr(n)}}function cr(n){var i=n.flags;if(i&2){try{e:{for(var a=n.return;a!==null;){if(Zg(a)){var t=a;break e}a=a.return}throw Error(G(160))}switch(t.tag){case 5:var e=t.stateNode;t.flags&32&&(Zo(e,""),t.flags&=-33);var r=sf(n);ud(n,r,e);break;case 3:case 4:var o=t.stateNode.containerInfo,s=sf(n);ld(n,s,o);break;default:throw Error(G(161))}}catch(l){Qe(n,n.return,l)}n.flags&=-3}i&4096&&(n.flags&=-4097)}function y1(n,i,a){ee=n,n0(n)}function n0(n,i,a){for(var t=(n.mode&1)!==0;ee!==null;){var e=ee,r=e.child;if(e.tag===22&&t){var o=e.memoizedState!==null||Ks;if(!o){var s=e.alternate,l=s!==null&&s.memoizedState!==null||Nt;s=Ks;var u=Nt;if(Ks=o,(Nt=l)&&!u)for(ee=e;ee!==null;)o=ee,l=o.child,o.tag===22&&o.memoizedState!==null?df(e):l!==null?(l.return=o,ee=l):df(e);for(;r!==null;)ee=r,n0(r),r=r.sibling;ee=e,Ks=s,Nt=u}uf(n)}else e.subtreeFlags&8772&&r!==null?(r.return=e,ee=r):uf(n)}}function uf(n){for(;ee!==null;){var i=ee;if(i.flags&8772){var a=i.alternate;try{if(i.flags&8772)switch(i.tag){case 0:case 11:case 15:Nt||Cu(5,i);break;case 1:var t=i.stateNode;if(i.flags&4&&!Nt)if(a===null)t.componentDidMount();else{var e=i.elementType===i.type?a.memoizedProps:$n(i.type,a.memoizedProps);t.componentDidUpdate(e,a.memoizedState,t.__reactInternalSnapshotBeforeUpdate)}var r=i.updateQueue;r!==null&&Xh(i,r,t);break;case 3:var o=i.updateQueue;if(o!==null){if(a=null,i.child!==null)switch(i.child.tag){case 5:a=i.child.stateNode;break;case 1:a=i.child.stateNode}Xh(i,o,a)}break;case 5:var s=i.stateNode;if(a===null&&i.flags&4){a=s;var l=i.memoizedProps;switch(i.type){case"button":case"input":case"select":case"textarea":l.autoFocus&&a.focus();break;case"img":l.src&&(a.src=l.src)}}break;case 6:break;case 4:break;case 12:break;case 13:if(i.memoizedState===null){var u=i.alternate;if(u!==null){var c=u.memoizedState;if(c!==null){var d=c.dehydrated;d!==null&&rs(d)}}}break;case 19:case 17:case 21:case 22:case 23:case 25:break;default:throw Error(G(163))}Nt||i.flags&512&&sd(i)}catch(_){Qe(i,i.return,_)}}if(i===n){ee=null;break}if(a=i.sibling,a!==null){a.return=i.return,ee=a;break}ee=i.return}}function cf(n){for(;ee!==null;){var i=ee;if(i===n){ee=null;break}var a=i.sibling;if(a!==null){a.return=i.return,ee=a;break}ee=i.return}}function df(n){for(;ee!==null;){var i=ee;try{switch(i.tag){case 0:case 11:case 15:var a=i.return;try{Cu(4,i)}catch(l){Qe(i,a,l)}break;case 1:var t=i.stateNode;if(typeof t.componentDidMount=="function"){var e=i.return;try{t.componentDidMount()}catch(l){Qe(i,e,l)}}var r=i.return;try{sd(i)}catch(l){Qe(i,r,l)}break;case 5:var o=i.return;try{sd(i)}catch(l){Qe(i,o,l)}}}catch(l){Qe(i,i.return,l)}if(i===n){ee=null;break}var s=i.sibling;if(s!==null){s.return=i.return,ee=s;break}ee=i.return}}var x1=Math.ceil,ql=Wr.ReactCurrentDispatcher,E_=Wr.ReactCurrentOwner,Vn=Wr.ReactCurrentBatchConfig,Ce=0,gt=null,st=null,Mt=0,gn=0,Fa=bi(0),ft=0,fs=null,na=0,Au=0,P_=0,Go=null,rn=null,b_=0,Qa=1/0,Tr=null,Ql=!1,cd=null,gi=null,Js=!1,li=null,$l=0,Wo=0,dd=null,Sl=-1,Cl=0;function Qt(){return Ce&6?Ze():Sl!==-1?Sl:Sl=Ze()}function mi(n){return n.mode&1?Ce&2&&Mt!==0?Mt&-Mt:r1.transition!==null?(Cl===0&&(Cl=Vp()),Cl):(n=be,n!==0||(n=window.event,n=n===void 0?16:jp(n.type)),n):1}function nr(n,i,a,t){if(50<Wo)throw Wo=0,dd=null,Error(G(185));Ps(n,a,t),(!(Ce&2)||n!==gt)&&(n===gt&&(!(Ce&2)&&(Au|=a),ft===4&&ai(n,Mt)),cn(n,t),a===1&&Ce===0&&!(i.mode&1)&&(Qa=Ze()+500,xu&&Mi()))}function cn(n,i){var a=n.callbackNode;ry(n,i);var t=Bl(n,n===gt?Mt:0);if(t===0)a!==null&&yh(a),n.callbackNode=null,n.callbackPriority=0;else if(i=t&-t,n.callbackPriority!==i){if(a!=null&&yh(a),i===1)n.tag===0?n1(_f.bind(null,n)):dg(_f.bind(null,n)),Jy(function(){!(Ce&6)&&Mi()}),a=null;else{switch(Up(t)){case 1:a=e_;break;case 4:a=Op;break;case 16:a=Dl;break;case 536870912:a=Np;break;default:a=Dl}a=c0(a,r0.bind(null,n))}n.callbackPriority=i,n.callbackNode=a}}function r0(n,i){if(Sl=-1,Cl=0,Ce&6)throw Error(G(327));var a=n.callbackNode;if(Ua()&&n.callbackNode!==a)return null;var t=Bl(n,n===gt?Mt:0);if(t===0)return null;if(t&30||t&n.expiredLanes||i)i=Kl(n,t);else{i=t;var e=Ce;Ce|=2;var r=a0();(gt!==n||Mt!==i)&&(Tr=null,Qa=Ze()+500,qi(n,i));do try{C1();break}catch(s){i0(n,s)}while(1);h_(),ql.current=r,Ce=e,st!==null?i=0:(gt=null,Mt=0,i=ft)}if(i!==0){if(i===2&&(e=Nc(n),e!==0&&(t=e,i=_d(n,e))),i===1)throw a=fs,qi(n,0),ai(n,t),cn(n,Ze()),a;if(i===6)ai(n,t);else{if(e=n.current.alternate,!(t&30)&&!w1(e)&&(i=Kl(n,t),i===2&&(r=Nc(n),r!==0&&(t=r,i=_d(n,r))),i===1))throw a=fs,qi(n,0),ai(n,t),cn(n,Ze()),a;switch(n.finishedWork=e,n.finishedLanes=t,i){case 0:case 1:throw Error(G(345));case 2:Ni(n,rn,Tr);break;case 3:if(ai(n,t),(t&130023424)===t&&(i=b_+500-Ze(),10<i)){if(Bl(n,0)!==0)break;if(e=n.suspendedLanes,(e&t)!==t){Qt(),n.pingedLanes|=n.suspendedLanes&e;break}n.timeoutHandle=jc(Ni.bind(null,n,rn,Tr),i);break}Ni(n,rn,Tr);break;case 4:if(ai(n,t),(t&4194240)===t)break;for(i=n.eventTimes,e=-1;0<t;){var o=31-tr(t);r=1<<o,o=i[o],o>e&&(e=o),t&=~r}if(t=e,t=Ze()-t,t=(120>t?120:480>t?480:1080>t?1080:1920>t?1920:3e3>t?3e3:4320>t?4320:1960*x1(t/1960))-t,10<t){n.timeoutHandle=jc(Ni.bind(null,n,rn,Tr),t);break}Ni(n,rn,Tr);break;case 5:Ni(n,rn,Tr);break;default:throw Error(G(329))}}}return cn(n,Ze()),n.callbackNode===a?r0.bind(null,n):null}function _d(n,i){var a=Go;return n.current.memoizedState.isDehydrated&&(qi(n,i).flags|=256),n=Kl(n,i),n!==2&&(i=rn,rn=a,i!==null&&hd(i)),n}function hd(n){rn===null?rn=n:rn.push.apply(rn,n)}function w1(n){for(var i=n;;){if(i.flags&16384){var a=i.updateQueue;if(a!==null&&(a=a.stores,a!==null))for(var t=0;t<a.length;t++){var e=a[t],r=e.getSnapshot;e=e.value;try{if(!rr(r(),e))return!1}catch{return!1}}}if(a=i.child,i.subtreeFlags&16384&&a!==null)a.return=i,i=a;else{if(i===n)break;for(;i.sibling===null;){if(i.return===null||i.return===n)return!0;i=i.return}i.sibling.return=i.return,i=i.sibling}}return!0}function ai(n,i){for(i&=~P_,i&=~Au,n.suspendedLanes|=i,n.pingedLanes&=~i,n=n.expirationTimes;0<i;){var a=31-tr(i),t=1<<a;n[a]=-1,i&=~t}}function _f(n){if(Ce&6)throw Error(G(327));Ua();var i=Bl(n,0);if(!(i&1))return cn(n,Ze()),null;var a=Kl(n,i);if(n.tag!==0&&a===2){var t=Nc(n);t!==0&&(i=t,a=_d(n,t))}if(a===1)throw a=fs,qi(n,0),ai(n,i),cn(n,Ze()),a;if(a===6)throw Error(G(345));return n.finishedWork=n.current.alternate,n.finishedLanes=i,Ni(n,rn,Tr),cn(n,Ze()),null}function M_(n,i){var a=Ce;Ce|=1;try{return n(i)}finally{Ce=a,Ce===0&&(Qa=Ze()+500,xu&&Mi())}}function ra(n){li!==null&&li.tag===0&&!(Ce&6)&&Ua();var i=Ce;Ce|=1;var a=Vn.transition,t=be;try{if(Vn.transition=null,be=1,n)return n()}finally{be=t,Vn.transition=a,Ce=i,!(Ce&6)&&Mi()}}function R_(){gn=Fa.current,ze(Fa)}function qi(n,i){n.finishedWork=null,n.finishedLanes=0;var a=n.timeoutHandle;if(a!==-1&&(n.timeoutHandle=-1,Ky(a)),st!==null)for(a=st.return;a!==null;){var t=a;switch(c_(t),t.tag){case 1:t=t.type.childContextTypes,t!=null&&Nl();break;case 3:Ya(),ze(ln),ze(Ht),y_();break;case 5:m_(t);break;case 4:Ya();break;case 13:ze(Ue);break;case 19:ze(Ue);break;case 10:f_(t.type._context);break;case 22:case 23:R_()}a=a.return}if(gt=n,st=n=yi(n.current,null),Mt=gn=i,ft=0,fs=null,P_=Au=na=0,rn=Go=null,ki!==null){for(i=0;i<ki.length;i++)if(a=ki[i],t=a.interleaved,t!==null){a.interleaved=null;var e=t.next,r=a.pending;if(r!==null){var o=r.next;r.next=e,t.next=o}a.pending=t}ki=null}return n}function i0(n,i){do{var a=st;try{if(h_(),yl.current=Yl,jl){for(var t=Ge.memoizedState;t!==null;){var e=t.queue;e!==null&&(e.pending=null),t=t.next}jl=!1}if(ta=0,vt=_t=Ge=null,ko=!1,ds=0,E_.current=null,a===null||a.return===null){ft=1,fs=i,st=null;break}e:{var r=n,o=a.return,s=a,l=i;if(i=Mt,s.flags|=32768,l!==null&&typeof l=="object"&&typeof l.then=="function"){var u=l,c=s,d=c.tag;if(!(c.mode&1)&&(d===0||d===11||d===15)){var _=c.alternate;_?(c.updateQueue=_.updateQueue,c.memoizedState=_.memoizedState,c.lanes=_.lanes):(c.updateQueue=null,c.memoizedState=null)}var h=Jh(o);if(h!==null){h.flags&=-257,Zh(h,o,s,r,i),h.mode&1&&Kh(r,u,i),i=h,l=u;var f=i.updateQueue;if(f===null){var g=new Set;g.add(l),i.updateQueue=g}else f.add(l);break e}else{if(!(i&1)){Kh(r,u,i),F_();break e}l=Error(G(426))}}else if(Ve&&s.mode&1){var y=Jh(o);if(y!==null){!(y.flags&65536)&&(y.flags|=256),Zh(y,o,s,r,i),d_(qa(l,s));break e}}r=l=qa(l,s),ft!==4&&(ft=2),Go===null?Go=[r]:Go.push(r),r=o;do{switch(r.tag){case 3:r.flags|=65536,i&=-i,r.lanes|=i;var p=kg(r,l,i);Wh(r,p);break e;case 1:s=l;var v=r.type,m=r.stateNode;if(!(r.flags&128)&&(typeof v.getDerivedStateFromError=="function"||m!==null&&typeof m.componentDidCatch=="function"&&(gi===null||!gi.has(m)))){r.flags|=65536,i&=-i,r.lanes|=i;var x=Hg(r,s,i);Wh(r,x);break e}}r=r.return}while(r!==null)}s0(a)}catch(S){i=S,st===a&&a!==null&&(st=a=a.return);continue}break}while(1)}function a0(){var n=ql.current;return ql.current=Yl,n===null?Yl:n}function F_(){(ft===0||ft===3||ft===2)&&(ft=4),gt===null||!(na&268435455)&&!(Au&268435455)||ai(gt,Mt)}function Kl(n,i){var a=Ce;Ce|=2;var t=a0();(gt!==n||Mt!==i)&&(Tr=null,qi(n,i));do try{S1();break}catch(e){i0(n,e)}while(1);if(h_(),Ce=a,ql.current=t,st!==null)throw Error(G(261));return gt=null,Mt=0,ft}function S1(){for(;st!==null;)o0(st)}function C1(){for(;st!==null&&!qm();)o0(st)}function o0(n){var i=u0(n.alternate,n,gn);n.memoizedProps=n.pendingProps,i===null?s0(n):st=i,E_.current=null}function s0(n){var i=n;do{var a=i.alternate;if(n=i.return,i.flags&32768){if(a=p1(a,i),a!==null){a.flags&=32767,st=a;return}if(n!==null)n.flags|=32768,n.subtreeFlags=0,n.deletions=null;else{ft=6,st=null;return}}else if(a=v1(a,i,gn),a!==null){st=a;return}if(i=i.sibling,i!==null){st=i;return}st=i=n}while(i!==null);ft===0&&(ft=5)}function Ni(n,i,a){var t=be,e=Vn.transition;try{Vn.transition=null,be=1,A1(n,i,a,t)}finally{Vn.transition=e,be=t}return null}function A1(n,i,a,t){do Ua();while(li!==null);if(Ce&6)throw Error(G(327));a=n.finishedWork;var e=n.finishedLanes;if(a===null)return null;if(n.finishedWork=null,n.finishedLanes=0,a===n.current)throw Error(G(177));n.callbackNode=null,n.callbackPriority=0;var r=a.lanes|a.childLanes;if(iy(n,r),n===gt&&(st=gt=null,Mt=0),!(a.subtreeFlags&2064)&&!(a.flags&2064)||Js||(Js=!0,c0(Dl,function(){return Ua(),null})),r=(a.flags&15990)!==0,a.subtreeFlags&15990||r){r=Vn.transition,Vn.transition=null;var o=be;be=1;var s=Ce;Ce|=4,E_.current=null,m1(n,a),t0(a,n),Wy(Wc),Il=!!Gc,Wc=Gc=null,n.current=a,y1(a),Qm(),Ce=s,be=o,Vn.transition=r}else n.current=a;if(Js&&(Js=!1,li=n,$l=e),r=n.pendingLanes,r===0&&(gi=null),Jm(a.stateNode),cn(n,Ze()),i!==null)for(t=n.onRecoverableError,a=0;a<i.length;a++)e=i[a],t(e.value,{componentStack:e.stack,digest:e.digest});if(Ql)throw Ql=!1,n=cd,cd=null,n;return $l&1&&n.tag!==0&&Ua(),r=n.pendingLanes,r&1?n===dd?Wo++:(Wo=0,dd=n):Wo=0,Mi(),null}function Ua(){if(li!==null){var n=Up($l),i=Vn.transition,a=be;try{if(Vn.transition=null,be=16>n?16:n,li===null)var t=!1;else{if(n=li,li=null,$l=0,Ce&6)throw Error(G(331));var e=Ce;for(Ce|=4,ee=n.current;ee!==null;){var r=ee,o=r.child;if(ee.flags&16){var s=r.deletions;if(s!==null){for(var l=0;l<s.length;l++){var u=s[l];for(ee=u;ee!==null;){var c=ee;switch(c.tag){case 0:case 11:case 15:Ho(8,c,r)}var d=c.child;if(d!==null)d.return=c,ee=d;else for(;ee!==null;){c=ee;var _=c.sibling,h=c.return;if(Jg(c),c===u){ee=null;break}if(_!==null){_.return=h,ee=_;break}ee=h}}}var f=r.alternate;if(f!==null){var g=f.child;if(g!==null){f.child=null;do{var y=g.sibling;g.sibling=null,g=y}while(g!==null)}}ee=r}}if(r.subtreeFlags&2064&&o!==null)o.return=r,ee=o;else e:for(;ee!==null;){if(r=ee,r.flags&2048)switch(r.tag){case 0:case 11:case 15:Ho(9,r,r.return)}var p=r.sibling;if(p!==null){p.return=r.return,ee=p;break e}ee=r.return}}var v=n.current;for(ee=v;ee!==null;){o=ee;var m=o.child;if(o.subtreeFlags&2064&&m!==null)m.return=o,ee=m;else e:for(o=v;ee!==null;){if(s=ee,s.flags&2048)try{switch(s.tag){case 0:case 11:case 15:Cu(9,s)}}catch(S){Qe(s,s.return,S)}if(s===o){ee=null;break e}var x=s.sibling;if(x!==null){x.return=s.return,ee=x;break e}ee=s.return}}if(Ce=e,Mi(),gr&&typeof gr.onPostCommitFiberRoot=="function")try{gr.onPostCommitFiberRoot(vu,n)}catch{}t=!0}return t}finally{be=a,Vn.transition=i}}return!1}function hf(n,i,a){i=qa(a,i),i=kg(n,i,1),n=pi(n,i,1),i=Qt(),n!==null&&(Ps(n,1,i),cn(n,i))}function Qe(n,i,a){if(n.tag===3)hf(n,n,a);else for(;i!==null;){if(i.tag===3){hf(i,n,a);break}else if(i.tag===1){var t=i.stateNode;if(typeof i.type.getDerivedStateFromError=="function"||typeof t.componentDidCatch=="function"&&(gi===null||!gi.has(t))){n=qa(a,n),n=Hg(i,n,1),i=pi(i,n,1),n=Qt(),i!==null&&(Ps(i,1,n),cn(i,n));break}}i=i.return}}function T1(n,i,a){var t=n.pingCache;t!==null&&t.delete(i),i=Qt(),n.pingedLanes|=n.suspendedLanes&a,gt===n&&(Mt&a)===a&&(ft===4||ft===3&&(Mt&130023424)===Mt&&500>Ze()-b_?qi(n,0):P_|=a),cn(n,i)}function l0(n,i){i===0&&(n.mode&1?(i=Hs,Hs<<=1,!(Hs&130023424)&&(Hs=4194304)):i=1);var a=Qt();n=Vr(n,i),n!==null&&(Ps(n,i,a),cn(n,a))}function E1(n){var i=n.memoizedState,a=0;i!==null&&(a=i.retryLane),l0(n,a)}function P1(n,i){var a=0;switch(n.tag){case 13:var t=n.stateNode,e=n.memoizedState;e!==null&&(a=e.retryLane);break;case 19:t=n.stateNode;break;default:throw Error(G(314))}t!==null&&t.delete(i),l0(n,a)}var u0;u0=function(n,i,a){if(n!==null)if(n.memoizedProps!==i.pendingProps||ln.current)on=!0;else{if(!(n.lanes&a)&&!(i.flags&128))return on=!1,f1(n,i,a);on=!!(n.flags&131072)}else on=!1,Ve&&i.flags&1048576&&_g(i,kl,i.index);switch(i.lanes=0,i.tag){case 2:var t=i.type;wl(n,i),n=i.pendingProps;var e=Wa(i,Ht.current);Va(i,a),e=w_(null,i,t,n,e,a);var r=S_();return i.flags|=1,typeof e=="object"&&e!==null&&typeof e.render=="function"&&e.$$typeof===void 0?(i.tag=1,i.memoizedState=null,i.updateQueue=null,un(t)?(r=!0,Vl(i)):r=!1,i.memoizedState=e.state!==null&&e.state!==void 0?e.state:null,p_(i),e.updater=wu,i.stateNode=e,e._reactInternals=i,Zc(i,t,n,a),i=nd(null,i,t,!0,r,a)):(i.tag=0,Ve&&r&&u_(i),Yt(null,i,e,a),i=i.child),i;case 16:t=i.elementType;e:{switch(wl(n,i),n=i.pendingProps,e=t._init,t=e(t._payload),i.type=t,e=i.tag=M1(t),n=$n(t,n),e){case 0:i=td(null,i,t,n,a);break e;case 1:i=nf(null,i,t,n,a);break e;case 11:i=ef(null,i,t,n,a);break e;case 14:i=tf(null,i,t,$n(t.type,n),a);break e}throw Error(G(306,t,""))}return i;case 0:return t=i.type,e=i.pendingProps,e=i.elementType===t?e:$n(t,e),td(n,i,t,e,a);case 1:return t=i.type,e=i.pendingProps,e=i.elementType===t?e:$n(t,e),nf(n,i,t,e,a);case 3:e:{if(jg(i),n===null)throw Error(G(387));t=i.pendingProps,r=i.memoizedState,e=r.element,pg(n,i),Wl(i,t,null,a);var o=i.memoizedState;if(t=o.element,r.isDehydrated)if(r={element:t,isDehydrated:!1,cache:o.cache,pendingSuspenseBoundaries:o.pendingSuspenseBoundaries,transitions:o.transitions},i.updateQueue.baseState=r,i.memoizedState=r,i.flags&256){e=qa(Error(G(423)),i),i=rf(n,i,t,a,e);break e}else if(t!==e){e=qa(Error(G(424)),i),i=rf(n,i,t,a,e);break e}else for(wn=vi(i.stateNode.containerInfo.firstChild),Sn=i,Ve=!0,Jn=null,a=xg(i,null,t,a),i.child=a;a;)a.flags=a.flags&-3|4096,a=a.sibling;else{if(Xa(),t===e){i=Ur(n,i,a);break e}Yt(n,i,t,a)}i=i.child}return i;case 5:return wg(i),n===null&&$c(i),t=i.type,e=i.pendingProps,r=n!==null?n.memoizedProps:null,o=e.children,Xc(t,e)?o=null:r!==null&&Xc(t,r)&&(i.flags|=32),Xg(n,i),Yt(n,i,o,a),i.child;case 6:return n===null&&$c(i),null;case 13:return Yg(n,i,a);case 4:return g_(i,i.stateNode.containerInfo),t=i.pendingProps,n===null?i.child=ja(i,null,t,a):Yt(n,i,t,a),i.child;case 11:return t=i.type,e=i.pendingProps,e=i.elementType===t?e:$n(t,e),ef(n,i,t,e,a);case 7:return Yt(n,i,i.pendingProps,a),i.child;case 8:return Yt(n,i,i.pendingProps.children,a),i.child;case 12:return Yt(n,i,i.pendingProps.children,a),i.child;case 10:e:{if(t=i.type._context,e=i.pendingProps,r=i.memoizedProps,o=e.value,Fe(Hl,t._currentValue),t._currentValue=o,r!==null)if(rr(r.value,o)){if(r.children===e.children&&!ln.current){i=Ur(n,i,a);break e}}else for(r=i.child,r!==null&&(r.return=i);r!==null;){var s=r.dependencies;if(s!==null){o=r.child;for(var l=s.firstContext;l!==null;){if(l.context===t){if(r.tag===1){l=Lr(-1,a&-a),l.tag=2;var u=r.updateQueue;if(u!==null){u=u.shared;var c=u.pending;c===null?l.next=l:(l.next=c.next,c.next=l),u.pending=l}}r.lanes|=a,l=r.alternate,l!==null&&(l.lanes|=a),Kc(r.return,a,i),s.lanes|=a;break}l=l.next}}else if(r.tag===10)o=r.type===i.type?null:r.child;else if(r.tag===18){if(o=r.return,o===null)throw Error(G(341));o.lanes|=a,s=o.alternate,s!==null&&(s.lanes|=a),Kc(o,a,i),o=r.sibling}else o=r.child;if(o!==null)o.return=r;else for(o=r;o!==null;){if(o===i){o=null;break}if(r=o.sibling,r!==null){r.return=o.return,o=r;break}o=o.return}r=o}Yt(n,i,e.children,a),i=i.child}return i;case 9:return e=i.type,t=i.pendingProps.children,Va(i,a),e=kn(e),t=t(e),i.flags|=1,Yt(n,i,t,a),i.child;case 14:return t=i.type,e=$n(t,i.pendingProps),e=$n(t.type,e),tf(n,i,t,e,a);case 15:return Gg(n,i,i.type,i.pendingProps,a);case 17:return t=i.type,e=i.pendingProps,e=i.elementType===t?e:$n(t,e),wl(n,i),i.tag=1,un(t)?(n=!0,Vl(i)):n=!1,Va(i,a),mg(i,t,e),Zc(i,t,e,a),nd(null,i,t,!0,n,a);case 19:return qg(n,i,a);case 22:return Wg(n,i,a)}throw Error(G(156,i.tag))};function c0(n,i){return zp(n,i)}function b1(n,i,a,t){this.tag=n,this.key=a,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=i,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=t,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function Nn(n,i,a,t){return new b1(n,i,a,t)}function D_(n){return n=n.prototype,!(!n||!n.isReactComponent)}function M1(n){if(typeof n=="function")return D_(n)?1:0;if(n!=null){if(n=n.$$typeof,n===Kd)return 11;if(n===Jd)return 14}return 2}function yi(n,i){var a=n.alternate;return a===null?(a=Nn(n.tag,i,n.key,n.mode),a.elementType=n.elementType,a.type=n.type,a.stateNode=n.stateNode,a.alternate=n,n.alternate=a):(a.pendingProps=i,a.type=n.type,a.flags=0,a.subtreeFlags=0,a.deletions=null),a.flags=n.flags&14680064,a.childLanes=n.childLanes,a.lanes=n.lanes,a.child=n.child,a.memoizedProps=n.memoizedProps,a.memoizedState=n.memoizedState,a.updateQueue=n.updateQueue,i=n.dependencies,a.dependencies=i===null?null:{lanes:i.lanes,firstContext:i.firstContext},a.sibling=n.sibling,a.index=n.index,a.ref=n.ref,a}function Al(n,i,a,t,e,r){var o=2;if(t=n,typeof n=="function")D_(n)&&(o=1);else if(typeof n=="string")o=5;else e:switch(n){case wa:return Qi(a.children,e,r,i);case $d:o=8,e|=8;break;case Cc:return n=Nn(12,a,i,e|2),n.elementType=Cc,n.lanes=r,n;case Ac:return n=Nn(13,a,i,e),n.elementType=Ac,n.lanes=r,n;case Tc:return n=Nn(19,a,i,e),n.elementType=Tc,n.lanes=r,n;case yp:return Tu(a,e,r,i);default:if(typeof n=="object"&&n!==null)switch(n.$$typeof){case gp:o=10;break e;case mp:o=9;break e;case Kd:o=11;break e;case Jd:o=14;break e;case ti:o=16,t=null;break e}throw Error(G(130,n==null?n:typeof n,""))}return i=Nn(o,a,i,e),i.elementType=n,i.type=t,i.lanes=r,i}function Qi(n,i,a,t){return n=Nn(7,n,t,i),n.lanes=a,n}function Tu(n,i,a,t){return n=Nn(22,n,t,i),n.elementType=yp,n.lanes=a,n.stateNode={isHidden:!1},n}function dc(n,i,a){return n=Nn(6,n,null,i),n.lanes=a,n}function _c(n,i,a){return i=Nn(4,n.children!==null?n.children:[],n.key,i),i.lanes=a,i.stateNode={containerInfo:n.containerInfo,pendingChildren:null,implementation:n.implementation},i}function R1(n,i,a,t,e){this.tag=i,this.containerInfo=n,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=ju(0),this.expirationTimes=ju(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=ju(0),this.identifierPrefix=t,this.onRecoverableError=e,this.mutableSourceEagerHydrationData=null}function B_(n,i,a,t,e,r,o,s,l){return n=new R1(n,i,a,s,l),i===1?(i=1,r===!0&&(i|=8)):i=0,r=Nn(3,null,null,i),n.current=r,r.stateNode=n,r.memoizedState={element:t,isDehydrated:a,cache:null,transitions:null,pendingSuspenseBoundaries:null},p_(r),n}function F1(n,i,a){var t=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:xa,key:t==null?null:""+t,children:n,containerInfo:i,implementation:a}}function d0(n){if(!n)return Ai;n=n._reactInternals;e:{if(la(n)!==n||n.tag!==1)throw Error(G(170));var i=n;do{switch(i.tag){case 3:i=i.stateNode.context;break e;case 1:if(un(i.type)){i=i.stateNode.__reactInternalMemoizedMergedChildContext;break e}}i=i.return}while(i!==null);throw Error(G(171))}if(n.tag===1){var a=n.type;if(un(a))return cg(n,a,i)}return i}function _0(n,i,a,t,e,r,o,s,l){return n=B_(a,t,!0,n,e,r,o,s,l),n.context=d0(null),a=n.current,t=Qt(),e=mi(a),r=Lr(t,e),r.callback=i??null,pi(a,r,e),n.current.lanes=e,Ps(n,e,t),cn(n,t),n}function Eu(n,i,a,t){var e=i.current,r=Qt(),o=mi(e);return a=d0(a),i.context===null?i.context=a:i.pendingContext=a,i=Lr(r,o),i.payload={element:n},t=t===void 0?null:t,t!==null&&(i.callback=t),n=pi(e,i,o),n!==null&&(nr(n,e,o,r),ml(n,e,o)),o}function Jl(n){if(n=n.current,!n.child)return null;switch(n.child.tag){case 5:return n.child.stateNode;default:return n.child.stateNode}}function ff(n,i){if(n=n.memoizedState,n!==null&&n.dehydrated!==null){var a=n.retryLane;n.retryLane=a!==0&&a<i?a:i}}function I_(n,i){ff(n,i),(n=n.alternate)&&ff(n,i)}function D1(){return null}var h0=typeof reportError=="function"?reportError:function(n){console.error(n)};function L_(n){this._internalRoot=n}Pu.prototype.render=L_.prototype.render=function(n){var i=this._internalRoot;if(i===null)throw Error(G(409));Eu(n,i,null,null)};Pu.prototype.unmount=L_.prototype.unmount=function(){var n=this._internalRoot;if(n!==null){this._internalRoot=null;var i=n.containerInfo;ra(function(){Eu(null,n,null,null)}),i[Nr]=null}};function Pu(n){this._internalRoot=n}Pu.prototype.unstable_scheduleHydration=function(n){if(n){var i=Gp();n={blockedOn:null,target:n,priority:i};for(var a=0;a<ii.length&&i!==0&&i<ii[a].priority;a++);ii.splice(a,0,n),a===0&&Xp(n)}};function z_(n){return!(!n||n.nodeType!==1&&n.nodeType!==9&&n.nodeType!==11)}function bu(n){return!(!n||n.nodeType!==1&&n.nodeType!==9&&n.nodeType!==11&&(n.nodeType!==8||n.nodeValue!==" react-mount-point-unstable "))}function vf(){}function B1(n,i,a,t,e){if(e){if(typeof t=="function"){var r=t;t=function(){var u=Jl(o);r.call(u)}}var o=_0(i,t,n,0,null,!1,!1,"",vf);return n._reactRootContainer=o,n[Nr]=o.current,os(n.nodeType===8?n.parentNode:n),ra(),o}for(;e=n.lastChild;)n.removeChild(e);if(typeof t=="function"){var s=t;t=function(){var u=Jl(l);s.call(u)}}var l=B_(n,0,!1,null,null,!1,!1,"",vf);return n._reactRootContainer=l,n[Nr]=l.current,os(n.nodeType===8?n.parentNode:n),ra(function(){Eu(i,l,a,t)}),l}function Mu(n,i,a,t,e){var r=a._reactRootContainer;if(r){var o=r;if(typeof e=="function"){var s=e;e=function(){var l=Jl(o);s.call(l)}}Eu(i,o,n,e)}else o=B1(a,i,n,e,t);return Jl(o)}kp=function(n){switch(n.tag){case 3:var i=n.stateNode;if(i.current.memoizedState.isDehydrated){var a=Do(i.pendingLanes);a!==0&&(t_(i,a|1),cn(i,Ze()),!(Ce&6)&&(Qa=Ze()+500,Mi()))}break;case 13:ra(function(){var t=Vr(n,1);if(t!==null){var e=Qt();nr(t,n,1,e)}}),I_(n,1)}};n_=function(n){if(n.tag===13){var i=Vr(n,134217728);if(i!==null){var a=Qt();nr(i,n,134217728,a)}I_(n,134217728)}};Hp=function(n){if(n.tag===13){var i=mi(n),a=Vr(n,i);if(a!==null){var t=Qt();nr(a,n,i,t)}I_(n,i)}};Gp=function(){return be};Wp=function(n,i){var a=be;try{return be=n,i()}finally{be=a}};Lc=function(n,i,a){switch(i){case"input":if(bc(n,a),i=a.name,a.type==="radio"&&i!=null){for(a=n;a.parentNode;)a=a.parentNode;for(a=a.querySelectorAll("input[name="+JSON.stringify(""+i)+'][type="radio"]'),i=0;i<a.length;i++){var t=a[i];if(t!==n&&t.form===n.form){var e=yu(t);if(!e)throw Error(G(90));wp(t),bc(t,e)}}}break;case"textarea":Cp(n,a);break;case"select":i=a.value,i!=null&&La(n,!!a.multiple,i,!1)}};Rp=M_;Fp=ra;var I1={usingClientEntryPoint:!1,Events:[Ms,Ta,yu,bp,Mp,M_]},Ao={findFiberByHostInstance:Ui,bundleType:0,version:"18.2.0",rendererPackageName:"react-dom"},L1={bundleType:Ao.bundleType,version:Ao.version,rendererPackageName:Ao.rendererPackageName,rendererConfig:Ao.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:Wr.ReactCurrentDispatcher,findHostInstanceByFiber:function(n){return n=Ip(n),n===null?null:n.stateNode},findFiberByHostInstance:Ao.findFiberByHostInstance||D1,findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.2.0-next-9e3b772b8-20220608"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var Zs=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!Zs.isDisabled&&Zs.supportsFiber)try{vu=Zs.inject(L1),gr=Zs}catch{}}bn.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=I1;bn.createPortal=function(n,i){var a=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!z_(i))throw Error(G(200));return F1(n,i,null,a)};bn.createRoot=function(n,i){if(!z_(n))throw Error(G(299));var a=!1,t="",e=h0;return i!=null&&(i.unstable_strictMode===!0&&(a=!0),i.identifierPrefix!==void 0&&(t=i.identifierPrefix),i.onRecoverableError!==void 0&&(e=i.onRecoverableError)),i=B_(n,1,!1,null,null,a,!1,t,e),n[Nr]=i.current,os(n.nodeType===8?n.parentNode:n),new L_(i)};bn.findDOMNode=function(n){if(n==null)return null;if(n.nodeType===1)return n;var i=n._reactInternals;if(i===void 0)throw typeof n.render=="function"?Error(G(188)):(n=Object.keys(n).join(","),Error(G(268,n)));return n=Ip(i),n=n===null?null:n.stateNode,n};bn.flushSync=function(n){return ra(n)};bn.hydrate=function(n,i,a){if(!bu(i))throw Error(G(200));return Mu(null,n,i,!0,a)};bn.hydrateRoot=function(n,i,a){if(!z_(n))throw Error(G(405));var t=a!=null&&a.hydratedSources||null,e=!1,r="",o=h0;if(a!=null&&(a.unstable_strictMode===!0&&(e=!0),a.identifierPrefix!==void 0&&(r=a.identifierPrefix),a.onRecoverableError!==void 0&&(o=a.onRecoverableError)),i=_0(i,null,n,1,a??null,e,!1,r,o),n[Nr]=i.current,os(n),t)for(n=0;n<t.length;n++)a=t[n],e=a._getVersion,e=e(a._source),i.mutableSourceEagerHydrationData==null?i.mutableSourceEagerHydrationData=[a,e]:i.mutableSourceEagerHydrationData.push(a,e);return new Pu(i)};bn.render=function(n,i,a){if(!bu(i))throw Error(G(200));return Mu(null,n,i,!1,a)};bn.unmountComponentAtNode=function(n){if(!bu(n))throw Error(G(40));return n._reactRootContainer?(ra(function(){Mu(null,null,n,!1,function(){n._reactRootContainer=null,n[Nr]=null})}),!0):!1};bn.unstable_batchedUpdates=M_;bn.unstable_renderSubtreeIntoContainer=function(n,i,a,t){if(!bu(a))throw Error(G(200));if(n==null||n._reactInternals===void 0)throw Error(G(38));return Mu(n,i,a,!1,t)};bn.version="18.2.0-next-9e3b772b8-20220608";(function(n){function i(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(i)}catch(a){console.error(a)}}i(),n.exports=bn})(Dm);var pf=xc;yc.createRoot=pf.createRoot,yc.hydrateRoot=pf.hydrateRoot;var Pr;(function(n){n[n.Disjoint=0]="Disjoint",n[n.Contains=1]="Contains",n[n.Intersects=2]="Intersects"})(Pr||(Pr={}));var Wt;(function(n){n[n.Back=0]="Back",n[n.Front=1]="Front",n[n.Intersecting=2]="Intersecting"})(Wt||(Wt={}));var pe;(function(n){n[n.Near=0]="Near",n[n.Far=1]="Far",n[n.Left=2]="Left",n[n.Right=3]="Right",n[n.Bottom=4]="Bottom",n[n.Top=5]="Top"})(pe||(pe={}));function gf(n,i){for(var a=0;a<i.length;a++){var t=i[a];t.enumerable=t.enumerable||!1,t.configurable=!0,"value"in t&&(t.writable=!0),Object.defineProperty(n,t.key,t)}}function Fs(n,i,a){return i&&gf(n.prototype,i),a&&gf(n,a),n}var H=function(){function n(){}return n.clamp=function(a,t,e){return Math.max(t,Math.min(e,a))},n.equals=function(a,t){return Math.abs(a-t)<=n.zeroTolerance},n.isPowerOf2=function(a){return(a&a-1)===0},n.radianToDegree=function(a){return a*n.radToDegreeFactor},n.degreeToRadian=function(a){return a*n.degreeToRadFactor},n}();H.zeroTolerance=1e-6;H.radToDegreeFactor=180/Math.PI;H.degreeToRadFactor=Math.PI/180;var w=function(){function n(a,t,e){a===void 0&&(a=0),t===void 0&&(t=0),e===void 0&&(e=0),this._onValueChanged=null,this._x=a,this._y=t,this._z=e}var i=n.prototype;return i.set=function(t,e,r){return this._x=t,this._y=e,this._z=r,this._onValueChanged&&this._onValueChanged(),this},i.add=function(t){return this._x+=t._x,this._y+=t._y,this._z+=t._z,this._onValueChanged&&this._onValueChanged(),this},i.subtract=function(t){return this._x-=t._x,this._y-=t._y,this._z-=t._z,this._onValueChanged&&this._onValueChanged(),this},i.multiply=function(t){return this._x*=t._x,this._y*=t._y,this._z*=t._z,this._onValueChanged&&this._onValueChanged(),this},i.divide=function(t){return this._x/=t._x,this._y/=t._y,this._z/=t._z,this._onValueChanged&&this._onValueChanged(),this},i.length=function(){var t=this,e=t._x,r=t._y,o=t._z;return Math.sqrt(e*e+r*r+o*o)},i.lengthSquared=function(){var t=this,e=t._x,r=t._y,o=t._z;return e*e+r*r+o*o},i.negate=function(){return this._x=-this._x,this._y=-this._y,this._z=-this._z,this._onValueChanged&&this._onValueChanged(),this},i.normalize=function(){return n.normalize(this,this),this},i.scale=function(t){return this._x*=t,this._y*=t,this._z*=t,this._onValueChanged&&this._onValueChanged(),this},i.transformNormal=function(t){return n.transformNormal(this,t,this),this},i.transformToVec3=function(t){return n.transformToVec3(this,t,this),this},i.transformCoordinate=function(t){return n.transformCoordinate(this,t,this),this},i.transformByQuat=function(t){return n.transformByQuat(this,t,this),this},i.clone=function(){return new n(this._x,this._y,this._z)},i.copyFrom=function(t){return this._x=t.x,this._y=t.y,this._z=t.z,this._onValueChanged&&this._onValueChanged(),this},i.copyFromArray=function(t,e){return e===void 0&&(e=0),this._x=t[e],this._y=t[e+1],this._z=t[e+2],this._onValueChanged&&this._onValueChanged(),this},i.copyToArray=function(t,e){e===void 0&&(e=0),t[e]=this._x,t[e+1]=this._y,t[e+2]=this._z},n.add=function(t,e,r){r._x=t._x+e._x,r._y=t._y+e._y,r._z=t._z+e._z,r._onValueChanged&&r._onValueChanged()},n.subtract=function(t,e,r){r._x=t._x-e._x,r._y=t._y-e._y,r._z=t._z-e._z,r._onValueChanged&&r._onValueChanged()},n.multiply=function(t,e,r){r._x=t._x*e._x,r._y=t._y*e._y,r._z=t._z*e._z,r._onValueChanged&&r._onValueChanged()},n.divide=function(t,e,r){r._x=t._x/e._x,r._y=t._y/e._y,r._z=t._z/e._z,r._onValueChanged&&r._onValueChanged()},n.dot=function(t,e){return t._x*e._x+t._y*e._y+t._z*e._z},n.cross=function(t,e,r){var o=t._x,s=t._y,l=t._z,u=e._x,c=e._y,d=e._z;r.set(s*d-l*c,l*u-o*d,o*c-s*u)},n.distance=function(t,e){var r=e._x-t._x,o=e._y-t._y,s=e._z-t._z;return Math.sqrt(r*r+o*o+s*s)},n.distanceSquared=function(t,e){var r=e._x-t._x,o=e._y-t._y,s=e._z-t._z;return r*r+o*o+s*s},n.equals=function(t,e){return H.equals(t._x,e._x)&&H.equals(t._y,e._y)&&H.equals(t._z,e._z)},n.lerp=function(t,e,r,o){var s=t._x,l=t._y,u=t._z;o._x=s+(e._x-s)*r,o._y=l+(e._y-l)*r,o._z=u+(e._z-u)*r,o._onValueChanged&&o._onValueChanged()},n.max=function(t,e,r){r._x=Math.max(t._x,e._x),r._y=Math.max(t._y,e._y),r._z=Math.max(t._z,e._z),r._onValueChanged&&r._onValueChanged()},n.min=function(t,e,r){r._x=Math.min(t._x,e._x),r._y=Math.min(t._y,e._y),r._z=Math.min(t._z,e._z),r._onValueChanged&&r._onValueChanged()},n.negate=function(t,e){e._x=-t._x,e._y=-t._y,e._z=-t._z,e._onValueChanged&&e._onValueChanged()},n.normalize=function(t,e){var r=t._x,o=t._y,s=t._z,l=Math.sqrt(r*r+o*o+s*s);l>H.zeroTolerance&&(l=1/l,e.set(r*l,o*l,s*l))},n.scale=function(t,e,r){r._x=t._x*e,r._y=t._y*e,r._z=t._z*e,r._onValueChanged&&r._onValueChanged()},n.transformNormal=function(t,e,r){var o=t._x,s=t._y,l=t._z,u=e.elements;r._x=o*u[0]+s*u[4]+l*u[8],r._y=o*u[1]+s*u[5]+l*u[9],r._z=o*u[2]+s*u[6]+l*u[10],r._onValueChanged&&r._onValueChanged()},n.transformToVec3=function(t,e,r){var o=t._x,s=t._y,l=t._z,u=e.elements;r._x=o*u[0]+s*u[4]+l*u[8]+u[12],r._y=o*u[1]+s*u[5]+l*u[9]+u[13],r._z=o*u[2]+s*u[6]+l*u[10]+u[14],r._onValueChanged&&r._onValueChanged()},n.transformToVec4=function(t,e,r){var o=t._x,s=t._y,l=t._z,u=e.elements;r._x=o*u[0]+s*u[4]+l*u[8]+u[12],r._y=o*u[1]+s*u[5]+l*u[9]+u[13],r._z=o*u[2]+s*u[6]+l*u[10]+u[14],r._w=o*u[3]+s*u[7]+l*u[11]+u[15],r._onValueChanged&&r._onValueChanged()},n.transformCoordinate=function(t,e,r){var o=t._x,s=t._y,l=t._z,u=e.elements,c=o*u[3]+s*u[7]+l*u[11]+u[15];c=1/c,r._x=(o*u[0]+s*u[4]+l*u[8]+u[12])*c,r._y=(o*u[1]+s*u[5]+l*u[9]+u[13])*c,r._z=(o*u[2]+s*u[6]+l*u[10]+u[14])*c,r._onValueChanged&&r._onValueChanged()},n.transformByQuat=function(t,e,r){var o=t._x,s=t._y,l=t._z,u=e._x,c=e._y,d=e._z,_=e._w,h=_*o+c*l-d*s,f=_*s+d*o-u*l,g=_*l+u*s-c*o,y=-u*o-c*s-d*l;r._x=h*_-y*u-f*d+g*c,r._y=f*_-y*c-g*u+h*d,r._z=g*_-y*d-h*c+f*u,r._onValueChanged&&r._onValueChanged()},Fs(n,[{key:"x",get:function(){return this._x},set:function(t){this._x=t,this._onValueChanged&&this._onValueChanged()}},{key:"y",get:function(){return this._y},set:function(t){this._y=t,this._onValueChanged&&this._onValueChanged()}},{key:"z",get:function(){return this._z},set:function(t){this._z=t,this._onValueChanged&&this._onValueChanged()}}]),n}();w._zero=new w(0,0,0);w._one=new w(1,1,1);var f0=function(){function n(a,t){a===void 0&&(a=null),t===void 0&&(t=0),this.center=new w,this.radius=0,a&&this.center.copyFrom(a),this.radius=t}var i=n.prototype;return i.clone=function(){return new n(this.center,this.radius)},i.copyFrom=function(t){return this.center.copyFrom(t.center),this.radius=t.radius,this},n.fromPoints=function(t,e){if(!t||t.length===0)throw new Error("points must be array and length must > 0");var r=t.length,o=n._tempVec30;o.x=o.y=o.z=0;for(var s=0;s<r;++s)w.add(t[s],o,o);w.scale(o,1/r,e.center);for(var l=0,u=0;u<r;++u){var c=w.distanceSquared(o,t[u]);c>l&&(l=c)}e.radius=Math.sqrt(l)},n.fromBox=function(t,e){var r=e.center,o=t.min,s=t.max;r.x=(o.x+s.x)*.5,r.y=(o.y+s.y)*.5,r.z=(o.z+s.z)*.5,e.radius=w.distance(r,s)},n}();f0._tempVec30=new w;var sn=function(){function n(a,t){a===void 0&&(a=null),t===void 0&&(t=null),this.min=new w,this.max=new w,a&&this.min.copyFrom(a),t&&this.max.copyFrom(t)}var i=n.prototype;return i.getCenter=function(t){return w.add(this.min,this.max,t),w.scale(t,.5,t),t},i.getExtent=function(t){return w.subtract(this.max,this.min,t),w.scale(t,.5,t),t},i.getCorners=function(t){t===void 0&&(t=[]);var e=this,r=e.min,o=e.max,s=r.x,l=r.y,u=r.z,c=o.x,d=o.y,_=o.z,h=t.length;if(h<8)for(var f=0,g=8-h;f<g;++f)t[h+f]=new w;return t[0].set(s,d,_),t[1].set(c,d,_),t[2].set(c,l,_),t[3].set(s,l,_),t[4].set(s,d,u),t[5].set(c,d,u),t[6].set(c,l,u),t[7].set(s,l,u),t},i.transform=function(t){return n.transform(this,t,this),this},i.clone=function(){return new n(this.min,this.max)},i.copyFrom=function(t){return this.min.copyFrom(t.min),this.max.copyFrom(t.max),this},n.fromCenterAndExtent=function(t,e,r){w.subtract(t,e,r.min),w.add(t,e,r.max)},n.fromPoints=function(t,e){if(!t||t.length===0)throw new Error("points must be array and length must > 0");var r=e.min,o=e.max;r.x=r.y=r.z=Number.MAX_VALUE,o.x=o.y=o.z=-Number.MAX_VALUE;for(var s=0,l=t.length;s<l;++s){var u=t[s];w.min(r,u,r),w.max(o,u,o)}},n.fromSphere=function(t,e){var r=t.center,o=t.radius,s=e.min,l=e.max;s.x=r.x-o,s.y=r.y-o,s.z=r.z-o,l.x=r.x+o,l.y=r.y+o,l.z=r.z+o},n.transform=function(t,e,r){var o=n._tempVec30,s=n._tempVec31;t.getCenter(o),t.getExtent(s),w.transformCoordinate(o,e,o);var l=s.x,u=s.y,c=s.z,d=e.elements;s.x=Math.abs(l*d[0])+Math.abs(u*d[4])+Math.abs(c*d[8]),s.y=Math.abs(l*d[1])+Math.abs(u*d[5])+Math.abs(c*d[9]),s.z=Math.abs(l*d[2])+Math.abs(u*d[6])+Math.abs(c*d[10]),w.subtract(o,s,r.min),w.add(o,s,r.max)},n.merge=function(t,e,r){return w.min(t.min,e.min,r.min),w.max(t.max,e.max,r.max),r},n}();sn._tempVec30=new w;sn._tempVec31=new w;var zt=function(){function n(){}return n.intersectionPointThreePlanes=function(a,t,e,r){var o=a.normal,s=t.normal,l=e.normal;w.cross(s,l,n._tempVec30),w.cross(l,o,n._tempVec31),w.cross(o,s,n._tempVec32);var u=-w.dot(o,n._tempVec30),c=-w.dot(s,n._tempVec31),d=-w.dot(l,n._tempVec32);w.scale(n._tempVec30,a.distance/u,n._tempVec30),w.scale(n._tempVec31,t.distance/c,n._tempVec31),w.scale(n._tempVec32,e.distance/d,n._tempVec32),w.add(n._tempVec30,n._tempVec31,r),w.add(r,n._tempVec32,r)},n.distancePlaneAndPoint=function(a,t){return w.dot(a.normal,t)+a.distance},n.intersectsPlaneAndPoint=function(a,t){var e=n.distancePlaneAndPoint(a,t);return e>0?Wt.Front:e<0?Wt.Back:Wt.Intersecting},n.intersectsPlaneAndBox=function(a,t){var e=t.min,r=t.max,o=a.normal,s=n._tempVec30,l=n._tempVec31;return o.x>=0?(s.x=r.x,l.x=e.x):(s.x=e.x,l.x=r.x),o.y>=0?(s.y=r.y,l.y=e.y):(s.y=e.y,l.y=r.y),o.z>=0?(s.z=r.z,l.z=e.z):(s.z=e.z,l.z=r.z),n.distancePlaneAndPoint(a,s)<0?Wt.Back:n.distancePlaneAndPoint(a,l)>0?Wt.Front:Wt.Intersecting},n.intersectsPlaneAndSphere=function(a,t){var e=t.center,r=t.radius,o=n.distancePlaneAndPoint(a,e);return o>r?Wt.Front:o<-r?Wt.Back:Wt.Intersecting},n.intersectsRayAndPlane=function(a,t){var e=t.normal,r=H.zeroTolerance,o=w.dot(e,a.direction);if(Math.abs(o)<r)return-1;var s=w.dot(e,a.origin),l=(-t.distance-s)/o;if(l<0){if(l<-r)return-1;l=0}return l},n.intersectsRayAndBox=function(a,t){var e=H.zeroTolerance,r=a.origin,o=a.direction,s=t.min,l=t.max,u=o.x,c=o.y,d=o.z,_=r.x,h=r.y,f=r.z,g=0,y=Number.MAX_VALUE;if(Math.abs(u)<e){if(_<s.x||_>l.x)return-1}else{var p=1/u,v=(s.x-_)*p,m=(l.x-_)*p;if(v>m){var x=v;v=m,m=x}if(g=Math.max(v,g),y=Math.min(m,y),g>y)return-1}if(Math.abs(c)<e){if(h<s.y||h>l.y)return-1}else{var S=1/c,C=(s.y-h)*S,A=(l.y-h)*S;if(C>A){var T=C;C=A,A=T}if(g=Math.max(C,g),y=Math.min(A,y),g>y)return-1}if(Math.abs(d)<e){if(f<s.z||f>l.z)return-1}else{var E=1/d,P=(s.z-f)*E,b=(l.z-f)*E;if(P>b){var M=P;P=b,b=M}if(g=Math.max(P,g),y=Math.min(b,y),g>y)return-1}return g},n.intersectsRayAndSphere=function(a,t){var e=a.origin,r=a.direction,o=t.center,s=t.radius,l=n._tempVec30;w.subtract(e,o,l);var u=w.dot(l,r),c=w.dot(l,l)-s*s;if(u>0&&c>0)return-1;var d=u*u-c;if(d<0)return-1;var _=-u-Math.sqrt(d);return _<0&&(_=0),_},n.intersectsBoxAndBox=function(a,t){return a.min.x>t.max.x||t.min.x>a.max.x||a.min.y>t.max.y||t.min.y>a.max.y?!1:!(a.min.z>t.max.z||t.min.z>a.max.z)},n.intersectsSphereAndSphere=function(a,t){var e=a.radius+t.radius;return w.distanceSquared(a.center,t.center)<e*e},n.intersectsSphereAndBox=function(a,t){var e=a.center,r=t.max,o=t.min,s=n._tempVec30;s.set(Math.max(o.x,Math.min(e.x,r.x)),Math.max(o.y,Math.min(e.y,r.y)),Math.max(o.z,Math.min(e.z,r.z)));var l=w.distanceSquared(e,s);return l<=a.radius*a.radius},n.intersectsFrustumAndBox=function(a,t){for(var e=t.min,r=t.max,o=n._tempVec30,s=0;s<6;++s){var l=a.getPlane(s),u=l.normal;if(o.set(u.x>=0?r.x:e.x,u.y>=0?r.y:e.y,u.z>=0?r.z:e.z),w.dot(u,o)<-l.distance)return!1}return!0},n.frustumContainsBox=function(a,t){for(var e=t.min,r=t.max,o=n._tempVec30,s=n._tempVec31,l=Pr.Contains,u=0;u<6;++u){var c=a.getPlane(u),d=c.normal;if(d.x>=0?(o.x=r.x,s.x=e.x):(o.x=e.x,s.x=r.x),d.y>=0?(o.y=r.y,s.y=e.y):(o.y=e.y,s.y=r.y),d.z>=0?(o.z=r.z,s.z=e.z):(o.z=e.z,s.z=r.z),n.intersectsPlaneAndPoint(c,o)===Wt.Back)return Pr.Disjoint;n.intersectsPlaneAndPoint(c,s)===Wt.Back&&(l=Pr.Intersects)}return l},n.frustumContainsSphere=function(a,t){for(var e=Pr.Contains,r=0;r<6;++r){var o=a.getPlane(r),s=n.intersectsPlaneAndSphere(o,t);if(s===Wt.Back)return Pr.Disjoint;if(s===Wt.Intersecting){e=Pr.Intersects;break}}return e},n}();zt._tempVec30=new w;zt._tempVec31=new w;zt._tempVec32=new w;var Le=function(){function n(a,t){a===void 0&&(a=null),t===void 0&&(t=0),this.normal=new w,this.distance=0,a&&this.normal.copyFrom(a),this.distance=t}var i=n.prototype;return i.normalize=function(){return n.normalize(this,this),this},i.clone=function(){var t=new n;return t.copyFrom(this),t},i.copyFrom=function(t){return this.normal.copyFrom(t.normal),this.distance=t.distance,this},n.normalize=function(t,e){var r=t.normal,o=1/r.length();w.scale(r,o,e.normal),e.distance=t.distance*o},n.fromPoints=function(t,e,r,o){var s=t.x,l=t.y,u=t.z,c=e.x-s,d=e.y-l,_=e.z-u,h=r.x-s,f=r.y-l,g=r.z-u,y=d*g-_*f,p=_*h-c*g,v=c*f-d*h,m=1/Math.sqrt(y*y+p*p+v*v),x=y*m,S=p*m,C=v*m,A=o.normal;A.x=x,A.y=S,A.z=C,o.distance=-(x*s+S*l+C*u)},n}(),z1=function(){function n(a){a===void 0&&(a=null),this.near=new Le,this.far=new Le,this.left=new Le,this.right=new Le,this.top=new Le,this.bottom=new Le,a&&this.calculateFromMatrix(a)}var i=n.prototype;return i.getPlane=function(t){switch(t){case pe.Near:return this.near;case pe.Far:return this.far;case pe.Left:return this.left;case pe.Right:return this.right;case pe.Bottom:return this.bottom;case pe.Top:return this.top;default:return null}},i.calculateFromMatrix=function(t){var e=t.elements,r=e[0],o=e[1],s=e[2],l=e[3],u=e[4],c=e[5],d=e[6],_=e[7],h=e[8],f=e[9],g=e[10],y=e[11],p=e[12],v=e[13],m=e[14],x=e[15],S=this.near.normal;S.set(l+s,_+d,y+g),this.near.distance=x+m,this.near.normalize();var C=this.far.normal;C.set(l-s,_-d,y-g),this.far.distance=x-m,this.far.normalize();var A=this.left.normal;A.set(l+r,_+u,y+h),this.left.distance=x+p,this.left.normalize();var T=this.right.normal;T.set(l-r,_-u,y-h),this.right.distance=x-p,this.right.normalize();var E=this.bottom.normal;E.set(l+o,_+c,y+f),this.bottom.distance=x+v,this.bottom.normalize();var P=this.top.normal;P.set(l-o,_-c,y-f),this.top.distance=x-v,this.top.normalize()},i.intersectsBox=function(t){return zt.intersectsFrustumAndBox(this,t)},i.intersectsSphere=function(t){return zt.frustumContainsSphere(this,t)!==Pr.Disjoint},i.clone=function(){var t=new n;return t.copyFrom(this),t},i.copyFrom=function(t){return this.near.copyFrom(t.near),this.far.copyFrom(t.far),this.left.copyFrom(t.left),this.right.copyFrom(t.right),this.bottom.copyFrom(t.bottom),this.top.copyFrom(t.top),this},n}(),$a=function(){function n(a,t,e,r,o,s,l,u,c){a===void 0&&(a=1),t===void 0&&(t=0),e===void 0&&(e=0),r===void 0&&(r=0),o===void 0&&(o=1),s===void 0&&(s=0),l===void 0&&(l=0),u===void 0&&(u=0),c===void 0&&(c=1),this.elements=new Float32Array(9);var d=this.elements;d[0]=a,d[1]=t,d[2]=e,d[3]=r,d[4]=o,d[5]=s,d[6]=l,d[7]=u,d[8]=c}var i=n.prototype;return i.set=function(t,e,r,o,s,l,u,c,d){var _=this.elements;return _[0]=t,_[1]=e,_[2]=r,_[3]=o,_[4]=s,_[5]=l,_[6]=u,_[7]=c,_[8]=d,this},i.add=function(t){return n.add(this,t,this),this},i.subtract=function(t){return n.subtract(this,t,this),this},i.multiply=function(t){return n.multiply(this,t,this),this},i.determinant=function(){var t=this.elements,e=t[0],r=t[1],o=t[2],s=t[3],l=t[4],u=t[5],c=t[6],d=t[7],_=t[8],h=_*l-u*d,f=-_*s+u*c,g=d*s-l*c;return e*h+r*f+o*g},i.identity=function(){var t=this.elements;return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=1,t[5]=0,t[6]=0,t[7]=0,t[8]=1,this},i.invert=function(){return n.invert(this,this),this},i.rotate=function(t){return n.rotate(this,t,this),this},i.scale=function(t){return n.scale(this,t,this),this},i.translate=function(t){return n.translate(this,t,this),this},i.transpose=function(){return n.transpose(this,this),this},i.clone=function(){var t=this.elements,e=new n(t[0],t[1],t[2],t[3],t[4],t[5],t[6],t[7],t[8]);return e},i.copyFrom=function(t){var e=this.elements,r=t.elements;return e[0]=r[0],e[1]=r[1],e[2]=r[2],e[3]=r[3],e[4]=r[4],e[5]=r[5],e[6]=r[6],e[7]=r[7],e[8]=r[8],this},i.copyFromArray=function(t,e){e===void 0&&(e=0);for(var r=this.elements,o=0;o<12;o++)r[o]=t[o+e];return this},i.copyToArray=function(t,e){e===void 0&&(e=0);var r=this.elements;t[e]=r[0],t[e+1]=r[1],t[e+2]=r[2],t[e+3]=r[3],t[e+4]=r[4],t[e+5]=r[5],t[e+6]=r[6],t[e+7]=r[7],t[e+8]=r[8]},i.copyFromMatrix=function(t){var e=t.elements,r=this.elements;return r[0]=e[0],r[1]=e[1],r[2]=e[2],r[3]=e[4],r[4]=e[5],r[5]=e[6],r[6]=e[8],r[7]=e[9],r[8]=e[10],this},n.add=function(t,e,r){var o=t.elements,s=e.elements,l=r.elements;l[0]=o[0]+s[0],l[1]=o[1]+s[1],l[2]=o[2]+s[2],l[3]=o[3]+s[3],l[4]=o[4]+s[4],l[5]=o[5]+s[5],l[6]=o[6]+s[6],l[7]=o[7]+s[7],l[8]=o[8]+s[8]},n.subtract=function(t,e,r){var o=t.elements,s=e.elements,l=r.elements;l[0]=o[0]-s[0],l[1]=o[1]-s[1],l[2]=o[2]-s[2],l[3]=o[3]-s[3],l[4]=o[4]-s[4],l[5]=o[5]-s[5],l[6]=o[6]-s[6],l[7]=o[7]-s[7],l[8]=o[8]-s[8]},n.multiply=function(t,e,r){var o=t.elements,s=e.elements,l=r.elements,u=o[0],c=o[1],d=o[2],_=o[3],h=o[4],f=o[5],g=o[6],y=o[7],p=o[8],v=s[0],m=s[1],x=s[2],S=s[3],C=s[4],A=s[5],T=s[6],E=s[7],P=s[8];l[0]=u*v+_*m+g*x,l[1]=c*v+h*m+y*x,l[2]=d*v+f*m+p*x,l[3]=u*S+_*C+g*A,l[4]=c*S+h*C+y*A,l[5]=d*S+f*C+p*A,l[6]=u*T+_*E+g*P,l[7]=c*T+h*E+y*P,l[8]=d*T+f*E+p*P},n.equals=function(t,e){var r=t.elements,o=e.elements;return H.equals(r[0],o[0])&&H.equals(r[1],o[1])&&H.equals(r[2],o[2])&&H.equals(r[3],o[3])&&H.equals(r[4],o[4])&&H.equals(r[5],o[5])&&H.equals(r[6],o[6])&&H.equals(r[7],o[7])&&H.equals(r[8],o[8])},n.lerp=function(t,e,r,o){var s=t.elements,l=e.elements,u=o.elements,c=1-r;u[0]=s[0]*c+l[0]*r,u[1]=s[1]*c+l[1]*r,u[2]=s[2]*c+l[2]*r,u[3]=s[3]*c+l[3]*r,u[4]=s[4]*c+l[4]*r,u[5]=s[5]*c+l[5]*r,u[6]=s[6]*c+l[6]*r,u[7]=s[7]*c+l[7]*r,u[8]=s[8]*c+l[8]*r},n.rotationQuaternion=function(t,e){var r=e.elements,o=t._x,s=t._y,l=t._z,u=t._w,c=o+o,d=s+s,_=l+l,h=o*c,f=s*c,g=s*d,y=l*c,p=l*d,v=l*_,m=u*c,x=u*d,S=u*_;r[0]=1-g-v,r[3]=f-S,r[6]=y+x,r[1]=f+S,r[4]=1-h-v,r[7]=p-m,r[2]=y-x,r[5]=p+m,r[8]=1-h-g},n.scaling=function(t,e){var r=e.elements;r[0]=t._x,r[1]=0,r[2]=0,r[3]=0,r[4]=t._y,r[5]=0,r[6]=0,r[7]=0,r[8]=1},n.translation=function(a,t){var e=t.elements;e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=1,e[5]=0,e[6]=a._x,e[7]=a._y,e[8]=1},n.invert=function(t,e){var r=t.elements,o=e.elements,s=r[0],l=r[1],u=r[2],c=r[3],d=r[4],_=r[5],h=r[6],f=r[7],g=r[8],y=g*d-_*f,p=-g*c+_*h,v=f*c-d*h,m=s*y+l*p+u*v;m&&(m=1/m,o[0]=y*m,o[1]=(-g*l+u*f)*m,o[2]=(_*l-u*d)*m,o[3]=p*m,o[4]=(g*s-u*h)*m,o[5]=(-_*s+u*c)*m,o[6]=v*m,o[7]=(-f*s+l*h)*m,o[8]=(d*s-l*c)*m)},n.normalMatrix=function(t,e){var r=t.elements,o=e.elements,s=r[0],l=r[1],u=r[2],c=r[3],d=r[4],_=r[5],h=r[6],f=r[7],g=r[8],y=r[9],p=r[10],v=r[11],m=r[12],x=r[13],S=r[14],C=r[15],A=s*_-l*d,T=s*h-u*d,E=s*f-c*d,P=l*h-u*_,b=l*f-c*_,M=u*f-c*h,F=g*x-y*m,I=g*S-p*m,L=g*C-v*m,V=y*S-p*x,U=y*C-v*x,D=p*C-v*S,R=A*D-T*U+E*V+P*L-b*I+M*F;if(!R)return null;R=1/R,o[0]=(_*D-h*U+f*V)*R,o[1]=(h*L-d*D-f*I)*R,o[2]=(d*U-_*L+f*F)*R,o[3]=(u*U-l*D-c*V)*R,o[4]=(s*D-u*L+c*I)*R,o[5]=(l*L-s*U-c*F)*R,o[6]=(x*M-S*b+C*P)*R,o[7]=(S*E-m*M-C*T)*R,o[8]=(m*b-x*E+C*A)*R},n.rotate=function(t,e,r){var o=t.elements,s=r.elements,l=Math.sin(e),u=Math.cos(e),c=o[0],d=o[1],_=o[2],h=o[3],f=o[4],g=o[5],y=o[6],p=o[7],v=o[8];s[0]=u*c+l*h,s[1]=u*d+l*f,s[2]=u*_+l*g,s[3]=u*h-l*c,s[4]=u*f-l*d,s[5]=u*g-l*_,s[6]=y,s[7]=p,s[8]=v},n.scale=function(t,e,r){var o=e._x,s=e._y,l=t.elements,u=r.elements;u[0]=o*l[0],u[1]=o*l[1],u[2]=o*l[2],u[3]=s*l[3],u[4]=s*l[4],u[5]=s*l[5],u[6]=l[6],u[7]=l[7],u[8]=l[8]},n.translate=function(t,e,r){var o=e._x,s=e._y,l=t.elements,u=r.elements,c=l[0],d=l[1],_=l[2],h=l[3],f=l[4],g=l[5],y=l[6],p=l[7],v=l[8];u[0]=c,u[1]=d,u[2]=_,u[3]=h,u[4]=f,u[5]=g,u[6]=o*c+s*h+y,u[7]=o*d+s*f+p,u[8]=o*_+s*g+v},n.transpose=function(t,e){var r=t.elements,o=e.elements;if(e===t){var s=r[1],l=r[2],u=r[5];o[1]=r[3],o[2]=r[6],o[3]=s,o[5]=r[7],o[6]=l,o[7]=u}else o[0]=r[0],o[1]=r[3],o[2]=r[6],o[3]=r[1],o[4]=r[4],o[5]=r[7],o[6]=r[2],o[7]=r[5],o[8]=r[8]},n}(),ve=function(){function n(a,t,e,r){a===void 0&&(a=0),t===void 0&&(t=0),e===void 0&&(e=0),r===void 0&&(r=1),this._onValueChanged=null,this._x=a,this._y=t,this._z=e,this._w=r}var i=n.prototype;return i.set=function(t,e,r,o){return this._x=t,this._y=e,this._z=r,this._w=o,this._onValueChanged&&this._onValueChanged(),this},i.conjugate=function(){return this._x*=-1,this._y*=-1,this._z*=-1,this._onValueChanged&&this._onValueChanged(),this},i.getAxisAngle=function(t){var e=this,r=e._x,o=e._y,s=e._z,l=r*r+o*o+s*s;if(l<H.zeroTolerance)return t._x=1,t._y=0,t._z=0,0;var u=1/l;return t._x=this._x*u,t._y=this._y*u,t._z=this._z*u,Math.acos(this._w)*2},i.identity=function(){return this._x=0,this._y=0,this._z=0,this._w=1,this._onValueChanged&&this._onValueChanged(),this},i.length=function(){var t=this,e=t._x,r=t._y,o=t._z,s=t._w;return Math.sqrt(e*e+r*r+o*o+s*s)},i.lengthSquared=function(){var t=this,e=t._x,r=t._y,o=t._z,s=t._w;return e*e+r*r+o*o+s*s},i.normalize=function(){return n.normalize(this,this),this},i.toEuler=function(t){this._toYawPitchRoll(t);var e=t._x;return t._x=t._y,t._y=e,t._onValueChanged&&t._onValueChanged(),t},i.toYawPitchRoll=function(t){return this._toYawPitchRoll(t),t._onValueChanged&&t._onValueChanged(),t},i.rotateX=function(t){return n.rotateX(this,t,this),this},i.rotateY=function(t){return n.rotateY(this,t,this),this},i.rotateZ=function(t){return n.rotateZ(this,t,this),this},i.rotationAxisAngle=function(t,e){return n.rotationAxisAngle(t,e,this),this},i.multiply=function(t){return n.multiply(this,t,this),this},i.invert=function(){return n.invert(this,this),this},i.dot=function(t){return n.dot(this,t)},i.lerp=function(t,e){return n.lerp(this,t,e,this),this},i.rotateAxisAngle=function(t,e){return n._tempQuat1.rotationAxisAngle(t,e),this.multiply(n._tempQuat1),this},i.clone=function(){return new n(this._x,this._y,this._z,this._w)},i.copyFrom=function(t){return this._x=t.x,this._y=t.y,this._z=t.z,this._w=t.w,this._onValueChanged&&this._onValueChanged(),this},i.copyFromArray=function(t,e){return e===void 0&&(e=0),this._x=t[e],this._y=t[e+1],this._z=t[e+2],this._w=t[e+3],this._onValueChanged&&this._onValueChanged(),this},i.copyToArray=function(t,e){e===void 0&&(e=0),t[e]=this._x,t[e+1]=this._y,t[e+2]=this._z,t[e+3]=this._w},i._toYawPitchRoll=function(t){var e=this,r=e._x,o=e._y,s=e._z,l=e._w,u=r*r,c=2*(r*l-o*s);t._y=Math.abs(c)>=1?Math.sign(c)*(Math.PI/2):Math.asin(c),t._x=Math.atan2(2*(s*r+o*l),1-2*(o*o+u)),t._z=Math.atan2(2*(r*o+s*l),1-2*(s*s+u))},n.add=function(t,e,r){r._x=t._x+e._x,r._y=t._y+e._y,r._z=t._z+e._z,r._w=t._w+e._w,r._onValueChanged&&r._onValueChanged()},n.multiply=function(t,e,r){var o=t._x,s=t._y,l=t._z,u=t._w,c=e._x,d=e._y,_=e._z,h=e._w;r._x=o*h+u*c+s*_-l*d,r._y=s*h+u*d+l*c-o*_,r._z=l*h+u*_+o*d-s*c,r._w=u*h-o*c-s*d-l*_,r._onValueChanged&&r._onValueChanged()},n.conjugate=function(t,e){e._x=-t._x,e._y=-t._y,e._z=-t._z,e._w=t._w,e._onValueChanged&&e._onValueChanged()},n.dot=function(t,e){return t._x*e._x+t._y*e._y+t._z*e._z+t._w*e._w},n.equals=function(t,e){return H.equals(t._x,e._x)&&H.equals(t._y,e._y)&&H.equals(t._z,e._z)&&H.equals(t._w,e._w)},n.rotationAxisAngle=function(t,e,r){var o=n._tempVector3;w.normalize(t,o),e*=.5;var s=Math.sin(e);r._x=o._x*s,r._y=o._y*s,r._z=o._z*s,r._w=Math.cos(e),r._onValueChanged&&r._onValueChanged()},n.rotationEuler=function(t,e,r,o){n.rotationYawPitchRoll(e,t,r,o)},n.rotationYawPitchRoll=function(t,e,r,o){var s=r*.5,l=e*.5,u=t*.5,c=Math.sin(s),d=Math.cos(s),_=Math.sin(l),h=Math.cos(l),f=Math.sin(u),g=Math.cos(u),y=g*h,p=f*_;o._x=g*_*d+f*h*c,o._y=f*h*d-g*_*c,o._z=y*c-p*d,o._w=y*d+p*c,o._onValueChanged&&o._onValueChanged()},n.rotationMatrix3x3=function(t,e){var r=t.elements,o=r[0],s=r[1],l=r[2],u=r[3],c=r[4],d=r[5],_=r[6],h=r[7],f=r[8],g=o+c+f,y,p;g>0?(y=Math.sqrt(g+1),e._w=y*.5,y=.5/y,e._x=(d-h)*y,e._y=(_-l)*y,e._z=(s-u)*y):o>=c&&o>=f?(y=Math.sqrt(1+o-c-f),p=.5/y,e._x=.5*y,e._y=(s+u)*p,e._z=(l+_)*p,e._w=(d-h)*p):c>f?(y=Math.sqrt(1+c-o-f),p=.5/y,e._x=(u+s)*p,e._y=.5*y,e._z=(h+d)*p,e._w=(_-l)*p):(y=Math.sqrt(1+f-o-c),p=.5/y,e._x=(l+_)*p,e._y=(d+h)*p,e._z=.5*y,e._w=(s-u)*p),e._onValueChanged&&e._onValueChanged()},n.invert=function(t,e){var r=t._x,o=t._y,s=t._z,l=t._w,u=r*r+o*o+s*s+l*l;if(u>H.zeroTolerance){var c=1/u;e._x=-r*c,e._y=-o*c,e._z=-s*c,e._w=l*c,e._onValueChanged&&e._onValueChanged()}},n.lerp=function(t,e,r,o){var s=1-r;n.dot(t,e)>=0?(o._x=t._x*s+e._x*r,o._y=t._y*s+e._y*r,o._z=t._z*s+e._z*r,o._w=t._w*s+e._w*r):(o._x=t._x*s-e._x*r,o._y=t._y*s-e._y*r,o._z=t._z*s-e._z*r,o._w=t._w*s-e._w*r),o.normalize()},n.slerp=function(t,e,r,o){var s,l,u=n.dot(t,e);if(Math.abs(u)>1-H.zeroTolerance)l=1-r,s=r*Math.sign(u);else{var c=Math.acos(Math.abs(u)),d=1/Math.sin(c);l=Math.sin((1-r)*c)*d,s=Math.sin(r*c)*d*Math.sign(u)}o.x=l*t.x+s*e.x,o.y=l*t.y+s*e.y,o.z=l*t.z+s*e.z,o.w=l*t.w+s*e.w,o._onValueChanged&&o._onValueChanged()},n.normalize=function(t,e){var r=t._x,o=t._y,s=t._z,l=t._w,u=Math.sqrt(r*r+o*o+s*s+l*l);u>H.zeroTolerance&&(u=1/u,e._x=r*u,e._y=o*u,e._z=s*u,e._w=l*u,e._onValueChanged&&e._onValueChanged())},n.rotationX=function(t,e){t*=.5;var r=Math.sin(t),o=Math.cos(t);e._x=r,e._y=0,e._z=0,e._w=o,e._onValueChanged&&e._onValueChanged()},n.rotationY=function(t,e){t*=.5;var r=Math.sin(t),o=Math.cos(t);e._x=0,e._y=r,e._z=0,e._w=o,e._onValueChanged&&e._onValueChanged()},n.rotationZ=function(t,e){t*=.5;var r=Math.sin(t),o=Math.cos(t);e._x=0,e._y=0,e._z=r,e._w=o,e._onValueChanged&&e._onValueChanged()},n.rotateX=function(t,e,r){var o=t._x,s=t._y,l=t._z,u=t._w;e*=.5;var c=Math.sin(e),d=Math.cos(e);r._x=o*d+u*c,r._y=s*d+l*c,r._z=l*d-s*c,r._w=u*d-o*c,r._onValueChanged&&r._onValueChanged()},n.rotateY=function(t,e,r){var o=t._x,s=t._y,l=t._z,u=t._w;e*=.5;var c=Math.sin(e),d=Math.cos(e);r._x=o*d-l*c,r._y=s*d+u*c,r._z=l*d+o*c,r._w=u*d-s*c,r._onValueChanged&&r._onValueChanged()},n.rotateZ=function(t,e,r){var o=t._x,s=t._y,l=t._z,u=t._w;e*=.5;var c=Math.sin(e),d=Math.cos(e);r._x=o*d+s*c,r._y=s*d-o*c,r._z=l*d+u*c,r._w=u*d-l*c,r._onValueChanged&&r._onValueChanged()},n.scale=function(t,e,r){r._x=t._x*e,r._y=t._y*e,r._z=t._z*e,r._w=t._w*e,r._onValueChanged&&r._onValueChanged()},Fs(n,[{key:"x",get:function(){return this._x},set:function(t){this._x=t,this._onValueChanged&&this._onValueChanged()}},{key:"y",get:function(){return this._y},set:function(t){this._y=t,this._onValueChanged&&this._onValueChanged()}},{key:"z",get:function(){return this._z},set:function(t){this._z=t,this._onValueChanged&&this._onValueChanged()}},{key:"normalized",get:function(){return Math.abs(this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w-1)<H.zeroTolerance}},{key:"w",get:function(){return this._w},set:function(t){this._w=t,this._onValueChanged&&this._onValueChanged()}}]),n}();ve._tempVector3=new w;ve._tempQuat1=new ve;var J=function(){function n(a,t,e,r,o,s,l,u,c,d,_,h,f,g,y,p){a===void 0&&(a=1),t===void 0&&(t=0),e===void 0&&(e=0),r===void 0&&(r=0),o===void 0&&(o=0),s===void 0&&(s=1),l===void 0&&(l=0),u===void 0&&(u=0),c===void 0&&(c=0),d===void 0&&(d=0),_===void 0&&(_=1),h===void 0&&(h=0),f===void 0&&(f=0),g===void 0&&(g=0),y===void 0&&(y=0),p===void 0&&(p=1),this.elements=new Float32Array(16);var v=this.elements;v[0]=a,v[1]=t,v[2]=e,v[3]=r,v[4]=o,v[5]=s,v[6]=l,v[7]=u,v[8]=c,v[9]=d,v[10]=_,v[11]=h,v[12]=f,v[13]=g,v[14]=y,v[15]=p}var i=n.prototype;return i.set=function(t,e,r,o,s,l,u,c,d,_,h,f,g,y,p,v){var m=this.elements;return m[0]=t,m[1]=e,m[2]=r,m[3]=o,m[4]=s,m[5]=l,m[6]=u,m[7]=c,m[8]=d,m[9]=_,m[10]=h,m[11]=f,m[12]=g,m[13]=y,m[14]=p,m[15]=v,this},i.multiply=function(t){return n.multiply(this,t,this),this},i.determinant=function(){var t=this.elements,e=t[0],r=t[1],o=t[2],s=t[3],l=t[4],u=t[5],c=t[6],d=t[7],_=t[8],h=t[9],f=t[10],g=t[11],y=t[12],p=t[13],v=t[14],m=t[15],x=e*u-r*l,S=e*c-o*l,C=e*d-s*l,A=r*c-o*u,T=r*d-s*u,E=o*d-s*c,P=_*p-h*y,b=_*v-f*y,M=_*m-g*y,F=h*v-f*p,I=h*m-g*p,L=f*m-g*v;return x*L-S*I+C*F+A*M-T*b+E*P},i.decompose=function(t,e,r){var o=n._tempMat30,s=this.elements,l=o.elements,u=s[0],c=s[1],d=s[2],_=s[3],h=s[4],f=s[5],g=s[6],y=s[7],p=s[8],v=s[9],m=s[10],x=s[11];t.set(s[12],s[13],s[14]);var S=Math.sign(u*c*d*_)<0?-1:1,C=Math.sign(h*f*g*y)<0?-1:1,A=Math.sign(p*v*m*x)<0?-1:1,T=S*Math.sqrt(u*u+c*c+d*d),E=C*Math.sqrt(h*h+f*f+g*g),P=A*Math.sqrt(p*p+v*v+m*m);if(r.set(T,E,P),Math.abs(T)<H.zeroTolerance||Math.abs(E)<H.zeroTolerance||Math.abs(P)<H.zeroTolerance)return e.identity(),!1;var b=1/T,M=1/E,F=1/P;return l[0]=u*b,l[1]=c*b,l[2]=d*b,l[3]=h*M,l[4]=f*M,l[5]=g*M,l[6]=p*F,l[7]=v*F,l[8]=m*F,ve.rotationMatrix3x3(o,e),!0},i.getRotation=function(t){var e=this.elements,r=e[0]+e[5]+e[10];if(r>H.zeroTolerance){var o=Math.sqrt(r+1)*2;t._w=.25*o,t._x=(e[6]-e[9])/o,t._y=(e[8]-e[2])/o,t._z=(e[1]-e[4])/o}else if(e[0]>e[5]&&e[0]>e[10]){var s=Math.sqrt(1+e[0]-e[5]-e[10])*2;t._w=(e[6]-e[9])/s,t._x=.25*s,t._y=(e[1]+e[4])/s,t._z=(e[8]+e[2])/s}else if(e[5]>e[10]){var l=Math.sqrt(1+e[5]-e[0]-e[10])*2;t._w=(e[8]-e[2])/l,t._x=(e[1]+e[4])/l,t._y=.25*l,t._z=(e[6]+e[9])/l}else{var u=Math.sqrt(1+e[10]-e[0]-e[5])*2;t._w=(e[1]-e[4])/u,t._x=(e[8]+e[2])/u,t._y=(e[6]+e[9])/u,t._z=.25*u}return t._onValueChanged&&t._onValueChanged(),t},i.getScaling=function(t){var e=this.elements,r=e[0],o=e[1],s=e[2],l=e[4],u=e[5],c=e[6],d=e[8],_=e[9],h=e[10];return t.set(Math.sqrt(r*r+o*o+s*s),Math.sqrt(l*l+u*u+c*c),Math.sqrt(d*d+_*_+h*h)),t},i.getTranslation=function(t){var e=this.elements;return t.set(e[12],e[13],e[14]),t},i.identity=function(){var t=this.elements;return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,this},i.invert=function(){return n.invert(this,this),this},i.rotateAxisAngle=function(t,e){return n.rotateAxisAngle(this,t,e,this),this},i.scale=function(t){return n.scale(this,t,this),this},i.translate=function(t){return n.translate(this,t,this),this},i.transpose=function(){return n.transpose(this,this),this},i.clone=function(){var t=this.elements,e=new n(t[0],t[1],t[2],t[3],t[4],t[5],t[6],t[7],t[8],t[9],t[10],t[11],t[12],t[13],t[14],t[15]);return e},i.copyFrom=function(t){var e=this.elements,r=t.elements;return e[0]=r[0],e[1]=r[1],e[2]=r[2],e[3]=r[3],e[4]=r[4],e[5]=r[5],e[6]=r[6],e[7]=r[7],e[8]=r[8],e[9]=r[9],e[10]=r[10],e[11]=r[11],e[12]=r[12],e[13]=r[13],e[14]=r[14],e[15]=r[15],this},i.copyFromArray=function(t,e){e===void 0&&(e=0);for(var r=this.elements,o=0;o<16;o++)r[o]=t[o+e];return this},i.copyToArray=function(t,e){e===void 0&&(e=0);var r=this.elements;t[e]=r[0],t[e+1]=r[1],t[e+2]=r[2],t[e+3]=r[3],t[e+4]=r[4],t[e+5]=r[5],t[e+6]=r[6],t[e+7]=r[7],t[e+8]=r[8],t[e+9]=r[9],t[e+10]=r[10],t[e+11]=r[11],t[e+12]=r[12],t[e+13]=r[13],t[e+14]=r[14],t[e+15]=r[15]},n.multiply=function(t,e,r){var o=t.elements,s=e.elements,l=r.elements,u=o[0],c=o[1],d=o[2],_=o[3],h=o[4],f=o[5],g=o[6],y=o[7],p=o[8],v=o[9],m=o[10],x=o[11],S=o[12],C=o[13],A=o[14],T=o[15],E=s[0],P=s[1],b=s[2],M=s[3],F=s[4],I=s[5],L=s[6],V=s[7],U=s[8],D=s[9],R=s[10],N=s[11],X=s[12],q=s[13],te=s[14],ie=s[15];l[0]=u*E+h*P+p*b+S*M,l[1]=c*E+f*P+v*b+C*M,l[2]=d*E+g*P+m*b+A*M,l[3]=_*E+y*P+x*b+T*M,l[4]=u*F+h*I+p*L+S*V,l[5]=c*F+f*I+v*L+C*V,l[6]=d*F+g*I+m*L+A*V,l[7]=_*F+y*I+x*L+T*V,l[8]=u*U+h*D+p*R+S*N,l[9]=c*U+f*D+v*R+C*N,l[10]=d*U+g*D+m*R+A*N,l[11]=_*U+y*D+x*R+T*N,l[12]=u*X+h*q+p*te+S*ie,l[13]=c*X+f*q+v*te+C*ie,l[14]=d*X+g*q+m*te+A*ie,l[15]=_*X+y*q+x*te+T*ie},n.equals=function(t,e){var r=t.elements,o=e.elements;return H.equals(r[0],o[0])&&H.equals(r[1],o[1])&&H.equals(r[2],o[2])&&H.equals(r[3],o[3])&&H.equals(r[4],o[4])&&H.equals(r[5],o[5])&&H.equals(r[6],o[6])&&H.equals(r[7],o[7])&&H.equals(r[8],o[8])&&H.equals(r[9],o[9])&&H.equals(r[10],o[10])&&H.equals(r[11],o[11])&&H.equals(r[12],o[12])&&H.equals(r[13],o[13])&&H.equals(r[14],o[14])&&H.equals(r[15],o[15])},n.lerp=function(t,e,r,o){var s=t.elements,l=e.elements,u=o.elements,c=1-r;u[0]=s[0]*c+l[0]*r,u[1]=s[1]*c+l[1]*r,u[2]=s[2]*c+l[2]*r,u[3]=s[3]*c+l[3]*r,u[4]=s[4]*c+l[4]*r,u[5]=s[5]*c+l[5]*r,u[6]=s[6]*c+l[6]*r,u[7]=s[7]*c+l[7]*r,u[8]=s[8]*c+l[8]*r,u[9]=s[9]*c+l[9]*r,u[10]=s[10]*c+l[10]*r,u[11]=s[11]*c+l[11]*r,u[12]=s[12]*c+l[12]*r,u[13]=s[13]*c+l[13]*r,u[14]=s[14]*c+l[14]*r,u[15]=s[15]*c+l[15]*r},n.add=function(t,e,r){var o=t.elements,s=e.elements,l=r.elements;l[0]=o[0]+s[0],l[1]=o[1]+s[1],l[2]=o[2]+s[2],l[3]=o[3]+s[3],l[4]=o[4]+s[4],l[5]=o[5]+s[5],l[6]=o[6]+s[6],l[7]=o[7]+s[7],l[8]=o[8]+s[8],l[9]=o[9]+s[9],l[10]=o[10]+s[10],l[11]=o[11]+s[11],l[12]=o[12]+s[12],l[13]=o[13]+s[13],l[14]=o[14]+s[14],l[15]=o[15]+s[15]},n.multiplyScalar=function(t,e,r){var o=t.elements,s=r.elements;s[0]=o[0]*e,s[1]=o[1]*e,s[2]=o[2]*e,s[3]=o[3]*e,s[4]=o[4]*e,s[5]=o[5]*e,s[6]=o[6]*e,s[7]=o[7]*e,s[8]=o[8]*e,s[9]=o[9]*e,s[10]=o[10]*e,s[11]=o[11]*e,s[12]=o[12]*e,s[13]=o[13]*e,s[14]=o[14]*e,s[15]=o[15]*e},n.rotationQuaternion=function(t,e){var r=e.elements,o=t._x,s=t._y,l=t._z,u=t._w,c=o+o,d=s+s,_=l+l,h=o*c,f=s*c,g=s*d,y=l*c,p=l*d,v=l*_,m=u*c,x=u*d,S=u*_;r[0]=1-g-v,r[1]=f+S,r[2]=y-x,r[3]=0,r[4]=f-S,r[5]=1-h-v,r[6]=p+m,r[7]=0,r[8]=y+x,r[9]=p-m,r[10]=1-h-g,r[11]=0,r[12]=0,r[13]=0,r[14]=0,r[15]=1},n.rotationAxisAngle=function(t,e,r){var o=r.elements,s=t._x,l=t._y,u=t._z,c=Math.sqrt(s*s+l*l+u*u),d,_,h;Math.abs(c)<H.zeroTolerance||(c=1/c,s*=c,l*=c,u*=c,d=Math.sin(e),_=Math.cos(e),h=1-_,o[0]=s*s*h+_,o[1]=l*s*h+u*d,o[2]=u*s*h-l*d,o[3]=0,o[4]=s*l*h-u*d,o[5]=l*l*h+_,o[6]=u*l*h+s*d,o[7]=0,o[8]=s*u*h+l*d,o[9]=l*u*h-s*d,o[10]=u*u*h+_,o[11]=0,o[12]=0,o[13]=0,o[14]=0,o[15]=1)},n.rotationTranslation=function(t,e,r){n.rotationQuaternion(t,r);var o=r.elements;o[12]=e._x,o[13]=e._y,o[14]=e._z},n.affineTransformation=function(t,e,r,o){var s=o.elements,l=e._x,u=e._y,c=e._z,d=e._w,_=l+l,h=u+u,f=c+c,g=l*_,y=l*h,p=l*f,v=u*h,m=u*f,x=c*f,S=d*_,C=d*h,A=d*f,T=t._x,E=t._y,P=t._z;s[0]=(1-(v+x))*T,s[1]=(y+A)*T,s[2]=(p-C)*T,s[3]=0,s[4]=(y-A)*E,s[5]=(1-(g+x))*E,s[6]=(m+S)*E,s[7]=0,s[8]=(p+C)*P,s[9]=(m-S)*P,s[10]=(1-(g+v))*P,s[11]=0,s[12]=r._x,s[13]=r._y,s[14]=r._z,s[15]=1},n.scaling=function(t,e){var r=e.elements;r[0]=t._x,r[1]=0,r[2]=0,r[3]=0,r[4]=0,r[5]=t._y,r[6]=0,r[7]=0,r[8]=0,r[9]=0,r[10]=t._z,r[11]=0,r[12]=0,r[13]=0,r[14]=0,r[15]=1},n.translation=function(a,t){var e=t.elements;e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=a._x,e[13]=a._y,e[14]=a._z,e[15]=1},n.invert=function(t,e){var r=t.elements,o=e.elements,s=r[0],l=r[1],u=r[2],c=r[3],d=r[4],_=r[5],h=r[6],f=r[7],g=r[8],y=r[9],p=r[10],v=r[11],m=r[12],x=r[13],S=r[14],C=r[15],A=s*_-l*d,T=s*h-u*d,E=s*f-c*d,P=l*h-u*_,b=l*f-c*_,M=u*f-c*h,F=g*x-y*m,I=g*S-p*m,L=g*C-v*m,V=y*S-p*x,U=y*C-v*x,D=p*C-v*S,R=A*D-T*U+E*V+P*L-b*I+M*F;if(!R)return null;R=1/R,o[0]=(_*D-h*U+f*V)*R,o[1]=(u*U-l*D-c*V)*R,o[2]=(x*M-S*b+C*P)*R,o[3]=(p*b-y*M-v*P)*R,o[4]=(h*L-d*D-f*I)*R,o[5]=(s*D-u*L+c*I)*R,o[6]=(S*E-m*M-C*T)*R,o[7]=(g*M-p*E+v*T)*R,o[8]=(d*U-_*L+f*F)*R,o[9]=(l*L-s*U-c*F)*R,o[10]=(m*b-x*E+C*A)*R,o[11]=(y*E-g*b-v*A)*R,o[12]=(_*I-d*V-h*F)*R,o[13]=(s*V-l*I+u*F)*R,o[14]=(x*T-m*P-S*A)*R,o[15]=(g*P-y*T+p*A)*R},n.lookAt=function(t,e,r,o){var s=o.elements,l=n._tempVec30,u=n._tempVec31,c=n._tempVec32;w.subtract(t,e,c),c.normalize(),w.cross(r,c,l),l.normalize(),w.cross(c,l,u),s[0]=l._x,s[1]=u._x,s[2]=c._x,s[3]=0,s[4]=l._y,s[5]=u._y,s[6]=c._y,s[7]=0,s[8]=l._z,s[9]=u._z,s[10]=c._z,s[11]=0,s[12]=-w.dot(l,t),s[13]=-w.dot(u,t),s[14]=-w.dot(c,t),s[15]=1},n.ortho=function(t,e,r,o,s,l,u){var c=u.elements,d=1/(t-e),_=1/(r-o),h=1/(s-l);c[0]=-2*d,c[1]=0,c[2]=0,c[3]=0,c[4]=0,c[5]=-2*_,c[6]=0,c[7]=0,c[8]=0,c[9]=0,c[10]=2*h,c[11]=0,c[12]=(t+e)*d,c[13]=(o+r)*_,c[14]=(l+s)*h,c[15]=1},n.perspective=function(t,e,r,o,s){var l=s.elements,u=1/Math.tan(t/2),c=1/(r-o);l[0]=u/e,l[1]=0,l[2]=0,l[3]=0,l[4]=0,l[5]=u,l[6]=0,l[7]=0,l[8]=0,l[9]=0,l[10]=(o+r)*c,l[11]=-1,l[12]=0,l[13]=0,l[14]=2*o*r*c,l[15]=0},n.rotateAxisAngle=function(t,e,r,o){var s=e._x,l=e._y,u=e._z,c=Math.sqrt(s*s+l*l+u*u);if(!(Math.abs(c)<H.zeroTolerance)){var d=t.elements,_=o.elements,h,f,g;c=1/c,s*=c,l*=c,u*=c,h=Math.sin(r),f=Math.cos(r),g=1-f;var y=d[0],p=d[1],v=d[2],m=d[3],x=d[4],S=d[5],C=d[6],A=d[7],T=d[8],E=d[9],P=d[10],b=d[11],M=s*s*g+f,F=l*s*g+u*h,I=u*s*g-l*h,L=s*l*g-u*h,V=l*l*g+f,U=u*l*g+s*h,D=s*u*g+l*h,R=l*u*g-s*h,N=u*u*g+f;_[0]=y*M+x*F+T*I,_[1]=p*M+S*F+E*I,_[2]=v*M+C*F+P*I,_[3]=m*M+A*F+b*I,_[4]=y*L+x*V+T*U,_[5]=p*L+S*V+E*U,_[6]=v*L+C*V+P*U,_[7]=m*L+A*V+b*U,_[8]=y*D+x*R+T*N,_[9]=p*D+S*R+E*N,_[10]=v*D+C*R+P*N,_[11]=m*D+A*R+b*N,t!==o&&(_[12]=d[12],_[13]=d[13],_[14]=d[14],_[15]=d[15])}},n.scale=function(t,e,r){var o=t.elements,s=r.elements,l=e._x,u=e._y,c=e._z;s[0]=o[0]*l,s[1]=o[1]*l,s[2]=o[2]*l,s[3]=o[3]*l,s[4]=o[4]*u,s[5]=o[5]*u,s[6]=o[6]*u,s[7]=o[7]*u,s[8]=o[8]*c,s[9]=o[9]*c,s[10]=o[10]*c,s[11]=o[11]*c,s[12]=o[12],s[13]=o[13],s[14]=o[14],s[15]=o[15]},n.translate=function(t,e,r){var o=t.elements,s=r.elements,l=e._x,u=e._y,c=e._z;if(t===r)s[12]=o[0]*l+o[4]*u+o[8]*c+o[12],s[13]=o[1]*l+o[5]*u+o[9]*c+o[13],s[14]=o[2]*l+o[6]*u+o[10]*c+o[14],s[15]=o[3]*l+o[7]*u+o[11]*c+o[15];else{var d=o[0],_=o[1],h=o[2],f=o[3],g=o[4],y=o[5],p=o[6],v=o[7],m=o[8],x=o[9],S=o[10],C=o[11];s[0]=d,s[1]=_,s[2]=h,s[3]=f,s[4]=g,s[5]=y,s[6]=p,s[7]=v,s[8]=m,s[9]=x,s[10]=S,s[11]=C,s[12]=d*l+g*u+m*c+o[12],s[13]=_*l+y*u+x*c+o[13],s[14]=h*l+p*u+S*c+o[14],s[15]=f*l+v*u+C*c+o[15]}},n.relectFromPlane=function(t,e){var r=e.elements;r[0]=1-2*t.x*t.x,r[1]=-2*t.y*t.x,r[2]=-2*t.z*t.x,r[3]=0,r[4]=-2*t.x*t.y,r[5]=1-2*t.y*t.y,r[6]=-2*t.y*t.x,r[7]=0,r[8]=-2*t.x*t.z,r[9]=-2*t.y*t.z,r[10]=1-2*t.z*t.z,r[11]=0,r[12]=-2*t.w*t.x,r[13]=-2*t.w*t.y,r[14]=-2*t.w*t.z,r[15]=1},n.transpose=function(t,e){var r=t.elements,o=e.elements;if(e===t){var s=r[1],l=r[2],u=r[3],c=r[6],d=r[7],_=r[11];o[1]=r[4],o[2]=r[8],o[3]=r[12],o[4]=s,o[6]=r[9],o[7]=r[13],o[8]=l,o[9]=c,o[11]=r[14],o[12]=u,o[13]=d,o[14]=_}else o[0]=r[0],o[1]=r[4],o[2]=r[8],o[3]=r[12],o[4]=r[1],o[5]=r[5],o[6]=r[9],o[7]=r[13],o[8]=r[2],o[9]=r[6],o[10]=r[10],o[11]=r[14],o[12]=r[3],o[13]=r[7],o[14]=r[11],o[15]=r[15]},n}();J._tempVec30=new w;J._tempVec31=new w;J._tempVec32=new w;J._tempMat30=new $a;J._identity=new J(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1);var O1=function(){function n(a,t){a===void 0&&(a=null),t===void 0&&(t=null),this.origin=new w,this.direction=new w,a&&this.origin.copyFrom(a),t&&this.direction.copyFrom(t)}var i=n.prototype;return i.intersectPlane=function(t){return zt.intersectsRayAndPlane(this,t)},i.intersectSphere=function(t){return zt.intersectsRayAndSphere(this,t)},i.intersectBox=function(t){return zt.intersectsRayAndBox(this,t)},i.getPoint=function(t,e){return w.scale(this.direction,t,e),e.add(this.origin)},n}(),W=function(){function n(a,t){a===void 0&&(a=0),t===void 0&&(t=0),this._onValueChanged=null,this._x=a,this._y=t}var i=n.prototype;return i.set=function(t,e){return this._x=t,this._y=e,this._onValueChanged&&this._onValueChanged(),this},i.add=function(t){return this._x+=t._x,this._y+=t._y,this._onValueChanged&&this._onValueChanged(),this},i.subtract=function(t){return this._x-=t._x,this._y-=t._y,this._onValueChanged&&this._onValueChanged(),this},i.multiply=function(t){return this._x*=t._x,this._y*=t._y,this._onValueChanged&&this._onValueChanged(),this},i.divide=function(t){return this._x/=t._x,this._y/=t._y,this._onValueChanged&&this._onValueChanged(),this},i.length=function(){var t=this,e=t._x,r=t._y;return Math.sqrt(e*e+r*r)},i.lengthSquared=function(){var t=this,e=t._x,r=t._y;return e*e+r*r},i.negate=function(){return this._x=-this._x,this._y=-this._y,this._onValueChanged&&this._onValueChanged(),this},i.normalize=function(){return n.normalize(this,this),this},i.scale=function(t){return this._x*=t,this._y*=t,this._onValueChanged&&this._onValueChanged(),this},i.clone=function(){return new n(this._x,this._y)},i.copyFrom=function(t){return this._x=t.x,this._y=t.y,this._onValueChanged&&this._onValueChanged(),this},i.copyFromArray=function(t,e){return e===void 0&&(e=0),this._x=t[e],this._y=t[e+1],this._onValueChanged&&this._onValueChanged(),this},i.copyToArray=function(t,e){e===void 0&&(e=0),t[e]=this._x,t[e+1]=this._y},n.add=function(t,e,r){r._x=t._x+e._x,r._y=t._y+e._y,r._onValueChanged&&r._onValueChanged()},n.subtract=function(t,e,r){r._x=t._x-e._x,r._y=t._y-e._y,r._onValueChanged&&r._onValueChanged()},n.multiply=function(t,e,r){r._x=t._x*e._x,r._y=t._y*e._y,r._onValueChanged&&r._onValueChanged()},n.divide=function(t,e,r){r._x=t._x/e._x,r._y=t._y/e._y,r._onValueChanged&&r._onValueChanged()},n.dot=function(t,e){return t._x*e._x+t._y*e._y},n.distance=function(t,e){var r=e._x-t._x,o=e._y-t._y;return Math.sqrt(r*r+o*o)},n.distanceSquared=function(t,e){var r=e._x-t._x,o=e._y-t._y;return r*r+o*o},n.equals=function(t,e){return H.equals(t._x,e._x)&&H.equals(t._y,e._y)},n.lerp=function(t,e,r,o){var s=t._x,l=t._y;o._x=s+(e._x-s)*r,o._y=l+(e._y-l)*r,o._onValueChanged&&o._onValueChanged()},n.max=function(t,e,r){r._x=Math.max(t._x,e._x),r._y=Math.max(t._y,e._y),r._onValueChanged&&r._onValueChanged()},n.min=function(t,e,r){r._x=Math.min(t._x,e._x),r._y=Math.min(t._y,e._y),r._onValueChanged&&r._onValueChanged()},n.negate=function(t,e){e._x=-t._x,e._y=-t._y,e._onValueChanged&&e._onValueChanged()},n.normalize=function(t,e){var r=t._x,o=t._y,s=Math.sqrt(r*r+o*o);s>H.zeroTolerance&&(s=1/s,e._x=r*s,e._y=o*s,e._onValueChanged&&e._onValueChanged())},n.scale=function(t,e,r){r._x=t._x*e,r._y=t._y*e,r._onValueChanged&&r._onValueChanged()},Fs(n,[{key:"x",get:function(){return this._x},set:function(t){this._x=t,this._onValueChanged&&this._onValueChanged()}},{key:"y",get:function(){return this._y},set:function(t){this._y=t,this._onValueChanged&&this._onValueChanged()}}]),n}();W._zero=new W(0,0);W._one=new W(1,1);var he=function(){function n(a,t,e,r){a===void 0&&(a=0),t===void 0&&(t=0),e===void 0&&(e=0),r===void 0&&(r=0),this._onValueChanged=null,this._x=a,this._y=t,this._z=e,this._w=r}var i=n.prototype;return i.set=function(t,e,r,o){return this._x=t,this._y=e,this._z=r,this._w=o,this._onValueChanged&&this._onValueChanged(),this},i.add=function(t){return this._x+=t._x,this._y+=t._y,this._z+=t._z,this._w+=t._w,this._onValueChanged&&this._onValueChanged(),this},i.subtract=function(t){return this._x-=t._x,this._y-=t._y,this._z-=t._z,this._w-=t._w,this._onValueChanged&&this._onValueChanged(),this},i.multiply=function(t){return this._x*=t._x,this._y*=t._y,this._z*=t._z,this._w*=t._w,this._onValueChanged&&this._onValueChanged(),this},i.divide=function(t){return this._x/=t._x,this._y/=t._y,this._z/=t._z,this._w/=t._w,this._onValueChanged&&this._onValueChanged(),this},i.length=function(){var t=this,e=t._x,r=t._y,o=t._z,s=t._w;return Math.sqrt(e*e+r*r+o*o+s*s)},i.lengthSquared=function(){var t=this,e=t._x,r=t._y,o=t._z,s=t._w;return e*e+r*r+o*o+s*s},i.negate=function(){return this._x=-this._x,this._y=-this._y,this._z=-this._z,this._w=-this._w,this._onValueChanged&&this._onValueChanged(),this},i.normalize=function(){return n.normalize(this,this),this},i.scale=function(t){return this._x*=t,this._y*=t,this._z*=t,this._w*=t,this._onValueChanged&&this._onValueChanged(),this},i.clone=function(){var t=new n(this._x,this._y,this._z,this._w);return t},i.copyFrom=function(t){return this._x=t.x,this._y=t.y,this._z=t.z,this._w=t.w,this._onValueChanged&&this._onValueChanged(),this},i.copyFromArray=function(t,e){return e===void 0&&(e=0),this._x=t[e],this._y=t[e+1],this._z=t[e+2],this._w=t[e+3],this._onValueChanged&&this._onValueChanged(),this},i.copyToArray=function(t,e){e===void 0&&(e=0),t[e]=this._x,t[e+1]=this._y,t[e+2]=this._z,t[e+3]=this._w},n.add=function(t,e,r){r._x=t._x+e._x,r._y=t._y+e._y,r._z=t._z+e._z,r._w=t._w+e._w,r._onValueChanged&&r._onValueChanged()},n.subtract=function(t,e,r){r._x=t._x-e._x,r._y=t._y-e._y,r._z=t._z-e._z,r._w=t._w-e._w,r._onValueChanged&&r._onValueChanged()},n.multiply=function(t,e,r){r._x=t._x*e._x,r._y=t._y*e._y,r._z=t._z*e._z,r._w=t._w*e._w,r._onValueChanged&&r._onValueChanged()},n.divide=function(t,e,r){r._x=t._x/e._x,r._y=t._y/e._y,r._z=t._z/e._z,r._w=t._w/e._w,r._onValueChanged&&r._onValueChanged()},n.dot=function(t,e){return t._x*e._x+t._y*e._y+t._z*e._z+t._w*e._w},n.distance=function(t,e){var r=e._x-t._x,o=e._y-t._y,s=e._z-t._z,l=e._w-t._w;return Math.sqrt(r*r+o*o+s*s+l*l)},n.distanceSquared=function(t,e){var r=e._x-t._x,o=e._y-t._y,s=e._z-t._z,l=e._w-t._w;return r*r+o*o+s*s+l*l},n.equals=function(t,e){return H.equals(t._x,e._x)&&H.equals(t._y,e._y)&&H.equals(t._z,e._z)&&H.equals(t._w,e._w)},n.lerp=function(t,e,r,o){var s=t._x,l=t._y,u=t._z,c=t._w;o._x=s+(e._x-s)*r,o._y=l+(e._y-l)*r,o._z=u+(e._z-u)*r,o._w=c+(e._w-c)*r,o._onValueChanged&&o._onValueChanged()},n.max=function(t,e,r){r._x=Math.max(t._x,e._x),r._y=Math.max(t._y,e._y),r._z=Math.max(t._z,e._z),r._w=Math.max(t._w,e._w),r._onValueChanged&&r._onValueChanged()},n.min=function(t,e,r){r._x=Math.min(t._x,e._x),r._y=Math.min(t._y,e._y),r._z=Math.min(t._z,e._z),r._w=Math.min(t._w,e._w),r._onValueChanged&&r._onValueChanged()},n.negate=function(t,e){e._x=-t._x,e._y=-t._y,e._z=-t._z,e._w=-t._w,e._onValueChanged&&e._onValueChanged()},n.normalize=function(t,e){var r=t._x,o=t._y,s=t._z,l=t._w,u=Math.sqrt(r*r+o*o+s*s+l*l);u>H.zeroTolerance&&(u=1/u,e._x=r*u,e._y=o*u,e._z=s*u,e._w=l*u,e._onValueChanged&&e._onValueChanged())},n.scale=function(t,e,r){r._x=t._x*e,r._y=t._y*e,r._z=t._z*e,r._w=t._w*e,r._onValueChanged&&r._onValueChanged()},n.transform=function(t,e,r){var o=t._x,s=t._y,l=t._z,u=t._w,c=e.elements;r._x=o*c[0]+s*c[4]+l*c[8]+u*c[12],r._y=o*c[1]+s*c[5]+l*c[9]+u*c[13],r._z=o*c[2]+s*c[6]+l*c[10]+u*c[14],r._w=o*c[3]+s*c[7]+l*c[11]+u*c[15],r._onValueChanged&&r._onValueChanged()},n.transformByQuat=function(t,e,r){var o=t._x,s=t._y,l=t._z,u=t._w,c=e._x,d=e._y,_=e._z,h=e._w,f=h*o+d*l-_*s,g=h*s+_*o-c*l,y=h*l+c*s-d*o,p=-c*o-d*s-_*l;r._x=f*h-p*c-g*_+y*d,r._y=g*h-p*d-y*c+f*_,r._z=y*h-p*_-f*d+g*c,r._w=u,r._onValueChanged&&r._onValueChanged()},Fs(n,[{key:"x",get:function(){return this._x},set:function(t){this._x=t,this._onValueChanged&&this._onValueChanged()}},{key:"y",get:function(){return this._y},set:function(t){this._y=t,this._onValueChanged&&this._onValueChanged()}},{key:"z",get:function(){return this._z},set:function(t){this._z=t,this._onValueChanged&&this._onValueChanged()}},{key:"w",get:function(){return this._w},set:function(t){this._w=t,this._onValueChanged&&this._onValueChanged()}}]),n}();he._zero=new he(0,0,0,0);he._one=new he(1,1,1,1);var ne=function(){function n(a,t,e,r){a===void 0&&(a=1),t===void 0&&(t=1),e===void 0&&(e=1),r===void 0&&(r=1),this._onValueChanged=null,this._r=a,this._g=t,this._b=e,this._a=r}var i=n.prototype;return i.set=function(t,e,r,o){return this._r=t,this._g=e,this._b=r,this._a=o,this._onValueChanged&&this._onValueChanged(),this},i.add=function(t){return this._r+=t._r,this._g+=t._g,this._b+=t._b,this._a+=t._a,this._onValueChanged&&this._onValueChanged(),this},i.scale=function(t){return this._r*=t,this._g*=t,this._b*=t,this._a*=t,this._onValueChanged&&this._onValueChanged(),this},i.clone=function(){var t=new n(this._r,this._g,this._b,this._a);return t},i.copyFrom=function(t){return this._r=t.r,this._g=t.g,this._b=t.b,this._a=t.a,this._onValueChanged&&this._onValueChanged(),this},i.toLinear=function(t){return t._r=n.gammaToLinearSpace(this._r),t._g=n.gammaToLinearSpace(this._g),t._b=n.gammaToLinearSpace(this._b),this._onValueChanged&&this._onValueChanged(),t},i.toGamma=function(t){return t._r=n.linearToGammaSpace(this._r),t._g=n.linearToGammaSpace(this._g),t._b=n.linearToGammaSpace(this._b),this._onValueChanged&&this._onValueChanged(),t},i.getBrightness=function(){var t=this.r,e=this.g,r=this.b,o=t,s=t;return e>o&&(o=e),r>o&&(o=r),e<s&&(s=e),r<s&&(s=r),(o+s)/2},n.gammaToLinearSpace=function(t){return t<=0?0:t<=.04045?t/12.92:t<1?Math.pow((t+.055)/1.055,2.4):Math.pow(t,2.4)},n.linearToGammaSpace=function(t){return t<=0?0:t<.0031308?12.92*t:t<1?1.055*Math.pow(t,.41666)-.055:Math.pow(t,.41666)},n.equals=function(t,e){return H.equals(t._r,e._r)&&H.equals(t._g,e._g)&&H.equals(t._b,e._b)&&H.equals(t._a,e._a)},n.add=function(t,e,r){return r._r=t._r+e._r,r._g=t._g+e._g,r._b=t._b+e._b,r._a=t._a+e._a,r._onValueChanged&&r._onValueChanged(),r},n.subtract=function(t,e,r){r._r=t._r-e._r,r._g=t._g-e._g,r._b=t._b-e._b,r._a=t._a-e._a,r._onValueChanged&&r._onValueChanged()},n.scale=function(t,e,r){return r._r=t._r*e,r._g=t._g*e,r._b=t._b*e,r._a=t._a*e,r._onValueChanged&&r._onValueChanged(),r},n.lerp=function(t,e,r,o){var s=t._r,l=t._g,u=t._b,c=t._a;return o._r=s+(e._r-s)*r,o._g=l+(e._g-l)*r,o._b=u+(e._b-u)*r,o._a=c+(e._a-c)*r,o._onValueChanged&&o._onValueChanged(),o},Fs(n,[{key:"r",get:function(){return this._r},set:function(t){this._r=t,this._onValueChanged&&this._onValueChanged()}},{key:"g",get:function(){return this._g},set:function(t){this._g=t,this._onValueChanged&&this._onValueChanged()}},{key:"b",get:function(){return this._b},set:function(t){this._b=t,this._onValueChanged&&this._onValueChanged()}},{key:"a",get:function(){return this._a},set:function(t){this._a=t,this._onValueChanged&&this._onValueChanged()}}]),n}(),fd=function(){function n(a,t,e,r){a===void 0&&(a=0),t===void 0&&(t=0),e===void 0&&(e=0),r===void 0&&(r=0),this.x=a,this.y=t,this.width=e,this.height=r}var i=n.prototype;return i.set=function(t,e,r,o){return this.x=t,this.y=e,this.width=r,this.height=o,this},i.clone=function(){return new n(this.x,this.y,this.width,this.height)},i.copyFrom=function(t){return this.x=t.x,this.y=t.y,this.width=t.width,this.height=t.height,this},n}(),N1=function(){function n(){this.coefficients=new Float32Array(27)}var i=n.prototype;return i.addLight=function(t,e,r){e.scale(r);var o=this.coefficients,s=t._x,l=t._y,u=t._z,c=e.r,d=e.g,_=e.b,h=.282095,f=-.488603*l,g=.488603*u,y=-.488603*s,p=1.092548*(s*l),v=-1.092548*(l*u),m=.315392*(3*u*u-1),x=-1.092548*(s*u),S=.546274*(s*s-l*l);o[0]+=c*h,o[1]+=d*h,o[2]+=_*h,o[3]+=c*f,o[4]+=d*f,o[5]+=_*f,o[6]+=c*g,o[7]+=d*g,o[8]+=_*g,o[9]+=c*y,o[10]+=d*y,o[11]+=_*y,o[12]+=c*p,o[13]+=d*p,o[14]+=_*p,o[15]+=c*v,o[16]+=d*v,o[17]+=_*v,o[18]+=c*m,o[19]+=d*m,o[20]+=_*m,o[21]+=c*x,o[22]+=d*x,o[23]+=_*x,o[24]+=c*S,o[25]+=d*S,o[26]+=_*S},i.evaluate=function(t,e){var r=this.coefficients,o=t._x,s=t._y,l=t._z,u=.886227,c=-1.023327*s,d=1.023327*l,_=-1.023327*o,h=.858086*s*o,f=-.858086*s*l,g=.247708*(3*l*l-1),y=-.858086*l*o,p=.429042*(o*o-s*s),v=r[0]*u,m=r[1]*u,x=r[2]*u;return v+=r[3]*c+r[6]*d+r[9]*_,m+=r[4]*c+r[7]*d+r[10]*_,x+=r[5]*c+r[8]*d+r[11]*_,v+=r[12]*h+r[15]*f+r[18]*g+r[21]*y+r[24]*p,m+=r[13]*h+r[16]*f+r[19]*g+r[22]*y+r[25]*p,x+=r[14]*h+r[17]*f+r[20]*g+r[23]*y+r[26]*p,e.set(v,m,x,1),e},i.scale=function(t){var e=this.coefficients;e[0]*=t,e[1]*=t,e[2]*=t,e[3]*=t,e[4]*=t,e[5]*=t,e[6]*=t,e[7]*=t,e[8]*=t,e[9]*=t,e[10]*=t,e[11]*=t,e[12]*=t,e[13]*=t,e[14]*=t,e[15]*=t,e[16]*=t,e[17]*=t,e[18]*=t,e[19]*=t,e[20]*=t,e[21]*=t,e[22]*=t,e[23]*=t,e[24]*=t,e[25]*=t,e[26]*=t},i.clone=function(){var t=new n;return t.copyFrom(this),t},i.copyFrom=function(t){return t.copyToArray(this.coefficients),this},i.copyFromArray=function(t,e){e===void 0&&(e=0);var r=this.coefficients;r[0]=t[e],r[1]=t[1+e],r[2]=t[2+e],r[3]=t[3+e],r[4]=t[4+e],r[5]=t[5+e],r[6]=t[6+e],r[7]=t[7+e],r[8]=t[8+e],r[9]=t[9+e],r[10]=t[10+e],r[11]=t[11+e],r[12]=t[12+e],r[13]=t[13+e],r[14]=t[14+e],r[15]=t[15+e],r[16]=t[16+e],r[17]=t[17+e],r[18]=t[18+e],r[19]=t[19+e],r[20]=t[20+e],r[21]=t[21+e],r[22]=t[22+e],r[23]=t[23+e],r[24]=t[24+e],r[25]=t[25+e],r[26]=t[26+e]},i.copyToArray=function(t,e){e===void 0&&(e=0);var r=this.coefficients;t[0+e]=r[0],t[1+e]=r[1],t[2+e]=r[2],t[3+e]=r[3],t[4+e]=r[4],t[5+e]=r[5],t[6+e]=r[6],t[7+e]=r[7],t[8+e]=r[8],t[9+e]=r[9],t[10+e]=r[10],t[11+e]=r[11],t[12+e]=r[12],t[13+e]=r[13],t[14+e]=r[14],t[15+e]=r[15],t[16+e]=r[16],t[17+e]=r[17],t[18+e]=r[18],t[19+e]=r[19],t[20+e]=r[20],t[21+e]=r[21],t[22+e]=r[22],t[23+e]=r[23],t[24+e]=r[24],t[25+e]=r[25],t[26+e]=r[26]},n}(),On;(function(n){n[n.Android=0]="Android",n[n.IPhone=1]="IPhone",n[n.IPad=2]="IPad",n[n.Unknown=3]="Unknown"})(On||(On={}));function _e(n){if(n===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return n}function mf(n,i){for(var a=0;a<i.length;a++){var t=i[a];t.enumerable=t.enumerable||!1,t.configurable=!0,"value"in t&&(t.writable=!0),Object.defineProperty(n,t.key,t)}}function K(n,i,a){return i&&mf(n.prototype,i),a&&mf(n,a),n}function vd(n,i){return vd=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t},vd(n,i)}function V1(n,i){return vd(n,i)}function Q(n,i){if(typeof i!="function"&&i!==null)throw new TypeError("Super expression must either be null or a function");n.prototype=Object.create(i&&i.prototype,{constructor:{value:n,writable:!0,configurable:!0}}),i&&V1(n,i)}var Gi=function(){function n(){}return n.clamp=function(a,t,e){return Math.max(t,Math.min(e,a))},n.equals=function(a,t){return Math.abs(a-t)<=n.zeroTolerance},n.isPowerOf2=function(a){return(a&a-1)===0},n.radianToDegree=function(a){return a*n.radToDegreeFactor},n.degreeToRadian=function(a){return a*n.degreeToRadFactor},n}();Gi.zeroTolerance=1e-6;Gi.radToDegreeFactor=180/Math.PI;Gi.degreeToRadFactor=Math.PI/180;var U1=function(){function n(a,t,e,r){a===void 0&&(a=1),t===void 0&&(t=1),e===void 0&&(e=1),r===void 0&&(r=1),this._onValueChanged=null,this._r=a,this._g=t,this._b=e,this._a=r}var i=n.prototype;return i.set=function(t,e,r,o){return this._r=t,this._g=e,this._b=r,this._a=o,this._onValueChanged&&this._onValueChanged(),this},i.add=function(t){return this._r+=t._r,this._g+=t._g,this._b+=t._b,this._a+=t._a,this._onValueChanged&&this._onValueChanged(),this},i.scale=function(t){return this._r*=t,this._g*=t,this._b*=t,this._a*=t,this._onValueChanged&&this._onValueChanged(),this},i.clone=function(){var t=new n(this._r,this._g,this._b,this._a);return t},i.copyFrom=function(t){return this._r=t.r,this._g=t.g,this._b=t.b,this._a=t.a,this._onValueChanged&&this._onValueChanged(),this},i.toLinear=function(t){return t._r=n.gammaToLinearSpace(this._r),t._g=n.gammaToLinearSpace(this._g),t._b=n.gammaToLinearSpace(this._b),this._onValueChanged&&this._onValueChanged(),t},i.toGamma=function(t){return t._r=n.linearToGammaSpace(this._r),t._g=n.linearToGammaSpace(this._g),t._b=n.linearToGammaSpace(this._b),this._onValueChanged&&this._onValueChanged(),t},i.getBrightness=function(){var t=this.r,e=this.g,r=this.b,o=t,s=t;return e>o&&(o=e),r>o&&(o=r),e<s&&(s=e),r<s&&(s=r),(o+s)/2},n.gammaToLinearSpace=function(t){return t<=0?0:t<=.04045?t/12.92:t<1?Math.pow((t+.055)/1.055,2.4):Math.pow(t,2.4)},n.linearToGammaSpace=function(t){return t<=0?0:t<.0031308?12.92*t:t<1?1.055*Math.pow(t,.41666)-.055:Math.pow(t,.41666)},n.equals=function(t,e){return Gi.equals(t._r,e._r)&&Gi.equals(t._g,e._g)&&Gi.equals(t._b,e._b)&&Gi.equals(t._a,e._a)},n.add=function(t,e,r){return r._r=t._r+e._r,r._g=t._g+e._g,r._b=t._b+e._b,r._a=t._a+e._a,r._onValueChanged&&r._onValueChanged(),r},n.subtract=function(t,e,r){r._r=t._r-e._r,r._g=t._g-e._g,r._b=t._b-e._b,r._a=t._a-e._a,r._onValueChanged&&r._onValueChanged()},n.scale=function(t,e,r){return r._r=t._r*e,r._g=t._g*e,r._b=t._b*e,r._a=t._a*e,r._onValueChanged&&r._onValueChanged(),r},n.lerp=function(t,e,r,o){var s=t._r,l=t._g,u=t._b,c=t._a;return o._r=s+(e._r-s)*r,o._g=l+(e._g-l)*r,o._b=u+(e._b-u)*r,o._a=c+(e._a-c)*r,o._onValueChanged&&o._onValueChanged(),o},K(n,[{key:"r",get:function(){return this._r},set:function(t){this._r=t,this._onValueChanged&&this._onValueChanged()}},{key:"g",get:function(){return this._g},set:function(t){this._g=t,this._onValueChanged&&this._onValueChanged()}},{key:"b",get:function(){return this._b},set:function(t){this._b=t,this._onValueChanged&&this._onValueChanged()}},{key:"a",get:function(){return this._a},set:function(t){this._a=t,this._onValueChanged&&this._onValueChanged()}}]),n}();function O(n,i,a,t){var e=arguments.length,r=e<3?i:t===null?t=Object.getOwnPropertyDescriptor(i,a):t,o;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(n,i,a,t);else for(var s=n.length-1;s>=0;s--)(o=n[s])&&(r=(e<3?o(r):e>3?o(i,a,r):o(i,a))||r);return e>3&&r&&Object.defineProperty(i,a,r),r}function He(n,i){return i!=null&&typeof Symbol<"u"&&i[Symbol.hasInstance]?!!i[Symbol.hasInstance](n):n instanceof i}var zr;(function(n){n[n.Ignore=0]="Ignore",n[n.Assignment=1]="Assignment",n[n.Shallow=2]="Shallow",n[n.Deep=3]="Deep"})(zr||(zr={}));function Y(n,i){Gn.registerCloneMode(n,i,zr.Ignore)}function Be(n,i){Gn.registerCloneMode(n,i,zr.Assignment)}function v0(n,i){Gn.registerCloneMode(n,i,zr.Shallow)}function je(n,i){Gn.registerCloneMode(n,i,zr.Deep)}var Gn=function(){function n(){}return n.registerCloneMode=function(a,t,e){var r=n._subCloneModeMap.get(a.constructor);r||(r=Object.create(null),n._subCloneModeMap.set(a.constructor,r)),r[t]=e},n.getCloneMode=function(a){var t=n._cloneModeMap.get(a);if(!t){t=Object.create(null),n._cloneModeMap.set(a,t);for(var e=n._objectType,r=n._subCloneModeMap;a!==e;){var o=r.get(a);o&&Object.assign(t,o),a=Object.getPrototypeOf(a)}}return t},n.deepCloneObject=function(a,t){var e=a.constructor;switch(e){case Uint8Array:case Uint16Array:case Uint32Array:case Int8Array:case Int16Array:case Int32Array:case Float32Array:case Float64Array:t.set(a);break;case Array:for(var r=0,o=a.length;r<o;r++)n._deepCloneObjectItem(a,t,r);break;default:var s=a;if(s.clone&&s.cloneTo)s.cloneTo(t);else for(var l=Object.keys(a),u=0,c=l.length;u<c;u++)n._deepCloneObjectItem(a,t,l[u])}},n._deepCloneObjectItem=function(a,t,e){var r=a[e];if(He(r,Object)){var o=r.constructor;switch(o){case Uint8Array:case Uint16Array:case Uint32Array:case Int8Array:case Int16Array:case Int32Array:case Float32Array:case Float64Array:var s=r,l=t[e];l==null?t[e]=s.slice():l.set(s);break;case Array:var u=r,c=t[e];c==null?t[e]=new Array(u.length):c.length=u.length,n.deepCloneObject(u,c);break;default:if(r.clone&&r.cloneTo){var d=r,_=t[e];_?d.cloneTo(_):t[e]=d.clone()}else{var h=t[e];h==null&&(t[e]=h=new r.constructor),n.deepCloneObject(r,h);break}}}else t[e]=r},n}();Gn._subCloneModeMap=new Map;Gn._cloneModeMap=new Map;Gn._objectType=Object.getPrototypeOf(Object);var ar=function(){function n(a){this._destroyed=!1,this.instanceId=++n._instanceIdCounter,this._engine=a}var i=n.prototype;return i.destroy=function(){var t;this._destroyed||((t=this._engine.resourceManager)==null||t._deleteAsset(this),this._destroyed=!0)},K(n,[{key:"engine",get:function(){return this._engine}},{key:"destroyed",get:function(){return this._destroyed}}]),n}();ar._instanceIdCounter=0;O([Y],ar.prototype,"instanceId",void 0);O([Y],ar.prototype,"_engine",void 0);var Xr=function(n){Q(i,n);function i(t){var e;return e=n.call(this,t)||this,e.isGCIgnored=!1,e._refCount=0,t.resourceManager._addRefObject(e.instanceId,_e(e)),e}var a=i.prototype;return a.destroy=function(e){if(e===void 0&&(e=!1),this._destroyed)return!0;if(!e&&this._refCount!==0)return!1;var r=this._engine.resourceManager;r&&(n.prototype.destroy.call(this),r._deleteRefObject(this.instanceId));var o=this._getRefCount();return o>0&&this._addRefCount(-o),this._engine=null,this._onDestroy(),!0},a._getRefCount=function(){return this._refCount},a._addRefCount=function(e){this._refCount+=e},a._addToResourceManager=function(e){this._engine.resourceManager._addAsset(e,this)},K(i,[{key:"refCount",get:function(){return this._refCount}}]),i}(ar),At;(function(n){n[n.Depth=0]="Depth",n[n.DepthStencil=1]="DepthStencil",n[n.Stencil=2]="Stencil",n[n.Depth16=3]="Depth16",n[n.Depth24=4]="Depth24",n[n.Depth32=5]="Depth32",n[n.Depth24Stencil8=6]="Depth24Stencil8",n[n.Depth32Stencil8=7]="Depth32Stencil8"})(At||(At={}));var an;(function(n){n[n.PositiveX=0]="PositiveX",n[n.NegativeX=1]="NegativeX",n[n.PositiveY=2]="PositiveY",n[n.NegativeY=3]="NegativeY",n[n.PositiveZ=4]="PositiveZ",n[n.NegativeZ=5]="NegativeZ"})(an||(an={}));var Dn;(function(n){n[n.Never=0]="Never",n[n.Less=1]="Less",n[n.Equal=2]="Equal",n[n.LessEqual=3]="LessEqual",n[n.Greater=4]="Greater",n[n.NotEqual=5]="NotEqual",n[n.GreaterEqual=6]="GreaterEqual",n[n.Always=7]="Always"})(Dn||(Dn={}));var $t;(function(n){n[n.Point=0]="Point",n[n.Bilinear=1]="Bilinear",n[n.Trilinear=2]="Trilinear"})($t||($t={}));var j;(function(n){n[n.R8G8B8=0]="R8G8B8",n[n.R8G8B8A8=1]="R8G8B8A8",n[n.R4G4B4A4=2]="R4G4B4A4",n[n.R5G5B5A1=3]="R5G5B5A1",n[n.R5G6B5=4]="R5G6B5",n[n.Alpha8=5]="Alpha8",n[n.LuminanceAlpha=6]="LuminanceAlpha",n[n.R16G16B16A16=7]="R16G16B16A16",n[n.R32G32B32A32=8]="R32G32B32A32",n[n.DXT1=9]="DXT1",n[n.DXT5=10]="DXT5",n[n.ETC1_RGB=11]="ETC1_RGB",n[n.ETC2_RGB=12]="ETC2_RGB",n[n.ETC2_RGBA5=13]="ETC2_RGBA5",n[n.ETC2_RGBA8=14]="ETC2_RGBA8",n[n.PVRTC_RGB2=15]="PVRTC_RGB2",n[n.PVRTC_RGBA2=16]="PVRTC_RGBA2",n[n.PVRTC_RGB4=17]="PVRTC_RGB4",n[n.PVRTC_RGBA4=18]="PVRTC_RGBA4",n[n.ASTC_4x4=19]="ASTC_4x4",n[n.ASTC_5x5=20]="ASTC_5x5",n[n.ASTC_6x6=21]="ASTC_6x6",n[n.ASTC_8x8=22]="ASTC_8x8",n[n.ASTC_10x10=23]="ASTC_10x10",n[n.ASTC_12x12=24]="ASTC_12x12",n[n.Depth=25]="Depth",n[n.DepthStencil=26]="DepthStencil",n[n.Depth16=27]="Depth16",n[n.Depth24=28]="Depth24",n[n.Depth32=29]="Depth32",n[n.Depth24Stencil8=30]="Depth24Stencil8",n[n.Depth32Stencil8=31]="Depth32Stencil8"})(j||(j={}));var Vt;(function(n){n[n.Clamp=0]="Clamp",n[n.Repeat=1]="Repeat",n[n.Mirror=2]="Mirror"})(Vt||(Vt={}));var pd=function(){function n(a,t,e,r){t===void 0&&(t=null),e===void 0&&(e={}),r===void 0&&(r=!0),this._timeStamp=new Date().getTime(),this._target=t,this.data=e,this._currentTarget=null,this._bubbles=r,this._propagationStopped=!1,this._type=a}var i=n.prototype;return i.stopPropagation=function(){this._propagationStopped=!0},K(n,[{key:"propagationStopped",get:function(){return this._propagationStopped}},{key:"target",get:function(){return this._target},set:function(t){this._target=t}},{key:"timeStamp",get:function(){return this._timeStamp}},{key:"currentTarget",get:function(){return this._currentTarget},set:function(t){this._currentTarget=t}},{key:"bubbles",get:function(){return this._bubbles}},{key:"type",get:function(){return this._type}}]),n}(),p0=function(){function n(){this._events=Object.create(null),this._eventCount=0,this._dispatchingListeners=[]}var i=n.prototype;return i.hasEvent=function(t){return this._events[t]!=null},i.eventNames=function(){return this._eventCount===0?[]:Object.keys(this._events)},i.listenerCount=function(t){var e=this._events[t];return e?Array.isArray(e)?e.length:1:0},i.dispatch=function(t,e){if(!this._events[t])return!1;var r=this._events[t];if(Array.isArray(r)){var o=r.length,s=this._dispatchingListeners;s.length=o;for(var l=0;l<o;l++)s[l]=r[l];for(var u=0;u<o;u++){var c=s[u];c.destroyed||(c.once&&this.off(t,c.fn),c.fn(e))}s.length=0}else r.once&&this.off(t,r.fn),r.fn(e);return!0},i.on=function(t,e){return this.addEventListener(t,e)},i.once=function(t,e){return this.addEventListener(t,e,!0)},i.addEventListener=function(t,e,r){var o={fn:e,once:r},s=this._events,l=s[t];return l?Array.isArray(l)?l.push(o):s[t]=[l,o]:(s[t]=o,this._eventCount++),this},i.off=function(t,e){if(!this._events[t])return this;if(!e)return this._clearEvent(t),this;var r=this._events[t],o=Array.isArray(r);if(!o&&r.fn===e)this._clearEvent(t);else if(o){for(var s=r.length-1;s>=0;s--)r[s].fn===e&&(r[s].destroyed=!0,r.splice(s,1));r.length===0?this._clearEvent(t):r.length===1&&(this._events[t]=r[0])}return this},i.removeEventListener=function(t,e){return this.off(t,e)},i.removeAllEventListeners=function(t){t?this._events[t]&&this._clearEvent(t):(this._events=Object.create(null),this._eventCount=0)},i.trigger=function(t){this.dispatch(t.type,t.data)},i._clearEvent=function(t){--this._eventCount===0?this._events=Object.create(null):delete this._events[t]},n}(),Zr=function(n){for(var i=arguments.length,a=new Array(i>1?i-1:0),t=1;t<i;t++)a[t-1]=arguments[t]},k1=console.log.bind(console),H1=console.info.bind(console),G1=console.warn.bind(console),W1=console.error.bind(console),we={debug:Zr,info:Zr,warn:Zr,error:Zr,isEnabled:!1,enable:function(){this.debug=k1,this.info=H1,this.warn=G1,this.error=W1,this.isEnabled=!0},disable:function(){this.debug=Zr,this.info=Zr,this.warn=Zr,this.error=Zr,this.isEnabled=!1}},g0=function(){function n(){this._frameCount=0,this._clock=performance||Date,this._timeScale=1,this._deltaTime=1e-4;var a=this._clock.now();this._startTime=a,this._lastTickTime=a}var i=n.prototype;return i.reset=function(){this._lastTickTime=this._clock.now()},i.tick=function(){var t=this.nowTime;this._deltaTime=(t-this._lastTickTime)*this._timeScale,this._lastTickTime=t,this._frameCount++},K(n,[{key:"frameCount",get:function(){return this._frameCount}},{key:"nowTime",get:function(){return this._clock.now()}},{key:"deltaTime",get:function(){return this._deltaTime}},{key:"timeScale",get:function(){return this._timeScale},set:function(t){this._timeScale=t}},{key:"unscaledDeltaTime",get:function(){return this._deltaTime/this._timeScale}},{key:"timeSinceStartup",get:function(){return this.nowTime-this._startTime}}]),n}(),Tl={isArray:"isArray"in Array?Array.isArray:function(n){return toString.call(n)==="[object Array]"},isArrayLike:function(i){return!!i&&typeof i.length=="number"&&typeof i!="function"},clone:function(i){if(typeof i!="object"||i===null)return i;var a;if(Tl.isArrayLike(i)){a=i.slice();for(var t=0,e=i.length;t<e;t++)a[t]=Tl.clone(i[t])}else{a={};for(var r in i)i.hasOwnProperty(r)&&(a[r]=Tl.clone(i[r]))}return a},downloadBlob:function(i,a){a===void 0&&(a="");var t=window.URL.createObjectURL(i),e=document.createElement("a");document.body.appendChild(e),e.style.display="none",e.href=t,e.download=a,e.addEventListener("click",function(){e.parentElement&&e.parentElement.removeChild(e)}),e.click(),window.URL.revokeObjectURL(t)}};function El(n,i){var a=n.indexOf(i);if(a<0)return!1;var t=n.length-1;if(a!==t){var e=n[t];n[a]=e}return n.length--,!0}function gd(n){return Object.keys(n).map(function(i){return n[i]})}var qe;(function(n){n[n.FLOAT=5126]="FLOAT",n[n.FLOAT_VEC2=35664]="FLOAT_VEC2",n[n.FLOAT_VEC3=35665]="FLOAT_VEC3",n[n.FLOAT_VEC4=35666]="FLOAT_VEC4",n[n.INT=5124]="INT",n[n.INT_VEC2=35667]="INT_VEC2",n[n.INT_VEC3=35668]="INT_VEC3",n[n.INT_VEC4=35669]="INT_VEC4",n[n.BOOL=35670]="BOOL",n[n.BOOL_VEC2=35671]="BOOL_VEC2",n[n.BOOL_VEC3=35672]="BOOL_VEC3",n[n.BOOL_VEC4=35673]="BOOL_VEC4",n[n.FLOAT_MAT2=35674]="FLOAT_MAT2",n[n.FLOAT_MAT3=35675]="FLOAT_MAT3",n[n.FLOAT_MAT4=35676]="FLOAT_MAT4",n[n.FLOAT_ARRAY=35677]="FLOAT_ARRAY",n[n.FLOAT_VEC2_ARRAY=1e5]="FLOAT_VEC2_ARRAY",n[n.FLOAT_VEC3_ARRAY=100001]="FLOAT_VEC3_ARRAY",n[n.FLOAT_VEC4_ARRAY=100002]="FLOAT_VEC4_ARRAY",n[n.INT_ARRAY=100003]="INT_ARRAY",n[n.INT_VEC2_ARRAY=100004]="INT_VEC2_ARRAY",n[n.INT_VEC3_ARRAY=100005]="INT_VEC3_ARRAY",n[n.INT_VEC4_ARRAY=100006]="INT_VEC4_ARRAY",n[n.FLOAT_MAT2_ARRAY=100007]="FLOAT_MAT2_ARRAY",n[n.FLOAT_MAT3_ARRAY=100008]="FLOAT_MAT3_ARRAY",n[n.FLOAT_MAT4_ARRAY=100009]="FLOAT_MAT4_ARRAY",n[n.SAMPLER_2D_ARRAY=100010]="SAMPLER_2D_ARRAY",n[n.SAMPLER_CUBE_ARRAY=100011]="SAMPLER_CUBE_ARRAY",n[n.SAMPLER_2D=35678]="SAMPLER_2D",n[n.SAMPLER_CUBE=35680]="SAMPLER_CUBE",n[n.BYTE=5120]="BYTE",n[n.UNSIGNED_BYTE=5121]="UNSIGNED_BYTE",n[n.SHORT=5122]="SHORT",n[n.UNSIGNED_SHORT=5123]="UNSIGNED_SHORT",n[n.UNSIGNED_INT=5125]="UNSIGNED_INT"})(qe||(qe={}));var Z;(function(n){n.shaderVertexID="shaderVertexID",n.standardDerivatives="OES_standard_derivatives",n.shaderTextureLod="EXT_shader_texture_lod",n.elementIndexUint="OES_element_index_uint",n.depthTexture="WEBGL_depth_texture",n.drawBuffers="WEBGL_draw_buffers",n.vertexArrayObject="OES_vertex_array_object",n.instancedArrays="ANGLE_instanced_arrays",n.multipleSample="multipleSampleOnlySupportedInWebGL2",n.textureFloat="OES_texture_float",n.textureFloatLinear="OES_texture_float_linear",n.textureHalfFloat="OES_texture_half_float",n.textureHalfFloatLinear="OES_texture_half_float_linear",n.WEBGL_colorBufferFloat="WEBGL_color_buffer_float",n.colorBufferFloat="EXT_color_buffer_float",n.colorBufferHalfFloat="EXT_color_buffer_half_float",n.textureFilterAnisotropic="EXT_texture_filter_anisotropic",n.blendMinMax="EXT_blend_minmax",n.astc="WEBGL_compressed_texture_astc",n.astc_webkit="WEBKIT_WEBGL_compressed_texture_astc",n.etc="WEBGL_compressed_texture_etc",n.etc_webkit="WEBKIT_WEBGL_compressed_texture_etc",n.etc1="WEBGL_compressed_texture_etc1",n.etc1_webkit="WEBKIT_WEBGL_compressed_texture_etc1",n.pvrtc="WEBGL_compressed_texture_pvrtc",n.pvrtc_webkit="WEBKIT_WEBGL_compressed_texture_pvrtc",n.s3tc="WEBGL_compressed_texture_s3tc",n.s3tc_webkit="WEBKIT_WEBGL_compressed_texture_s3tc"})(Z||(Z={}));var yr=function(n){Q(i,n);function i(){var t;return t=n.apply(this,arguments)||this,t._isDepthTexture=!1,t._anisoLevel=1,t._useDepthCompareMode=!1,t}var a=i.prototype;return a.generateMipmaps=function(){this._mipmap&&this._platformTexture.generateMipmaps()},a._setUseDepthCompareMode=function(e){this._useDepthCompareMode!==e&&(this._platformTexture.setUseDepthCompareMode(e),this._useDepthCompareMode=e)},a._onDestroy=function(){this._platformTexture.destroy(),this._platformTexture=null},a._getMaxMiplevel=function(e){return Math.floor(Math.log2(e))},a._getMipmapCount=function(){return this._mipmap?Math.floor(Math.log2(Math.max(this._width,this._height)))+1:1},K(i,[{key:"format",get:function(){return this._format}},{key:"width",get:function(){return this._width}},{key:"height",get:function(){return this._height}},{key:"wrapModeU",get:function(){return this._wrapModeU},set:function(e){e!==this._wrapModeU&&(this._wrapModeU=e,this._platformTexture.wrapModeU=e)}},{key:"wrapModeV",get:function(){return this._wrapModeV},set:function(e){e!==this._wrapModeV&&(this._wrapModeV=e,this._platformTexture.wrapModeV=e)}},{key:"mipmapCount",get:function(){return this._mipmapCount}},{key:"filterMode",get:function(){return this._filterMode},set:function(e){e!==this._filterMode&&(this._filterMode=e,this._platformTexture.filterMode=e)}},{key:"anisoLevel",get:function(){return this._anisoLevel},set:function(e){var r=this._engine._hardwareRenderer.capability.maxAnisoLevel;e>r&&(we.warn("anisoLevel:"+e+", exceeds the limit and is automatically downgraded to:"+r),e=r),e<1&&(we.warn("anisoLevel:"+e+", must be greater than 0, and is automatically downgraded to 1"),e=1),e!==this._anisoLevel&&(this._anisoLevel=e,this._platformTexture.anisoLevel=e)}},{key:"depthCompareFunction",get:function(){return this._depthCompareFunction},set:function(e){if(!this._engine._hardwareRenderer._isWebGL2){console.warn("depthCompareFunction only support WebGL2");return}e!==this._depthCompareFunction&&(this._depthCompareFunction=e,this._platformTexture.depthCompareFunction=e)}}]),i}(Xr),Ka=function(n){Q(i,n);function i(t,e,r,o,s,l){s===void 0&&(s=At.Depth),l===void 0&&(l=1);var u;if(u=n.call(this,t)||this,u._autoGenerateMipmaps=!0,u._width=e,u._height=r,u._antiAliasing=l,u._depth=s,o){for(var c=He(o,Array)?o.slice():[o],d=0,_=c.length;d<_;d++)if(c[d]._isDepthTexture)throw"Render texture can't use depth format.";u._colorTextures=c}else u._colorTextures=[];if(He(s,yr)){if(!s._isDepthTexture)throw"Depth texture must use depth format.";u._depthTexture=s}return u._platformRenderTarget=t._hardwareRenderer.createPlatformRenderTarget(_e(u)),u}var a=i.prototype;return a.getColorTexture=function(e){return e===void 0&&(e=0),this._colorTextures[e]},a.generateMipmaps=function(){if(this._autoGenerateMipmaps){for(var e=this._colorTextures,r=0,o=e.length;r<o;r++){var s=e[r];s.generateMipmaps()}this._depthTexture&&this._depthTexture.generateMipmaps()}},a.destroy=function(){this._platformRenderTarget.destroy(),this._colorTextures.length=0,this._depthTexture=null,this._depth=null},a._setRenderTargetInfo=function(e,r){this._platformRenderTarget.setRenderTargetInfo(e,r)},a._blitRenderTarget=function(){this._platformRenderTarget.blitRenderTarget()},K(i,[{key:"autoGenerateMipmaps",get:function(){return this._autoGenerateMipmaps},set:function(e){this._autoGenerateMipmaps=e}},{key:"width",get:function(){return this._width}},{key:"height",get:function(){return this._height}},{key:"colorTextureCount",get:function(){return this._colorTextures.length}},{key:"depthTexture",get:function(){return this._depthTexture}},{key:"antiAliasing",get:function(){return this._antiAliasing}}]),i}(ar),dn=function(n){Q(i,n);function i(t,e,r,o,s){o===void 0&&(o=j.R8G8B8A8),s===void 0&&(s=!0);var l;return l=n.call(this,t)||this,l._mipmap=s,l._width=e,l._height=r,l._format=o,l._mipmapCount=l._getMipmapCount(),l._isDepthTexture=o==j.Depth||o==j.DepthStencil||o==j.Depth16||o==j.Depth24||o==j.Depth32||o==j.Depth24Stencil8||o==j.Depth32Stencil8,l._platformTexture=t._hardwareRenderer.createPlatformTexture2D(_e(l)),l.filterMode=$t.Bilinear,l.wrapModeU=l.wrapModeV=Vt.Repeat,l}var a=i.prototype;return a.setPixelBuffer=function(e,r,o,s,l,u){r===void 0&&(r=0),o===void 0&&(o=0),s===void 0&&(s=0),this._platformTexture.setPixelBuffer(e,r,o,s,l,u)},a.setImageSource=function(e,r,o,s,l,u){r===void 0&&(r=0),o===void 0&&(o=!1),s===void 0&&(s=!1),l===void 0&&(l=0),u===void 0&&(u=0),this._platformTexture.setImageSource(e,r,o,s,l,u)},a.getPixelBuffer=function(e,r,o,s,l,u){var c=arguments.length;c===1?this._platformTexture.getPixelBuffer(0,0,this._width,this._height,0,e):c===2?this._platformTexture.getPixelBuffer(0,0,this._width>>e,this._height>>e,e,r):c===5?this._platformTexture.getPixelBuffer(e,r,o,s,0,l):c===6&&this._platformTexture.getPixelBuffer(e,r,o,s,l,u)},i}(yr),O_=function(n){Q(i,n);function i(t,e,r,o,s,l){s===void 0&&(s=j.R8G8B8A8),l===void 0&&(l=!0);var u;return u=n.call(this,t)||this,u._mipmap=l,u._width=e,u._height=r,u._length=o,u._format=s,u._mipmapCount=u._getMipmapCount(),u._platformTexture=t._hardwareRenderer.createPlatformTexture2DArray(_e(u)),u.filterMode=$t.Bilinear,u.wrapModeU=u.wrapModeV=Vt.Repeat,u}var a=i.prototype;return a.setPixelBuffer=function(e,r,o,s,l,u,c,d){o===void 0&&(o=0),s===void 0&&(s=0),l===void 0&&(l=0),this._platformTexture.setPixelBuffer(e,r,o,s,l,u,c,d)},a.setImageSource=function(e,r,o,s,l,u,c){o===void 0&&(o=0),s===void 0&&(s=!1),l===void 0&&(l=!1),u===void 0&&(u=0),c===void 0&&(c=0),this._platformTexture.setImageSource(e,r,o,s,l,u,c)},a.getPixelBuffer=function(e,r,o,s,l,u,c){var d=arguments.length;d===1?this._platformTexture.getPixelBuffer(e,0,0,this._width,this._height,0,r):d===2?this._platformTexture.getPixelBuffer(e,0,0,this._width>>r,this._height>>r,r,o):d===5?this._platformTexture.getPixelBuffer(e,r,o,s,l,0,u):d===6&&this._platformTexture.getPixelBuffer(e,r,o,s,l,u,c)},K(i,[{key:"length",get:function(){return this._length}}]),i}(yr),yn=function(n){Q(i,n);function i(t,e,r,o){r===void 0&&(r=j.R8G8B8A8),o===void 0&&(o=!0);var s;return s=n.call(this,t)||this,s._mipmap=o,s._width=e,s._height=e,s._format=r,s._mipmapCount=s._getMipmapCount(),s._platformTexture=t._hardwareRenderer.createPlatformTextureCube(_e(s)),s.filterMode=$t.Bilinear,s.wrapModeU=s.wrapModeV=Vt.Clamp,s}var a=i.prototype;return a.setPixelBuffer=function(e,r,o,s,l,u,c){o===void 0&&(o=0),s===void 0&&(s=0),l===void 0&&(l=0),this._platformTexture.setPixelBuffer(e,r,o,s,l,u,c)},a.setImageSource=function(e,r,o,s,l,u,c){o===void 0&&(o=0),s===void 0&&(s=!1),l===void 0&&(l=!1),u===void 0&&(u=0),c===void 0&&(c=0),this._platformTexture.setImageSource(e,r,o,s,l,u,c)},a.getPixelBuffer=function(e,r,o,s,l,u,c){var d=arguments.length;d===2?this._platformTexture.getPixelBuffer(e,0,0,this._width,this._height,0,r):d===3?this._platformTexture.getPixelBuffer(e,0,0,this._width>>r,this._height>>r,r,o):d===6?this._platformTexture.getPixelBuffer(e,r,o,s,l,0,u):d===7&&this._platformTexture.getPixelBuffer(e,r,o,s,l,u,c)},i}(yr),X1=function(n){Q(i,n);function i(t){var e;return e=n.call(this,t)||this,e._charInfoMap={},e._space=1,e._curX=1,e._curY=1,e._nextY=1,e}var a=i.prototype;return a._onDestroy=function(){this._texture.destroy(),this._texture=null,this._charInfoMap={}},a.uploadCharTexture=function(e){var r=e.w,o=e.h,s=e.data,l=this,u=l._space,c=l.texture,d=c.width,_=r+u,h=o+u;if(1+_>=d||1+h>=d)throw Error("The char fontSize is too large.");var f=this._curX+_;f>=d&&(this._curX=u,this._curY=this._nextY+u);var g=this._curY+h;if(g>this._nextY&&(this._nextY=g),g>=d)return!1;r>0&&o>0&&s&&(c.setPixelBuffer(s,0,this._curX,this._curY,r,o),c.generateMipmaps());var y=1/d,p=this._curX,v=this._curY,m=r,x=o,S=p*y,C=(p+m)*y,A=v*y,T=(v+x)*y;e.x=p,e.y=v;var E=e.uvs;return E[0].set(S,A),E[1].set(C,A),E[2].set(C,T),E[3].set(S,T),this._curX+=_+u,!0},a.addCharInfo=function(e,r){this._charInfoMap[e.charCodeAt(0)]=r},a.getCharInfo=function(e){return this._charInfoMap[e.charCodeAt(0)]},K(i,[{key:"texture",get:function(){return this._texture},set:function(e){this._texture=e}}]),i}(Xr),j1=function(){function n(a){this._fontAtlases=[],this._lastIndex=-1,this._engine=a}var i=n.prototype;return i.destroy=function(){for(var t=this._fontAtlases,e=0,r=t.length;e<r;++e)t[e].destroy(!0);t.length=0},i._uploadCharTexture=function(t){var e=this._fontAtlases,r=this._lastIndex;r===-1&&(this._createFontAtlas(),r++);var o=e[r];o.uploadCharTexture(t)||(o=this._createFontAtlas(),o.uploadCharTexture(t),r++),this._lastIndex=r,t.data=null},i._addCharInfo=function(t,e){var r=this._lastIndex;e.index=r,this._fontAtlases[r].addCharInfo(t,e)},i._getCharInfo=function(t){for(var e=this._fontAtlases,r=0,o=e.length;r<o;++r){var s=e[r],l=s.getCharInfo(t);if(l)return l}return null},i._getTextureByIndex=function(t){var e=this._fontAtlases[t];return e?e.texture:null},i._getLastIndex=function(){return this._lastIndex},i._createFontAtlas=function(){var t=this,e=t._engine,r=new X1(e),o=new dn(e,256,256);return r.texture=o,this._fontAtlases.push(r),r},n}(),ia=function(n){Q(i,n);function i(t,e){e===void 0&&(e="");var r;return r=n.call(this,t)||this,r._name="",r._subFontMap={},r._name=e,r}var a=i.prototype;return a._getSubFont=function(e,r){var o=e+"-"+r,s=this._subFontMap,l=s[o];return l||(l=new j1(this.engine),s[o]=l,l)},a._onDestroy=function(){var e=this._subFontMap;for(var r in e)e[r].destroy();this._subFontMap=null,delete i._fontMap[this._name]},i.createFromOS=function(e,r){if(r){var o=i._fontMap,s=o[r];return s||(s=new i(e,r),o[r]=s,s)}return null},K(i,[{key:"name",get:function(){return this._name}}]),i}(Xr);ia._fontMap={};var Y1=Symbol.toStringTag,Ae=function(){function n(a){var t=this;this._state="pending",this._onProgressCallback=[],this._promise=new Promise(function(e,r){t._reject=r;var o=function(c){t._state==="pending"&&(e(c),t._state="fulfilled",t._onProgressCallback=void 0)},s=function(c){t._state==="pending"&&(r(c),t._state="rejected",t._onProgressCallback=void 0)},l=function(c){t._state==="pending"&&(t._onCancelHandler=c)},u=function(c){t._state==="pending"&&t._onProgressCallback.forEach(function(d){return d(c)})};a(o,s,u,l)})}var i=n.prototype;return i.onProgress=function(t){return this._onProgressCallback.push(t),this},i.then=function(t,e){var r=this;return new n(function(o,s){r._promise.then(t,e).then(o).catch(s)})},i.catch=function(t){var e=this;return new n(function(r,o){e._promise.catch(t).then(r).catch(o)})},i.finally=function(t){return this._promise.finally(t)},i.cancel=function(){if(this._state==="pending")return this._state="canceled",this._reject("canceled"),this._onCancelHandler&&this._onCancelHandler(),this},n.all=function(t){return new n(function(e,r,o){var s=function(f,g){d++,c[f]=g,o(d/u),d===u&&e(c)},l=function(f,g){He(f,Promise)||He(f,n)?f.then(function(y){s(g,y)},r):Promise.resolve().then(function(){s(g,f)})},u=t.length,c=new Array(u),d=0;if(u===0)return e(c);for(var _=0;_<u;_++)l(t[_],_)})},K(n,[{key:Y1,get:function(){return"AssetPromise"}}]),n}(),yf;(function(n){n.Pending="pending",n.Fulfilled="fulfilled",n.Rejected="rejected",n.Canceled="canceled"})(yf||(yf={}));var Ds=function(){function n(a){this.engine=a,this.retryCount=1,this.retryInterval=0,this.timeout=1/0,this._assetPool=Object.create(null),this._assetUrlPool=Object.create(null),this._refObjectPool=Object.create(null),this._loadingPromises={},this._objectPool=Object.create(null),this._editorResourceConfig=Object.create(null),this._virtualPathMap=Object.create(null)}var i=n.prototype;return i.load=function(t){var e=this;if(!Array.isArray(t))return this._loadSingleItem(t);var r=t.map(function(o){return e._loadSingleItem(o)});return Ae.all(r)},i.cancelNotLoaded=function(t){var e=this;if(!t)gd(this._loadingPromises).forEach(function(o){o.cancel()});else if(typeof t=="string"){var r;(r=this._loadingPromises[t])==null||r.cancel()}else t.forEach(function(o){var s;(s=e._loadingPromises[o])==null||s.cancel()})},i.gc=function(){this._gc(!1)},i.getAssetPath=function(t){return this._assetPool[t]},i._addAsset=function(t,e){this._assetPool[e.instanceId]=t,this._assetUrlPool[t]=e},i._deleteAsset=function(t){var e=t.instanceId,r=this._assetPool[e];r&&(delete this._assetPool[e],delete this._assetUrlPool[r])},i._addRefObject=function(t,e){this._refObjectPool[t]=e},i._deleteRefObject=function(t){delete this._refObjectPool[t]},i._destroy=function(){this.cancelNotLoaded(),this._gc(!0),this._assetPool=null,this._assetUrlPool=null,this._refObjectPool=null},i._assignDefaultOptions=function(t){var e;if(t.type=(e=t.type)!=null?e:n._getTypeByUrl(t.url),t.type===void 0)throw"asset type should be specified: "+t.url;var r;t.retryCount=(r=t.retryCount)!=null?r:this.retryCount;var o;t.timeout=(o=t.timeout)!=null?o:this.timeout;var s;t.retryInterval=(s=t.retryInterval)!=null?s:this.retryInterval;var l;return t.url=(l=t.url)!=null?l:t.urls.join(","),t},i._loadSingleItem=function(t){var e=this,r=this._assignDefaultOptions(typeof t=="string"?{url:t}:t),o=r.url,s=this._virtualPathMap[o]?this._virtualPathMap[o]:o,l=this._parseURL(s),u=l.assetBaseURL,c=l.queryPath,d=c?this._parseQueryPath(c):[],_=this._assetUrlPool[u];if(_)return new Ae(function(S){S(e._getResolveResource(_,d))});var h=u;c&&(h+="?q="+d.shift());var f=this._loadingPromises,g=f[h];if(g)return new Ae(function(S,C){g.then(function(A){S(e._getResolveResource(A,d))}).catch(function(A){C(A)})});var y=n._loaders[r.type];if(!y)throw"loader not found: "+r.type;r.url=u;var p=y.load(r,this);if(He(p,Ae))return f[u]=p,p.then(function(S){y.useCache&&e._addAsset(u,S),delete f[u]}).catch(function(S){return delete f[u],Promise.reject(S)}),p;var v=function(S){var C=p[S],A=u===S;f[S]=C,C.then(function(T){if(A&&y.useCache){e._addAsset(S,T);for(var E in p)delete f[E]}}).catch(function(T){for(var E in p)delete f[E];return Promise.reject(T)})};for(var m in p)v(m);var x=p[h];return new Ae(function(S,C){x.then(function(A){S(e._getResolveResource(A,d))}),x.catch(function(A){C(A)})})},i._gc=function(t){for(var e=gd(this._refObjectPool),r=0,o=e.length;r<o;r++)(!e[r].isGCIgnored||t)&&e[r].destroy()},i._getResolveResource=function(t,e){var r=t;if(e)for(var o=0,s=e.length;o<s;o++){var l=e[o];r=r[l]}return r},i._parseURL=function(t){var e=t,r=e.indexOf("?");return r!==-1&&(e=e.slice(0,r)),{assetBaseURL:e,queryPath:this._getParameterByName("q",t)}},i._getParameterByName=function(t,e){e===void 0&&(e=window.location.href),t=t.replace(/[\[\]]/g,"\\$&");var r=new RegExp("[?&]"+t+"(=([^&#]*)|&|#|$)"),o=r.exec(e);return o?o[2]?decodeURIComponent(o[2].replace(/\+/g," ")):"":null},i._parseQueryPath=function(t){var e=[];return t.charCodeAt(0)===q1&&e.push(""),t.replace($1,function(r,o,s,l){var u=r;s?u=l.replace(Q1,"$1"):o&&(u=o.trim()),e.push(u)}),e},i.getResourceByRef=function(t){var e=t.refId,r=t.key,o=t.isClone,s=this._objectPool[e],l;if(s)l=Promise.resolve(s);else{var u,c=(u=this._editorResourceConfig[e])==null?void 0:u.path;if(!c)return we.warn("refId:"+e+" is not find in this._editorResourceConfig."),Promise.resolve(null);c=r?""+c+(c.indexOf("?")>-1?"&":"?")+"q="+r:c,l=this.load({url:c,type:this._editorResourceConfig[e].type})}return l.then(function(d){return o?d.clone():d})},i.initVirtualResources=function(t){var e=this;t.forEach(function(r){e._virtualPathMap[r.virtualPath]=r.path,e._editorResourceConfig[r.id]=r})},n._addLoader=function(t,e,r){this._loaders[t]=e;for(var o=0,s=r.length;o<s;o++)this._extTypeMapping[r[o]]=t},n._getTypeByUrl=function(t){var e=t.split("?")[0];return this._extTypeMapping[e.substring(e.lastIndexOf(".")+1)]},n}();Ds._loaders={};Ds._extTypeMapping={};function lt(n,i,a){return a===void 0&&(a=!0),function(t){var e=new t(a);Ds._addLoader(n,e,i)}}var q1=".".charCodeAt(0),Q1=/\\(\\)?/g,$1=RegExp(`[^.[\\]]+|\\[(?:([^"'][^[]*)|(["'])((?:(?!\\2)[^\\\\]|\\\\.)*?)\\2)\\]|(?=(?:\\.|\\[\\])(?:\\.|\\[\\]|$))`,"g"),ot=function(){function n(a){a===void 0&&(a=0),this.length=0,this._elements=new Array(a)}var i=n.prototype;return i.add=function(t){this.length===this._elements.length?this._elements.push(t):this._elements[this.length]=t,this.length++},i.delete=function(t){var e=this._elements.indexOf(t);this.deleteByIndex(e)},i.get=function(t){if(t>=this.length)throw"Index is out of range.";return this._elements[t]},i.deleteByIndex=function(t){var e=this._elements,r=null,o=this.length-1;return t!==o&&(r=e[o],e[t]=r),this.length--,r},i.garbageCollection=function(){this._elements.length=this.length},n}(),K1=function(){function n(){this._renderers=new ot,this._onStartScripts=new ot,this._onUpdateScripts=new ot,this._onLateUpdateScripts=new ot,this._onPhysicsUpdateScripts=new ot,this._disableScripts=[],this._pendingDestroyScripts=[],this._disposeDestroyScripts=[],this._onUpdateAnimations=new ot,this._onUpdateRenderers=new ot,this._componentsContainerPool=[]}var i=n.prototype;return i.addRenderer=function(t){t._rendererIndex=this._renderers.length,this._renderers.add(t)},i.removeRenderer=function(t){var e=this._renderers.deleteByIndex(t._rendererIndex);e&&(e._rendererIndex=t._rendererIndex),t._rendererIndex=-1},i.addOnStartScript=function(t){t._onStartIndex=this._onStartScripts.length,this._onStartScripts.add(t)},i.removeOnStartScript=function(t){var e=this._onStartScripts.deleteByIndex(t._onStartIndex);e&&(e._onStartIndex=t._onStartIndex),t._onStartIndex=-1},i.addOnUpdateScript=function(t){t._onUpdateIndex=this._onUpdateScripts.length,this._onUpdateScripts.add(t)},i.removeOnUpdateScript=function(t){var e=this._onUpdateScripts.deleteByIndex(t._onUpdateIndex);e&&(e._onUpdateIndex=t._onUpdateIndex),t._onUpdateIndex=-1},i.addOnLateUpdateScript=function(t){t._onLateUpdateIndex=this._onLateUpdateScripts.length,this._onLateUpdateScripts.add(t)},i.removeOnLateUpdateScript=function(t){var e=this._onLateUpdateScripts.deleteByIndex(t._onLateUpdateIndex);e&&(e._onLateUpdateIndex=t._onLateUpdateIndex),t._onLateUpdateIndex=-1},i.addOnPhysicsUpdateScript=function(t){t._onPhysicsUpdateIndex=this._onPhysicsUpdateScripts.length,this._onPhysicsUpdateScripts.add(t)},i.removeOnPhysicsUpdateScript=function(t){var e=this._onPhysicsUpdateScripts.deleteByIndex(t._onPhysicsUpdateIndex);e&&(e._onPhysicsUpdateIndex=t._onPhysicsUpdateIndex),t._onPhysicsUpdateIndex=-1},i.addOnUpdateAnimations=function(t){t._onUpdateIndex=this._onUpdateAnimations.length,this._onUpdateAnimations.add(t)},i.removeOnUpdateAnimations=function(t){var e=this._onUpdateAnimations.deleteByIndex(t._onUpdateIndex);e&&(e._onUpdateIndex=t._onUpdateIndex),t._onUpdateIndex=-1},i.addOnUpdateRenderers=function(t){t._onUpdateIndex=this._onUpdateRenderers.length,this._onUpdateRenderers.add(t)},i.removeOnUpdateRenderers=function(t){var e=this._onUpdateRenderers.deleteByIndex(t._onUpdateIndex);e&&(e._onUpdateIndex=t._onUpdateIndex),t._onUpdateIndex=-1},i.addDisableScript=function(t){this._disableScripts.push(t)},i.addPendingDestroyScript=function(t){this._pendingDestroyScripts.push(t)},i.callScriptOnStart=function(){var t=this._onStartScripts;if(t.length>0){for(var e=t._elements,r=0;r<t.length;r++){var o=e[r];o._waitHandlingInValid||(o._started=!0,o._onStartIndex=-1,o.onStart())}t.length=0}},i.callScriptOnUpdate=function(t){for(var e=this._onUpdateScripts._elements,r=this._onUpdateScripts.length-1;r>=0;--r){var o=e[r];!o._waitHandlingInValid&&o._started&&o.onUpdate(t)}},i.callScriptOnLateUpdate=function(t){for(var e=this._onLateUpdateScripts._elements,r=this._onLateUpdateScripts.length-1;r>=0;--r){var o=e[r];!o._waitHandlingInValid&&o._started&&o.onLateUpdate(t)}},i.callScriptOnPhysicsUpdate=function(){for(var t=this._onPhysicsUpdateScripts._elements,e=this._onPhysicsUpdateScripts.length-1;e>=0;--e){var r=t[e];!r._waitHandlingInValid&&r._started&&r.onPhysicsUpdate()}},i.callAnimationUpdate=function(t){for(var e=this._onUpdateAnimations._elements,r=this._onUpdateAnimations.length-1;r>=0;--r)e[r].update(t)},i.callRendererOnUpdate=function(t){for(var e=this._onUpdateRenderers._elements,r=this._onUpdateRenderers.length-1;r>=0;--r)e[r].update(t)},i.handlingInvalidScripts=function(){var t=this,e=t._disableScripts,r=e.length;if(r>0){for(var o=r-1;o>=0;o--){var s=e[o];s._waitHandlingInValid&&s._handlingInValid()}e.length=0}var l=this,u=l._disposeDestroyScripts,c=l._pendingDestroyScripts;if(this._disposeDestroyScripts=c,this._pendingDestroyScripts=u,r=c.length,r>0){for(var d=r-1;d>=0;d--)c[d].onDestroy();c.length=0}},i.callCameraOnBeginRender=function(t){for(var e=t.entity._scripts,r=e.length-1;r>=0;--r){var o=e.get(r);o._waitHandlingInValid||o.onBeginRender(t)}},i.callCameraOnEndRender=function(t){for(var e=t.entity._scripts,r=e.length-1;r>=0;--r){var o=e.get(r);o._waitHandlingInValid||o.onEndRender(t)}},i.getActiveChangedTempList=function(){return this._componentsContainerPool.length?this._componentsContainerPool.pop():[]},i.putActiveChangedTempList=function(t){t.length=0,this._componentsContainerPool.push(t)},n}(),J1=function(){function n(){}return n.cloneComponent=function(a,t){for(var e=Gn.getCloneMode(a.constructor),r=Object.keys(a),o=0,s=r.length;o<s;o++){var l=r[o],u=e[l];switch(u){case void 0:case zr.Assignment:t[l]=a[l];break;case zr.Shallow:var c=a[l];if(He(c,Object)){var d=t[l];d==null&&(d=t[l]=c.constructor()),Object.assign(d,c)}else t[l]=c;break;case zr.Deep:var _=a[l];if(He(_,Object)){var h=t[l];h==null&&(h=t[l]=_.constructor()),Gn.deepCloneObject(_,h)}else t[l]=_;break}}a._cloneTo&&a._cloneTo(t)},n}(),vs=function(){function n(){}return n._register=function(a,t){this._addDependency(a,t,this._dependenciesMap),this._addDependency(t,a,this._invDependenciesMap)},n._addCheck=function(a,t){var e=n._dependenciesMap.get(t);if(e)for(var r=0,o=e.length;r<o;r++){var s=e[r];a.getComponent(s)||a.addComponent(s)}},n._removeCheck=function(a,t){var e=n._invDependenciesMap.get(t);if(e){for(var r=0,o=e.length;r<o;r++)if(a.getComponent(e[r]))throw"you should remove "+e[r]+" before adding "+t}},n._addDependency=function(a,t,e){var r=e.get(a);r||(r=[],e.set(a,r)),r.indexOf(t)===-1&&r.push(t)},n}();vs._dependenciesMap=new Map;vs._invDependenciesMap=new Map;function ua(){for(var n=arguments.length,i=new Array(n),a=0;a<n;a++)i[a]=arguments[a];return function(t){i.forEach(function(e){return vs._register(t,e)})}}var Ut;(function(n){n[n.Layer0=1]="Layer0",n[n.Layer1=2]="Layer1",n[n.Layer2=4]="Layer2",n[n.Layer3=8]="Layer3",n[n.Layer4=16]="Layer4",n[n.Layer5=32]="Layer5",n[n.Layer6=64]="Layer6",n[n.Layer7=128]="Layer7",n[n.Layer8=256]="Layer8",n[n.Layer9=512]="Layer9",n[n.Layer10=1024]="Layer10",n[n.Layer11=2048]="Layer11",n[n.Layer12=4096]="Layer12",n[n.Layer13=8192]="Layer13",n[n.Layer14=16384]="Layer14",n[n.Layer15=32768]="Layer15",n[n.Layer16=65536]="Layer16",n[n.Layer17=131072]="Layer17",n[n.Layer18=262144]="Layer18",n[n.Layer19=524288]="Layer19",n[n.Layer20=1048576]="Layer20",n[n.Layer21=2097152]="Layer21",n[n.Layer22=4194304]="Layer22",n[n.Layer23=8388608]="Layer23",n[n.Layer24=16777216]="Layer24",n[n.Layer25=33554432]="Layer25",n[n.Layer26=67108864]="Layer26",n[n.Layer27=134217728]="Layer27",n[n.Layer28=268435456]="Layer28",n[n.Layer29=536870912]="Layer29",n[n.Layer30=1073741824]="Layer30",n[n.Layer31=2147483648]="Layer31",n[n.Everything=4294967295]="Everything",n[n.Nothing=0]="Nothing"})(Ut||(Ut={}));var Z1=function(){function n(){this._flagManagers=[]}var i=n.prototype;return i.clearFromManagers=function(){this._removeFromManagers(),this._flagManagers.length=0},i.destroy=function(){this._removeFromManagers(),this._flagManagers=null},i._removeFromManagers=function(){for(var t=this._flagManagers,e=0,r=t.length;e<r;e++)El(t[e]._updateFlags,this)},n}(),Ru=function(n){Q(i,n);function i(){var t;return t=n.apply(this,arguments)||this,t.flag=!0,t}var a=i.prototype;return a.dispatch=function(){this.flag=!0},i}(Z1),vn=function(n){Q(i,n);function i(t){var e;return e=n.call(this,t.engine)||this,e._awoken=!1,e._destroyed=!1,e._phasedActive=!1,e._enabled=!0,e._entity=t,e}var a=i.prototype;return a.destroy=function(){this._destroyed||(this._entity._removeComponent(this),this._entity.isActiveInHierarchy&&this._enabled&&this._onDisable(),this._destroyed=!0,this._onDestroy())},a._onAwake=function(){},a._onEnable=function(){},a._onDisable=function(){},a._onDestroy=function(){},a._setActive=function(e){var r=this._entity;e?(!this._awoken&&r._isActiveInHierarchy&&(this._awoken=!0,this._onAwake()),!this._phasedActive&&r._isActiveInHierarchy&&this._enabled&&(this._phasedActive=!0,this._onEnable())):this._phasedActive&&!(r._isActiveInHierarchy&&this._enabled)&&(this._phasedActive=!1,this._onDisable())},K(i,[{key:"enabled",get:function(){return this._enabled},set:function(e){e!==this._enabled&&(this._enabled=e,this._entity.isActiveInHierarchy&&(e?(this._phasedActive=!0,this._onEnable()):(this._phasedActive=!1,this._onDisable())))}},{key:"destroyed",get:function(){return this._destroyed}},{key:"entity",get:function(){return this._entity}},{key:"scene",get:function(){return this._entity.scene}}]),i}(ar);O([Y],vn.prototype,"_entity",void 0);O([Y],vn.prototype,"_awoken",void 0);O([Y],vn.prototype,"_destroyed",void 0);O([Y],vn.prototype,"_phasedActive",void 0);O([Be],vn.prototype,"_enabled",void 0);var Ja=function(){function n(){this._updateFlags=[],this._listensers=[]}var i=n.prototype;return i.createFlag=function(t){var e=new t;return this.addFlag(e),e},i.addFlag=function(t){this._updateFlags.push(t),t._flagManagers.push(this)},i.removeFlag=function(t){var e=El(this._updateFlags,t);e&&El(t._flagManagers,this)},i.addListener=function(t){this._listensers.push(t)},i.removeListener=function(t){El(this._listensers,t)},i.dispatch=function(t,e){for(var r=this._updateFlags,o=r.length-1;o>=0;o--)r[o].dispatch(t,e);for(var s=this._listensers,l=s.length-1;l>=0;l--)s[l](t,e)},n}(),fe=function(n){Q(i,n);function i(t){var e;return e=n.call(this,t)||this,e._dirtyFlag=188,e._position=new w,e._rotation=new w,e._rotationQuaternion=new ve,e._scale=new w(1,1,1),e._worldPosition=new w,e._worldRotation=new w,e._worldRotationQuaternion=new ve,e._lossyWorldScale=new w(1,1,1),e._localMatrix=new J,e._worldMatrix=new J,e._isParentDirty=!0,e._parentTransformCache=null,e._updateFlagManager=new Ja,e._onPositionChanged=e._onPositionChanged.bind(_e(e)),e._onWorldPositionChanged=e._onWorldPositionChanged.bind(_e(e)),e._onRotationChanged=e._onRotationChanged.bind(_e(e)),e._onWorldRotationChanged=e._onWorldRotationChanged.bind(_e(e)),e._onRotationQuaternionChanged=e._onRotationQuaternionChanged.bind(_e(e)),e._onWorldRotationQuaternionChanged=e._onWorldRotationQuaternionChanged.bind(_e(e)),e._onScaleChanged=e._onScaleChanged.bind(_e(e)),e._position._onValueChanged=e._onPositionChanged,e._worldPosition._onValueChanged=e._onWorldPositionChanged,e._rotation._onValueChanged=e._onRotationChanged,e._worldRotation._onValueChanged=e._onWorldRotationChanged,e._rotationQuaternion._onValueChanged=e._onRotationQuaternionChanged,e._worldRotationQuaternion._onValueChanged=e._onWorldRotationQuaternionChanged,e._scale._onValueChanged=e._onScaleChanged,e}var a=i.prototype;return a.setPosition=function(e,r,o){this._position.set(e,r,o)},a.setRotation=function(e,r,o){this._rotation.set(e,r,o)},a.setRotationQuaternion=function(e,r,o,s){this._rotationQuaternion.set(e,r,o,s)},a.setScale=function(e,r,o){this._scale.set(e,r,o)},a.setWorldPosition=function(e,r,o){this._worldPosition.set(e,r,o)},a.setWorldRotation=function(e,r,o){this._worldRotation.set(e,r,o)},a.setWorldRotationQuaternion=function(e,r,o,s){this._worldRotationQuaternion.set(e,r,o,s)},a.getWorldForward=function(e){var r=this.worldMatrix.elements;return e.set(-r[8],-r[9],-r[10]),e.normalize()},a.getWorldRight=function(e){var r=this.worldMatrix.elements;return e.set(r[0],r[1],r[2]),e.normalize()},a.getWorldUp=function(e){var r=this.worldMatrix.elements;return e.set(r[4],r[5],r[6]),e.normalize()},a.translate=function(e,r,o,s){if(typeof e=="number"){var l=i._tempVec30;l.set(e,r,o),this._translate(l,s)}else this._translate(e,r)},a.rotate=function(e,r,o,s){typeof e=="number"?this._rotateXYZ(e,r,o,s):this._rotateXYZ(e.x,e.y,e.z,r)},a.rotateByAxis=function(e,r,o){o===void 0&&(o=!0);var s=r*H.degreeToRadFactor;ve.rotationAxisAngle(e,s,i._tempQuat0),this._rotateByQuat(i._tempQuat0,o)},a.lookAt=function(e,r){var o=i._tempVec30;w.subtract(this.worldPosition,e,o);var s=o.length();if(!(s<=H.zeroTolerance)){o.scale(1/s);var l=i._tempVec31;if(r?w.cross(r,o,l):l.set(o.z,0,-o.x),s=l.length(),!(s<=H.zeroTolerance)){l.scale(1/s);var u=i._tempVec32;w.cross(o,l,u);var c=i._tempMat41,d=c.elements;d[0]=l.x,d[1]=l.y,d[2]=l.z,d[4]=u.x,d[5]=u.y,d[6]=u.z,d[8]=o.x,d[9]=o.y,d[10]=o.z,c.getRotation(this._worldRotationQuaternion)}}},a.registerWorldChangeFlag=function(){return this._updateFlagManager.createFlag(Ru)},a._parentChange=function(){this._isParentDirty=!0,this._updateAllWorldFlag()},a._isFrontFaceInvert=function(){var e=this.lossyWorldScale,r=e.x<0;return e.y<0&&(r=!r),e.z<0&&(r=!r),r},a._updateWorldPositionFlag=function(){if(!this._isContainDirtyFlags(132)){this._worldAssociatedChange(132);for(var e=this._entity._children,r=0,o=e.length;r<o;r++){var s;(s=e[r].transform)==null||s._updateWorldPositionFlag()}}},a._updateWorldRotationFlag=function(){if(!this._isContainDirtyFlags(152)){this._worldAssociatedChange(152);for(var e=this._entity._children,r=0,o=e.length;r<o;r++){var s;(s=e[r].transform)==null||s._updateWorldPositionAndRotationFlag()}}},a._updateWorldPositionAndRotationFlag=function(){if(!this._isContainDirtyFlags(156)){this._worldAssociatedChange(156);for(var e=this._entity._children,r=0,o=e.length;r<o;r++){var s;(s=e[r].transform)==null||s._updateWorldPositionAndRotationFlag()}}},a._updateWorldScaleFlag=function(){if(!this._isContainDirtyFlags(160)){this._worldAssociatedChange(160);for(var e=this._entity._children,r=0,o=e.length;r<o;r++){var s;(s=e[r].transform)==null||s._updateWorldPositionAndScaleFlag()}}},a._updateWorldPositionAndScaleFlag=function(){if(!this._isContainDirtyFlags(164)){this._worldAssociatedChange(164);for(var e=this._entity._children,r=0,o=e.length;r<o;r++){var s;(s=e[r].transform)==null||s._updateWorldPositionAndScaleFlag()}}},a._updateAllWorldFlag=function(){if(!this._isContainDirtyFlags(188)){this._worldAssociatedChange(188);for(var e=this._entity._children,r=0,o=e.length;r<o;r++){var s;(s=e[r].transform)==null||s._updateAllWorldFlag()}}},a._getParentTransform=function(){if(!this._isParentDirty)return this._parentTransformCache;for(var e=null,r=this._entity.parent;r;){var o=r.transform;if(o){e=o;break}else r=r.parent}return this._parentTransformCache=e,this._isParentDirty=!1,e},a._getScaleMatrix=function(){var e=i._tempQuat0,r=i._tempMat30,o=i._tempMat31,s=i._tempMat32;return o.copyFromMatrix(this.worldMatrix),ve.invert(this.worldRotationQuaternion,e),$a.rotationQuaternion(e,r),$a.multiply(r,o,s),s},a._isContainDirtyFlags=function(e){return(this._dirtyFlag&e)===e},a._isContainDirtyFlag=function(e){return(this._dirtyFlag&e)!=0},a._setDirtyFlagTrue=function(e){this._dirtyFlag|=e},a._setDirtyFlagFalse=function(e){this._dirtyFlag&=~e},a._worldAssociatedChange=function(e){this._dirtyFlag|=e,this._updateFlagManager.dispatch(128)},a._rotateByQuat=function(e,r){r?ve.multiply(this.rotationQuaternion,e,this._rotationQuaternion):ve.multiply(e,this.worldRotationQuaternion,this._worldRotationQuaternion)},a._translate=function(e,r){if(r===void 0&&(r=!0),r){var o=i._tempVec30;w.transformByQuat(e,this.worldRotationQuaternion,o),this._worldPosition.add(o)}else this._worldPosition.add(e)},a._rotateXYZ=function(e,r,o,s){s===void 0&&(s=!0);var l=H.degreeToRadFactor,u=i._tempQuat0;ve.rotationEuler(e*l,r*l,o*l,u),this._rotateByQuat(u,s)},a._onPositionChanged=function(){this._setDirtyFlagTrue(64),this._updateWorldPositionFlag()},a._onWorldPositionChanged=function(){var e=this._worldPosition,r=this._getParentTransform();r?(J.invert(r.worldMatrix,i._tempMat41),w.transformCoordinate(e,i._tempMat41,this._position)):this._position.copyFrom(e),this._setDirtyFlagFalse(4)},a._onRotationChanged=function(){this._setDirtyFlagTrue(66),this._setDirtyFlagFalse(1),this._updateWorldRotationFlag()},a._onWorldRotationChanged=function(){var e=this._worldRotation;ve.rotationEuler(H.degreeToRadian(e.x),H.degreeToRadian(e.y),H.degreeToRadian(e.z),this._worldRotationQuaternion),this._setDirtyFlagFalse(8)},a._onRotationQuaternionChanged=function(){this._setDirtyFlagTrue(65),this._setDirtyFlagFalse(2),this._updateWorldRotationFlag()},a._onWorldRotationQuaternionChanged=function(){var e=this._worldRotationQuaternion,r=this._getParentTransform();if(r){var o=i._tempQuat0;ve.invert(r.worldRotationQuaternion,o),ve.multiply(o,e,this._rotationQuaternion)}else this._rotationQuaternion.copyFrom(e);this._setDirtyFlagFalse(16)},a._onScaleChanged=function(){this._setDirtyFlagTrue(64),this._updateWorldScaleFlag()},K(i,[{key:"position",get:function(){return this._position},set:function(e){this._position!==e&&this._position.copyFrom(e)}},{key:"worldPosition",get:function(){var e=this._worldPosition;return this._isContainDirtyFlag(4)&&(e._onValueChanged=null,this._getParentTransform()?this.worldMatrix.getTranslation(e):e.copyFrom(this._position),e._onValueChanged=this._onWorldPositionChanged,this._setDirtyFlagFalse(4)),e},set:function(e){this._worldPosition!==e&&this._worldPosition.copyFrom(e)}},{key:"rotation",get:function(){var e=this._rotation;return this._isContainDirtyFlag(1)&&(e._onValueChanged=null,this._rotationQuaternion.toEuler(e),e.scale(H.radToDegreeFactor),e._onValueChanged=this._onRotationChanged,this._setDirtyFlagFalse(1)),e},set:function(e){this._rotation!==e&&this._rotation.copyFrom(e)}},{key:"worldRotation",get:function(){var e=this._worldRotation;return this._isContainDirtyFlag(8)&&(e._onValueChanged=null,this.worldRotationQuaternion.toEuler(e),e.scale(H.radToDegreeFactor),e._onValueChanged=this._onWorldRotationChanged,this._setDirtyFlagFalse(8)),e},set:function(e){this._worldRotation!==e&&this._worldRotation.copyFrom(e)}},{key:"rotationQuaternion",get:function(){var e=this._rotationQuaternion;return this._isContainDirtyFlag(2)&&(e._onValueChanged=null,ve.rotationEuler(H.degreeToRadian(this._rotation.x),H.degreeToRadian(this._rotation.y),H.degreeToRadian(this._rotation.z),e),e._onValueChanged=this._onRotationQuaternionChanged,this._setDirtyFlagFalse(2)),e},set:function(e){this._rotationQuaternion!==e?e.normalized?this._rotationQuaternion.copyFrom(e):ve.normalize(e,this._rotationQuaternion):e.normalized||e.normalize()}},{key:"worldRotationQuaternion",get:function(){var e=this._worldRotationQuaternion;if(this._isContainDirtyFlag(16)){e._onValueChanged=null;var r=this._getParentTransform();r!=null?ve.multiply(r.worldRotationQuaternion,this.rotationQuaternion,e):e.copyFrom(this.rotationQuaternion),e._onValueChanged=this._onWorldRotationQuaternionChanged,this._setDirtyFlagFalse(16)}return e},set:function(e){this._worldRotationQuaternion!==e&&(e.normalized?this._worldRotationQuaternion.copyFrom(e):ve.normalize(e,this._worldRotationQuaternion)),e.normalized||e.normalize()}},{key:"scale",get:function(){return this._scale},set:function(e){this._scale!==e&&this._scale.copyFrom(e)}},{key:"lossyWorldScale",get:function(){if(this._isContainDirtyFlag(32)){if(this._getParentTransform()){var e=this._getScaleMatrix(),r=e.elements;this._lossyWorldScale.set(r[0],r[4],r[8])}else this._lossyWorldScale.copyFrom(this._scale);this._setDirtyFlagFalse(32)}return this._lossyWorldScale}},{key:"localMatrix",get:function(){return this._isContainDirtyFlag(64)&&(J.affineTransformation(this._scale,this.rotationQuaternion,this._position,this._localMatrix),this._setDirtyFlagFalse(64)),this._localMatrix},set:function(e){this._localMatrix!==e&&this._localMatrix.copyFrom(e),this._position._onValueChanged=this._rotationQuaternion._onValueChanged=this._scale._onValueChanged=null,this._localMatrix.decompose(this._position,this._rotationQuaternion,this._scale),this._position._onValueChanged=this._onPositionChanged,this._rotationQuaternion._onValueChanged=this._onRotationQuaternionChanged,this._scale._onValueChanged=this._onScaleChanged,this._setDirtyFlagTrue(1),this._setDirtyFlagFalse(66),this._updateAllWorldFlag()}},{key:"worldMatrix",get:function(){if(this._isContainDirtyFlag(128)){var e=this._getParentTransform();e?J.multiply(e.worldMatrix,this.localMatrix,this._worldMatrix):this._worldMatrix.copyFrom(this.localMatrix),this._setDirtyFlagFalse(128)}return this._worldMatrix},set:function(e){this._worldMatrix!==e&&this._worldMatrix.copyFrom(e);var r=this._getParentTransform();r?(J.invert(r.worldMatrix,i._tempMat42),J.multiply(i._tempMat42,e,this._localMatrix)):this._localMatrix.copyFrom(e),this.localMatrix=this._localMatrix,this._setDirtyFlagFalse(128)}}]),i}(vn);fe._tempQuat0=new ve;fe._tempVec30=new w;fe._tempVec31=new w;fe._tempVec32=new w;fe._tempMat30=new $a;fe._tempMat31=new $a;fe._tempMat32=new $a;fe._tempMat41=new J;fe._tempMat42=new J;O([je],fe.prototype,"_position",void 0);O([je],fe.prototype,"_rotation",void 0);O([je],fe.prototype,"_rotationQuaternion",void 0);O([je],fe.prototype,"_scale",void 0);O([je],fe.prototype,"_worldPosition",void 0);O([je],fe.prototype,"_worldRotation",void 0);O([je],fe.prototype,"_worldRotationQuaternion",void 0);O([je],fe.prototype,"_lossyWorldScale",void 0);O([je],fe.prototype,"_localMatrix",void 0);O([je],fe.prototype,"_worldMatrix",void 0);O([Y],fe.prototype,"_isParentDirty",void 0);O([Y],fe.prototype,"_parentTransformCache",void 0);O([Y],fe.prototype,"_updateFlagManager",void 0);O([Y],fe.prototype,"_onPositionChanged",null);O([Y],fe.prototype,"_onWorldPositionChanged",null);O([Y],fe.prototype,"_onRotationChanged",null);O([Y],fe.prototype,"_onWorldRotationChanged",null);O([Y],fe.prototype,"_onRotationQuaternionChanged",null);O([Y],fe.prototype,"_onWorldRotationQuaternionChanged",null);O([Y],fe.prototype,"_onScaleChanged",null);var xf;(function(n){n[n.LocalEuler=1]="LocalEuler",n[n.LocalQuat=2]="LocalQuat",n[n.WorldPosition=4]="WorldPosition",n[n.WorldEuler=8]="WorldEuler",n[n.WorldQuat=16]="WorldQuat",n[n.WorldScale=32]="WorldScale",n[n.LocalMatrix=64]="LocalMatrix",n[n.WorldMatrix=128]="WorldMatrix",n[n.WmWp=132]="WmWp",n[n.WmWeWq=152]="WmWeWq",n[n.WmWpWeWq=156]="WmWpWeWq",n[n.WmWs=160]="WmWs",n[n.WmWpWs=164]="WmWpWs",n[n.WmWpWeWqWs=188]="WmWpWeWqWs"})(xf||(xf={}));var Fr=function(n){Q(i,n);function i(t,e){var r;return r=n.call(this,t)||this,r.layer=Ut.Layer0,r._isActiveInHierarchy=!1,r._components=[],r._scripts=new ot,r._children=[],r._isRoot=!1,r._isActive=!0,r._siblingIndex=-1,r._parent=null,r._invModelMatrix=new J,r.name=e,r.transform=r.addComponent(fe),r._inverseWorldMatFlag=r.transform.registerWorldChangeFlag(),r}var a=i.prototype;return a.addComponent=function(e){vs._addCheck(this,e);var r=new e(this);return this._components.push(r),r._setActive(!0),r},a.getComponent=function(e){for(var r=this._components,o=r.length-1;o>=0;o--){var s=r[o];if(He(s,e))return s}},a.getComponents=function(e,r){r.length=0;for(var o=this._components,s=0,l=o.length;s<l;s++){var u=o[s];He(u,e)&&r.push(u)}return r},a.getComponentsIncludeChildren=function(e,r){return r.length=0,this._getComponentsInChildren(e,r),r},a.addChild=function(e,r){var o;if(typeof e=="number"?o=e:(o=void 0,r=e),r._isRoot){r._scene._removeFromEntityList(r),r._isRoot=!1,this._addToChildrenList(o,r),r._parent=this;var s=this._scene;r._scene!==s&&i._traverseSetOwnerScene(r,s),this._isActiveInHierarchy?!r._isActiveInHierarchy&&r._isActive&&r._processActive():r._isActiveInHierarchy&&r._processInActive(),r._setTransformDirty()}else r._setParent(this,o)},a.removeChild=function(e){e._setParent(null)},a.getChild=function(e){return this._children[e]},a.findByName=function(e){if(e===this.name)return this;for(var r=this._children,o=0,s=r.length;o<s;o++){var l=r[o].findByName(e);if(l)return l}return null},a.findByPath=function(e){for(var r=e.split("/"),o=this,s=0,l=r.length;s<l;++s){var u=r[s];if(u&&(o=i._findChildByName(o,u),!o))return null}return o},a.createChild=function(e){var r=new i(this.engine,e);return r.layer=this.layer,r.parent=this,r},a.clearChildren=function(){for(var e=this._children,r=e.length-1;r>=0;r--){var o=e[r];o._parent=null,o._isActiveInHierarchy&&o._processInActive(),i._traverseSetOwnerScene(o,null)}e.length=0},a.clone=function(){var e=new i(this._engine,this.name);e._isActive=this._isActive,e.transform.localMatrix=this.transform.localMatrix;for(var r=this._children,o=0,s=this._children.length;o<s;o++){var l=r[o];e.addChild(l.clone())}for(var u=this._components,c=0,d=u.length;c<d;c++){var _=u[c];if(!He(_,fe)){var h=e.addComponent(_.constructor);J1.cloneComponent(_,h)}}return e},a.destroy=function(){if(!this._destroyed){n.prototype.destroy.call(this);for(var e=this._components,r=e.length-1;r>=0;r--)e[r].destroy();this._components.length=0;for(var o=this._children;o.length>0;)o[0].destroy();this._isRoot?(this._scene._removeFromEntityList(this),this._isRoot=!1):this._removeFromParent()}},a._removeComponent=function(e){vs._removeCheck(this,e.constructor);var r=this._components;r.splice(r.indexOf(e),1)},a._addScript=function(e){e._entityScriptsIndex=this._scripts.length,this._scripts.add(e)},a._removeScript=function(e){var r=this._scripts.deleteByIndex(e._entityScriptsIndex);r&&(r._entityScriptsIndex=e._entityScriptsIndex),e._entityScriptsIndex=-1},a._removeFromParent=function(){var e=this._parent;if(e!=null){var r=e._children,o=this._siblingIndex;r.splice(o,1);for(var s=r.length;o<s;o++)r[o]._siblingIndex--;this._parent=null,this._siblingIndex=-1}},a._processActive=function(){if(this._activeChangedComponents)throw"Note: can't set the 'main inActive entity' active in hierarchy, if the operation is in main inActive entity or it's children script's onDisable Event.";this._activeChangedComponents=this._engine._componentsManager.getActiveChangedTempList(),this._setActiveInHierarchy(this._activeChangedComponents),this._setActiveComponents(!0)},a._processInActive=function(){if(this._activeChangedComponents)throw"Note: can't set the 'main active entity' inActive in hierarchy, if the operation is in main active entity or it's children script's onEnable Event.";this._activeChangedComponents=this._engine._componentsManager.getActiveChangedTempList(),this._setInActiveInHierarchy(this._activeChangedComponents),this._setActiveComponents(!1)},a._addToChildrenList=function(e,r){var o=this._children,s=o.length;if(e===void 0)r._siblingIndex=s,o.push(r);else{if(e<0||e>s)throw"The index "+e+" is out of child list bounds "+s;r._siblingIndex=e,o.splice(e,0,r);for(var l=e+1,u=s+1;l<u;l++)o[l]._siblingIndex++}},a._setParent=function(e,r){var o=this._parent;if(e!==o){if(this._removeFromParent(),this._parent=e,e){e._addToChildrenList(r,this);var s=e._scene;this._scene!==s&&i._traverseSetOwnerScene(this,s),e._isActiveInHierarchy?!this._isActiveInHierarchy&&this._isActive&&this._processActive():this._isActiveInHierarchy&&this._processInActive()}else this._isActiveInHierarchy&&this._processInActive(),o&&i._traverseSetOwnerScene(this,null);this._setTransformDirty()}},a._getComponentsInChildren=function(e,r){for(var o=this._components.length-1;o>=0;o--){var s=this._components[o];He(s,e)&&r.push(s)}for(var l=this._children.length-1;l>=0;l--)this._children[l]._getComponentsInChildren(e,r)},a._setActiveComponents=function(e){for(var r=this._activeChangedComponents,o=0,s=r.length;o<s;++o)r[o]._setActive(e);this._engine._componentsManager.putActiveChangedTempList(r),this._activeChangedComponents=null},a._setActiveInHierarchy=function(e){this._isActiveInHierarchy=!0;for(var r=this._components,o=r.length-1;o>=0;o--){var s=r[o];(s.enabled||!s._awoken)&&e.push(s)}for(var l=this._children,u=l.length-1;u>=0;u--){var c=l[u];c.isActive&&c._setActiveInHierarchy(e)}},a._setInActiveInHierarchy=function(e){this._isActiveInHierarchy=!1;for(var r=this._components,o=r.length-1;o>=0;o--){var s=r[o];s.enabled&&e.push(s)}for(var l=this._children,u=l.length-1;u>=0;u--){var c=l[u];c.isActive&&c._setInActiveInHierarchy(e)}},a._setTransformDirty=function(){if(this.transform)this.transform._parentChange();else for(var e=0,r=this._children.length;e<r;e++)this._children[e]._setTransformDirty()},a._setSiblingIndex=function(e,r){if(r=Math.min(r,e.length-1),r<0)throw"Sibling index "+r+" should large than 0";if(this._siblingIndex!==r){var o=this._siblingIndex;if(r<o)for(var s=o;s>=r;s--){var l=s==r?this:e[s-1];e[s]=l,l._siblingIndex=s}else for(var u=o;u<=r;u++){var c=u==r?this:e[u+1];e[u]=c,c._siblingIndex=u}}},a.getInvModelMatrix=function(){return this._inverseWorldMatFlag.flag&&(J.invert(this.transform.worldMatrix,this._invModelMatrix),this._inverseWorldMatFlag.flag=!1),this._invModelMatrix},i._findChildByName=function(e,r){for(var o=e._children,s=o.length-1;s>=0;s--){var l=o[s];if(l.name===r)return l}return null},i._traverseSetOwnerScene=function(e,r){e._scene=r;for(var o=e._children,s=e.childCount-1;s>=0;s--)this._traverseSetOwnerScene(o[s],r)},K(i,[{key:"isActive",get:function(){return this._isActive},set:function(e){if(e!==this._isActive)if(this._isActive=e,e){var r=this._parent;(r!=null&&r._isActiveInHierarchy||this._isRoot&&this._scene._isActiveInEngine)&&this._processActive()}else this._isActiveInHierarchy&&this._processInActive()}},{key:"isActiveInHierarchy",get:function(){return this._isActiveInHierarchy}},{key:"parent",get:function(){return this._parent},set:function(e){this._setParent(e)}},{key:"children",get:function(){return this._children}},{key:"childCount",get:function(){return this._children.length}},{key:"scene",get:function(){return this._scene}},{key:"siblingIndex",get:function(){return this._siblingIndex},set:function(e){if(this._siblingIndex===-1)throw"The entity "+this.name+" is not in the hierarchy";this._setSiblingIndex(this._isRoot?this._scene._rootEntities:this._parent._children,e)}}]),i}(ar),xi;(function(n){n[n.Linear=0]="Linear",n[n.Gamma=1]="Gamma"})(xi||(xi={}));var St;(function(n){n[n.Down=0]="Down",n[n.Move=1]="Move",n[n.Stationary=2]="Stationary",n[n.Up=3]="Up",n[n.Leave=4]="Leave"})(St||(St={}));var m0=function(){function n(a){this.phase=St.Leave,this.position=new W,this.deltaPosition=new W,this._events=[],this._upMap=[],this._downMap=[],this._upList=new ot,this._downList=new ot,this.id=a}var i=n.prototype;return i._firePointerExitAndEnter=function(t){if(this._currentEnteredEntity!==t){if(this._currentEnteredEntity)for(var e=this._currentEnteredEntity._scripts,r=e.length-1;r>=0;r--){var o=e.get(r);o._waitHandlingInValid||o.onPointerExit(this)}if(t)for(var s=t._scripts,l=s.length-1;l>=0;l--){var u=s.get(l);u._waitHandlingInValid||u.onPointerEnter(this)}this._currentEnteredEntity=t}},i._firePointerDown=function(t){if(t)for(var e=t._scripts,r=e.length-1;r>=0;r--){var o=e.get(r);o._waitHandlingInValid||o.onPointerDown(this)}this._currentPressedEntity=t},i._firePointerDrag=function(){if(this._currentPressedEntity)for(var t=this._currentPressedEntity._scripts,e=t.length-1;e>=0;e--){var r=t.get(e);r._waitHandlingInValid||r.onPointerDrag(this)}},i._firePointerUpAndClick=function(t){var e=this,r=e._currentPressedEntity;if(r){for(var o=r===t,s=r._scripts,l=s.length-1;l>=0;l--){var u=s.get(l);u._waitHandlingInValid||(o&&u.onPointerClick(this),u.onPointerUp(this))}this._currentPressedEntity=null}},n}(),Me;(function(n){n[n.Backquote=0]="Backquote",n[n.Backslash=1]="Backslash",n[n.Backspace=2]="Backspace",n[n.BracketLeft=3]="BracketLeft",n[n.BracketRight=4]="BracketRight",n[n.Comma=5]="Comma",n[n.Digit0=6]="Digit0",n[n.Digit1=7]="Digit1",n[n.Digit2=8]="Digit2",n[n.Digit3=9]="Digit3",n[n.Digit4=10]="Digit4",n[n.Digit5=11]="Digit5",n[n.Digit6=12]="Digit6",n[n.Digit7=13]="Digit7",n[n.Digit8=14]="Digit8",n[n.Digit9=15]="Digit9",n[n.Equal=16]="Equal",n[n.IntlBackslash=17]="IntlBackslash",n[n.IntlRo=18]="IntlRo",n[n.IntlYen=19]="IntlYen",n[n.KeyA=20]="KeyA",n[n.KeyB=21]="KeyB",n[n.KeyC=22]="KeyC",n[n.KeyD=23]="KeyD",n[n.KeyE=24]="KeyE",n[n.KeyF=25]="KeyF",n[n.KeyG=26]="KeyG",n[n.KeyH=27]="KeyH",n[n.KeyI=28]="KeyI",n[n.KeyJ=29]="KeyJ",n[n.KeyK=30]="KeyK",n[n.KeyL=31]="KeyL",n[n.KeyM=32]="KeyM",n[n.KeyN=33]="KeyN",n[n.KeyO=34]="KeyO",n[n.KeyP=35]="KeyP",n[n.KeyQ=36]="KeyQ",n[n.KeyR=37]="KeyR",n[n.KeyS=38]="KeyS",n[n.KeyT=39]="KeyT",n[n.KeyU=40]="KeyU",n[n.KeyV=41]="KeyV",n[n.KeyW=42]="KeyW",n[n.KeyX=43]="KeyX",n[n.KeyY=44]="KeyY",n[n.KeyZ=45]="KeyZ",n[n.Minus=46]="Minus",n[n.Period=47]="Period",n[n.Quote=48]="Quote",n[n.Semicolon=49]="Semicolon",n[n.Slash=50]="Slash",n[n.AltLeft=51]="AltLeft",n[n.AltRight=52]="AltRight",n[n.CapsLock=53]="CapsLock",n[n.ContextMenu=54]="ContextMenu",n[n.ControlLeft=55]="ControlLeft",n[n.ControlRight=56]="ControlRight",n[n.Enter=57]="Enter",n[n.MetaLeft=58]="MetaLeft",n[n.MetaRight=59]="MetaRight",n[n.ShiftLeft=60]="ShiftLeft",n[n.ShiftRight=61]="ShiftRight",n[n.Space=62]="Space",n[n.Tab=63]="Tab",n[n.Convert=64]="Convert",n[n.KanaMode=65]="KanaMode",n[n.Lang1=66]="Lang1",n[n.Lang2=67]="Lang2",n[n.Lang3=68]="Lang3",n[n.Lang4=69]="Lang4",n[n.Lang5=70]="Lang5",n[n.NonConvert=71]="NonConvert",n[n.Delete=72]="Delete",n[n.End=73]="End",n[n.Help=74]="Help",n[n.Home=75]="Home",n[n.Insert=76]="Insert",n[n.PageDown=77]="PageDown",n[n.PageUp=78]="PageUp",n[n.ArrowDown=79]="ArrowDown",n[n.ArrowLeft=80]="ArrowLeft",n[n.ArrowRight=81]="ArrowRight",n[n.ArrowUp=82]="ArrowUp",n[n.NumLock=83]="NumLock",n[n.Numpad0=84]="Numpad0",n[n.Numpad1=85]="Numpad1",n[n.Numpad2=86]="Numpad2",n[n.Numpad3=87]="Numpad3",n[n.Numpad4=88]="Numpad4",n[n.Numpad5=89]="Numpad5",n[n.Numpad6=90]="Numpad6",n[n.Numpad7=91]="Numpad7",n[n.Numpad8=92]="Numpad8",n[n.Numpad9=93]="Numpad9",n[n.NumpadAdd=94]="NumpadAdd",n[n.NumpadBackspace=95]="NumpadBackspace",n[n.NumpadClear=96]="NumpadClear",n[n.NumpadClearEntry=97]="NumpadClearEntry",n[n.NumpadComma=98]="NumpadComma",n[n.NumpadDecimal=99]="NumpadDecimal",n[n.NumpadDivide=100]="NumpadDivide",n[n.NumpadEnter=101]="NumpadEnter",n[n.NumpadEqual=102]="NumpadEqual",n[n.NumpadHash=103]="NumpadHash",n[n.NumpadMemoryAdd=104]="NumpadMemoryAdd",n[n.NumpadMemoryClear=105]="NumpadMemoryClear",n[n.NumpadMemoryRecall=106]="NumpadMemoryRecall",n[n.NumpadMemoryStore=107]="NumpadMemoryStore",n[n.NumpadMemorySubtract=108]="NumpadMemorySubtract",n[n.NumpadMultiply=109]="NumpadMultiply",n[n.NumpadParenLeft=110]="NumpadParenLeft",n[n.NumpadParenRight=111]="NumpadParenRight",n[n.NumpadStar=112]="NumpadStar",n[n.NumpadSubtract=113]="NumpadSubtract",n[n.Escape=114]="Escape",n[n.F1=115]="F1",n[n.F2=116]="F2",n[n.F3=117]="F3",n[n.F4=118]="F4",n[n.F5=119]="F5",n[n.F6=120]="F6",n[n.F7=121]="F7",n[n.F8=122]="F8",n[n.F9=123]="F9",n[n.F10=124]="F10",n[n.F11=125]="F11",n[n.F12=126]="F12",n[n.F13=127]="F13",n[n.F14=128]="F14",n[n.F15=129]="F15",n[n.Fn=130]="Fn",n[n.FnLock=131]="FnLock",n[n.PrintScreen=132]="PrintScreen",n[n.ScrollLock=133]="ScrollLock",n[n.Pause=134]="Pause",n[n.BrowserBack=135]="BrowserBack",n[n.BrowserFavorites=136]="BrowserFavorites",n[n.BrowserForward=137]="BrowserForward",n[n.BrowserHome=138]="BrowserHome",n[n.BrowserRefresh=139]="BrowserRefresh",n[n.BrowserSearch=140]="BrowserSearch",n[n.BrowserStop=141]="BrowserStop",n[n.Eject=142]="Eject",n[n.LaunchApp1=143]="LaunchApp1",n[n.LaunchApp2=144]="LaunchApp2",n[n.LaunchMail=145]="LaunchMail",n[n.MediaPlayPause=146]="MediaPlayPause",n[n.MediaSelect=147]="MediaSelect",n[n.MediaStop=148]="MediaStop",n[n.MediaTrackNext=149]="MediaTrackNext",n[n.MediaTrackPrevious=150]="MediaTrackPrevious",n[n.Power=151]="Power",n[n.Sleep=152]="Sleep",n[n.AudioVolumeDown=153]="AudioVolumeDown",n[n.AudioVolumeMute=154]="AudioVolumeMute",n[n.AudioVolumeUp=155]="AudioVolumeUp",n[n.WakeUp=156]="WakeUp",n[n.Hyper=157]="Hyper",n[n.Super=158]="Super",n[n.Turbo=159]="Turbo",n[n.Abort=160]="Abort",n[n.Resume=161]="Resume",n[n.Suspend=162]="Suspend",n[n.Again=163]="Again",n[n.Copy=164]="Copy",n[n.Cut=165]="Cut",n[n.Find=166]="Find",n[n.Open=167]="Open",n[n.Paste=168]="Paste",n[n.Props=169]="Props",n[n.Select=170]="Select",n[n.Undo=171]="Undo",n[n.Hiragana=172]="Hiragana",n[n.Katakana=173]="Katakana",n[n.Unidentified=174]="Unidentified"})(Me||(Me={}));var ex=function(){function n(a){this._curHeldDownKeyToIndexMap=[],this._upKeyToFrameCountMap=[],this._downKeyToFrameCountMap=[],this._curFrameHeldDownList=new ot,this._curFrameDownList=new ot,this._curFrameUpList=new ot,this._nativeEvents=[],this._hadListener=!1,this._htmlCanvas=a,a.tabIndex=a.tabIndex,this._onKeyEvent=this._onKeyEvent.bind(this),a.addEventListener("keydown",this._onKeyEvent),a.addEventListener("keyup",this._onKeyEvent),this._hadListener=!0}var i=n.prototype;return i._update=function(t){var e=this,r=e._nativeEvents,o=e._curFrameDownList,s=e._curFrameUpList;if(o.length=0,s.length=0,r.length>0){for(var l=this,u=l._curHeldDownKeyToIndexMap,c=l._curFrameHeldDownList,d=l._downKeyToFrameCountMap,_=l._upKeyToFrameCountMap,h=0,f=r.length;h<f;h++){var g=r[h],y=Me[g.code];switch(g.type){case"keydown":u[y]==null&&(o.add(y),c.add(y),u[y]=c.length-1,d[y]=t);break;case"keyup":var p=u[y];if(p!=null){u[y]=null;var v=c.deleteByIndex(p);v&&(u[v]=p)}s.add(y),_[y]=t;break}}r.length=0}},i._onFocus=function(){this._hadListener||(this._htmlCanvas.addEventListener("keydown",this._onKeyEvent),this._htmlCanvas.addEventListener("keyup",this._onKeyEvent),this._hadListener=!0)},i._onBlur=function(){this._hadListener&&(this._htmlCanvas.removeEventListener("keydown",this._onKeyEvent),this._htmlCanvas.removeEventListener("keyup",this._onKeyEvent),this._curHeldDownKeyToIndexMap.length=0,this._curFrameHeldDownList.length=0,this._curFrameDownList.length=0,this._curFrameUpList.length=0,this._nativeEvents.length=0,this._hadListener=!1)},i._destroy=function(){this._hadListener&&(this._htmlCanvas.removeEventListener("keydown",this._onKeyEvent),this._htmlCanvas.removeEventListener("keyup",this._onKeyEvent),this._hadListener=!1),this._curHeldDownKeyToIndexMap=null,this._upKeyToFrameCountMap=null,this._downKeyToFrameCountMap=null,this._nativeEvents=null,this._curFrameHeldDownList=null,this._curFrameDownList=null,this._curFrameUpList=null},i._onKeyEvent=function(t){this._nativeEvents.push(t)},n}(),Kt;(function(n){n[n.None=0]="None",n[n.Color=1]="Color",n[n.Depth=2]="Depth",n[n.Stencil=4]="Stencil",n[n.ColorDepth=3]="ColorDepth",n[n.ColorStencil=5]="ColorStencil",n[n.DepthStencil=6]="DepthStencil",n[n.All=7]="All"})(Kt||(Kt={}));var y0=function(){this.entity=null,this.distance=0,this.point=new w,this.normal=new w},Rn=function(){function n(a){var t=this;this._initialized=!1,this._restTime=0,this._colliders=new ot,this._gravity=new w(0,-9.81,0),this._physicalObjectsMap={},this._onContactEnter=function(e,r){for(var o=t._physicalObjectsMap[e],s=t._physicalObjectsMap[r],l=o.collider.entity._scripts,u=0,c=l.length;u<c;u++){var d=l.get(u);d._waitHandlingInValid||d.onCollisionEnter(s)}l=s.collider.entity._scripts;for(var _=0,h=l.length;_<h;_++){var f=l.get(_);f._waitHandlingInValid||f.onCollisionEnter(o)}},this._onContactExit=function(e,r){for(var o=t._physicalObjectsMap[e],s=t._physicalObjectsMap[r],l=o.collider.entity._scripts,u=0,c=l.length;u<c;u++){var d=l.get(u);d._waitHandlingInValid||d.onCollisionExit(s)}l=s.collider.entity._scripts;for(var _=0,h=l.length;_<h;_++){var f=l.get(_);f._waitHandlingInValid||f.onCollisionExit(o)}},this._onContactStay=function(e,r){for(var o=t._physicalObjectsMap[e],s=t._physicalObjectsMap[r],l=o.collider.entity._scripts,u=0,c=l.length;u<c;u++){var d=l.get(u);d._waitHandlingInValid||d.onCollisionStay(s)}l=s.collider.entity._scripts;for(var _=0,h=l.length;_<h;_++){var f=l.get(_);f._waitHandlingInValid||f.onCollisionStay(o)}},this._onTriggerEnter=function(e,r){for(var o=t._physicalObjectsMap[e],s=t._physicalObjectsMap[r],l=o.collider.entity._scripts,u=0,c=l.length;u<c;u++){var d=l.get(u);d._waitHandlingInValid||d.onTriggerEnter(s)}l=s.collider.entity._scripts;for(var _=0,h=l.length;_<h;_++){var f=l.get(_);f._waitHandlingInValid||f.onTriggerEnter(o)}},this._onTriggerExit=function(e,r){for(var o=t._physicalObjectsMap[e],s=t._physicalObjectsMap[r],l=o.collider.entity._scripts,u=0,c=l.length;u<c;u++){var d=l.get(u);d._waitHandlingInValid||d.onTriggerExit(s)}l=s.collider.entity._scripts;for(var _=0,h=l.length;_<h;_++){var f=l.get(_);f._waitHandlingInValid||f.onTriggerExit(o)}},this._onTriggerStay=function(e,r){for(var o=t._physicalObjectsMap[e],s=t._physicalObjectsMap[r],l=o.collider.entity._scripts,u=0,c=l.length;u<c;u++){var d=l.get(u);d._waitHandlingInValid||d.onTriggerStay(s)}l=s.collider.entity._scripts;for(var _=0,h=l.length;_<h;_++){var f=l.get(_);f._waitHandlingInValid||f.onTriggerStay(o)}},this.fixedTimeStep=1/60,this.maxAllowedTimeStep=1/3,this._engine=a,this._setGravity=this._setGravity.bind(this),this._gravity._onValueChanged=this._setGravity}var i=n.prototype;return i.initialize=function(t){this._initialized||(n._nativePhysics=t,this._nativePhysicsManager=n._nativePhysics.createPhysicsManager(this._onContactEnter,this._onContactExit,this._onContactStay,this._onTriggerEnter,this._onTriggerExit,this._onTriggerStay),this._initialized=!0)},i.raycast=function(t,e,r,o){var s=this,l,u=Number.MAX_VALUE;typeof e=="number"?u=e:e!=null&&(l=e);var c=Ut.Everything;typeof r=="number"?c=r:r!=null&&(l=r),o&&(l=o);var d=function(h){var f=s._physicalObjectsMap[h];return f.collider.entity.layer&c&&f.isSceneQuery};if(l!=null){var _=this._nativePhysicsManager.raycast(t,u,d,function(h,f,g,y){l.entity=s._physicalObjectsMap[h]._collider.entity,l.distance=f,l.normal.copyFrom(y),l.point.copyFrom(g)});return _?!0:(l.entity=null,l.distance=0,l.point.set(0,0,0),l.normal.set(0,0,0),!1)}else return this._nativePhysicsManager.raycast(t,u,d)},i._update=function(t){var e=this,r=e.fixedTimeStep,o=e._nativePhysicsManager,s=this._engine._componentsManager,l=Math.min(this.maxAllowedTimeStep,this._restTime+t),u=Math.floor(l/r);this._restTime=l-u*r;for(var c=0;c<u;c++)s.callScriptOnPhysicsUpdate(),this._callColliderOnUpdate(),o.update(r),this._callColliderOnLateUpdate()},i._addColliderShape=function(t){this._physicalObjectsMap[t.id]=t,this._nativePhysicsManager.addColliderShape(t._nativeShape)},i._removeColliderShape=function(t){delete this._physicalObjectsMap[t.id],this._nativePhysicsManager.removeColliderShape(t._nativeShape)},i._addCollider=function(t){t._index===-1&&(t._index=this._colliders.length,this._colliders.add(t)),this._nativePhysicsManager.addCollider(t._nativeCollider)},i._addCharacterController=function(t){t._index===-1&&(t._index=this._colliders.length,this._colliders.add(t)),this._nativePhysicsManager.addCharacterController(t._nativeCollider)},i._removeCollider=function(t){var e=this._colliders.deleteByIndex(t._index);e&&(e._index=t._index),t._index=-1,this._nativePhysicsManager.removeCollider(t._nativeCollider)},i._removeCharacterController=function(t){var e=this._colliders.deleteByIndex(t._index);e&&(e._index=t._index),t._index=-1,this._nativePhysicsManager.removeCharacterController(t._nativeCollider)},i._callColliderOnUpdate=function(){for(var t=this._colliders._elements,e=this._colliders.length-1;e>=0;--e)t[e]._onUpdate()},i._callColliderOnLateUpdate=function(){for(var t=this._colliders._elements,e=this._colliders.length-1;e>=0;--e)t[e]._onLateUpdate()},i._setGravity=function(){this._nativePhysicsManager.setGravity(this._gravity)},K(n,[{key:"gravity",get:function(){return this._gravity},set:function(t){var e=this._gravity;e!==t&&e.copyFrom(t)}},{key:"maxSumTimeStep",get:function(){return this.maxAllowedTimeStep},set:function(t){this.maxAllowedTimeStep=t}}]),n}(),ps;(function(n){n[n.Average=0]="Average",n[n.Minimum=1]="Minimum",n[n.Multiply=2]="Multiply",n[n.Maximum=3]="Maximum"})(ps||(ps={}));var x0=function(){function n(){this._bounciness=.1,this._dynamicFriction=.1,this._staticFriction=.1,this._bounceCombine=ps.Average,this._frictionCombine=ps.Average,this._nativeMaterial=Rn._nativePhysics.createPhysicsMaterial(this._staticFriction,this._dynamicFriction,this._bounciness,this._bounceCombine,this._frictionCombine)}var i=n.prototype;return i._destroy=function(){this._nativeMaterial.destroy()},K(n,[{key:"bounciness",get:function(){return this._bounciness},set:function(t){this._bounciness!==t&&(this._bounciness=t,this._nativeMaterial.setBounciness(t))}},{key:"dynamicFriction",get:function(){return this._dynamicFriction},set:function(t){this._dynamicFriction!==t&&(this._dynamicFriction=t,this._nativeMaterial.setDynamicFriction(t))}},{key:"staticFriction",get:function(){return this._staticFriction},set:function(t){this._staticFriction!==t&&(this._staticFriction=t,this._nativeMaterial.setStaticFriction(t))}},{key:"bounceCombine",get:function(){return this._bounceCombine},set:function(t){this._bounceCombine!==t&&(this._bounceCombine=t,this._nativeMaterial.setBounceCombine(t))}},{key:"frictionCombine",get:function(){return this._frictionCombine},set:function(t){this._frictionCombine!==t&&(this._frictionCombine=t,this._nativeMaterial.setFrictionCombine(t))}}]),n}(),Tn=function(n){Q(i,n);function i(t){var e;return e=n.call(this,t)||this,e._shapes=[],e._index=-1,e._updateFlag=e.entity.transform.registerWorldChangeFlag(),e}var a=i.prototype;return a.addShape=function(e){var r=e._collider;r!==this&&(r&&r.removeShape(e),this._shapes.push(e),this.engine.physicsManager._addColliderShape(e),e._collider=this,this._nativeCollider.addShape(e._nativeShape))},a.removeShape=function(e){var r=this._shapes.indexOf(e);r!==-1&&(this._shapes.splice(r,1),this.engine.physicsManager._removeColliderShape(e),e._collider=null,this._nativeCollider.removeShape(e._nativeShape))},a.clearShapes=function(){for(var e=this._shapes,r=0,o=e.length;r<o;r++){var s=e[r];this.engine.physicsManager._removeColliderShape(s),s._destroy(),this._nativeCollider.removeShape(s._nativeShape)}e.length=0},a._onUpdate=function(){if(this._updateFlag.flag){var e=this.entity.transform;this._nativeCollider.setWorldTransform(e.worldPosition,e.worldRotationQuaternion);for(var r=e.lossyWorldScale,o=0,s=this.shapes.length;o<s;o++)this.shapes[o]._nativeShape.setWorldScale(r);this._updateFlag.flag=!1}},a._onLateUpdate=function(){},a._onEnable=function(){this.engine.physicsManager._addCollider(this)},a._onDisable=function(){this.engine.physicsManager._removeCollider(this)},a._onDestroy=function(){this.clearShapes(),this._nativeCollider.destroy()},K(i,[{key:"shapes",get:function(){return this._shapes}}]),i}(vn);O([Y],Tn.prototype,"_index",void 0);Tn=O([ua(fe)],Tn);var Zl;(function(n){n[n.PreventClimbing=0]="PreventClimbing",n[n.PreventClimbingAndForceSliding=1]="PreventClimbingAndForceSliding"})(Zl||(Zl={}));var tx=function(n){Q(i,n);function i(t){var e;return e=n.call(this,t)||this,e._index=-1,e._stepOffset=.5,e._nonWalkableMode=Zl.PreventClimbing,e._upDirection=new w(0,1,0),e._slopeLimit=.707,e._nativeCollider=Rn._nativePhysics.createCharacterController(),e._setUpDirection=e._setUpDirection.bind(_e(e)),e._upDirection._onValueChanged=e._setUpDirection,e}var a=i.prototype;return a.move=function(e,r,o){return this._nativeCollider.move(e,r,o)},a.addShape=function(e){if(this._shapes.length>0)throw"only allow single shape on controller!";n.prototype.addShape.call(this,e),this._updateFlag.flag=!0},a.clearShapes=function(){this._shapes.length>0&&n.prototype.removeShape.call(this,this._shapes[0])},a._onUpdate=function(){if(this._updateFlag.flag){var e=this.entity.transform,r=this.shapes;this._nativeCollider.setWorldPosition(e.worldPosition);for(var o=e.lossyWorldScale,s=0,l=r.length;s<l;s++)r[s]._nativeShape.setWorldScale(o);this._updateFlag.flag=!1}},a._onLateUpdate=function(){var e=this.entity.transform.worldPosition;this._nativeCollider.getWorldPosition(e),this.entity.transform.worldPosition=e,this._updateFlag.flag=!1},a._onEnable=function(){this.engine.physicsManager._addCharacterController(this)},a._onDisable=function(){this.engine.physicsManager._removeCharacterController(this)},a._setUpDirection=function(){this._nativeCollider.setUpDirection(this._upDirection)},K(i,[{key:"stepOffset",get:function(){return this._stepOffset},set:function(e){this._stepOffset!==e&&(this._stepOffset=e,this._nativeCollider.setStepOffset(e))}},{key:"nonWalkableMode",get:function(){return this._nonWalkableMode},set:function(e){this._nonWalkableMode!==e&&(this._nonWalkableMode=e,this._nativeCollider.setNonWalkableMode(e))}},{key:"upDirection",get:function(){return this._upDirection},set:function(e){this._upDirection!==e&&this._upDirection.copyFrom(e)}},{key:"slopeLimit",get:function(){return this._slopeLimit},set:function(e){this._slopeLimit!==e&&(this._slopeLimit=e,this._nativeCollider.setSlopeLimit(e))}}]),i}(Tn),lo=function(){function n(){this._isTrigger=!1,this._rotation=new w,this._position=new w,this._contactOffset=.02,this.isSceneQuery=!0,this._material=new x0,this._id=n._idGenerator++,this._setRotation=this._setRotation.bind(this),this._setPosition=this._setPosition.bind(this),this._rotation._onValueChanged=this._setRotation,this._position._onValueChanged=this._setPosition}var i=n.prototype;return i._destroy=function(){this._material._destroy(),this._nativeShape.destroy()},i._setPosition=function(){this._nativeShape.setPosition(this._position)},i._setRotation=function(){this._nativeShape.setRotation(this._rotation)},K(n,[{key:"collider",get:function(){return this._collider}},{key:"id",get:function(){return this._id}},{key:"contactOffset",get:function(){return this._contactOffset},set:function(t){this._contactOffset!==t&&(this._contactOffset=t,this._nativeShape.setContactOffset(t))}},{key:"material",get:function(){return this._material},set:function(t){this._material!==t&&(this._material=t,this._nativeShape.setMaterial(t._nativeMaterial))}},{key:"rotation",get:function(){return this._rotation},set:function(t){this._rotation!=t&&this._rotation.copyFrom(t)}},{key:"position",get:function(){return this._position},set:function(t){this._position!==t&&this._position.copyFrom(t)}},{key:"isTrigger",get:function(){return this._isTrigger},set:function(t){this._isTrigger!==t&&(this._isTrigger=t,this._nativeShape.setIsTrigger(t))}}]),n}();lo._idGenerator=0;var w0=function(n){Q(i,n);function i(){var t;return t=n.call(this)||this,t._size=new w(1,1,1),t._nativeShape=Rn._nativePhysics.createBoxColliderShape(t._id,t._size,t._material._nativeMaterial),t._setSize=t._setSize.bind(_e(t)),t._size._onValueChanged=t._setSize,t}var a=i.prototype;return a._setSize=function(){this._nativeShape.setSize(this._size)},K(i,[{key:"size",get:function(){return this._size},set:function(e){this._size!==e&&this._size.copyFrom(e)}}]),i}(lo),S0=function(n){Q(i,n);function i(){var a;return a=n.call(this)||this,a._radius=1,a._nativeShape=Rn._nativePhysics.createSphereColliderShape(a._id,a._radius,a._material._nativeMaterial),a}return K(i,[{key:"radius",get:function(){return this._radius},set:function(t){this._radius!==t&&(this._radius=t,this._nativeShape.setRadius(t))}}]),i}(lo),nx=function(n){Q(i,n);function i(){var a;return a=n.call(this)||this,a._nativeShape=Rn._nativePhysics.createPlaneColliderShape(a._id,a._material._nativeMaterial),a}return i}(lo),$i;(function(n){n[n.X=0]="X",n[n.Y=1]="Y",n[n.Z=2]="Z"})($i||($i={}));var C0=function(n){Q(i,n);function i(){var a;return a=n.call(this)||this,a._radius=1,a._height=2,a._upAxis=$i.Y,a._nativeShape=Rn._nativePhysics.createCapsuleColliderShape(a._id,a._radius,a._height,a._material._nativeMaterial),a}return K(i,[{key:"radius",get:function(){return this._radius},set:function(t){this._radius!==t&&(this._radius=t,this._nativeShape.setRadius(t))}},{key:"height",get:function(){return this._height},set:function(t){this._height!==t&&(this._height=t,this._nativeShape.setHeight(t))}},{key:"upAxis",get:function(){return this._upAxis},set:function(t){this._upAxis!==t&&(this._upAxis=t,this._nativeShape.setUpAxis(t))}}]),i}(lo),Za=function(n){Q(i,n);function i(a){var t;return t=n.call(this,a)||this,t._connectedCollider=new wf,t._collider=new wf,t._force=0,t._torque=0,t._connectedCollider.localPosition=new w,t}return K(i,[{key:"connectedCollider",get:function(){return this._connectedCollider.collider},set:function(t){this._connectedCollider.collider!==t&&(this._connectedCollider.collider=t,this._nativeJoint.setConnectedCollider(t._nativeCollider))}},{key:"connectedAnchor",get:function(){return this._connectedCollider.localPosition},set:function(t){var e=this._connectedCollider.localPosition;t!==e&&e.copyFrom(t),this._nativeJoint.setConnectedAnchor(t)}},{key:"connectedMassScale",get:function(){return this._connectedCollider.massScale},set:function(t){t!==this._connectedCollider.massScale&&(this._connectedCollider.massScale=t,this._nativeJoint.setConnectedMassScale(t))}},{key:"connectedInertiaScale",get:function(){return this._connectedCollider.inertiaScale},set:function(t){t!==this._connectedCollider.inertiaScale&&(this._connectedCollider.inertiaScale=t,this._nativeJoint.setConnectedInertiaScale(t))}},{key:"massScale",get:function(){return this._collider.massScale},set:function(t){t!==this._collider.massScale&&(this._collider.massScale=t,this._nativeJoint.setMassScale(t))}},{key:"inertiaScale",get:function(){return this._collider.inertiaScale},set:function(t){t!==this._collider.inertiaScale&&(this._collider.inertiaScale=t,this._nativeJoint.setInertiaScale(t))}},{key:"breakForce",get:function(){return this._force},set:function(t){t!==this._force&&(this._force=t,this._nativeJoint.setBreakForce(t))}},{key:"breakTorque",get:function(){return this._torque},set:function(t){t!==this._torque&&(this._torque=t,this._nativeJoint.setBreakTorque(t))}}]),i}(vn);Za=O([ua(Tn)],Za);var wf=function(){this.collider=null,this.massScale=0,this.inertiaScale=0},rx=function(n){Q(i,n);function i(){return n.apply(this,arguments)}var a=i.prototype;return a._onAwake=function(){var e=this._collider;e.collider=this.entity.getComponent(Tn),this._nativeJoint=Rn._nativePhysics.createFixedJoint(e.collider._nativeCollider)},i}(Za),Qn;(function(n){n[n.LimitEnabled=1]="LimitEnabled",n[n.DriveEnabled=2]="DriveEnabled",n[n.DriveFreeSpin=4]="DriveFreeSpin"})(Qn||(Qn={}));var ix=function(n){Q(i,n);function i(){var t;return t=n.apply(this,arguments)||this,t._axis=new w(1,0,0),t._hingeFlags=0,t._useSpring=!1,t}var a=i.prototype;return a._onAwake=function(){var e=this._collider;e.localPosition=new w,e.collider=this.entity.getComponent(Tn),this._nativeJoint=Rn._nativePhysics.createHingeJoint(e.collider._nativeCollider)},K(i,[{key:"axis",get:function(){return this._axis},set:function(e){var r=this._axis;e!==r&&r.copyFrom(e),this._nativeJoint.setAxis(r)}},{key:"swingOffset",get:function(){return this._collider.localPosition},set:function(e){var r=this._collider.localPosition;e!==r&&r.copyFrom(e),this._nativeJoint.setSwingOffset(r)}},{key:"angle",get:function(){return this._nativeJoint.getAngle()}},{key:"velocity",get:function(){return this._nativeJoint.getVelocity()}},{key:"useLimits",get:function(){return(this._hingeFlags&Qn.LimitEnabled)==Qn.LimitEnabled},set:function(e){e!==this.useLimits&&(this._hingeFlags|=Qn.LimitEnabled),this._nativeJoint.setHingeJointFlag(Qn.LimitEnabled,e)}},{key:"useMotor",get:function(){return(this._hingeFlags&Qn.DriveEnabled)==Qn.DriveEnabled},set:function(e){e!==this.useMotor&&(this._hingeFlags|=Qn.DriveEnabled),this._nativeJoint.setHingeJointFlag(Qn.DriveEnabled,e)}},{key:"useSpring",get:function(){return this._useSpring},set:function(e){this._useSpring!==e&&(this._useSpring=e,this.limits=this._limits)}},{key:"motor",get:function(){return this._jointMonitor},set:function(e){this._jointMonitor!==e&&(this._jointMonitor=e,this._nativeJoint.setDriveVelocity(e.targetVelocity),this._nativeJoint.setDriveForceLimit(e.forceLimit),this._nativeJoint.setDriveGearRatio(e.gearRation),this._nativeJoint.setHingeJointFlag(Qn.DriveFreeSpin,e.freeSpin))}},{key:"limits",get:function(){return this._limits},set:function(e){this._limits!==e&&(this._limits=e,this.useSpring?this._nativeJoint.setSoftLimit(e.min,e.max,e.stiffness,e.damping):this._nativeJoint.setHardLimit(e.min,e.max,e.contactDistance))}}]),i}(Za),ax=function(n){Q(i,n);function i(){var t;return t=n.apply(this,arguments)||this,t._minDistance=0,t._maxDistance=0,t._tolerance=.25,t._stiffness=0,t._damping=0,t}var a=i.prototype;return a._onAwake=function(){var e=this._collider;e.localPosition=new w,e.collider=this.entity.getComponent(Tn),this._nativeJoint=Rn._nativePhysics.createSpringJoint(e.collider._nativeCollider)},K(i,[{key:"swingOffset",get:function(){return this._collider.localPosition},set:function(e){var r=this._collider.localPosition;e!==r&&r.copyFrom(e),this._nativeJoint.setSwingOffset(e)}},{key:"minDistance",get:function(){return this._minDistance},set:function(e){this._minDistance!==e&&(this._minDistance=e,this._nativeJoint.setMinDistance(e))}},{key:"maxDistance",get:function(){return this._maxDistance},set:function(e){this._maxDistance!==e&&(this._maxDistance=e,this._nativeJoint.setMaxDistance(e))}},{key:"tolerance",get:function(){return this._tolerance},set:function(e){this._tolerance!==e&&(this._tolerance=e,this._nativeJoint.setTolerance(e))}},{key:"stiffness",get:function(){return this._stiffness},set:function(e){this._stiffness!==e&&(this._stiffness=e,this._nativeJoint.setStiffness(e))}},{key:"damping",get:function(){return this._damping},set:function(e){this._damping!==e&&(this._damping=e,this._nativeJoint.setDamping(e))}}]),i}(Za),ox=function(){this.max=0,this.min=0,this.contactDistance=-1,this.stiffness=0,this.damping=0},sx=function(){this.targetVelocity=0,this.forceLimit=Number.MAX_VALUE,this.gearRation=1,this.freeSpin=!1},md;(function(n){n[n.Sides=1]="Sides",n[n.Up=2]="Up",n[n.Down=4]="Down"})(md||(md={}));var lx=function(n){Q(i,n);function i(a){var t;t=n.call(this,a)||this;var e=t.entity.transform;return t._nativeCollider=Rn._nativePhysics.createStaticCollider(e.worldPosition,e.worldRotationQuaternion),t}return i}(Tn),ux=function(n){Q(i,n);function i(t){var e;e=n.call(this,t)||this,e._linearDamping=0,e._angularDamping=.05,e._linearVelocity=new w,e._angularVelocity=new w,e._mass=1,e._centerOfMass=new w,e._inertiaTensor=new w(1,1,1),e._maxAngularVelocity=100,e._maxDepenetrationVelocity=1e3,e._solverIterations=4,e._isKinematic=!1,e._constraints=0,e._collisionDetectionMode=0,e._sleepThreshold=.005;var r=e.entity.transform;return e._nativeCollider=Rn._nativePhysics.createDynamicCollider(r.worldPosition,r.worldRotationQuaternion),e._setLinearVelocity=e._setLinearVelocity.bind(_e(e)),e._setAngularVelocity=e._setAngularVelocity.bind(_e(e)),e._setCenterOfMass=e._setCenterOfMass.bind(_e(e)),e._setInertiaTensor=e._setInertiaTensor.bind(_e(e)),e._linearVelocity._onValueChanged=e._setLinearVelocity,e._angularVelocity._onValueChanged=e._setAngularVelocity,e._centerOfMass._onValueChanged=e._setCenterOfMass,e._inertiaTensor._onValueChanged=e._setInertiaTensor,e}var a=i.prototype;return a.applyForce=function(e){this._nativeCollider.addForce(e)},a.applyTorque=function(e){this._nativeCollider.addTorque(e)},a.move=function(e,r){this._nativeCollider.move(e,r)},a.sleep=function(){this._nativeCollider.sleep()},a.wakeUp=function(){this._nativeCollider.wakeUp()},a._onLateUpdate=function(){var e=this.entity.transform,r=e.worldPosition,o=e.worldRotationQuaternion;this._nativeCollider.getWorldTransform(r,o),this._updateFlag.flag=!1},a._setLinearVelocity=function(){this._nativeCollider.setLinearVelocity(this._linearVelocity)},a._setAngularVelocity=function(){this._nativeCollider.setAngularVelocity(this._angularVelocity)},a._setCenterOfMass=function(){this._nativeCollider.setCenterOfMass(this._centerOfMass)},a._setInertiaTensor=function(){this._nativeCollider.setInertiaTensor(this._inertiaTensor)},K(i,[{key:"linearDamping",get:function(){return this._linearDamping},set:function(e){this._linearDamping!==e&&(this._linearDamping=e,this._nativeCollider.setLinearDamping(e))}},{key:"angularDamping",get:function(){return this._angularDamping},set:function(e){this._angularDamping!==e&&(this._angularDamping=e,this._nativeCollider.setAngularDamping(e))}},{key:"linearVelocity",get:function(){return this._linearVelocity},set:function(e){this._linearVelocity!==e&&this._linearVelocity.copyFrom(e)}},{key:"angularVelocity",get:function(){return this._angularVelocity},set:function(e){this._angularVelocity!==e&&this._angularVelocity.copyFrom(e)}},{key:"mass",get:function(){return this._mass},set:function(e){this._mass!==e&&(this._mass=e,this._nativeCollider.setMass(e))}},{key:"centerOfMass",get:function(){return this._centerOfMass},set:function(e){this._centerOfMass!==e&&this._centerOfMass.copyFrom(e)}},{key:"inertiaTensor",get:function(){return this._inertiaTensor},set:function(e){this._inertiaTensor!==e&&this._inertiaTensor.copyFrom(e)}},{key:"maxAngularVelocity",get:function(){return this._maxAngularVelocity},set:function(e){this._maxAngularVelocity!==e&&(this._maxAngularVelocity=e,this._nativeCollider.setMaxAngularVelocity(e))}},{key:"maxDepenetrationVelocity",get:function(){return this._maxDepenetrationVelocity},set:function(e){this._maxDepenetrationVelocity!==e&&(this._maxDepenetrationVelocity=e,this._nativeCollider.setMaxDepenetrationVelocity(e))}},{key:"sleepThreshold",get:function(){return this._sleepThreshold},set:function(e){e!==this._sleepThreshold&&(this._sleepThreshold=e,this._nativeCollider.setSleepThreshold(e))}},{key:"solverIterations",get:function(){return this._solverIterations},set:function(e){this._solverIterations!==e&&(this._solverIterations=e,this._nativeCollider.setSolverIterations(e))}},{key:"isKinematic",get:function(){return this._isKinematic},set:function(e){this._isKinematic!==e&&(this._isKinematic=e,this._nativeCollider.setIsKinematic(e))}},{key:"constraints",get:function(){return this._constraints},set:function(e){this._constraints!==e&&(this._constraints=e,this._nativeCollider.setConstraints(e))}},{key:"collisionDetectionMode",get:function(){return this._collisionDetectionMode},set:function(e){this._collisionDetectionMode!==e&&(this._collisionDetectionMode=e,this._nativeCollider.setCollisionDetectionMode(e))}}]),i}(Tn),yd;(function(n){n[n.Discrete=0]="Discrete",n[n.Continuous=1]="Continuous",n[n.ContinuousDynamic=2]="ContinuousDynamic",n[n.ContinuousSpeculative=3]="ContinuousSpeculative"})(yd||(yd={}));var xd;(function(n){n[n.None=0]="None",n[n.FreezePositionX=1]="FreezePositionX",n[n.FreezePositionY=2]="FreezePositionY",n[n.FreezePositionZ=4]="FreezePositionZ",n[n.FreezeRotationX=8]="FreezeRotationX",n[n.FreezeRotationY=16]="FreezeRotationY",n[n.FreezeRotationZ=32]="FreezeRotationZ"})(xd||(xd={}));var qt;(function(n){n[n.None=0]="None",n[n.Primary=1]="Primary",n[n.Secondary=2]="Secondary",n[n.Auxiliary=4]="Auxiliary",n[n.XButton1=8]="XButton1",n[n.XButton2=16]="XButton2",n[n.XButton3=32]="XButton3",n[n.XButton4=64]="XButton4",n[n.XButton5=128]="XButton5",n[n.XButton6=256]="XButton6",n[n.XButton7=512]="XButton7",n[n.XButton8=1024]="XButton8"})(qt||(qt={}));var Sf=[1,4,2,8,16,32,64,128,256,512,1024],Cf={1:0,2:2,4:1,8:3,16:4,32:5,64:6,128:7,256:8,512:9,1024:10},Fu=function(){function n(a,t){this._pointers=[],this._multiPointerEnabled=!0,this._buttons=qt.None,this._upMap=[],this._downMap=[],this._upList=new ot,this._downList=new ot,this._nativeEvents=[],this._hadListener=!1,this._engine=a,this._canvas=a.canvas,this._htmlCanvas=t,t.oncontextmenu=function(e){return!1},this._onPointerEvent=this._onPointerEvent.bind(this),this._updatePointerWithPhysics=this._updatePointerWithPhysics.bind(this),this._updatePointerWithoutPhysics=this._updatePointerWithoutPhysics.bind(this),this._onFocus(),this._pointerPool=new Array(11)}var i=n.prototype;return i._update=function(t){var e=this,r=e._pointers,o=e._nativeEvents,s=r.length-1;if(s>=0)for(var l=s;l>=0;l--)r[l].phase===St.Leave&&r.splice(l,1);if(s=o.length-1,s>=0){for(var u=0;u<=s;u++){var c,d=o[u];(c=this._getPointer(d.pointerId))==null||c._events.push(d)}o.length=0}if(this._upList.length=this._downList.length=0,this._buttons=qt.None,s=r.length-1,s>=0)for(var _=this._engine.physicsManager._initialized?this._updatePointerWithPhysics:this._updatePointerWithoutPhysics,h=this._htmlCanvas.getBoundingClientRect(),f=this._htmlCanvas,g=f.clientWidth,y=f.clientHeight,p=this._canvas,v=p.width,m=p.height,x=s;x>=0;x--){var S=r[x];S._upList.length=S._downList.length=0,_(t,S,h,g,y,v,m),this._buttons|=S.pressedButtons}},i._onFocus=function(){if(!this._hadListener){var t=this,e=t._htmlCanvas,r=t._onPointerEvent;e.addEventListener("pointerdown",r),e.addEventListener("pointerup",r),e.addEventListener("pointerout",r),e.addEventListener("pointermove",r),e.addEventListener("pointercancel",r),this._hadListener=!0}},i._onBlur=function(){if(this._hadListener){var t=this,e=t._htmlCanvas,r=t._onPointerEvent;e.removeEventListener("pointerdown",r),e.removeEventListener("pointerup",r),e.removeEventListener("pointerout",r),e.removeEventListener("pointermove",r),e.removeEventListener("pointercancel",r),this._hadListener=!1,this._downList.length=0,this._upList.length=0;for(var o=this,s=o._pointers,l=s.length-1;l>=0;l--)s[l].phase=St.Leave;s.length=0}},i._destroy=function(){if(this._hadListener){var t=this,e=t._htmlCanvas,r=t._onPointerEvent;e.removeEventListener("pointerdown",r),e.removeEventListener("pointerup",r),e.removeEventListener("pointerout",r),e.removeEventListener("pointermove",r),e.removeEventListener("pointercancel",r),this._hadListener=!1}this._pointerPool.length=0,this._pointers.length=0,this._downList.length=0,this._upList.length=0,this._htmlCanvas=null,this._engine=null},i._onPointerEvent=function(t){t.cancelable&&t.preventDefault(),t.type==="pointerdown"&&this._htmlCanvas.focus(),this._nativeEvents.push(t)},i._getIndexByPointerID=function(t){for(var e=this,r=e._pointers,o=r.length-1;o>=0;o--)if(r[o]._uniqueID===t)return o;return-1},i._getPointer=function(t){var e=this,r=e._pointers,o=this._getIndexByPointerID(t);if(o>=0)return r[o];var s=r.length;if(s===0||this._multiPointerEnabled){for(var l=this,u=l._pointerPool,c=0;c<s&&!(r[c].id>c);c++);var d=u[c];return d||(d=u[c]=new m0(c)),d._uniqueID=t,r.splice(c,0,d),d}else return null},i._pointerRayCast=function(t,e){for(var r=n._tempPoint,o=n._tempRay,s=n._tempHitResult,l=this._engine.sceneManager.activeScene,u=l._activeCameras,c=u.length-1;c>=0;c--){var d=u[c];if(!(!d.enabled||d.renderTarget)){var _=d.viewport,h=_.x,f=_.y,g=_.z,y=_.w;if(t>=h&&e>=f&&t-h<=g&&e-f<=y){if(r.set((t-h)/g,(e-f)/y),this._engine.physicsManager.raycast(d.viewportPointToRay(r,o),Number.MAX_VALUE,d.cullingMask,s))return s.entity;if(d.clearFlags&Kt.Color)return null}}}},i._updatePointerWithPhysics=function(t,e,r,o,s,l,u){var c=e._events,d=e.position,_=c.length;if(_>0){var h=this,f=h._upList,g=h._upMap,y=h._downList,p=h._downMap,v=c[_-1],m=(v.clientX-r.left)/o,x=(v.clientY-r.top)/s,S=m*l,C=x*u;S===d.x&&C===d.y?(e.deltaPosition.set(0,0),e.phase=St.Stationary):(e.deltaPosition.set(S-d.x,C-d.y),e.phase=St.Move),d.set(S,C),e._firePointerDrag();var A=this._pointerRayCast(m,x);e._firePointerExitAndEnter(A);for(var T=0;T<_;T++){var E=c[T],P=E.button;switch(e.button=Sf[P]||qt.None,e.pressedButtons=E.buttons,E.type){case"pointerdown":y.add(P),p[P]=t,e._downList.add(P),e._downMap[P]=t,e.phase=St.Down,e._firePointerDown(A);break;case"pointerup":f.add(P),g[P]=t,e._upList.add(P),e._upMap[P]=t,e.phase=St.Up,e._firePointerUpAndClick(A);break;case"pointerout":case"pointercancel":e.phase=St.Leave,e._firePointerExitAndEnter(null)}}e._events.length=0}else e.deltaPosition.set(0,0),e.phase=St.Stationary,e._firePointerDrag(),e._firePointerExitAndEnter(this._pointerRayCast(d.x/l,d.y/u))},i._updatePointerWithoutPhysics=function(t,e,r,o,s,l,u){var c=e._events,d=c.length;if(d>0){var _=e.position,h=c[d-1],f=(h.clientX-r.left)/o*l,g=(h.clientY-r.top)/s*u;e.deltaPosition.set(f-_.x,g-_.y),_.set(f,g),e.button=Sf[h.button]||qt.None,e.pressedButtons=h.buttons;for(var y=this,p=y._upList,v=y._upMap,m=y._downList,x=y._downMap,S=0;S<d;S++){var C=c[S].button;switch(c[S].type){case"pointerdown":m.add(C),x[C]=t,e._downList.add(C),e._downMap[C]=t,e.phase=St.Down;break;case"pointerup":p.add(C),v[C]=t,e._upList.add(C),e._upMap[C]=t,e.phase=St.Up;break;case"pointermove":e.phase=St.Move;break;case"pointerout":case"pointercancel":e.phase=St.Leave}}e._events.length=0}else e.deltaPosition.set(0,0),e.phase=St.Stationary},n}();Fu._tempRay=new O1;Fu._tempPoint=new W;Fu._tempHitResult=new y0;var cx=function(){function n(a){this._delta=new w,this._nativeEvents=[],this._onWheelEvent=this._onWheelEvent.bind(this),a.addEventListener("wheel",this._onWheelEvent),this._canvas=a,this._hadListener=!0}var i=n.prototype;return i._update=function(){var t=this,e=t._delta;e.set(0,0,0);var r=this,o=r._nativeEvents;if(o.length>0){for(var s=o.length-1;s>=0;s--){var l=o[s];e.x+=l.deltaX,e.y+=l.deltaY,e.z+=l.deltaZ}o.length=0}},i._onFocus=function(){this._hadListener||(this._canvas.addEventListener("wheel",this._onWheelEvent),this._hadListener=!0)},i._onBlur=function(){this._hadListener&&(this._canvas.removeEventListener("wheel",this._onWheelEvent),this._nativeEvents.length=0,this._delta.set(0,0,0),this._hadListener=!1)},i._destroy=function(){this._hadListener&&(this._canvas.removeEventListener("wheel",this._onWheelEvent),this._hadListener=!1),this._nativeEvents=null},i._onWheelEvent=function(t){t.cancelable&&t.preventDefault(),this._nativeEvents.push(t)},n}(),A0=function(){function n(a){this._initialized=!1,this._curFrameCount=0;var t=a._canvas._webCanvas;(typeof OffscreenCanvas>"u"||!He(t,OffscreenCanvas))&&(this._wheelManager=new cx(t),this._pointerManager=new Fu(a,t),this._keyboardManager=new ex(t),this._onBlur=this._onBlur.bind(this),window.addEventListener("blur",this._onBlur),this._onFocus=this._onFocus.bind(this),window.addEventListener("focus",this._onFocus),this._initialized=!0)}var i=n.prototype;return i.isKeyHeldDown=function(t){return this._initialized?t===void 0?this._keyboardManager._curFrameHeldDownList.length>0:this._keyboardManager._curHeldDownKeyToIndexMap[t]!=null:!1},i.isKeyDown=function(t){return this._initialized?t===void 0?this._keyboardManager._curFrameDownList.length>0:this._keyboardManager._downKeyToFrameCountMap[t]===this._curFrameCount:!1},i.isKeyUp=function(t){return this._initialized?t===void 0?this._keyboardManager._curFrameUpList.length>0:this._keyboardManager._upKeyToFrameCountMap[t]===this._curFrameCount:!1},i.isPointerHeldDown=function(t){return this._initialized?t===void 0?this._pointerManager._buttons!==0:(this._pointerManager._buttons&t)!==0:!1},i.isPointerDown=function(t){return this._initialized?t===void 0?this._pointerManager._downList.length>0:this._pointerManager._downMap[Cf[t]]===this._curFrameCount:!1},i.isPointerUp=function(t){return this._initialized?t===void 0?this._pointerManager._upList.length>0:this._pointerManager._upMap[Cf[t]]===this._curFrameCount:!1},i._update=function(){this._initialized&&(++this._curFrameCount,this._wheelManager._update(),this._pointerManager._update(this._curFrameCount),this._keyboardManager._update(this._curFrameCount))},i._destroy=function(){this._initialized&&(window.removeEventListener("blur",this._onBlur),window.removeEventListener("focus",this._onFocus),this._wheelManager._destroy(),this._pointerManager._destroy(),this._keyboardManager._destroy())},i._onBlur=function(){this._wheelManager._onBlur(),this._pointerManager._onBlur(),this._keyboardManager._onBlur()},i._onFocus=function(){this._wheelManager._onFocus(),this._pointerManager._onFocus(),this._keyboardManager._onFocus()},K(n,[{key:"pointers",get:function(){return this._initialized?this._pointerManager._pointers:[]}},{key:"multiPointerEnabled",get:function(){return this._initialized?this._pointerManager._multiPointerEnabled:!1},set:function(t){this._initialized&&(this._pointerManager._multiPointerEnabled=t)}},{key:"wheelDelta",get:function(){return this._initialized?this._wheelManager._delta:null}}]),n}(),Bn;(function(n){n[n.NoCascades=1]="NoCascades",n[n.TwoCascades=2]="TwoCascades",n[n.FourCascades=4]="FourCascades"})(Bn||(Bn={}));var ui;(function(n){n[n.Low=0]="Low",n[n.Medium=1]="Medium",n[n.High=2]="High",n[n.VeryHigh=3]="VeryHigh"})(ui||(ui={}));var kr;(function(n){n[n.None=0]="None",n[n.Hard=1]="Hard",n[n.SoftLow=2]="SoftLow",n[n.SoftHigh=3]="SoftHigh"})(kr||(kr={}));var Ot;(function(n){n[n.Opaque=0]="Opaque",n[n.AlphaTest=1]="AlphaTest",n[n.Transparent=2]="Transparent"})(Ot||(Ot={}));var oe;(function(n){n[n.Zero=0]="Zero",n[n.One=1]="One",n[n.SourceColor=2]="SourceColor",n[n.OneMinusSourceColor=3]="OneMinusSourceColor",n[n.DestinationColor=4]="DestinationColor",n[n.OneMinusDestinationColor=5]="OneMinusDestinationColor",n[n.SourceAlpha=6]="SourceAlpha",n[n.OneMinusSourceAlpha=7]="OneMinusSourceAlpha",n[n.DestinationAlpha=8]="DestinationAlpha",n[n.OneMinusDestinationAlpha=9]="OneMinusDestinationAlpha",n[n.SourceAlphaSaturate=10]="SourceAlphaSaturate",n[n.BlendColor=11]="BlendColor",n[n.OneMinusBlendColor=12]="OneMinusBlendColor"})(oe||(oe={}));var xn;(function(n){n[n.Add=0]="Add",n[n.Subtract=1]="Subtract",n[n.ReverseSubtract=2]="ReverseSubtract",n[n.Min=3]="Min",n[n.Max=4]="Max"})(xn||(xn={}));var Zn;(function(n){n[n.None=0]="None",n[n.Red=1]="Red",n[n.Green=2]="Green",n[n.Blue=4]="Blue",n[n.Alpha=8]="Alpha",n[n.All=15]="All"})(Zn||(Zn={}));var ye;(function(n){n[n.Never=0]="Never",n[n.Less=1]="Less",n[n.Equal=2]="Equal",n[n.LessEqual=3]="LessEqual",n[n.Greater=4]="Greater",n[n.NotEqual=5]="NotEqual",n[n.GreaterEqual=6]="GreaterEqual",n[n.Always=7]="Always"})(ye||(ye={}));var kt;(function(n){n[n.Off=0]="Off",n[n.Front=1]="Front",n[n.Back=2]="Back"})(kt||(kt={}));var Xt;(function(n){n[n.Float=0]="Float",n[n.Int=1]="Int",n[n.Vector2=2]="Vector2",n[n.Vector3=3]="Vector3",n[n.Vector4=4]="Vector4",n[n.Matrix=5]="Matrix",n[n.Color=6]="Color",n[n.Texture=7]="Texture",n[n.FloatArray=8]="FloatArray",n[n.IntArray=9]="IntArray",n[n.TextureArray=10]="TextureArray"})(Xt||(Xt={}));var Je;(function(n){n[n.Keep=0]="Keep",n[n.Zero=1]="Zero",n[n.Replace=2]="Replace",n[n.IncrementSaturate=3]="IncrementSaturate",n[n.DecrementSaturate=4]="DecrementSaturate",n[n.Invert=5]="Invert",n[n.IncrementWrap=6]="IncrementWrap",n[n.DecrementWrap=7]="DecrementWrap"})(Je||(Je={}));var Du=function n(i,a,t,e){this.name=i,this._maskIndex=t,this._maskValue=e,this.value=a;var r=n._macroNameIdMap,o=r[i];r[i]===void 0&&(r[i]=o=n._macroNameCounter++),this._nameId=o};Du._macroNameIdMap=Object.create(null);Du._macroNameCounter=0;var En=function(){function n(){this._mask=[],this._length=0}var i=n.prototype;return i.enable=function(t){var e=t._maskIndex,r=e+1,o=this._mask,s=this._length;if(s<r){for(o.length<r&&(o.length=r);s<e;s++)o[s]=0;o[e]=t._maskValue,this._length=r}else o[e]|=t._maskValue},i.disable=function(t){var e=t._maskIndex,r=this._mask,o=this._length-1;if(!(e>o)){var s=r[e]&~t._maskValue;e==o&&s===0?this._length--:r[e]=s}},i.unionCollection=function(t){var e=t._mask,r=t._length,o=this._mask,s=this._length;if(s<r){o.length<r&&(o.length=r);for(var l=0;l<s;l++)o[l]|=e[l];for(;l<r;l++)o[l]=e[l];this._length=r}else for(var u=0;u<r;u++)o[u]|=e[u]},i.complementaryCollection=function(t){for(var e=t._mask,r=this._mask,o=this._length-1,s=Math.min(t._length-1,o);s>=0;s--){var l=r[s]&~e[s];s==o&&l===0?(o--,this._length--):r[s]=l}},i.intersectionCollection=function(t){for(var e=t._mask,r=this._mask,o=this._length-1;o>=0;o--){var s=r[o]&e[o];s==0&&o==this._length-1?this._length--:r[o]=s}},i.isEnable=function(t){var e=t._maskIndex;return e>=this._length?!1:(this._mask[e]&t._maskValue)!==0},i.clear=function(){this._length=0},n.unionCollection=function(t,e,r){var o=r._mask,s,l,u,c;t._length<e._length?(s=t._length,l=e._length,u=t._mask,c=e._mask):(s=e._length,l=t._length,u=e._mask,c=t._mask);var d=0;for(o.length<l&&(o.length=l);d<s;d++)o[d]=u[d]|c[d];for(;d<l;d++)o[d]=c[d];r._length=l},n}();function wd(){return wd=Object.assign||function(n){for(var i=1;i<arguments.length;i++){var a=arguments[i];for(var t in a)Object.prototype.hasOwnProperty.call(a,t)&&(n[t]=a[t])}return n},wd.apply(this,arguments)}function dx(){return wd.apply(this,arguments)}var _x=`#define GLSLIFY 1
uniform vec3 u_cameraPos;`,hx=`#define GLSLIFY 1
#define PI 3.14159265359
#define RECIPROCAL_PI 0.31830988618
#define EPSILON 1e-6
#define LOG2 1.442695
#define saturate( a ) clamp( a, 0.0, 1.0 )
float pow2(float x){return x*x;}vec4 RGBMToLinear(vec4 value,float maxRange){return vec4(value.rgb*value.a*maxRange,1.0);}vec4 gammaToLinear(vec4 srgbIn){return vec4(pow(srgbIn.rgb,vec3(2.2)),srgbIn.a);}vec4 linearToGamma(vec4 linearIn){return vec4(pow(linearIn.rgb,vec3(1.0/2.2)),linearIn.a);}
#ifdef GRAPHICS_API_WEBGL2
#define INVERSE_MAT(mat) inverse(mat)
#else
mat2 inverseMat(mat2 m){return mat2(m[1][1],-m[0][1],-m[1][0],m[0][0])/(m[0][0]*m[1][1]-m[0][1]*m[1][0]);}mat3 inverseMat(mat3 m){float a00=m[0][0],a01=m[0][1],a02=m[0][2];float a10=m[1][0],a11=m[1][1],a12=m[1][2];float a20=m[2][0],a21=m[2][1],a22=m[2][2];float b01=a22*a11-a12*a21;float b11=-a22*a10+a12*a20;float b21=a21*a10-a11*a20;float det=a00*b01+a01*b11+a02*b21;return mat3(b01,(-a22*a01+a02*a21),(a12*a01-a02*a11),b11,(a22*a00-a02*a20),(-a12*a00+a02*a10),b21,(-a21*a00+a01*a20),(a11*a00-a01*a10))/det;}mat4 inverseMat(mat4 m){float a00=m[0][0],a01=m[0][1],a02=m[0][2],a03=m[0][3],a10=m[1][0],a11=m[1][1],a12=m[1][2],a13=m[1][3],a20=m[2][0],a21=m[2][1],a22=m[2][2],a23=m[2][3],a30=m[3][0],a31=m[3][1],a32=m[3][2],a33=m[3][3],b00=a00*a11-a01*a10,b01=a00*a12-a02*a10,b02=a00*a13-a03*a10,b03=a01*a12-a02*a11,b04=a01*a13-a03*a11,b05=a02*a13-a03*a12,b06=a20*a31-a21*a30,b07=a20*a32-a22*a30,b08=a20*a33-a23*a30,b09=a21*a32-a22*a31,b10=a21*a33-a23*a31,b11=a22*a33-a23*a32,det=b00*b11-b01*b10+b02*b09+b03*b08-b04*b07+b05*b06;return mat4(a11*b11-a12*b10+a13*b09,a02*b10-a01*b11-a03*b09,a31*b05-a32*b04+a33*b03,a22*b04-a21*b05-a23*b03,a12*b08-a10*b11-a13*b07,a00*b11-a02*b08+a03*b07,a32*b02-a30*b05-a33*b01,a20*b05-a22*b02+a23*b01,a10*b10-a11*b08+a13*b06,a01*b08-a00*b10-a03*b06,a30*b04-a31*b02+a33*b00,a21*b02-a20*b04-a23*b00,a11*b07-a10*b09-a12*b06,a00*b09-a01*b07+a02*b06,a31*b01-a30*b03-a32*b00,a20*b03-a21*b01+a22*b00)/det;}
#define INVERSE_MAT(mat) inverseMat(mat)
#endif
#ifdef OASIS_CLIP_PLANE
uniform vec4 u_clip_plane;
#endif
`,fx=`#define GLSLIFY 1
attribute vec3 POSITION;
#ifdef O3_HAS_UV
attribute vec2 TEXCOORD_0;
#endif
#ifdef O3_HAS_UV1
attribute vec2 TEXCOORD_1;
#endif
#ifdef O3_HAS_SKIN
attribute vec4 JOINTS_0;attribute vec4 WEIGHTS_0;
#ifdef O3_USE_JOINT_TEXTURE
uniform sampler2D u_jointSampler;uniform float u_jointCount;mat4 getJointMatrix(sampler2D smp,float index){float base=index/u_jointCount;float hf=0.5/u_jointCount;float v=base+hf;vec4 m0=texture2D(smp,vec2(0.125,v));vec4 m1=texture2D(smp,vec2(0.375,v));vec4 m2=texture2D(smp,vec2(0.625,v));vec4 m3=texture2D(smp,vec2(0.875,v));return mat4(m0,m1,m2,m3);}
#else
uniform mat4 u_jointMatrix[O3_JOINTS_NUM];
#endif
#endif
#ifdef O3_HAS_VERTEXCOLOR
attribute vec4 COLOR_0;
#endif
#include <transform_declare>
#include <camera_declare>
uniform vec4 u_tilingOffset;
#ifndef OMIT_NORMAL
#ifdef O3_HAS_NORMAL
attribute vec3 NORMAL;
#endif
#ifdef O3_HAS_TANGENT
attribute vec4 TANGENT;
#endif
#endif
`,vx=`#define GLSLIFY 1
uniform mat4 u_localMat;uniform mat4 u_modelMat;uniform mat4 u_viewMat;uniform mat4 u_projMat;uniform mat4 u_MVMat;uniform mat4 u_MVPMat;uniform mat4 u_normalMat;`,px=`#define GLSLIFY 1
#ifdef O3_HAS_VERTEXCOLOR
varying vec4 v_color;
#endif
`,gx=`#define GLSLIFY 1
#if OASIS_FOG_MODE != 0
varying vec3 v_positionVS;uniform vec4 oasis_FogColor;uniform vec4 oasis_FogParams;float ComputeFogIntensity(float fogDepth){
#if OASIS_FOG_MODE == 1
return clamp(fogDepth*oasis_FogParams.x+oasis_FogParams.y,0.0,1.0);
#elif OASIS_FOG_MODE == 2
return clamp(exp2(-fogDepth*oasis_FogParams.z),0.0,1.0);
#elif OASIS_FOG_MODE == 3
float factor=fogDepth*oasis_FogParams.w;return clamp(exp2(-factor*factor),0.0,1.0);
#endif
}
#endif
`,mx=`#define GLSLIFY 1
#if OASIS_FOG_MODE != 0
varying vec3 v_positionVS;
#endif
`,yx=`#define GLSLIFY 1
#ifndef OMIT_NORMAL
#ifdef O3_HAS_NORMAL
varying vec3 v_normal;
#if defined(O3_HAS_TANGENT) && ( defined(NORMALTEXTURE) || defined(HAS_CLEARCOATNORMALTEXTURE) )
varying mat3 v_TBN;
#endif
#endif
#endif
`,xx=`#define GLSLIFY 1
varying vec2 v_uv;
#ifdef O3_HAS_UV1
varying vec2 v_uv1;
#endif
`,wx=`#define GLSLIFY 1
#ifdef O3_NEED_WORLDPOS
varying vec3 v_pos;
#endif
`,Sx=`#define GLSLIFY 1
#ifndef OMIT_NORMAL
#ifdef O3_HAS_NORMAL
vec3 normal=vec3(NORMAL);
#endif
#ifdef O3_HAS_TANGENT
vec4 tangent=vec4(TANGENT);
#endif
#endif
`,Cx=`#define GLSLIFY 1
vec4 position=vec4(POSITION,1.0);`,Ax=`#define GLSLIFY 1
#ifdef OASIS_BLENDSHAPE
#ifdef OASIS_BLENDSHAPE_TEXTURE
uniform mediump sampler2DArray u_blendShapeTexture;uniform ivec3 u_blendShapeTextureInfo;uniform float u_blendShapeWeights[OASIS_BLENDSHAPE_COUNT];
#else
attribute vec3 POSITION_BS0;attribute vec3 POSITION_BS1;
#if defined( OASIS_BLENDSHAPE_NORMAL ) && defined( OASIS_BLENDSHAPE_TANGENT )
attribute vec3 NORMAL_BS0;attribute vec3 NORMAL_BS1;attribute vec3 TANGENT_BS0;attribute vec3 TANGENT_BS1;uniform float u_blendShapeWeights[2];
#else
#if defined( OASIS_BLENDSHAPE_NORMAL ) || defined( OASIS_BLENDSHAPE_TANGENT )
attribute vec3 POSITION_BS2;attribute vec3 POSITION_BS3;
#ifdef OASIS_BLENDSHAPE_NORMAL
attribute vec3 NORMAL_BS0;attribute vec3 NORMAL_BS1;attribute vec3 NORMAL_BS2;attribute vec3 NORMAL_BS3;
#endif
#ifdef OASIS_BLENDSHAPE_TANGENT
attribute vec3 TANGENT_BS0;attribute vec3 TANGENT_BS1;attribute vec3 TANGENT_BS2;attribute vec3 TANGENT_BS3;
#endif
uniform float u_blendShapeWeights[4];
#else
attribute vec3 POSITION_BS2;attribute vec3 POSITION_BS3;attribute vec3 POSITION_BS4;attribute vec3 POSITION_BS5;attribute vec3 POSITION_BS6;attribute vec3 POSITION_BS7;uniform float u_blendShapeWeights[8];
#endif
#endif
#endif
#ifdef OASIS_BLENDSHAPE_TEXTURE
vec3 getBlendShapeVertexElement(int blendShapeIndex,int vertexElementIndex){int y=vertexElementIndex/u_blendShapeTextureInfo.y;int x=vertexElementIndex-y*u_blendShapeTextureInfo.y;ivec3 uv=ivec3(x,y,blendShapeIndex);return texelFetch(u_blendShapeTexture,uv,0).xyz;}
#endif
#endif
`,Tx=`#define GLSLIFY 1
#ifdef OASIS_BLENDSHAPE
#ifdef OASIS_BLENDSHAPE_TEXTURE
int vertexOffset=gl_VertexID*u_blendShapeTextureInfo.x;for(int i=0;i<OASIS_BLENDSHAPE_COUNT;i++){int vertexElementOffset=vertexOffset;float weight=u_blendShapeWeights[i];position.xyz+=getBlendShapeVertexElement(i,vertexElementOffset)*weight;
#ifndef OMIT_NORMAL
#if defined( O3_HAS_NORMAL ) && defined( OASIS_BLENDSHAPE_NORMAL )
vertexElementOffset+=1;normal+=getBlendShapeVertexElement(i,vertexElementOffset)*weight;
#endif
#if defined( O3_HAS_TANGENT ) && defined(OASIS_BLENDSHAPE_TANGENT) && ( defined(NORMALTEXTURE) || defined(HAS_CLEARCOATNORMALTEXTURE) )
vertexElementOffset+=1;tangent.xyz+=getBlendShapeVertexElement(i,vertexElementOffset)*weight;
#endif
#endif
}
#else
position.xyz+=POSITION_BS0*u_blendShapeWeights[0];position.xyz+=POSITION_BS1*u_blendShapeWeights[1];
#if defined( OASIS_BLENDSHAPE_NORMAL ) && defined( OASIS_BLENDSHAPE_TANGENT )
#ifndef OMIT_NORMAL
#ifdef O3_HAS_NORMAL
normal+=NORMAL_BS0*u_blendShapeWeights[0];normal+=NORMAL_BS1*u_blendShapeWeights[1];
#endif
#if defined( O3_HAS_TANGENT ) && ( defined(NORMALTEXTURE) || defined(HAS_CLEARCOATNORMALTEXTURE) )
tangent.xyz+=TANGENT_BS0*u_blendShapeWeights[0];tangent.xyz+=TANGENT_BS1*u_blendShapeWeights[1];
#endif
#endif
#else
#if defined( OASIS_BLENDSHAPE_NORMAL ) || defined( OASIS_BLENDSHAPE_TANGENT )
#ifndef OMIT_NORMAL
position.xyz+=POSITION_BS2*u_blendShapeWeights[2];position.xyz+=POSITION_BS3*u_blendShapeWeights[3];
#if defined( OASIS_BLENDSHAPE_NORMAL ) && defined( O3_HAS_NORMAL )
normal+=NORMAL_BS0*u_blendShapeWeights[0];normal+=NORMAL_BS1*u_blendShapeWeights[1];normal+=NORMAL_BS2*u_blendShapeWeights[2];normal+=NORMAL_BS3*u_blendShapeWeights[3];
#endif
#if defined(OASIS_BLENDSHAPE_TANGENT) && defined( O3_HAS_TANGENT ) && ( defined(NORMALTEXTURE) || defined(HAS_CLEARCOATNORMALTEXTURE) )
tangent.xyz+=TANGENT_BS0*u_blendShapeWeights[0];tangent.xyz+=TANGENT_BS1*u_blendShapeWeights[1];tangent.xyz+=TANGENT_BS2*u_blendShapeWeights[2];tangent.xyz+=TANGENT_BS3*u_blendShapeWeights[3];
#endif
#endif
#else
position.xyz+=POSITION_BS2*u_blendShapeWeights[2];position.xyz+=POSITION_BS3*u_blendShapeWeights[3];position.xyz+=POSITION_BS4*u_blendShapeWeights[4];position.xyz+=POSITION_BS5*u_blendShapeWeights[5];position.xyz+=POSITION_BS6*u_blendShapeWeights[6];position.xyz+=POSITION_BS7*u_blendShapeWeights[7];
#endif
#endif
#endif
#endif
`,Ex=`#define GLSLIFY 1
#ifdef O3_HAS_VERTEXCOLOR
v_color=COLOR_0;
#endif
`,Px=`#define GLSLIFY 1
#if OASIS_FOG_MODE != 0
vec4 positionVS=u_MVMat*position;v_positionVS=positionVS.xyz/positionVS.w;
#endif
`,bx=`#define GLSLIFY 1
#ifndef OMIT_NORMAL
#ifdef O3_HAS_NORMAL
v_normal=normalize(mat3(u_normalMat)*normal);
#if defined(O3_HAS_TANGENT) && ( defined(NORMALTEXTURE) || defined(HAS_CLEARCOATNORMALTEXTURE) )
vec3 normalW=normalize(mat3(u_normalMat)*normal.xyz);vec3 tangentW=normalize(mat3(u_normalMat)*tangent.xyz);vec3 bitangentW=cross(normalW,tangentW)*tangent.w;v_TBN=mat3(tangentW,bitangentW,normalW);
#endif
#endif
#endif
`,Mx=`#define GLSLIFY 1
gl_Position=u_MVPMat*position;`,Rx=`#define GLSLIFY 1
#ifdef O3_HAS_SKIN
#ifdef O3_USE_JOINT_TEXTURE
mat4 skinMatrix=WEIGHTS_0.x*getJointMatrix(u_jointSampler,JOINTS_0.x)+WEIGHTS_0.y*getJointMatrix(u_jointSampler,JOINTS_0.y)+WEIGHTS_0.z*getJointMatrix(u_jointSampler,JOINTS_0.z)+WEIGHTS_0.w*getJointMatrix(u_jointSampler,JOINTS_0.w);
#else
mat4 skinMatrix=WEIGHTS_0.x*u_jointMatrix[int(JOINTS_0.x)]+WEIGHTS_0.y*u_jointMatrix[int(JOINTS_0.y)]+WEIGHTS_0.z*u_jointMatrix[int(JOINTS_0.z)]+WEIGHTS_0.w*u_jointMatrix[int(JOINTS_0.w)];
#endif
position=skinMatrix*position;
#if defined(O3_HAS_NORMAL) && !defined(OMIT_NORMAL)
mat3 skinNormalMatrix=INVERSE_MAT(mat3(skinMatrix));normal=normal*skinNormalMatrix;
#if defined(O3_HAS_TANGENT) && ( defined(NORMALTEXTURE) || defined(HAS_CLEARCOATNORMALTEXTURE) )
tangent.xyz=tangent.xyz*skinNormalMatrix;
#endif
#endif
#endif
`,Fx=`#define GLSLIFY 1
#ifdef O3_HAS_UV
v_uv=TEXCOORD_0;
#else
v_uv=vec2(0.,0.);
#endif
#ifdef O3_HAS_UV1
v_uv1=TEXCOORD_1;
#endif
#ifdef O3_NEED_TILINGOFFSET
v_uv=v_uv*u_tilingOffset.xy+u_tilingOffset.zw;
#endif
`,Dx=`#define GLSLIFY 1
#ifdef O3_NEED_WORLDPOS
vec4 temp_pos=u_modelMat*position;v_pos=temp_pos.xyz/temp_pos.w;
#endif
`,Bx=`#define GLSLIFY 1
#if OASIS_FOG_MODE != 0
float fogIntensity=ComputeFogIntensity(length(v_positionVS));gl_FragColor.rgb=mix(oasis_FogColor.rgb,gl_FragColor.rgb,fogIntensity);
#endif
`,Ix=`#define GLSLIFY 1
#ifdef O3_DIRECT_LIGHT_COUNT
struct DirectLight{vec3 color;vec3 direction;};uniform vec3 u_directLightColor[O3_DIRECT_LIGHT_COUNT];uniform vec3 u_directLightDirection[O3_DIRECT_LIGHT_COUNT];
#endif
#ifdef O3_POINT_LIGHT_COUNT
struct PointLight{vec3 color;vec3 position;float distance;};uniform vec3 u_pointLightColor[O3_POINT_LIGHT_COUNT];uniform vec3 u_pointLightPosition[O3_POINT_LIGHT_COUNT];uniform float u_pointLightDistance[O3_POINT_LIGHT_COUNT];
#endif
#ifdef O3_SPOT_LIGHT_COUNT
struct SpotLight{vec3 color;vec3 position;vec3 direction;float distance;float angleCos;float penumbraCos;};uniform vec3 u_spotLightColor[O3_SPOT_LIGHT_COUNT];uniform vec3 u_spotLightPosition[O3_SPOT_LIGHT_COUNT];uniform vec3 u_spotLightDirection[O3_SPOT_LIGHT_COUNT];uniform float u_spotLightDistance[O3_SPOT_LIGHT_COUNT];uniform float u_spotLightAngleCos[O3_SPOT_LIGHT_COUNT];uniform float u_spotLightPenumbraCos[O3_SPOT_LIGHT_COUNT];
#endif
struct EnvMapLight{vec3 diffuse;float mipMapLevel;float diffuseIntensity;float specularIntensity;};uniform EnvMapLight u_envMapLight;
#ifdef O3_USE_SH
uniform vec3 u_env_sh[9];
#endif
#ifdef O3_USE_SPECULAR_ENV
uniform samplerCube u_env_specularSampler;
#endif
`,Lx=`#define GLSLIFY 1
uniform vec4 u_emissiveColor;uniform vec4 u_baseColor;uniform vec4 u_specularColor;uniform float u_shininess;uniform float u_normalIntensity;uniform float u_alphaCutoff;
#ifdef EMISSIVETEXTURE
uniform sampler2D u_emissiveTexture;
#endif
#ifdef BASETEXTURE
uniform sampler2D u_baseTexture;
#endif
#ifdef O3_SPECULAR_TEXTURE
uniform sampler2D u_specularTexture;
#endif
#ifdef NORMALTEXTURE
uniform sampler2D u_normalTexture;
#endif
`,zx=`#define GLSLIFY 1
vec4 ambient=vec4(0.0);vec4 emission=u_emissiveColor;vec4 diffuse=u_baseColor;vec4 specular=u_specularColor;
#ifdef EMISSIVETEXTURE
vec4 emissiveTextureColor=texture2D(u_emissiveTexture,v_uv);
#ifndef OASIS_COLORSPACE_GAMMA
emissiveTextureColor=gammaToLinear(emissiveTextureColor);
#endif
emission*=emissiveTextureColor;
#endif
#ifdef BASETEXTURE
vec4 diffuseTextureColor=texture2D(u_baseTexture,v_uv);
#ifndef OASIS_COLORSPACE_GAMMA
diffuseTextureColor=gammaToLinear(diffuseTextureColor);
#endif
diffuse*=diffuseTextureColor;
#endif
#ifdef O3_HAS_VERTEXCOLOR
diffuse*=v_color;
#endif
#ifdef O3_SPECULAR_TEXTURE
vec4 specularTextureColor=texture2D(u_specularTexture,v_uv);
#ifndef OASIS_COLORSPACE_GAMMA
specularTextureColor=gammaToLinear(specularTextureColor);
#endif
specular*=specularTextureColor;
#endif
ambient=vec4(u_envMapLight.diffuse*u_envMapLight.diffuseIntensity,1.0)*diffuse;`,Ox=`#define GLSLIFY 1
#ifdef O3_NEED_WORLDPOS
vec3 V=normalize(u_cameraPos-v_pos);
#endif
`,Nx=`#define GLSLIFY 1
#ifdef NORMALTEXTURE
mat3 tbn=getTBN();vec3 N=getNormalByNormalTexture(tbn,u_normalTexture,u_normalIntensity,v_uv);
#else
vec3 N=getNormal();
#endif
vec3 lightDiffuse=vec3(0.0,0.0,0.0);vec3 lightSpecular=vec3(0.0,0.0,0.0);float shadowAttenuation=1.0;
#ifdef O3_DIRECT_LIGHT_COUNT
shadowAttenuation=1.0;
#ifdef OASIS_CALCULATE_SHADOWS
shadowAttenuation*=sampleShadowMap();int sunIndex=int(u_shadowInfo.z);
#endif
DirectLight directionalLight;for(int i=0;i<O3_DIRECT_LIGHT_COUNT;i++){directionalLight.color=u_directLightColor[i];
#ifdef OASIS_CALCULATE_SHADOWS
if(i==sunIndex){directionalLight.color*=shadowAttenuation;}
#endif
directionalLight.direction=u_directLightDirection[i];float d=max(dot(N,-directionalLight.direction),0.0);lightDiffuse+=directionalLight.color*d;vec3 halfDir=normalize(V-directionalLight.direction);float s=pow(clamp(dot(N,halfDir),0.0,1.0),u_shininess);lightSpecular+=directionalLight.color*s;}
#endif
#ifdef O3_POINT_LIGHT_COUNT
PointLight pointLight;for(int i=0;i<O3_POINT_LIGHT_COUNT;i++){pointLight.color=u_pointLightColor[i];pointLight.position=u_pointLightPosition[i];pointLight.distance=u_pointLightDistance[i];vec3 direction=v_pos-pointLight.position;float dist=length(direction);direction/=dist;float decay=clamp(1.0-pow(dist/pointLight.distance,4.0),0.0,1.0);float d=max(dot(N,-direction),0.0)*decay;lightDiffuse+=pointLight.color*d;vec3 halfDir=normalize(V-direction);float s=pow(clamp(dot(N,halfDir),0.0,1.0),u_shininess)*decay;lightSpecular+=pointLight.color*s;}
#endif
#ifdef O3_SPOT_LIGHT_COUNT
SpotLight spotLight;for(int i=0;i<O3_SPOT_LIGHT_COUNT;i++){spotLight.color=u_spotLightColor[i];spotLight.position=u_spotLightPosition[i];spotLight.direction=u_spotLightDirection[i];spotLight.distance=u_spotLightDistance[i];spotLight.angleCos=u_spotLightAngleCos[i];spotLight.penumbraCos=u_spotLightPenumbraCos[i];vec3 direction=spotLight.position-v_pos;float lightDistance=length(direction);direction/=lightDistance;float angleCos=dot(direction,-spotLight.direction);float decay=clamp(1.0-pow(lightDistance/spotLight.distance,4.0),0.0,1.0);float spotEffect=smoothstep(spotLight.penumbraCos,spotLight.angleCos,angleCos);float decayTotal=decay*spotEffect;float d=max(dot(N,direction),0.0)*decayTotal;lightDiffuse+=spotLight.color*d;vec3 halfDir=normalize(V+direction);float s=pow(clamp(dot(N,halfDir),0.0,1.0),u_shininess)*decayTotal;lightSpecular+=spotLight.color*s;}
#endif
diffuse*=vec4(lightDiffuse,1.0);specular*=vec4(lightSpecular,1.0);
#ifdef ALPHA_CUTOFF
if(diffuse.a<u_alphaCutoff){discard;}
#endif
`,Vx=`#define GLSLIFY 1
#include <noise_cellular_2D>
#include <noise_cellular_3D>
#include <noise_cellular_2x2>
#include <noise_cellular_2x2x2>
`,Ux=`#define GLSLIFY 1
vec2 cellular(vec2 P){vec2 Pi=mod289(floor(P));vec2 Pf=fract(P);vec3 oi=vec3(-1.0,0.0,1.0);vec3 of=vec3(-0.5,0.5,1.5);vec3 px=permute(Pi.x+oi);vec3 p=permute(px.x+Pi.y+oi);vec3 ox=fract(p*K)-Ko;vec3 oy=mod7(floor(p*K))*K-Ko;vec3 dx=Pf.x+0.5+jitter*ox;vec3 dy=Pf.y-of+jitter*oy;vec3 d1=dx*dx+dy*dy;p=permute(px.y+Pi.y+oi);ox=fract(p*K)-Ko;oy=mod7(floor(p*K))*K-Ko;dx=Pf.x-0.5+jitter*ox;dy=Pf.y-of+jitter*oy;vec3 d2=dx*dx+dy*dy;p=permute(px.z+Pi.y+oi);ox=fract(p*K)-Ko;oy=mod7(floor(p*K))*K-Ko;dx=Pf.x-1.5+jitter*ox;dy=Pf.y-of+jitter*oy;vec3 d3=dx*dx+dy*dy;vec3 d1a=min(d1,d2);d2=max(d1,d2);d2=min(d2,d3);d1=min(d1a,d2);d2=max(d1a,d2);d1.xy=(d1.x<d1.y)? d1.xy : d1.yx;d1.xz=(d1.x<d1.z)? d1.xz : d1.zx;d1.yz=min(d1.yz,d2.yz);d1.y=min(d1.y,d1.z);d1.y=min(d1.y,d2.x);return sqrt(d1.xy);}`,kx=`#define GLSLIFY 1
vec2 cellular2x2(vec2 P){vec2 Pi=mod289(floor(P));vec2 Pf=fract(P);vec4 Pfx=Pf.x+vec4(-0.5,-1.5,-0.5,-1.5);vec4 Pfy=Pf.y+vec4(-0.5,-0.5,-1.5,-1.5);vec4 p=permute(Pi.x+vec4(0.0,1.0,0.0,1.0));p=permute(p+Pi.y+vec4(0.0,0.0,1.0,1.0));vec4 ox=mod7(p)*K+Kd2;vec4 oy=mod7(floor(p*K))*K+Kd2;vec4 dx=Pfx+jitter1*ox;vec4 dy=Pfy+jitter1*oy;vec4 d=dx*dx+dy*dy;d.xy=(d.x<d.y)? d.xy : d.yx;d.xz=(d.x<d.z)? d.xz : d.zx;d.xw=(d.x<d.w)? d.xw : d.wx;d.y=min(d.y,d.z);d.y=min(d.y,d.w);return sqrt(d.xy);}`,Hx=`#define GLSLIFY 1
vec2 cellular2x2x2(vec3 P){vec3 Pi=mod289(floor(P));vec3 Pf=fract(P);vec4 Pfx=Pf.x+vec4(0.0,-1.0,0.0,-1.0);vec4 Pfy=Pf.y+vec4(0.0,0.0,-1.0,-1.0);vec4 p=permute(Pi.x+vec4(0.0,1.0,0.0,1.0));p=permute(p+Pi.y+vec4(0.0,0.0,1.0,1.0));vec4 p1=permute(p+Pi.z);vec4 p2=permute(p+Pi.z+vec4(1.0));vec4 ox1=fract(p1*K)-Ko;vec4 oy1=mod7(floor(p1*K))*K-Ko;vec4 oz1=floor(p1*K2)*Kz-Kzo;vec4 ox2=fract(p2*K)-Ko;vec4 oy2=mod7(floor(p2*K))*K-Ko;vec4 oz2=floor(p2*K2)*Kz-Kzo;vec4 dx1=Pfx+jitter1*ox1;vec4 dy1=Pfy+jitter1*oy1;vec4 dz1=Pf.z+jitter1*oz1;vec4 dx2=Pfx+jitter1*ox2;vec4 dy2=Pfy+jitter1*oy2;vec4 dz2=Pf.z-1.0+jitter1*oz2;vec4 d1=dx1*dx1+dy1*dy1+dz1*dz1;vec4 d2=dx2*dx2+dy2*dy2+dz2*dz2;vec4 d=min(d1,d2);d2=max(d1,d2);d.xy=(d.x<d.y)? d.xy : d.yx;d.xz=(d.x<d.z)? d.xz : d.zx;d.xw=(d.x<d.w)? d.xw : d.wx;d.yzw=min(d.yzw,d2.yzw);d.y=min(d.y,d.z);d.y=min(d.y,d.w);d.y=min(d.y,d2.x);return sqrt(d.xy);}`,Gx=`#define GLSLIFY 1
vec2 cellular(vec3 P){vec3 Pi=mod289(floor(P));vec3 Pf=fract(P)-0.5;vec3 Pfx=Pf.x+vec3(1.0,0.0,-1.0);vec3 Pfy=Pf.y+vec3(1.0,0.0,-1.0);vec3 Pfz=Pf.z+vec3(1.0,0.0,-1.0);vec3 p=permute(Pi.x+vec3(-1.0,0.0,1.0));vec3 p1=permute(p+Pi.y-1.0);vec3 p2=permute(p+Pi.y);vec3 p3=permute(p+Pi.y+1.0);vec3 p11=permute(p1+Pi.z-1.0);vec3 p12=permute(p1+Pi.z);vec3 p13=permute(p1+Pi.z+1.0);vec3 p21=permute(p2+Pi.z-1.0);vec3 p22=permute(p2+Pi.z);vec3 p23=permute(p2+Pi.z+1.0);vec3 p31=permute(p3+Pi.z-1.0);vec3 p32=permute(p3+Pi.z);vec3 p33=permute(p3+Pi.z+1.0);vec3 ox11=fract(p11*K)-Ko;vec3 oy11=mod7(floor(p11*K))*K-Ko;vec3 oz11=floor(p11*K2)*Kz-Kzo;vec3 ox12=fract(p12*K)-Ko;vec3 oy12=mod7(floor(p12*K))*K-Ko;vec3 oz12=floor(p12*K2)*Kz-Kzo;vec3 ox13=fract(p13*K)-Ko;vec3 oy13=mod7(floor(p13*K))*K-Ko;vec3 oz13=floor(p13*K2)*Kz-Kzo;vec3 ox21=fract(p21*K)-Ko;vec3 oy21=mod7(floor(p21*K))*K-Ko;vec3 oz21=floor(p21*K2)*Kz-Kzo;vec3 ox22=fract(p22*K)-Ko;vec3 oy22=mod7(floor(p22*K))*K-Ko;vec3 oz22=floor(p22*K2)*Kz-Kzo;vec3 ox23=fract(p23*K)-Ko;vec3 oy23=mod7(floor(p23*K))*K-Ko;vec3 oz23=floor(p23*K2)*Kz-Kzo;vec3 ox31=fract(p31*K)-Ko;vec3 oy31=mod7(floor(p31*K))*K-Ko;vec3 oz31=floor(p31*K2)*Kz-Kzo;vec3 ox32=fract(p32*K)-Ko;vec3 oy32=mod7(floor(p32*K))*K-Ko;vec3 oz32=floor(p32*K2)*Kz-Kzo;vec3 ox33=fract(p33*K)-Ko;vec3 oy33=mod7(floor(p33*K))*K-Ko;vec3 oz33=floor(p33*K2)*Kz-Kzo;vec3 dx11=Pfx+jitter*ox11;vec3 dy11=Pfy.x+jitter*oy11;vec3 dz11=Pfz.x+jitter*oz11;vec3 dx12=Pfx+jitter*ox12;vec3 dy12=Pfy.x+jitter*oy12;vec3 dz12=Pfz.y+jitter*oz12;vec3 dx13=Pfx+jitter*ox13;vec3 dy13=Pfy.x+jitter*oy13;vec3 dz13=Pfz.z+jitter*oz13;vec3 dx21=Pfx+jitter*ox21;vec3 dy21=Pfy.y+jitter*oy21;vec3 dz21=Pfz.x+jitter*oz21;vec3 dx22=Pfx+jitter*ox22;vec3 dy22=Pfy.y+jitter*oy22;vec3 dz22=Pfz.y+jitter*oz22;vec3 dx23=Pfx+jitter*ox23;vec3 dy23=Pfy.y+jitter*oy23;vec3 dz23=Pfz.z+jitter*oz23;vec3 dx31=Pfx+jitter*ox31;vec3 dy31=Pfy.z+jitter*oy31;vec3 dz31=Pfz.x+jitter*oz31;vec3 dx32=Pfx+jitter*ox32;vec3 dy32=Pfy.z+jitter*oy32;vec3 dz32=Pfz.y+jitter*oz32;vec3 dx33=Pfx+jitter*ox33;vec3 dy33=Pfy.z+jitter*oy33;vec3 dz33=Pfz.z+jitter*oz33;vec3 d11=dx11*dx11+dy11*dy11+dz11*dz11;vec3 d12=dx12*dx12+dy12*dy12+dz12*dz12;vec3 d13=dx13*dx13+dy13*dy13+dz13*dz13;vec3 d21=dx21*dx21+dy21*dy21+dz21*dz21;vec3 d22=dx22*dx22+dy22*dy22+dz22*dz22;vec3 d23=dx23*dx23+dy23*dy23+dz23*dz23;vec3 d31=dx31*dx31+dy31*dy31+dz31*dz31;vec3 d32=dx32*dx32+dy32*dy32+dz32*dz32;vec3 d33=dx33*dx33+dy33*dy33+dz33*dz33;vec3 d1a=min(d11,d12);d12=max(d11,d12);d11=min(d1a,d13);d13=max(d1a,d13);d12=min(d12,d13);vec3 d2a=min(d21,d22);d22=max(d21,d22);d21=min(d2a,d23);d23=max(d2a,d23);d22=min(d22,d23);vec3 d3a=min(d31,d32);d32=max(d31,d32);d31=min(d3a,d33);d33=max(d3a,d33);d32=min(d32,d33);vec3 da=min(d11,d21);d21=max(d11,d21);d11=min(da,d31);d31=max(da,d31);d11.xy=(d11.x<d11.y)? d11.xy : d11.yx;d11.xz=(d11.x<d11.z)? d11.xz : d11.zx;d12=min(d12,d21);d12=min(d12,d22);d12=min(d12,d31);d12=min(d12,d32);d11.yz=min(d11.yz,d12.xy);d11.y=min(d11.y,d12.z);d11.y=min(d11.y,d11.z);return sqrt(d11.xy);}`,Wx=`#define GLSLIFY 1
vec4 mod289(vec4 x){return x-floor(x*(1.0/289.0))*289.0;}vec3 mod289(vec3 x){return x-floor(x*(1.0/289.0))*289.0;}vec2 mod289(vec2 x){return x-floor(x*(1.0/289.0))*289.0;}float mod289(float x){return x-floor(x*(1.0/289.0))*289.0;}vec4 mod7(vec4 x){return x-floor(x*(1.0/7.0))*7.0;}vec3 mod7(vec3 x){return x-floor(x*(1.0/7.0))*7.0;}vec4 permute(vec4 x){return mod289((34.0*x+1.0)*x);}vec3 permute(vec3 x){return mod289((34.0*x+1.0)*x);}float permute(float x){return mod289(((x*34.0)+1.0)*x);}vec4 taylorInvSqrt(vec4 r){return 1.79284291400159-0.85373472095314*r;}float taylorInvSqrt(float r){return 1.79284291400159-0.85373472095314*r;}vec4 fade(vec4 t){return t*t*t*(t*(t*6.0-15.0)+10.0);}vec3 fade(vec3 t){return t*t*t*(t*(t*6.0-15.0)+10.0);}vec2 fade(vec2 t){return t*t*t*(t*(t*6.0-15.0)+10.0);}
#define K 0.142857142857
#define Ko 0.428571428571
#define K2 0.020408163265306
#define Kd2 0.0714285714285
#define Kz 0.166666666667
#define Kzo 0.416666666667
#define jitter 1.0
#define jitter1 0.8
`,Xx=`#define GLSLIFY 1
#include <noise_perlin_2D>
#include <noise_perlin_3D>
#include <noise_perlin_4D>
`,jx=`#define GLSLIFY 1
float perlin(vec2 P){vec4 Pi=floor(P.xyxy)+vec4(0.0,0.0,1.0,1.0);vec4 Pf=fract(P.xyxy)-vec4(0.0,0.0,1.0,1.0);Pi=mod289(Pi);vec4 ix=Pi.xzxz;vec4 iy=Pi.yyww;vec4 fx=Pf.xzxz;vec4 fy=Pf.yyww;vec4 i=permute(permute(ix)+iy);vec4 gx=fract(i*(1.0/41.0))*2.0-1.0;vec4 gy=abs(gx)-0.5;vec4 tx=floor(gx+0.5);gx=gx-tx;vec2 g00=vec2(gx.x,gy.x);vec2 g10=vec2(gx.y,gy.y);vec2 g01=vec2(gx.z,gy.z);vec2 g11=vec2(gx.w,gy.w);vec4 norm=taylorInvSqrt(vec4(dot(g00,g00),dot(g01,g01),dot(g10,g10),dot(g11,g11)));g00*=norm.x;g01*=norm.y;g10*=norm.z;g11*=norm.w;float n00=dot(g00,vec2(fx.x,fy.x));float n10=dot(g10,vec2(fx.y,fy.y));float n01=dot(g01,vec2(fx.z,fy.z));float n11=dot(g11,vec2(fx.w,fy.w));vec2 fade_xy=fade(Pf.xy);vec2 n_x=mix(vec2(n00,n01),vec2(n10,n11),fade_xy.x);float n_xy=mix(n_x.x,n_x.y,fade_xy.y);return 2.3*n_xy;}float perlin(vec2 P,vec2 rep){vec4 Pi=floor(P.xyxy)+vec4(0.0,0.0,1.0,1.0);vec4 Pf=fract(P.xyxy)-vec4(0.0,0.0,1.0,1.0);Pi=mod(Pi,rep.xyxy);Pi=mod289(Pi);vec4 ix=Pi.xzxz;vec4 iy=Pi.yyww;vec4 fx=Pf.xzxz;vec4 fy=Pf.yyww;vec4 i=permute(permute(ix)+iy);vec4 gx=fract(i*(1.0/41.0))*2.0-1.0;vec4 gy=abs(gx)-0.5;vec4 tx=floor(gx+0.5);gx=gx-tx;vec2 g00=vec2(gx.x,gy.x);vec2 g10=vec2(gx.y,gy.y);vec2 g01=vec2(gx.z,gy.z);vec2 g11=vec2(gx.w,gy.w);vec4 norm=taylorInvSqrt(vec4(dot(g00,g00),dot(g01,g01),dot(g10,g10),dot(g11,g11)));g00*=norm.x;g01*=norm.y;g10*=norm.z;g11*=norm.w;float n00=dot(g00,vec2(fx.x,fy.x));float n10=dot(g10,vec2(fx.y,fy.y));float n01=dot(g01,vec2(fx.z,fy.z));float n11=dot(g11,vec2(fx.w,fy.w));vec2 fade_xy=fade(Pf.xy);vec2 n_x=mix(vec2(n00,n01),vec2(n10,n11),fade_xy.x);float n_xy=mix(n_x.x,n_x.y,fade_xy.y);return 2.3*n_xy;}`,Yx=`#define GLSLIFY 1
float perlin(vec3 P){vec3 Pi0=floor(P);vec3 Pi1=Pi0+vec3(1.0);Pi0=mod289(Pi0);Pi1=mod289(Pi1);vec3 Pf0=fract(P);vec3 Pf1=Pf0-vec3(1.0);vec4 ix=vec4(Pi0.x,Pi1.x,Pi0.x,Pi1.x);vec4 iy=vec4(Pi0.yy,Pi1.yy);vec4 iz0=Pi0.zzzz;vec4 iz1=Pi1.zzzz;vec4 ixy=permute(permute(ix)+iy);vec4 ixy0=permute(ixy+iz0);vec4 ixy1=permute(ixy+iz1);vec4 gx0=ixy0*(1.0/7.0);vec4 gy0=fract(floor(gx0)*(1.0/7.0))-0.5;gx0=fract(gx0);vec4 gz0=vec4(0.5)-abs(gx0)-abs(gy0);vec4 sz0=step(gz0,vec4(0.0));gx0-=sz0*(step(0.0,gx0)-0.5);gy0-=sz0*(step(0.0,gy0)-0.5);vec4 gx1=ixy1*(1.0/7.0);vec4 gy1=fract(floor(gx1)*(1.0/7.0))-0.5;gx1=fract(gx1);vec4 gz1=vec4(0.5)-abs(gx1)-abs(gy1);vec4 sz1=step(gz1,vec4(0.0));gx1-=sz1*(step(0.0,gx1)-0.5);gy1-=sz1*(step(0.0,gy1)-0.5);vec3 g000=vec3(gx0.x,gy0.x,gz0.x);vec3 g100=vec3(gx0.y,gy0.y,gz0.y);vec3 g010=vec3(gx0.z,gy0.z,gz0.z);vec3 g110=vec3(gx0.w,gy0.w,gz0.w);vec3 g001=vec3(gx1.x,gy1.x,gz1.x);vec3 g101=vec3(gx1.y,gy1.y,gz1.y);vec3 g011=vec3(gx1.z,gy1.z,gz1.z);vec3 g111=vec3(gx1.w,gy1.w,gz1.w);vec4 norm0=taylorInvSqrt(vec4(dot(g000,g000),dot(g010,g010),dot(g100,g100),dot(g110,g110)));g000*=norm0.x;g010*=norm0.y;g100*=norm0.z;g110*=norm0.w;vec4 norm1=taylorInvSqrt(vec4(dot(g001,g001),dot(g011,g011),dot(g101,g101),dot(g111,g111)));g001*=norm1.x;g011*=norm1.y;g101*=norm1.z;g111*=norm1.w;float n000=dot(g000,Pf0);float n100=dot(g100,vec3(Pf1.x,Pf0.yz));float n010=dot(g010,vec3(Pf0.x,Pf1.y,Pf0.z));float n110=dot(g110,vec3(Pf1.xy,Pf0.z));float n001=dot(g001,vec3(Pf0.xy,Pf1.z));float n101=dot(g101,vec3(Pf1.x,Pf0.y,Pf1.z));float n011=dot(g011,vec3(Pf0.x,Pf1.yz));float n111=dot(g111,Pf1);vec3 fade_xyz=fade(Pf0);vec4 n_z=mix(vec4(n000,n100,n010,n110),vec4(n001,n101,n011,n111),fade_xyz.z);vec2 n_yz=mix(n_z.xy,n_z.zw,fade_xyz.y);float n_xyz=mix(n_yz.x,n_yz.y,fade_xyz.x);return 2.2*n_xyz;}float perlin(vec3 P,vec3 rep){vec3 Pi0=mod(floor(P),rep);vec3 Pi1=mod(Pi0+vec3(1.0),rep);Pi0=mod289(Pi0);Pi1=mod289(Pi1);vec3 Pf0=fract(P);vec3 Pf1=Pf0-vec3(1.0);vec4 ix=vec4(Pi0.x,Pi1.x,Pi0.x,Pi1.x);vec4 iy=vec4(Pi0.yy,Pi1.yy);vec4 iz0=Pi0.zzzz;vec4 iz1=Pi1.zzzz;vec4 ixy=permute(permute(ix)+iy);vec4 ixy0=permute(ixy+iz0);vec4 ixy1=permute(ixy+iz1);vec4 gx0=ixy0*(1.0/7.0);vec4 gy0=fract(floor(gx0)*(1.0/7.0))-0.5;gx0=fract(gx0);vec4 gz0=vec4(0.5)-abs(gx0)-abs(gy0);vec4 sz0=step(gz0,vec4(0.0));gx0-=sz0*(step(0.0,gx0)-0.5);gy0-=sz0*(step(0.0,gy0)-0.5);vec4 gx1=ixy1*(1.0/7.0);vec4 gy1=fract(floor(gx1)*(1.0/7.0))-0.5;gx1=fract(gx1);vec4 gz1=vec4(0.5)-abs(gx1)-abs(gy1);vec4 sz1=step(gz1,vec4(0.0));gx1-=sz1*(step(0.0,gx1)-0.5);gy1-=sz1*(step(0.0,gy1)-0.5);vec3 g000=vec3(gx0.x,gy0.x,gz0.x);vec3 g100=vec3(gx0.y,gy0.y,gz0.y);vec3 g010=vec3(gx0.z,gy0.z,gz0.z);vec3 g110=vec3(gx0.w,gy0.w,gz0.w);vec3 g001=vec3(gx1.x,gy1.x,gz1.x);vec3 g101=vec3(gx1.y,gy1.y,gz1.y);vec3 g011=vec3(gx1.z,gy1.z,gz1.z);vec3 g111=vec3(gx1.w,gy1.w,gz1.w);vec4 norm0=taylorInvSqrt(vec4(dot(g000,g000),dot(g010,g010),dot(g100,g100),dot(g110,g110)));g000*=norm0.x;g010*=norm0.y;g100*=norm0.z;g110*=norm0.w;vec4 norm1=taylorInvSqrt(vec4(dot(g001,g001),dot(g011,g011),dot(g101,g101),dot(g111,g111)));g001*=norm1.x;g011*=norm1.y;g101*=norm1.z;g111*=norm1.w;float n000=dot(g000,Pf0);float n100=dot(g100,vec3(Pf1.x,Pf0.yz));float n010=dot(g010,vec3(Pf0.x,Pf1.y,Pf0.z));float n110=dot(g110,vec3(Pf1.xy,Pf0.z));float n001=dot(g001,vec3(Pf0.xy,Pf1.z));float n101=dot(g101,vec3(Pf1.x,Pf0.y,Pf1.z));float n011=dot(g011,vec3(Pf0.x,Pf1.yz));float n111=dot(g111,Pf1);vec3 fade_xyz=fade(Pf0);vec4 n_z=mix(vec4(n000,n100,n010,n110),vec4(n001,n101,n011,n111),fade_xyz.z);vec2 n_yz=mix(n_z.xy,n_z.zw,fade_xyz.y);float n_xyz=mix(n_yz.x,n_yz.y,fade_xyz.x);return 2.2*n_xyz;}`,qx=`#define GLSLIFY 1
float perlin(vec4 P){vec4 Pi0=floor(P);vec4 Pi1=Pi0+1.0;Pi0=mod289(Pi0);Pi1=mod289(Pi1);vec4 Pf0=fract(P);vec4 Pf1=Pf0-1.0;vec4 ix=vec4(Pi0.x,Pi1.x,Pi0.x,Pi1.x);vec4 iy=vec4(Pi0.yy,Pi1.yy);vec4 iz0=vec4(Pi0.zzzz);vec4 iz1=vec4(Pi1.zzzz);vec4 iw0=vec4(Pi0.wwww);vec4 iw1=vec4(Pi1.wwww);vec4 ixy=permute(permute(ix)+iy);vec4 ixy0=permute(ixy+iz0);vec4 ixy1=permute(ixy+iz1);vec4 ixy00=permute(ixy0+iw0);vec4 ixy01=permute(ixy0+iw1);vec4 ixy10=permute(ixy1+iw0);vec4 ixy11=permute(ixy1+iw1);vec4 gx00=ixy00*(1.0/7.0);vec4 gy00=floor(gx00)*(1.0/7.0);vec4 gz00=floor(gy00)*(1.0/6.0);gx00=fract(gx00)-0.5;gy00=fract(gy00)-0.5;gz00=fract(gz00)-0.5;vec4 gw00=vec4(0.75)-abs(gx00)-abs(gy00)-abs(gz00);vec4 sw00=step(gw00,vec4(0.0));gx00-=sw00*(step(0.0,gx00)-0.5);gy00-=sw00*(step(0.0,gy00)-0.5);vec4 gx01=ixy01*(1.0/7.0);vec4 gy01=floor(gx01)*(1.0/7.0);vec4 gz01=floor(gy01)*(1.0/6.0);gx01=fract(gx01)-0.5;gy01=fract(gy01)-0.5;gz01=fract(gz01)-0.5;vec4 gw01=vec4(0.75)-abs(gx01)-abs(gy01)-abs(gz01);vec4 sw01=step(gw01,vec4(0.0));gx01-=sw01*(step(0.0,gx01)-0.5);gy01-=sw01*(step(0.0,gy01)-0.5);vec4 gx10=ixy10*(1.0/7.0);vec4 gy10=floor(gx10)*(1.0/7.0);vec4 gz10=floor(gy10)*(1.0/6.0);gx10=fract(gx10)-0.5;gy10=fract(gy10)-0.5;gz10=fract(gz10)-0.5;vec4 gw10=vec4(0.75)-abs(gx10)-abs(gy10)-abs(gz10);vec4 sw10=step(gw10,vec4(0.0));gx10-=sw10*(step(0.0,gx10)-0.5);gy10-=sw10*(step(0.0,gy10)-0.5);vec4 gx11=ixy11*(1.0/7.0);vec4 gy11=floor(gx11)*(1.0/7.0);vec4 gz11=floor(gy11)*(1.0/6.0);gx11=fract(gx11)-0.5;gy11=fract(gy11)-0.5;gz11=fract(gz11)-0.5;vec4 gw11=vec4(0.75)-abs(gx11)-abs(gy11)-abs(gz11);vec4 sw11=step(gw11,vec4(0.0));gx11-=sw11*(step(0.0,gx11)-0.5);gy11-=sw11*(step(0.0,gy11)-0.5);vec4 g0000=vec4(gx00.x,gy00.x,gz00.x,gw00.x);vec4 g1000=vec4(gx00.y,gy00.y,gz00.y,gw00.y);vec4 g0100=vec4(gx00.z,gy00.z,gz00.z,gw00.z);vec4 g1100=vec4(gx00.w,gy00.w,gz00.w,gw00.w);vec4 g0010=vec4(gx10.x,gy10.x,gz10.x,gw10.x);vec4 g1010=vec4(gx10.y,gy10.y,gz10.y,gw10.y);vec4 g0110=vec4(gx10.z,gy10.z,gz10.z,gw10.z);vec4 g1110=vec4(gx10.w,gy10.w,gz10.w,gw10.w);vec4 g0001=vec4(gx01.x,gy01.x,gz01.x,gw01.x);vec4 g1001=vec4(gx01.y,gy01.y,gz01.y,gw01.y);vec4 g0101=vec4(gx01.z,gy01.z,gz01.z,gw01.z);vec4 g1101=vec4(gx01.w,gy01.w,gz01.w,gw01.w);vec4 g0011=vec4(gx11.x,gy11.x,gz11.x,gw11.x);vec4 g1011=vec4(gx11.y,gy11.y,gz11.y,gw11.y);vec4 g0111=vec4(gx11.z,gy11.z,gz11.z,gw11.z);vec4 g1111=vec4(gx11.w,gy11.w,gz11.w,gw11.w);vec4 norm00=taylorInvSqrt(vec4(dot(g0000,g0000),dot(g0100,g0100),dot(g1000,g1000),dot(g1100,g1100)));g0000*=norm00.x;g0100*=norm00.y;g1000*=norm00.z;g1100*=norm00.w;vec4 norm01=taylorInvSqrt(vec4(dot(g0001,g0001),dot(g0101,g0101),dot(g1001,g1001),dot(g1101,g1101)));g0001*=norm01.x;g0101*=norm01.y;g1001*=norm01.z;g1101*=norm01.w;vec4 norm10=taylorInvSqrt(vec4(dot(g0010,g0010),dot(g0110,g0110),dot(g1010,g1010),dot(g1110,g1110)));g0010*=norm10.x;g0110*=norm10.y;g1010*=norm10.z;g1110*=norm10.w;vec4 norm11=taylorInvSqrt(vec4(dot(g0011,g0011),dot(g0111,g0111),dot(g1011,g1011),dot(g1111,g1111)));g0011*=norm11.x;g0111*=norm11.y;g1011*=norm11.z;g1111*=norm11.w;float n0000=dot(g0000,Pf0);float n1000=dot(g1000,vec4(Pf1.x,Pf0.yzw));float n0100=dot(g0100,vec4(Pf0.x,Pf1.y,Pf0.zw));float n1100=dot(g1100,vec4(Pf1.xy,Pf0.zw));float n0010=dot(g0010,vec4(Pf0.xy,Pf1.z,Pf0.w));float n1010=dot(g1010,vec4(Pf1.x,Pf0.y,Pf1.z,Pf0.w));float n0110=dot(g0110,vec4(Pf0.x,Pf1.yz,Pf0.w));float n1110=dot(g1110,vec4(Pf1.xyz,Pf0.w));float n0001=dot(g0001,vec4(Pf0.xyz,Pf1.w));float n1001=dot(g1001,vec4(Pf1.x,Pf0.yz,Pf1.w));float n0101=dot(g0101,vec4(Pf0.x,Pf1.y,Pf0.z,Pf1.w));float n1101=dot(g1101,vec4(Pf1.xy,Pf0.z,Pf1.w));float n0011=dot(g0011,vec4(Pf0.xy,Pf1.zw));float n1011=dot(g1011,vec4(Pf1.x,Pf0.y,Pf1.zw));float n0111=dot(g0111,vec4(Pf0.x,Pf1.yzw));float n1111=dot(g1111,Pf1);vec4 fade_xyzw=fade(Pf0);vec4 n_0w=mix(vec4(n0000,n1000,n0100,n1100),vec4(n0001,n1001,n0101,n1101),fade_xyzw.w);vec4 n_1w=mix(vec4(n0010,n1010,n0110,n1110),vec4(n0011,n1011,n0111,n1111),fade_xyzw.w);vec4 n_zw=mix(n_0w,n_1w,fade_xyzw.z);vec2 n_yzw=mix(n_zw.xy,n_zw.zw,fade_xyzw.y);float n_xyzw=mix(n_yzw.x,n_yzw.y,fade_xyzw.x);return 2.2*n_xyzw;}float perlin(vec4 P,vec4 rep){vec4 Pi0=mod(floor(P),rep);vec4 Pi1=mod(Pi0+1.0,rep);Pi0=mod289(Pi0);Pi1=mod289(Pi1);vec4 Pf0=fract(P);vec4 Pf1=Pf0-1.0;vec4 ix=vec4(Pi0.x,Pi1.x,Pi0.x,Pi1.x);vec4 iy=vec4(Pi0.yy,Pi1.yy);vec4 iz0=vec4(Pi0.zzzz);vec4 iz1=vec4(Pi1.zzzz);vec4 iw0=vec4(Pi0.wwww);vec4 iw1=vec4(Pi1.wwww);vec4 ixy=permute(permute(ix)+iy);vec4 ixy0=permute(ixy+iz0);vec4 ixy1=permute(ixy+iz1);vec4 ixy00=permute(ixy0+iw0);vec4 ixy01=permute(ixy0+iw1);vec4 ixy10=permute(ixy1+iw0);vec4 ixy11=permute(ixy1+iw1);vec4 gx00=ixy00*(1.0/7.0);vec4 gy00=floor(gx00)*(1.0/7.0);vec4 gz00=floor(gy00)*(1.0/6.0);gx00=fract(gx00)-0.5;gy00=fract(gy00)-0.5;gz00=fract(gz00)-0.5;vec4 gw00=vec4(0.75)-abs(gx00)-abs(gy00)-abs(gz00);vec4 sw00=step(gw00,vec4(0.0));gx00-=sw00*(step(0.0,gx00)-0.5);gy00-=sw00*(step(0.0,gy00)-0.5);vec4 gx01=ixy01*(1.0/7.0);vec4 gy01=floor(gx01)*(1.0/7.0);vec4 gz01=floor(gy01)*(1.0/6.0);gx01=fract(gx01)-0.5;gy01=fract(gy01)-0.5;gz01=fract(gz01)-0.5;vec4 gw01=vec4(0.75)-abs(gx01)-abs(gy01)-abs(gz01);vec4 sw01=step(gw01,vec4(0.0));gx01-=sw01*(step(0.0,gx01)-0.5);gy01-=sw01*(step(0.0,gy01)-0.5);vec4 gx10=ixy10*(1.0/7.0);vec4 gy10=floor(gx10)*(1.0/7.0);vec4 gz10=floor(gy10)*(1.0/6.0);gx10=fract(gx10)-0.5;gy10=fract(gy10)-0.5;gz10=fract(gz10)-0.5;vec4 gw10=vec4(0.75)-abs(gx10)-abs(gy10)-abs(gz10);vec4 sw10=step(gw10,vec4(0.0));gx10-=sw10*(step(0.0,gx10)-0.5);gy10-=sw10*(step(0.0,gy10)-0.5);vec4 gx11=ixy11*(1.0/7.0);vec4 gy11=floor(gx11)*(1.0/7.0);vec4 gz11=floor(gy11)*(1.0/6.0);gx11=fract(gx11)-0.5;gy11=fract(gy11)-0.5;gz11=fract(gz11)-0.5;vec4 gw11=vec4(0.75)-abs(gx11)-abs(gy11)-abs(gz11);vec4 sw11=step(gw11,vec4(0.0));gx11-=sw11*(step(0.0,gx11)-0.5);gy11-=sw11*(step(0.0,gy11)-0.5);vec4 g0000=vec4(gx00.x,gy00.x,gz00.x,gw00.x);vec4 g1000=vec4(gx00.y,gy00.y,gz00.y,gw00.y);vec4 g0100=vec4(gx00.z,gy00.z,gz00.z,gw00.z);vec4 g1100=vec4(gx00.w,gy00.w,gz00.w,gw00.w);vec4 g0010=vec4(gx10.x,gy10.x,gz10.x,gw10.x);vec4 g1010=vec4(gx10.y,gy10.y,gz10.y,gw10.y);vec4 g0110=vec4(gx10.z,gy10.z,gz10.z,gw10.z);vec4 g1110=vec4(gx10.w,gy10.w,gz10.w,gw10.w);vec4 g0001=vec4(gx01.x,gy01.x,gz01.x,gw01.x);vec4 g1001=vec4(gx01.y,gy01.y,gz01.y,gw01.y);vec4 g0101=vec4(gx01.z,gy01.z,gz01.z,gw01.z);vec4 g1101=vec4(gx01.w,gy01.w,gz01.w,gw01.w);vec4 g0011=vec4(gx11.x,gy11.x,gz11.x,gw11.x);vec4 g1011=vec4(gx11.y,gy11.y,gz11.y,gw11.y);vec4 g0111=vec4(gx11.z,gy11.z,gz11.z,gw11.z);vec4 g1111=vec4(gx11.w,gy11.w,gz11.w,gw11.w);vec4 norm00=taylorInvSqrt(vec4(dot(g0000,g0000),dot(g0100,g0100),dot(g1000,g1000),dot(g1100,g1100)));g0000*=norm00.x;g0100*=norm00.y;g1000*=norm00.z;g1100*=norm00.w;vec4 norm01=taylorInvSqrt(vec4(dot(g0001,g0001),dot(g0101,g0101),dot(g1001,g1001),dot(g1101,g1101)));g0001*=norm01.x;g0101*=norm01.y;g1001*=norm01.z;g1101*=norm01.w;vec4 norm10=taylorInvSqrt(vec4(dot(g0010,g0010),dot(g0110,g0110),dot(g1010,g1010),dot(g1110,g1110)));g0010*=norm10.x;g0110*=norm10.y;g1010*=norm10.z;g1110*=norm10.w;vec4 norm11=taylorInvSqrt(vec4(dot(g0011,g0011),dot(g0111,g0111),dot(g1011,g1011),dot(g1111,g1111)));g0011*=norm11.x;g0111*=norm11.y;g1011*=norm11.z;g1111*=norm11.w;float n0000=dot(g0000,Pf0);float n1000=dot(g1000,vec4(Pf1.x,Pf0.yzw));float n0100=dot(g0100,vec4(Pf0.x,Pf1.y,Pf0.zw));float n1100=dot(g1100,vec4(Pf1.xy,Pf0.zw));float n0010=dot(g0010,vec4(Pf0.xy,Pf1.z,Pf0.w));float n1010=dot(g1010,vec4(Pf1.x,Pf0.y,Pf1.z,Pf0.w));float n0110=dot(g0110,vec4(Pf0.x,Pf1.yz,Pf0.w));float n1110=dot(g1110,vec4(Pf1.xyz,Pf0.w));float n0001=dot(g0001,vec4(Pf0.xyz,Pf1.w));float n1001=dot(g1001,vec4(Pf1.x,Pf0.yz,Pf1.w));float n0101=dot(g0101,vec4(Pf0.x,Pf1.y,Pf0.z,Pf1.w));float n1101=dot(g1101,vec4(Pf1.xy,Pf0.z,Pf1.w));float n0011=dot(g0011,vec4(Pf0.xy,Pf1.zw));float n1011=dot(g1011,vec4(Pf1.x,Pf0.y,Pf1.zw));float n0111=dot(g0111,vec4(Pf0.x,Pf1.yzw));float n1111=dot(g1111,Pf1);vec4 fade_xyzw=fade(Pf0);vec4 n_0w=mix(vec4(n0000,n1000,n0100,n1100),vec4(n0001,n1001,n0101,n1101),fade_xyzw.w);vec4 n_1w=mix(vec4(n0010,n1010,n0110,n1110),vec4(n0011,n1011,n0111,n1111),fade_xyzw.w);vec4 n_zw=mix(n_0w,n_1w,fade_xyzw.z);vec2 n_yzw=mix(n_zw.xy,n_zw.zw,fade_xyzw.y);float n_xyzw=mix(n_yzw.x,n_yzw.y,fade_xyzw.x);return 2.2*n_xyzw;}`,Qx=`#define GLSLIFY 1
vec2 rgrad2(vec2 p,float rot){float u=permute(permute(p.x)+p.y)*0.0243902439+rot;u=fract(u)*6.28318530718;return vec2(cos(u),sin(u));}vec3 psrdnoise(vec2 pos,vec2 per,float rot){pos.y+=0.01;vec2 uv=vec2(pos.x+pos.y*0.5,pos.y);vec2 i0=floor(uv);vec2 f0=fract(uv);vec2 i1=(f0.x>f0.y)? vec2(1.0,0.0): vec2(0.0,1.0);vec2 p0=vec2(i0.x-i0.y*0.5,i0.y);vec2 p1=vec2(p0.x+i1.x-i1.y*0.5,p0.y+i1.y);vec2 p2=vec2(p0.x+0.5,p0.y+1.0);i1=i0+i1;vec2 i2=i0+vec2(1.0,1.0);vec2 d0=pos-p0;vec2 d1=pos-p1;vec2 d2=pos-p2;vec3 xw=mod(vec3(p0.x,p1.x,p2.x),per.x);vec3 yw=mod(vec3(p0.y,p1.y,p2.y),per.y);vec3 iuw=xw+0.5*yw;vec3 ivw=yw;vec2 g0=rgrad2(vec2(iuw.x,ivw.x),rot);vec2 g1=rgrad2(vec2(iuw.y,ivw.y),rot);vec2 g2=rgrad2(vec2(iuw.z,ivw.z),rot);vec3 w=vec3(dot(g0,d0),dot(g1,d1),dot(g2,d2));vec3 t=0.8-vec3(dot(d0,d0),dot(d1,d1),dot(d2,d2));vec3 dtdx=-2.0*vec3(d0.x,d1.x,d2.x);vec3 dtdy=-2.0*vec3(d0.y,d1.y,d2.y);if(t.x<0.0){dtdx.x=0.0;dtdy.x=0.0;t.x=0.0;}if(t.y<0.0){dtdx.y=0.0;dtdy.y=0.0;t.y=0.0;}if(t.z<0.0){dtdx.z=0.0;dtdy.z=0.0;t.z=0.0;}vec3 t2=t*t;vec3 t4=t2*t2;vec3 t3=t2*t;float n=dot(t4,w);vec2 dt0=vec2(dtdx.x,dtdy.x)*4.0*t3.x;vec2 dn0=t4.x*g0+dt0*w.x;vec2 dt1=vec2(dtdx.y,dtdy.y)*4.0*t3.y;vec2 dn1=t4.y*g1+dt1*w.y;vec2 dt2=vec2(dtdx.z,dtdy.z)*4.0*t3.z;vec2 dn2=t4.z*g2+dt2*w.z;return 11.0*vec3(n,dn0+dn1+dn2);}vec3 psdnoise(vec2 pos,vec2 per){return psrdnoise(pos,per,0.0);}float psrnoise(vec2 pos,vec2 per,float rot){pos.y+=0.001;vec2 uv=vec2(pos.x+pos.y*0.5,pos.y);vec2 i0=floor(uv);vec2 f0=fract(uv);vec2 i1=(f0.x>f0.y)? vec2(1.0,0.0): vec2(0.0,1.0);vec2 p0=vec2(i0.x-i0.y*0.5,i0.y);vec2 p1=vec2(p0.x+i1.x-i1.y*0.5,p0.y+i1.y);vec2 p2=vec2(p0.x+0.5,p0.y+1.0);i1=i0+i1;vec2 i2=i0+vec2(1.0,1.0);vec2 d0=pos-p0;vec2 d1=pos-p1;vec2 d2=pos-p2;vec3 xw=mod(vec3(p0.x,p1.x,p2.x),per.x);vec3 yw=mod(vec3(p0.y,p1.y,p2.y),per.y);vec3 iuw=xw+0.5*yw;vec3 ivw=yw;vec2 g0=rgrad2(vec2(iuw.x,ivw.x),rot);vec2 g1=rgrad2(vec2(iuw.y,ivw.y),rot);vec2 g2=rgrad2(vec2(iuw.z,ivw.z),rot);vec3 w=vec3(dot(g0,d0),dot(g1,d1),dot(g2,d2));vec3 t=0.8-vec3(dot(d0,d0),dot(d1,d1),dot(d2,d2));t=max(t,0.0);vec3 t2=t*t;vec3 t4=t2*t2;float n=dot(t4,w);return 11.0*n;}float psnoise(vec2 pos,vec2 per){return psrnoise(pos,per,0.0);}vec3 srdnoise(vec2 pos,float rot){pos.y+=0.001;vec2 uv=vec2(pos.x+pos.y*0.5,pos.y);vec2 i0=floor(uv);vec2 f0=fract(uv);vec2 i1=(f0.x>f0.y)? vec2(1.0,0.0): vec2(0.0,1.0);vec2 p0=vec2(i0.x-i0.y*0.5,i0.y);vec2 p1=vec2(p0.x+i1.x-i1.y*0.5,p0.y+i1.y);vec2 p2=vec2(p0.x+0.5,p0.y+1.0);i1=i0+i1;vec2 i2=i0+vec2(1.0,1.0);vec2 d0=pos-p0;vec2 d1=pos-p1;vec2 d2=pos-p2;vec3 x=vec3(p0.x,p1.x,p2.x);vec3 y=vec3(p0.y,p1.y,p2.y);vec3 iuw=x+0.5*y;vec3 ivw=y;iuw=mod289(iuw);ivw=mod289(ivw);vec2 g0=rgrad2(vec2(iuw.x,ivw.x),rot);vec2 g1=rgrad2(vec2(iuw.y,ivw.y),rot);vec2 g2=rgrad2(vec2(iuw.z,ivw.z),rot);vec3 w=vec3(dot(g0,d0),dot(g1,d1),dot(g2,d2));vec3 t=0.8-vec3(dot(d0,d0),dot(d1,d1),dot(d2,d2));vec3 dtdx=-2.0*vec3(d0.x,d1.x,d2.x);vec3 dtdy=-2.0*vec3(d0.y,d1.y,d2.y);if(t.x<0.0){dtdx.x=0.0;dtdy.x=0.0;t.x=0.0;}if(t.y<0.0){dtdx.y=0.0;dtdy.y=0.0;t.y=0.0;}if(t.z<0.0){dtdx.z=0.0;dtdy.z=0.0;t.z=0.0;}vec3 t2=t*t;vec3 t4=t2*t2;vec3 t3=t2*t;float n=dot(t4,w);vec2 dt0=vec2(dtdx.x,dtdy.x)*4.0*t3.x;vec2 dn0=t4.x*g0+dt0*w.x;vec2 dt1=vec2(dtdx.y,dtdy.y)*4.0*t3.y;vec2 dn1=t4.y*g1+dt1*w.y;vec2 dt2=vec2(dtdx.z,dtdy.z)*4.0*t3.z;vec2 dn2=t4.z*g2+dt2*w.z;return 11.0*vec3(n,dn0+dn1+dn2);}vec3 sdnoise(vec2 pos){return srdnoise(pos,0.0);}float srnoise(vec2 pos,float rot){pos.y+=0.001;vec2 uv=vec2(pos.x+pos.y*0.5,pos.y);vec2 i0=floor(uv);vec2 f0=fract(uv);vec2 i1=(f0.x>f0.y)? vec2(1.0,0.0): vec2(0.0,1.0);vec2 p0=vec2(i0.x-i0.y*0.5,i0.y);vec2 p1=vec2(p0.x+i1.x-i1.y*0.5,p0.y+i1.y);vec2 p2=vec2(p0.x+0.5,p0.y+1.0);i1=i0+i1;vec2 i2=i0+vec2(1.0,1.0);vec2 d0=pos-p0;vec2 d1=pos-p1;vec2 d2=pos-p2;vec3 x=vec3(p0.x,p1.x,p2.x);vec3 y=vec3(p0.y,p1.y,p2.y);vec3 iuw=x+0.5*y;vec3 ivw=y;iuw=mod289(iuw);ivw=mod289(ivw);vec2 g0=rgrad2(vec2(iuw.x,ivw.x),rot);vec2 g1=rgrad2(vec2(iuw.y,ivw.y),rot);vec2 g2=rgrad2(vec2(iuw.z,ivw.z),rot);vec3 w=vec3(dot(g0,d0),dot(g1,d1),dot(g2,d2));vec3 t=0.8-vec3(dot(d0,d0),dot(d1,d1),dot(d2,d2));t=max(t,0.0);vec3 t2=t*t;vec3 t4=t2*t2;float n=dot(t4,w);return 11.0*n;}float snoise(vec2 pos){return srnoise(pos,0.0);}`,$x=`#define GLSLIFY 1
#include <noise_simplex_2D>
#include <noise_simplex_3D>
#include <noise_simplex_3D_grad>
#include <noise_simplex_4D>
`,Kx=`#define GLSLIFY 1
float simplex(vec2 v){const vec4 C=vec4(0.211324865405187,0.366025403784439,-0.577350269189626,0.024390243902439);vec2 i=floor(v+dot(v,C.yy));vec2 x0=v-i+dot(i,C.xx);vec2 i1;i1=(x0.x>x0.y)? vec2(1.0,0.0): vec2(0.0,1.0);vec4 x12=x0.xyxy+C.xxzz;x12.xy-=i1;i=mod289(i);vec3 p=permute(permute(i.y+vec3(0.0,i1.y,1.0))+i.x+vec3(0.0,i1.x,1.0));vec3 m=max(0.5-vec3(dot(x0,x0),dot(x12.xy,x12.xy),dot(x12.zw,x12.zw)),0.0);m=m*m;m=m*m;vec3 x=2.0*fract(p*C.www)-1.0;vec3 h=abs(x)-0.5;vec3 ox=floor(x+0.5);vec3 a0=x-ox;m*=1.79284291400159-0.85373472095314*(a0*a0+h*h);vec3 g;g.x=a0.x*x0.x+h.x*x0.y;g.yz=a0.yz*x12.xz+h.yz*x12.yw;return 130.0*dot(m,g);}`,Jx=`#define GLSLIFY 1
float simplex(vec3 v){const vec2 C=vec2(1.0/6.0,1.0/3.0);const vec4 D=vec4(0.0,0.5,1.0,2.0);vec3 i=floor(v+dot(v,C.yyy));vec3 x0=v-i+dot(i,C.xxx);vec3 g=step(x0.yzx,x0.xyz);vec3 l=1.0-g;vec3 i1=min(g.xyz,l.zxy);vec3 i2=max(g.xyz,l.zxy);vec3 x1=x0-i1+C.xxx;vec3 x2=x0-i2+C.yyy;vec3 x3=x0-D.yyy;i=mod289(i);vec4 p=permute(permute(permute(i.z+vec4(0.0,i1.z,i2.z,1.0))+i.y+vec4(0.0,i1.y,i2.y,1.0))+i.x+vec4(0.0,i1.x,i2.x,1.0));float n_=0.142857142857;vec3 ns=n_*D.wyz-D.xzx;vec4 j=p-49.0*floor(p*ns.z*ns.z);vec4 x_=floor(j*ns.z);vec4 y_=floor(j-7.0*x_);vec4 x=x_*ns.x+ns.yyyy;vec4 y=y_*ns.x+ns.yyyy;vec4 h=1.0-abs(x)-abs(y);vec4 b0=vec4(x.xy,y.xy);vec4 b1=vec4(x.zw,y.zw);vec4 s0=floor(b0)*2.0+1.0;vec4 s1=floor(b1)*2.0+1.0;vec4 sh=-step(h,vec4(0.0));vec4 a0=b0.xzyw+s0.xzyw*sh.xxyy;vec4 a1=b1.xzyw+s1.xzyw*sh.zzww;vec3 p0=vec3(a0.xy,h.x);vec3 p1=vec3(a0.zw,h.y);vec3 p2=vec3(a1.xy,h.z);vec3 p3=vec3(a1.zw,h.w);vec4 norm=taylorInvSqrt(vec4(dot(p0,p0),dot(p1,p1),dot(p2,p2),dot(p3,p3)));p0*=norm.x;p1*=norm.y;p2*=norm.z;p3*=norm.w;vec4 m=max(0.6-vec4(dot(x0,x0),dot(x1,x1),dot(x2,x2),dot(x3,x3)),0.0);m=m*m;return 42.0*dot(m*m,vec4(dot(p0,x0),dot(p1,x1),dot(p2,x2),dot(p3,x3)));}`,Zx=`#define GLSLIFY 1
float simplex(vec3 v,out vec3 gradient){const vec2 C=vec2(1.0/6.0,1.0/3.0);const vec4 D=vec4(0.0,0.5,1.0,2.0);vec3 i=floor(v+dot(v,C.yyy));vec3 x0=v-i+dot(i,C.xxx);vec3 g=step(x0.yzx,x0.xyz);vec3 l=1.0-g;vec3 i1=min(g.xyz,l.zxy);vec3 i2=max(g.xyz,l.zxy);vec3 x1=x0-i1+C.xxx;vec3 x2=x0-i2+C.yyy;vec3 x3=x0-D.yyy;i=mod289(i);vec4 p=permute(permute(permute(i.z+vec4(0.0,i1.z,i2.z,1.0))+i.y+vec4(0.0,i1.y,i2.y,1.0))+i.x+vec4(0.0,i1.x,i2.x,1.0));float n_=0.142857142857;vec3 ns=n_*D.wyz-D.xzx;vec4 j=p-49.0*floor(p*ns.z*ns.z);vec4 x_=floor(j*ns.z);vec4 y_=floor(j-7.0*x_);vec4 x=x_*ns.x+ns.yyyy;vec4 y=y_*ns.x+ns.yyyy;vec4 h=1.0-abs(x)-abs(y);vec4 b0=vec4(x.xy,y.xy);vec4 b1=vec4(x.zw,y.zw);vec4 s0=floor(b0)*2.0+1.0;vec4 s1=floor(b1)*2.0+1.0;vec4 sh=-step(h,vec4(0.0));vec4 a0=b0.xzyw+s0.xzyw*sh.xxyy;vec4 a1=b1.xzyw+s1.xzyw*sh.zzww;vec3 p0=vec3(a0.xy,h.x);vec3 p1=vec3(a0.zw,h.y);vec3 p2=vec3(a1.xy,h.z);vec3 p3=vec3(a1.zw,h.w);vec4 norm=taylorInvSqrt(vec4(dot(p0,p0),dot(p1,p1),dot(p2,p2),dot(p3,p3)));p0*=norm.x;p1*=norm.y;p2*=norm.z;p3*=norm.w;vec4 m=max(0.6-vec4(dot(x0,x0),dot(x1,x1),dot(x2,x2),dot(x3,x3)),0.0);vec4 m2=m*m;vec4 m4=m2*m2;vec4 pdotx=vec4(dot(p0,x0),dot(p1,x1),dot(p2,x2),dot(p3,x3));vec4 temp=m2*m*pdotx;gradient=-8.0*(temp.x*x0+temp.y*x1+temp.z*x2+temp.w*x3);gradient+=m4.x*p0+m4.y*p1+m4.z*p2+m4.w*p3;gradient*=42.0;return 42.0*dot(m4,pdotx);}`,ew=`#define GLSLIFY 1
vec4 grad4(float j,vec4 ip){const vec4 ones=vec4(1.0,1.0,1.0,-1.0);vec4 p,s;p.xyz=floor(fract(vec3(j)*ip.xyz)*7.0)*ip.z-1.0;p.w=1.5-dot(abs(p.xyz),ones.xyz);s=vec4(lessThan(p,vec4(0.0)));p.xyz=p.xyz+(s.xyz*2.0-1.0)*s.www;return p;}
#define F4 0.309016994374947451
float simplex(vec4 v){const vec4 C=vec4(0.138196601125011,0.276393202250021,0.414589803375032,-0.447213595499958);vec4 i=floor(v+dot(v,vec4(F4)));vec4 x0=v-i+dot(i,C.xxxx);vec4 i0;vec3 isX=step(x0.yzw,x0.xxx);vec3 isYZ=step(x0.zww,x0.yyz);i0.x=isX.x+isX.y+isX.z;i0.yzw=1.0-isX;i0.y+=isYZ.x+isYZ.y;i0.zw+=1.0-isYZ.xy;i0.z+=isYZ.z;i0.w+=1.0-isYZ.z;vec4 i3=clamp(i0,0.0,1.0);vec4 i2=clamp(i0-1.0,0.0,1.0);vec4 i1=clamp(i0-2.0,0.0,1.0);vec4 x1=x0-i1+C.xxxx;vec4 x2=x0-i2+C.yyyy;vec4 x3=x0-i3+C.zzzz;vec4 x4=x0+C.wwww;i=mod289(i);float j0=permute(permute(permute(permute(i.w)+i.z)+i.y)+i.x);vec4 j1=permute(permute(permute(permute(i.w+vec4(i1.w,i2.w,i3.w,1.0))+i.z+vec4(i1.z,i2.z,i3.z,1.0))+i.y+vec4(i1.y,i2.y,i3.y,1.0))+i.x+vec4(i1.x,i2.x,i3.x,1.0));vec4 ip=vec4(1.0/294.0,1.0/49.0,1.0/7.0,0.0);vec4 p0=grad4(j0,ip);vec4 p1=grad4(j1.x,ip);vec4 p2=grad4(j1.y,ip);vec4 p3=grad4(j1.z,ip);vec4 p4=grad4(j1.w,ip);vec4 norm=taylorInvSqrt(vec4(dot(p0,p0),dot(p1,p1),dot(p2,p2),dot(p3,p3)));p0*=norm.x;p1*=norm.y;p2*=norm.z;p3*=norm.w;p4*=taylorInvSqrt(dot(p4,p4));vec3 m0=max(0.6-vec3(dot(x0,x0),dot(x1,x1),dot(x2,x2)),0.0);vec2 m1=max(0.6-vec2(dot(x3,x3),dot(x4,x4)),0.0);m0=m0*m0;m1=m1*m1;return 49.0*(dot(m0*m0,vec3(dot(p0,x0),dot(p1,x1),dot(p2,x2)))+dot(m1*m1,vec2(dot(p3,x3),dot(p4,x4))));}`,tw=`#define GLSLIFY 1
uniform float u_alphaCutoff;uniform vec4 u_baseColor;uniform float u_metal;uniform float u_roughness;uniform vec3 u_PBRSpecularColor;uniform float u_glossiness;uniform vec3 u_emissiveColor;
#ifdef CLEARCOAT
uniform float u_clearCoat;uniform float u_clearCoatRoughness;
#endif
uniform float u_normalIntensity;uniform float u_occlusionIntensity;uniform float u_occlusionTextureCoord;
#ifdef BASETEXTURE
uniform sampler2D u_baseTexture;
#endif
#ifdef NORMALTEXTURE
uniform sampler2D u_normalTexture;
#endif
#ifdef EMISSIVETEXTURE
uniform sampler2D u_emissiveTexture;
#endif
#ifdef ROUGHNESSMETALLICTEXTURE
uniform sampler2D u_roughnessMetallicTexture;
#endif
#ifdef SPECULARGLOSSINESSTEXTURE
uniform sampler2D u_specularGlossinessTexture;
#endif
#ifdef OCCLUSIONTEXTURE
uniform sampler2D u_occlusionTexture;
#endif
#ifdef HAS_CLEARCOATTEXTURE
uniform sampler2D u_clearCoatTexture;
#endif
#ifdef HAS_CLEARCOATROUGHNESSTEXTURE
uniform sampler2D u_clearCoatRoughnessTexture;
#endif
#ifdef HAS_CLEARCOATNORMALTEXTURE
uniform sampler2D u_clearCoatNormalTexture;
#endif
struct ReflectedLight{vec3 directDiffuse;vec3 directSpecular;vec3 indirectDiffuse;vec3 indirectSpecular;};struct Geometry{vec3 position;vec3 normal;vec3 viewDir;float dotNV;
#ifdef CLEARCOAT
vec3 clearCoatNormal;float clearCoatDotNV;
#endif
};struct Material{vec3 diffuseColor;float roughness;vec3 specularColor;float opacity;
#ifdef CLEARCOAT
float clearCoat;float clearCoatRoughness;
#endif
};`,nw=`#define GLSLIFY 1
#include <normal_get>
float computeSpecularOcclusion(float ambientOcclusion,float roughness,float dotNV){return saturate(pow(dotNV+ambientOcclusion,exp2(-16.0*roughness-1.0))-1.0+ambientOcclusion);}float getAARoughnessFactor(vec3 normal){
#ifdef HAS_DERIVATIVES
vec3 dxy=max(abs(dFdx(normal)),abs(dFdy(normal)));return 0.04+max(max(dxy.x,dxy.y),dxy.z);
#else
return 0.04;
#endif
}void initGeometry(out Geometry geometry){geometry.position=v_pos;geometry.viewDir=normalize(u_cameraPos-v_pos);
#if defined(NORMALTEXTURE) || defined(HAS_CLEARCOATNORMALTEXTURE)
mat3 tbn=getTBN();
#endif
#ifdef NORMALTEXTURE
geometry.normal=getNormalByNormalTexture(tbn,u_normalTexture,u_normalIntensity,v_uv);
#else
geometry.normal=getNormal();
#endif
geometry.dotNV=saturate(dot(geometry.normal,geometry.viewDir));
#ifdef CLEARCOAT
#ifdef HAS_CLEARCOATNORMALTEXTURE
geometry.clearCoatNormal=getNormalByNormalTexture(tbn,u_clearCoatNormalTexture,u_normalIntensity,v_uv);
#else
geometry.clearCoatNormal=getNormal();
#endif
geometry.clearCoatDotNV=saturate(dot(geometry.clearCoatNormal,geometry.viewDir));
#endif
}void initMaterial(out Material material,const in Geometry geometry){vec4 baseColor=u_baseColor;float metal=u_metal;float roughness=u_roughness;vec3 specularColor=u_PBRSpecularColor;float glossiness=u_glossiness;float alphaCutoff=u_alphaCutoff;
#ifdef BASETEXTURE
vec4 baseTextureColor=texture2D(u_baseTexture,v_uv);
#ifndef OASIS_COLORSPACE_GAMMA
baseTextureColor=gammaToLinear(baseTextureColor);
#endif
baseColor*=baseTextureColor;
#endif
#ifdef O3_HAS_VERTEXCOLOR
baseColor*=v_color;
#endif
#ifdef ALPHA_CUTOFF
if(baseColor.a<alphaCutoff){discard;}
#endif
#ifdef ROUGHNESSMETALLICTEXTURE
vec4 metalRoughMapColor=texture2D(u_roughnessMetallicTexture,v_uv);roughness*=metalRoughMapColor.g;metal*=metalRoughMapColor.b;
#endif
#ifdef SPECULARGLOSSINESSTEXTURE
vec4 specularGlossinessColor=texture2D(u_specularGlossinessTexture,v_uv);
#ifndef OASIS_COLORSPACE_GAMMA
specularGlossinessColor=gammaToLinear(specularGlossinessColor);
#endif
specularColor*=specularGlossinessColor.rgb;glossiness*=specularGlossinessColor.a;
#endif
#ifdef IS_METALLIC_WORKFLOW
material.diffuseColor=baseColor.rgb*(1.0-metal);material.specularColor=mix(vec3(0.04),baseColor.rgb,metal);material.roughness=roughness;
#else
float specularStrength=max(max(specularColor.r,specularColor.g),specularColor.b);material.diffuseColor=baseColor.rgb*(1.0-specularStrength);material.specularColor=specularColor;material.roughness=1.0-glossiness;
#endif
material.roughness=max(material.roughness,getAARoughnessFactor(geometry.normal));
#ifdef CLEARCOAT
material.clearCoat=u_clearCoat;material.clearCoatRoughness=u_clearCoatRoughness;
#ifdef HAS_CLEARCOATTEXTURE
material.clearCoat*=texture2D(u_clearCoatTexture,v_uv).r;
#endif
#ifdef HAS_CLEARCOATROUGHNESSTEXTURE
material.clearCoatRoughness*=texture2D(u_clearCoatRoughnessTexture,v_uv).g;
#endif
material.clearCoat=saturate(material.clearCoat);material.clearCoatRoughness=max(material.clearCoatRoughness,getAARoughnessFactor(geometry.clearCoatNormal));
#endif
#ifdef OASIS_TRANSPARENT
material.opacity=baseColor.a;
#else
material.opacity=1.0;
#endif
}
#include <brdf>
#include <direct_irradiance_frag_define>
#include <ibl_frag_define>
`,rw=`#define GLSLIFY 1
float F_Schlick(float dotLH){return 0.04+0.96*(pow(1.0-dotLH,5.0));}vec3 F_Schlick(vec3 specularColor,float dotLH){float fresnel=exp2((-5.55473*dotLH-6.98316)*dotLH);return(1.0-specularColor)*fresnel+specularColor;}float G_GGX_SmithCorrelated(float alpha,float dotNL,float dotNV){float a2=pow2(alpha);float gv=dotNL*sqrt(a2+(1.0-a2)*pow2(dotNV));float gl=dotNV*sqrt(a2+(1.0-a2)*pow2(dotNL));return 0.5/max(gv+gl,EPSILON);}float D_GGX(float alpha,float dotNH){float a2=pow2(alpha);float denom=pow2(dotNH)*(a2-1.0)+1.0;return RECIPROCAL_PI*a2/pow2(denom);}vec3 BRDF_Specular_GGX(vec3 incidentDirection,vec3 viewDir,vec3 normal,vec3 specularColor,float roughness){float alpha=pow2(roughness);vec3 halfDir=normalize(incidentDirection+viewDir);float dotNL=saturate(dot(normal,incidentDirection));float dotNV=saturate(dot(normal,viewDir));float dotNH=saturate(dot(normal,halfDir));float dotLH=saturate(dot(incidentDirection,halfDir));vec3 F=F_Schlick(specularColor,dotLH);float G=G_GGX_SmithCorrelated(alpha,dotNL,dotNV);float D=D_GGX(alpha,dotNH);return F*(G*D);}vec3 BRDF_Diffuse_Lambert(vec3 diffuseColor){return RECIPROCAL_PI*diffuseColor;}`,iw=`#define GLSLIFY 1
#include <ShadowFragmentDeclaration>
void addDirectRadiance(vec3 incidentDirection,vec3 color,Geometry geometry,Material material,inout ReflectedLight reflectedLight){float attenuation=1.0;
#ifdef CLEARCOAT
float clearCoatDotNL=saturate(dot(geometry.clearCoatNormal,incidentDirection));vec3 clearCoatIrradiance=clearCoatDotNL*color;reflectedLight.directSpecular+=material.clearCoat*clearCoatIrradiance*BRDF_Specular_GGX(incidentDirection,geometry.viewDir,geometry.clearCoatNormal,vec3(0.04),material.clearCoatRoughness);attenuation-=material.clearCoat*F_Schlick(geometry.clearCoatDotNV);
#endif
float dotNL=saturate(dot(geometry.normal,incidentDirection));vec3 irradiance=dotNL*color*PI;reflectedLight.directSpecular+=attenuation*irradiance*BRDF_Specular_GGX(incidentDirection,geometry.viewDir,geometry.normal,material.specularColor,material.roughness);reflectedLight.directDiffuse+=attenuation*irradiance*BRDF_Diffuse_Lambert(material.diffuseColor);}
#ifdef O3_DIRECT_LIGHT_COUNT
void addDirectionalDirectLightRadiance(DirectLight directionalLight,Geometry geometry,Material material,inout ReflectedLight reflectedLight){vec3 color=directionalLight.color;vec3 direction=-directionalLight.direction;addDirectRadiance(direction,color,geometry,material,reflectedLight);}
#endif
#ifdef O3_POINT_LIGHT_COUNT
void addPointDirectLightRadiance(PointLight pointLight,Geometry geometry,Material material,inout ReflectedLight reflectedLight){vec3 lVector=pointLight.position-geometry.position;vec3 direction=normalize(lVector);float lightDistance=length(lVector);vec3 color=pointLight.color;color*=clamp(1.0-pow(lightDistance/pointLight.distance,4.0),0.0,1.0);addDirectRadiance(direction,color,geometry,material,reflectedLight);}
#endif
#ifdef O3_SPOT_LIGHT_COUNT
void addSpotDirectLightRadiance(SpotLight spotLight,Geometry geometry,Material material,inout ReflectedLight reflectedLight){vec3 lVector=spotLight.position-geometry.position;vec3 direction=normalize(lVector);float lightDistance=length(lVector);float angleCos=dot(direction,-spotLight.direction);float spotEffect=smoothstep(spotLight.penumbraCos,spotLight.angleCos,angleCos);float decayEffect=clamp(1.0-pow(lightDistance/spotLight.distance,4.0),0.0,1.0);vec3 color=spotLight.color;color*=spotEffect*decayEffect;addDirectRadiance(direction,color,geometry,material,reflectedLight);}
#endif
void addTotalDirectRadiance(Geometry geometry,Material material,inout ReflectedLight reflectedLight){float shadowAttenuation=1.0;
#ifdef O3_DIRECT_LIGHT_COUNT
shadowAttenuation=1.0;
#ifdef OASIS_CALCULATE_SHADOWS
shadowAttenuation*=sampleShadowMap();int sunIndex=int(u_shadowInfo.z);
#endif
DirectLight directionalLight;for(int i=0;i<O3_DIRECT_LIGHT_COUNT;i++){directionalLight.color=u_directLightColor[i];
#ifdef OASIS_CALCULATE_SHADOWS
if(i==sunIndex){directionalLight.color*=shadowAttenuation;}
#endif
directionalLight.direction=u_directLightDirection[i];addDirectionalDirectLightRadiance(directionalLight,geometry,material,reflectedLight);}
#endif
#ifdef O3_POINT_LIGHT_COUNT
PointLight pointLight;for(int i=0;i<O3_POINT_LIGHT_COUNT;i++){pointLight.color=u_pointLightColor[i];pointLight.position=u_pointLightPosition[i];pointLight.distance=u_pointLightDistance[i];addPointDirectLightRadiance(pointLight,geometry,material,reflectedLight);}
#endif
#ifdef O3_SPOT_LIGHT_COUNT
SpotLight spotLight;for(int i=0;i<O3_SPOT_LIGHT_COUNT;i++){spotLight.color=u_spotLightColor[i];spotLight.position=u_spotLightPosition[i];spotLight.direction=u_spotLightDirection[i];spotLight.distance=u_spotLightDistance[i];spotLight.angleCos=u_spotLightAngleCos[i];spotLight.penumbraCos=u_spotLightPenumbraCos[i];addSpotDirectLightRadiance(spotLight,geometry,material,reflectedLight);}
#endif
}`,aw=`#define GLSLIFY 1
vec3 getLightProbeIrradiance(vec3 sh[9],vec3 normal){normal.x=-normal.x;vec3 result=sh[0]+sh[1]*(normal.y)+sh[2]*(normal.z)+sh[3]*(normal.x)+sh[4]*(normal.y*normal.x)+sh[5]*(normal.y*normal.z)+sh[6]*(3.0*normal.z*normal.z-1.0)+sh[7]*(normal.z*normal.x)+sh[8]*(normal.x*normal.x-normal.y*normal.y);return max(result,vec3(0.0));}vec3 envBRDFApprox(vec3 specularColor,float roughness,float dotNV){const vec4 c0=vec4(-1,-0.0275,-0.572,0.022);const vec4 c1=vec4(1,0.0425,1.04,-0.04);vec4 r=roughness*c0+c1;float a004=min(r.x*r.x,exp2(-9.28*dotNV))*r.x+r.y;vec2 AB=vec2(-1.04,1.04)*a004+r.zw;return specularColor*AB.x+AB.y;}float getSpecularMIPLevel(float roughness,int maxMIPLevel){return roughness*float(maxMIPLevel);}vec3 getLightProbeRadiance(vec3 viewDir,vec3 normal,float roughness,int maxMIPLevel,float specularIntensity){
#ifndef O3_USE_SPECULAR_ENV
return vec3(0);
#else
vec3 reflectVec=reflect(-viewDir,normal);reflectVec.x=-reflectVec.x;float specularMIPLevel=getSpecularMIPLevel(roughness,maxMIPLevel);
#ifdef HAS_TEX_LOD
vec4 envMapColor=textureCubeLodEXT(u_env_specularSampler,reflectVec,specularMIPLevel);
#else
vec4 envMapColor=textureCube(u_env_specularSampler,reflectVec,specularMIPLevel);
#endif
#ifdef O3_DECODE_ENV_RGBM
envMapColor.rgb=RGBMToLinear(envMapColor,5.0).rgb;
#ifdef OASIS_COLORSPACE_GAMMA
envMapColor=linearToGamma(envMapColor);
#endif
#else
#ifndef OASIS_COLORSPACE_GAMMA
envMapColor=gammaToLinear(envMapColor);
#endif
#endif
return envMapColor.rgb*specularIntensity;
#endif
}`,ow=`#define GLSLIFY 1
Geometry geometry;Material material;ReflectedLight reflectedLight=ReflectedLight(vec3(0.0),vec3(0.0),vec3(0.0),vec3(0.0));initGeometry(geometry);initMaterial(material,geometry);addTotalDirectRadiance(geometry,material,reflectedLight);
#ifdef O3_USE_SH
vec3 irradiance=getLightProbeIrradiance(u_env_sh,geometry.normal);
#ifdef OASIS_COLORSPACE_GAMMA
irradiance=linearToGamma(vec4(irradiance,1.0)).rgb;
#endif
irradiance*=u_envMapLight.diffuseIntensity;
#else
vec3 irradiance=u_envMapLight.diffuse*u_envMapLight.diffuseIntensity;irradiance*=PI;
#endif
reflectedLight.indirectDiffuse+=irradiance*BRDF_Diffuse_Lambert(material.diffuseColor);vec3 radiance=getLightProbeRadiance(geometry.viewDir,geometry.normal,material.roughness,int(u_envMapLight.mipMapLevel),u_envMapLight.specularIntensity);float radianceAttenuation=1.0;
#ifdef CLEARCOAT
vec3 clearCoatRadiance=getLightProbeRadiance(geometry.viewDir,geometry.clearCoatNormal,material.clearCoatRoughness,int(u_envMapLight.mipMapLevel),u_envMapLight.specularIntensity);reflectedLight.indirectSpecular+=clearCoatRadiance*material.clearCoat*envBRDFApprox(vec3(0.04),material.clearCoatRoughness,geometry.clearCoatDotNV);radianceAttenuation-=material.clearCoat*F_Schlick(geometry.clearCoatDotNV);
#endif
reflectedLight.indirectSpecular+=radianceAttenuation*radiance*envBRDFApprox(material.specularColor,material.roughness,geometry.dotNV);
#ifdef OCCLUSIONTEXTURE
vec2 aoUV=v_uv;
#ifdef O3_HAS_UV1
if(u_occlusionTextureCoord==1.0){aoUV=v_uv1;}
#endif
float ambientOcclusion=(texture2D(u_occlusionTexture,aoUV).r-1.0)*u_occlusionIntensity+1.0;reflectedLight.indirectDiffuse*=ambientOcclusion;
#ifdef O3_USE_SPECULAR_ENV
reflectedLight.indirectSpecular*=computeSpecularOcclusion(ambientOcclusion,material.roughness,geometry.dotNV);
#endif
#endif
vec3 emissiveRadiance=u_emissiveColor;
#ifdef EMISSIVETEXTURE
vec4 emissiveColor=texture2D(u_emissiveTexture,v_uv);
#ifndef OASIS_COLORSPACE_GAMMA
emissiveColor=gammaToLinear(emissiveColor);
#endif
emissiveRadiance*=emissiveColor.rgb;
#endif
vec3 totalRadiance=reflectedLight.directDiffuse+reflectedLight.indirectDiffuse+reflectedLight.directSpecular+reflectedLight.indirectSpecular+emissiveRadiance;vec4 targetColor=vec4(totalRadiance,material.opacity);gl_FragColor=targetColor;`,sw={pbr_frag_define:tw,pbr_helper:nw,brdf:rw,direct_irradiance_frag_define:iw,ibl_frag_define:aw,pbr_frag:ow},lw=`#define GLSLIFY 1
uniform mat4 u_shadowMatrices[CASCADED_COUNT+1];uniform vec4 u_shadowSplitSpheres[4];mediump int computeCascadeIndex(vec3 positionWS){vec3 fromCenter0=positionWS-u_shadowSplitSpheres[0].xyz;vec3 fromCenter1=positionWS-u_shadowSplitSpheres[1].xyz;vec3 fromCenter2=positionWS-u_shadowSplitSpheres[2].xyz;vec3 fromCenter3=positionWS-u_shadowSplitSpheres[3].xyz;mediump vec4 comparison=vec4(dot(fromCenter0,fromCenter0)<u_shadowSplitSpheres[0].w,dot(fromCenter1,fromCenter1)<u_shadowSplitSpheres[1].w,dot(fromCenter2,fromCenter2)<u_shadowSplitSpheres[2].w,dot(fromCenter3,fromCenter3)<u_shadowSplitSpheres[3].w);comparison.yzw=clamp(comparison.yzw-comparison.xyz,0.0,1.0);mediump vec4 indexCoefficient=vec4(4.0,3.0,2.0,1.0);mediump int index=4-int(dot(comparison,indexCoefficient));return index;}vec3 getShadowCoord(){
#if CASCADED_COUNT == 1
mediump int cascadeIndex=0;
#else
mediump int cascadeIndex=computeCascadeIndex(v_pos);
#endif
#ifdef GRAPHICS_API_WEBGL2
mat4 shadowMatrix=u_shadowMatrices[cascadeIndex];
#else
mat4 shadowMatrix;
#if CASCADED_COUNT == 4
if(cascadeIndex==0){shadowMatrix=u_shadowMatrices[0];}else if(cascadeIndex==1){shadowMatrix=u_shadowMatrices[1];}else if(cascadeIndex==2){shadowMatrix=u_shadowMatrices[2];}else if(cascadeIndex==3){shadowMatrix=u_shadowMatrices[3];}else{shadowMatrix=u_shadowMatrices[4];}
#endif
#if CASCADED_COUNT == 2
if(cascadeIndex==0){shadowMatrix=u_shadowMatrices[0];}else if(cascadeIndex==1){shadowMatrix=u_shadowMatrices[1];}else{shadowMatrix=u_shadowMatrices[2];}
#endif
#if CASCADED_COUNT == 1
if(cascadeIndex==0){shadowMatrix=u_shadowMatrices[0];}else{shadowMatrix=u_shadowMatrices[1];}
#endif
#endif
vec4 shadowCoord=shadowMatrix*vec4(v_pos,1.0);return shadowCoord.xyz;}`,uw=`#define GLSLIFY 1
#if defined(SHADOW_TYPE) && defined(OASIS_RECEIVE_SHADOWS)
#define OASIS_CALCULATE_SHADOWS
#endif
#ifdef OASIS_CALCULATE_SHADOWS
#if CASCADED_COUNT == 1
varying vec3 v_shadowCoord;
#else
#include <ShadowCoord>
#endif
uniform vec3 u_shadowInfo;uniform vec4 u_shadowMapSize;
#ifdef GRAPHICS_API_WEBGL2
uniform mediump sampler2DShadow u_shadowMap;
#define SAMPLE_TEXTURE2D_SHADOW(textureName, coord3) textureLod(textureName, coord3 , 0.0)
#define TEXTURE2D_SHADOW_PARAM(shadowMap) mediump sampler2DShadow shadowMap
#else
uniform sampler2D u_shadowMap;
#ifdef OASIS_NO_DEPTH_TEXTURE
const vec4 bitShift=vec4(1.0,1.0/256.0,1.0/(256.0*256.0),1.0/(256.0*256.0*256.0));float unpack(const in vec4 rgbaDepth){return dot(rgbaDepth,bitShift);}
#define SAMPLE_TEXTURE2D_SHADOW(textureName, coord3) (unpack(texture2D(textureName, coord3.xy)) < coord3.z ? 0.0 : 1.0)
#else
#define SAMPLE_TEXTURE2D_SHADOW(textureName, coord3) (texture2D(textureName, coord3.xy).r < coord3.z ? 0.0 : 1.0)
#endif
#define TEXTURE2D_SHADOW_PARAM(shadowMap) mediump sampler2D shadowMap
#endif
#if SHADOW_TYPE == 2
float sampleShadowMapFiltered4(TEXTURE2D_SHADOW_PARAM(shadowMap),vec3 shadowCoord,vec4 shadowMapSize){float attenuation;vec4 attenuation4;vec2 offset=shadowMapSize.xy/2.0;vec3 shadowCoord0=shadowCoord+vec3(-offset,0.0);vec3 shadowCoord1=shadowCoord+vec3(offset.x,-offset.y,0.0);vec3 shadowCoord2=shadowCoord+vec3(-offset.x,offset.y,0.0);vec3 shadowCoord3=shadowCoord+vec3(offset,0.0);attenuation4.x=SAMPLE_TEXTURE2D_SHADOW(shadowMap,shadowCoord0);attenuation4.y=SAMPLE_TEXTURE2D_SHADOW(shadowMap,shadowCoord1);attenuation4.z=SAMPLE_TEXTURE2D_SHADOW(shadowMap,shadowCoord2);attenuation4.w=SAMPLE_TEXTURE2D_SHADOW(shadowMap,shadowCoord3);attenuation=dot(attenuation4,vec4(0.25));return attenuation;}
#endif
#if SHADOW_TYPE == 3
#include <shadow_sample_tent>
float sampleShadowMapFiltered9(TEXTURE2D_SHADOW_PARAM(shadowMap),vec3 shadowCoord,vec4 shadowmapSize){float attenuation;float fetchesWeights[9];vec2 fetchesUV[9];sampleShadowComputeSamplesTent5x5(shadowmapSize,shadowCoord.xy,fetchesWeights,fetchesUV);attenuation=fetchesWeights[0]*SAMPLE_TEXTURE2D_SHADOW(shadowMap,vec3(fetchesUV[0].xy,shadowCoord.z));attenuation+=fetchesWeights[1]*SAMPLE_TEXTURE2D_SHADOW(shadowMap,vec3(fetchesUV[1].xy,shadowCoord.z));attenuation+=fetchesWeights[2]*SAMPLE_TEXTURE2D_SHADOW(shadowMap,vec3(fetchesUV[2].xy,shadowCoord.z));attenuation+=fetchesWeights[3]*SAMPLE_TEXTURE2D_SHADOW(shadowMap,vec3(fetchesUV[3].xy,shadowCoord.z));attenuation+=fetchesWeights[4]*SAMPLE_TEXTURE2D_SHADOW(shadowMap,vec3(fetchesUV[4].xy,shadowCoord.z));attenuation+=fetchesWeights[5]*SAMPLE_TEXTURE2D_SHADOW(shadowMap,vec3(fetchesUV[5].xy,shadowCoord.z));attenuation+=fetchesWeights[6]*SAMPLE_TEXTURE2D_SHADOW(shadowMap,vec3(fetchesUV[6].xy,shadowCoord.z));attenuation+=fetchesWeights[7]*SAMPLE_TEXTURE2D_SHADOW(shadowMap,vec3(fetchesUV[7].xy,shadowCoord.z));attenuation+=fetchesWeights[8]*SAMPLE_TEXTURE2D_SHADOW(shadowMap,vec3(fetchesUV[8].xy,shadowCoord.z));return attenuation;}
#endif
float sampleShadowMap(){
#if CASCADED_COUNT == 1
vec3 shadowCoord=v_shadowCoord;
#else
vec3 shadowCoord=getShadowCoord();
#endif
float attenuation=1.0;if(shadowCoord.z>0.0&&shadowCoord.z<1.0){
#if SHADOW_TYPE == 1
attenuation=SAMPLE_TEXTURE2D_SHADOW(u_shadowMap,shadowCoord);
#endif
#if SHADOW_TYPE == 2
attenuation=sampleShadowMapFiltered4(u_shadowMap,shadowCoord,u_shadowMapSize);
#endif
#if SHADOW_TYPE == 3
attenuation=sampleShadowMapFiltered9(u_shadowMap,shadowCoord,u_shadowMapSize);
#endif
attenuation=mix(1.0,attenuation,u_shadowInfo.x);}return attenuation;}
#endif
`,cw=`#define GLSLIFY 1
float sampleShadowGetIRTriangleTexelArea(float triangleHeight){return triangleHeight-0.5;}void sampleShadowGetTexelAreasTent3x3(float offset,out vec4 computedArea,out vec4 computedAreaUncut){float a=offset+0.5;float offsetSquaredHalved=a*a*0.5;computedAreaUncut.x=computedArea.x=offsetSquaredHalved-offset;computedAreaUncut.w=computedArea.w=offsetSquaredHalved;computedAreaUncut.y=sampleShadowGetIRTriangleTexelArea(1.5-offset);float clampedOffsetLeft=min(offset,0.0);float areaOfSmallLeftTriangle=clampedOffsetLeft*clampedOffsetLeft;computedArea.y=computedAreaUncut.y-areaOfSmallLeftTriangle;computedAreaUncut.z=sampleShadowGetIRTriangleTexelArea(1.5+offset);float clampedOffsetRight=max(offset,0.0);float areaOfSmallRightTriangle=clampedOffsetRight*clampedOffsetRight;computedArea.z=computedAreaUncut.z-areaOfSmallRightTriangle;}void sampleShadowGetTexelWeightsTent5x5(float offset,out vec3 texelsWeightsA,out vec3 texelsWeightsB){vec4 areaFrom3texelTriangle;vec4 areaUncutFrom3texelTriangle;sampleShadowGetTexelAreasTent3x3(offset,areaFrom3texelTriangle,areaUncutFrom3texelTriangle);texelsWeightsA.x=0.16*(areaFrom3texelTriangle.x);texelsWeightsA.y=0.16*(areaUncutFrom3texelTriangle.y);texelsWeightsA.z=0.16*(areaFrom3texelTriangle.y+1.0);texelsWeightsB.x=0.16*(areaFrom3texelTriangle.z+1.0);texelsWeightsB.y=0.16*(areaUncutFrom3texelTriangle.z);texelsWeightsB.z=0.16*(areaFrom3texelTriangle.w);}void sampleShadowComputeSamplesTent5x5(vec4 shadowMapTextureTexelSize,vec2 coord,out float fetchesWeights[9],out vec2 fetchesUV[9]){vec2 tentCenterInTexelSpace=coord.xy*shadowMapTextureTexelSize.zw;vec2 centerOfFetchesInTexelSpace=floor(tentCenterInTexelSpace+0.5);vec2 offsetFromTentCenterToCenterOfFetches=tentCenterInTexelSpace-centerOfFetchesInTexelSpace;vec3 texelsWeightsUA,texelsWeightsUB;vec3 texelsWeightsVA,texelsWeightsVB;sampleShadowGetTexelWeightsTent5x5(offsetFromTentCenterToCenterOfFetches.x,texelsWeightsUA,texelsWeightsUB);sampleShadowGetTexelWeightsTent5x5(offsetFromTentCenterToCenterOfFetches.y,texelsWeightsVA,texelsWeightsVB);vec3 fetchesWeightsU=vec3(texelsWeightsUA.xz,texelsWeightsUB.y)+vec3(texelsWeightsUA.y,texelsWeightsUB.xz);vec3 fetchesWeightsV=vec3(texelsWeightsVA.xz,texelsWeightsVB.y)+vec3(texelsWeightsVA.y,texelsWeightsVB.xz);vec3 fetchesOffsetsU=vec3(texelsWeightsUA.y,texelsWeightsUB.xz)/fetchesWeightsU.xyz+vec3(-2.5,-0.5,1.5);vec3 fetchesOffsetsV=vec3(texelsWeightsVA.y,texelsWeightsVB.xz)/fetchesWeightsV.xyz+vec3(-2.5,-0.5,1.5);fetchesOffsetsU*=shadowMapTextureTexelSize.xxx;fetchesOffsetsV*=shadowMapTextureTexelSize.yyy;vec2 bilinearFetchOrigin=centerOfFetchesInTexelSpace*shadowMapTextureTexelSize.xy;fetchesUV[0]=bilinearFetchOrigin+vec2(fetchesOffsetsU.x,fetchesOffsetsV.x);fetchesUV[1]=bilinearFetchOrigin+vec2(fetchesOffsetsU.y,fetchesOffsetsV.x);fetchesUV[2]=bilinearFetchOrigin+vec2(fetchesOffsetsU.z,fetchesOffsetsV.x);fetchesUV[3]=bilinearFetchOrigin+vec2(fetchesOffsetsU.x,fetchesOffsetsV.y);fetchesUV[4]=bilinearFetchOrigin+vec2(fetchesOffsetsU.y,fetchesOffsetsV.y);fetchesUV[5]=bilinearFetchOrigin+vec2(fetchesOffsetsU.z,fetchesOffsetsV.y);fetchesUV[6]=bilinearFetchOrigin+vec2(fetchesOffsetsU.x,fetchesOffsetsV.z);fetchesUV[7]=bilinearFetchOrigin+vec2(fetchesOffsetsU.y,fetchesOffsetsV.z);fetchesUV[8]=bilinearFetchOrigin+vec2(fetchesOffsetsU.z,fetchesOffsetsV.z);fetchesWeights[0]=fetchesWeightsU.x*fetchesWeightsV.x;fetchesWeights[1]=fetchesWeightsU.y*fetchesWeightsV.x;fetchesWeights[2]=fetchesWeightsU.z*fetchesWeightsV.x;fetchesWeights[3]=fetchesWeightsU.x*fetchesWeightsV.y;fetchesWeights[4]=fetchesWeightsU.y*fetchesWeightsV.y;fetchesWeights[5]=fetchesWeightsU.z*fetchesWeightsV.y;fetchesWeights[6]=fetchesWeightsU.x*fetchesWeightsV.z;fetchesWeights[7]=fetchesWeightsU.y*fetchesWeightsV.z;fetchesWeights[8]=fetchesWeightsU.z*fetchesWeightsV.z;}`,dw=`#define GLSLIFY 1
#if defined(SHADOW_TYPE) && defined(OASIS_RECEIVE_SHADOWS)
#define OASIS_CALCULATE_SHADOWS
#endif
#ifdef OASIS_CALCULATE_SHADOWS
#if CASCADED_COUNT==1
#include <ShadowCoord>
varying vec3 v_shadowCoord;
#endif
#endif
`,_w=`#define GLSLIFY 1
#ifdef OASIS_CALCULATE_SHADOWS
#if CASCADED_COUNT == 1
v_shadowCoord=getShadowCoord();
#endif
#endif
`,hw={ShadowCoord:lw,ShadowFragmentDeclaration:uw,shadow_sample_tent:cw,ShadowVertexDeclaration:dw,ShadowVertex:_w},fw=`#define GLSLIFY 1
vec3 getNormal(){
#ifdef O3_HAS_NORMAL
vec3 normal=normalize(v_normal);
#elif defined(HAS_DERIVATIVES)
vec3 pos_dx=dFdx(v_pos);vec3 pos_dy=dFdy(v_pos);vec3 normal=normalize(cross(pos_dx,pos_dy));
#else
vec3 normal=vec3(0,0,1);
#endif
normal*=float(gl_FrontFacing)*2.0-1.0;return normal;}vec3 getNormalByNormalTexture(mat3 tbn,sampler2D normalTexture,float normalIntensity,vec2 uv){vec3 normal=texture2D(normalTexture,uv).rgb;normal=normalize(tbn*((2.0*normal-1.0)*vec3(normalIntensity,normalIntensity,1.0)));normal*=float(gl_FrontFacing)*2.0-1.0;return normal;}mat3 getTBN(){
#if defined(O3_HAS_NORMAL) && defined(O3_HAS_TANGENT) && ( defined(NORMALTEXTURE) || defined(HAS_CLEARCOATNORMALTEXTURE) )
mat3 tbn=v_TBN;
#else
vec3 normal=getNormal();vec3 position=v_pos;vec2 uv=gl_FrontFacing? v_uv:-v_uv;
#ifdef HAS_DERIVATIVES
vec3 dp1=dFdx(position);vec3 dp2=dFdy(position);vec2 duv1=dFdx(uv);vec2 duv2=dFdy(uv);vec3 dp2perp=cross(dp2,normal);vec3 dp1perp=cross(normal,dp1);vec3 tangent=dp2perp*duv1.x+dp1perp*duv2.x;vec3 binormal=dp2perp*duv1.y+dp1perp*duv2.y;float invmax=inversesqrt(max(dot(tangent,tangent),dot(binormal,binormal)));mat3 tbn=mat3(tangent*invmax,binormal*invmax,normal);
#else
mat3 tbn=mat3(vec3(0.0),vec3(0.0),normal);
#endif
#endif
return tbn;}`,vw=`#define GLSLIFY 1
#ifdef OASIS_CLIP_PLANE
if(dot(u_clip_plane,vec4(v_pos,1.0))<-EPSILON){discard;}
#endif
`,pw=dx({common:hx,common_vert:fx,transform_declare:vx,camera_declare:_x,color_share:px,normal_share:yx,uv_share:xx,worldpos_share:wx,FogVertexDeclaration:mx,FogFragmentDeclaration:gx,begin_normal_vert:Sx,begin_position_vert:Cx,position_vert:Mx,color_vert:Ex,normal_vert:bx,skinning_vert:Rx,blendShape_input:Ax,blendShape_vert:Tx,uv_vert:Fx,worldpos_vert:Dx,FogVertex:Px,light_frag_define:Ix,mobile_material_frag:Lx,FogFragment:Bx,begin_mobile_frag:zx,begin_viewdir_frag:Ox,mobile_blinnphong_frag:Nx,noise_common:Wx,noise_cellular_2D:Ux,noise_cellular_2x2:kx,noise_cellular_2x2x2:Hx,noise_cellular_3D:Gx,noise_cellular:Vx,noise_perlin_2D:jx,noise_perlin_3D:Yx,noise_perlin_4D:qx,noise_perlin:Xx,noise_psrd_2D:Qx,noise_simplex_2D:Kx,noise_simplex_3D_grad:Zx,noise_simplex_3D:Jx,noise_simplex_4D:ew,noise_simplex:$x},hw,sw,{normal_get:fw,clip_plane:vw}),Vi=function(){function n(){}return n.parseCustomMacros=function(a){return a.map(function(t){return"#define "+t+`
`}).join("")},n.parseIncludes=function(a){var t=function(o,s){var l=pw[s];return l===void 0?(we.error('Shader slice "'+o.trim()+'" not founded.'),""):n.parseIncludes(l)},e=/^[ \t]*#include +<([\w\d.]+)>/gm;return a.replace(e,t)},n.parseExtension=function(a){return a.map(function(t){return"#extension "+t+` : enable
`}).join("")},n.convertTo300=function(a,t){if(a=a.replace(/\battribute\b/g,"in"),a=a.replace(/\bvarying\b/g,t?"in":"out"),a=a.replace(/\btexture(2D|Cube)\b/g,"texture"),a=a.replace(/\btexture(2D|Cube)LodEXT\b/g,"textureLod"),t){var e=/\bgl_FragData\[.+?\]/g.test(a);if(e){a=a.replace(/\bgl_FragColor\b/g,"gl_FragData[0]");var r=a.match(/\bgl_FragData\[.+?\]/g);a=this._replaceMRTShader(a,r)}else a=a.replace(/void\s+?main\s*\(/g,`out vec4 glFragColor;
void main(`),a=a.replace(/\bgl_FragColor\b/g,"glFragColor")}return a},n._replaceMRTShader=function(a,t){for(var e="",r=new Set,o=0;o<t.length;o++){var s=t[o].match(/\bgl_FragData\[(.+?)\]/);r.add(s[1])}return r.forEach(function(l){e+="layout(location="+l+") out vec4 fragOutColor"+l+`;
`}),e+="void main(",a=a.replace(/\bgl_FragData\[(.+?)\]/g,"fragOutColor$1"),a=a.replace(/void\s+?main\s*\(/g,e),a},n}(),er;(function(n){n[n.Scene=0]="Scene",n[n.Camera=1]="Camera",n[n.Renderer=2]="Renderer",n[n.Material=3]="Material"})(er||(er={}));var gw=function(){function n(a){this.textureUseComporeMode=!1;var t=a._hardwareRenderer;this._rhi=t,this._gl=t.gl,this._colorSpace=a.settings.colorSpace}var i=n.prototype;return i.upload1f=function(t,e){this.cacheValue!==e&&(this._gl.uniform1f(t.location,e),this.cacheValue=e)},i.upload1fv=function(t,e){this._gl.uniform1fv(t.location,e)},i.upload2f=function(t,e){var r=this.cacheValue;e.r!==void 0?(r.x!==e.r||r.y!==e.g)&&(this._colorSpace===xi.Linear?this._gl.uniform2f(t.location,ne.gammaToLinearSpace(e.r),ne.gammaToLinearSpace(e.g)):this._gl.uniform2f(t.location,e.r,e.g),r.x=e.r,r.y=e.g):(r.x!==e.x||r.y!==e.y)&&(this._gl.uniform2f(t.location,e.x,e.y),r.x=e.x,r.y=e.y)},i.upload2fv=function(t,e){this._gl.uniform2fv(t.location,e)},i.upload3f=function(t,e){var r=this.cacheValue;e.r!==void 0?(r.x!==e.r||r.y!==e.g||r.z!==e.b)&&(this._colorSpace===xi.Linear?this._gl.uniform3f(t.location,ne.gammaToLinearSpace(e.r),ne.gammaToLinearSpace(e.g),ne.gammaToLinearSpace(e.b)):this._gl.uniform3f(t.location,e.r,e.g,e.b),r.x=e.r,r.y=e.g,r.z=e.b):(r.x!==e.x||r.y!==e.y||r.z!==e.z)&&(this._gl.uniform3f(t.location,e.x,e.y,e.z),r.x=e.x,r.y=e.y,r.z=e.z)},i.upload3fv=function(t,e){this._gl.uniform3fv(t.location,e)},i.upload4f=function(t,e){var r=this.cacheValue;e.r!==void 0?(r.x!==e.r||r.y!==e.g||r.z!==e.b||r.w!==e.a)&&(this._colorSpace===xi.Linear?this._gl.uniform4f(t.location,ne.gammaToLinearSpace(e.r),ne.gammaToLinearSpace(e.g),ne.gammaToLinearSpace(e.b),e.a):this._gl.uniform4f(t.location,e.r,e.g,e.b,e.a),r.x=e.r,r.y=e.g,r.z=e.b,r.w=e.a):(r.x!==e.x||r.y!==e.y||r.z!==e.z||r.w!==e.w)&&(this._gl.uniform4f(t.location,e.x,e.y,e.z,e.w),r.x=e.x,r.y=e.y,r.z=e.z,r.w=e.w)},i.upload4fv=function(t,e){this._gl.uniform4fv(t.location,e)},i.upload1i=function(t,e){this.cacheValue!==e&&(this._gl.uniform1i(t.location,e),this.cacheValue=e)},i.upload1iv=function(t,e){this._gl.uniform1iv(t.location,e)},i.upload2i=function(t,e){var r=this.cacheValue;e.r!==void 0?(r.x!==e.r||r.y!==e.g)&&(this._gl.uniform2i(t.location,e.r,e.g),r.x=e.r,r.y=e.g):(r.x!==e.x||r.y!==e.y)&&(this._gl.uniform2i(t.location,e.x,e.y),r.x=e.x,r.y=e.y)},i.upload2iv=function(t,e){this._gl.uniform2iv(t.location,e)},i.upload3i=function(t,e){var r=this.cacheValue;e.r!==void 0?(r.x!==e.r||r.y!==e.g||r.z!==e.b)&&(this._gl.uniform3i(t.location,e.r,e.g,e.b),r.x=e.r,r.y=e.g,r.z=e.b):(r.x!==e.x||r.y!==e.y||r.z!==e.z)&&(this._gl.uniform3i(t.location,e.x,e.y,e.z),r.x=e.x,r.y=e.y,r.z=e.z)},i.upload3iv=function(t,e){this._gl.uniform3iv(t.location,e)},i.upload4i=function(t,e){var r=this.cacheValue;e.r!==void 0?(r.x!==e.r||r.y!==e.g||r.z!==e.b||r.w!==e.a)&&(this._gl.uniform4i(t.location,e.r,e.g,e.b,e.a),r.x=e.r,r.y=e.g,r.z=e.b,r.w=e.a):(r.x!==e.x||r.y!==e.y||r.z!==e.z||r.w!==e.w)&&(this._gl.uniform4i(t.location,e.x,e.y,e.z,e.w),r.x=e.x,r.y=e.y,r.z=e.z,r.w=e.w)},i.upload4iv=function(t,e){this._gl.uniform4iv(t.location,e)},i.uploadMat4=function(t,e){this._gl.uniformMatrix4fv(t.location,!1,e.elements)},i.uploadMat4v=function(t,e){this._gl.uniformMatrix4fv(t.location,!1,e)},i.uploadTexture=function(t,e){var r=this._rhi;r.activeTexture(t.textureIndex),r.bindTexture(e._platformTexture),e._setUseDepthCompareMode(t.textureUseComporeMode)},i.uploadTextureArray=function(t,e){for(var r=this._rhi,o=t.textureIndex,s=0;s<e.length;s++){var l=e[s];r.activeTexture(o[s]),r.bindTexture(l._platformTexture),l._setUseDepthCompareMode(t.textureUseComporeMode)}},n}(),To=function(){this.constUniforms=[],this.textureUniforms=[]},T0=function(){function n(a,t,e){this.sceneUniformBlock=new To,this.cameraUniformBlock=new To,this.rendererUniformBlock=new To,this.materialUniformBlock=new To,this.otherUniformBlock=new To,this._uploadRenderCount=-1,this.attributeLocation=Object.create(null),this._activeTextureUint=0,this._engine=a,this._gl=a._hardwareRenderer.gl,this._glProgram=this._createProgram(t,e),this._glProgram?(this._isValid=!0,this._recordLocation()):this._isValid=!1,this.id=n._counter++}var i=n.prototype;return i.uploadAll=function(t,e){this.uploadUniforms(t,e),this.uploadTextures(t,e)},i.uploadUniforms=function(t,e){for(var r=e._propertyValueMap,o=t.constUniforms,s=0,l=o.length;s<l;s++){var u=o[s],c=r[u.propertyId];c!=null&&u.applyFunc(u,c)}},i.uploadTextures=function(t,e){var r=e._propertyValueMap,o=t.textureUniforms;if(o)for(var s=0,l=o.length;s<l;s++){var u=o[s],c=r[u.propertyId];c&&!c.destroyed?u.applyFunc(u,c):u.applyFunc(u,u.textureDefault)}},i.uploadUnGroupTextures=function(){var t=this.otherUniformBlock.textureUniforms;if(t)for(var e=0,r=t.length;e<r;e++){var o=t[e];o.applyFunc(o,o.textureDefault)}},i.groupingOtherUniformBlock=function(){var t=this.otherUniformBlock,e=t.constUniforms,r=t.textureUniforms;e.length>0&&this._groupingSubOtherUniforms(e,!1),r.length>0&&this._groupingSubOtherUniforms(r,!0)},i.bind=function(){var t=this._engine._hardwareRenderer;return t._currentBind!==this?(this._gl.useProgram(this._glProgram),t._currentBind=this,!0):!1},i.destroy=function(){var t=this._gl;this._vertexShader&&t.deleteShader(this._vertexShader),this._fragmentShader&&t.deleteShader(this._fragmentShader),this._glProgram&&t.deleteProgram(this._glProgram)},i._groupingSubOtherUniforms=function(t,e){for(var r=t.length-1;r>=0;r--){var o=t[r],s=B._getShaderPropertyGroup(o.name);s!==void 0&&(t.splice(t.indexOf(o),1),this._groupingUniform(o,s,e))}},i._groupingUniform=function(t,e,r){switch(e){case er.Scene:r?this.sceneUniformBlock.textureUniforms.push(t):this.sceneUniformBlock.constUniforms.push(t);break;case er.Camera:r?this.cameraUniformBlock.textureUniforms.push(t):this.cameraUniformBlock.constUniforms.push(t);break;case er.Renderer:r?this.rendererUniformBlock.textureUniforms.push(t):this.rendererUniformBlock.constUniforms.push(t);break;case er.Material:r?this.materialUniformBlock.textureUniforms.push(t):this.materialUniformBlock.constUniforms.push(t);break;default:r?this.otherUniformBlock.textureUniforms.push(t):this.otherUniformBlock.constUniforms.push(t)}},i._createProgram=function(t,e){var r=this._gl,o=this._createShader(r.VERTEX_SHADER,t);if(!o)return null;var s=this._createShader(r.FRAGMENT_SHADER,e);if(!s)return null;var l=r.createProgram();return r.attachShader(l,o),r.attachShader(l,s),r.linkProgram(l),r.validateProgram(l),r.isContextLost()?(we.error("Context lost while linking program."),r.deleteShader(o),r.deleteShader(s),null):we.isEnabled&&!r.getProgramParameter(l,r.LINK_STATUS)?(we.error(`Could not link WebGL program. 
`+r.getProgramInfoLog(l)),r.deleteProgram(l),null):(this._vertexShader=o,this._fragmentShader=s,l)},i._createShader=function(t,e){var r=this._gl,o=r.createShader(t);return o?(r.shaderSource(o,e),r.compileShader(o),r.isContextLost()?(console.warn("Context lost while compiling shader."),r.deleteShader(o),null):we.isEnabled&&!r.getShaderParameter(o,r.COMPILE_STATUS)?(console.warn(`Could not compile WebGL shader.
`+r.getShaderInfoLog(o),n._addLineNum(e)),r.deleteShader(o),null):o):(console.warn("Context lost while create shader."),null)},i._recordLocation=function(){var t=this,e=this._gl,r=this._glProgram,o=this._getUniformInfos(),s=this._getAttributeInfos();o.forEach(function(l){var u=l.name,c=l.size,d=l.type,_=new gw(t._engine),h=!1,f=!1;u.indexOf("[0]")>0&&(u=u.substr(0,u.length-3),h=!0);var g=e.getUniformLocation(r,u);switch(_.name=u,_.propertyId=B.getPropertyByName(u)._uniqueId,_.location=g,d){case e.FLOAT:h?_.applyFunc=_.upload1fv:(_.applyFunc=_.upload1f,_.cacheValue=0);break;case e.FLOAT_VEC2:h?_.applyFunc=_.upload2fv:(_.applyFunc=_.upload2f,_.cacheValue=new W(0,0));break;case e.FLOAT_VEC3:h?_.applyFunc=_.upload3fv:(_.applyFunc=_.upload3f,_.cacheValue=new w(0,0,0));break;case e.FLOAT_VEC4:h?_.applyFunc=_.upload4fv:(_.applyFunc=_.upload4f,_.cacheValue=new he(0,0,0,0));break;case e.BOOL:case e.INT:h?_.applyFunc=_.upload1iv:(_.applyFunc=_.upload1i,_.cacheValue=0);break;case e.BOOL_VEC2:case e.INT_VEC2:h?_.applyFunc=_.upload2iv:(_.applyFunc=_.upload2i,_.cacheValue=new W(0,0));break;case e.BOOL_VEC3:case e.INT_VEC3:_.applyFunc=h?_.upload3iv:_.upload3i,_.cacheValue=new w(0,0,0);break;case e.BOOL_VEC4:case e.INT_VEC4:h?_.applyFunc=_.upload4iv:(_.applyFunc=_.upload4i,_.cacheValue=new he(0,0,0));break;case e.FLOAT_MAT4:_.applyFunc=h?_.uploadMat4v:_.uploadMat4;break;case e.SAMPLER_2D:case e.SAMPLER_CUBE:case e.SAMPLER_2D_ARRAY:case e.SAMPLER_2D_SHADOW:var y;switch(d){case e.SAMPLER_2D:y=t._engine._magentaTexture2D;break;case e.SAMPLER_CUBE:y=t._engine._magentaTextureCube;break;case e.SAMPLER_2D_ARRAY:y=t._engine._magentaTexture2DArray;break;case e.SAMPLER_2D_SHADOW:y=t._engine._depthTexture2D,_.textureUseComporeMode=!0;break}if(f=!0,h){for(var p=new Array(c),v=new Int32Array(c),m=new Array(c),x=0;x<c;x++)p[x]=y,v[x]=t._activeTextureUint,m[x]=e.TEXTURE0+t._activeTextureUint++;_.textureDefault=p,_.textureIndex=m,_.applyFunc=_.uploadTextureArray,t.bind(),e.uniform1iv(g,v)}else{var S=e.TEXTURE0+t._activeTextureUint;_.textureDefault=y,_.textureIndex=S,_.applyFunc=_.uploadTexture,t.bind(),e.uniform1i(g,t._activeTextureUint++)}break}var C=B._getShaderPropertyGroup(u);t._groupingUniform(_,C,f)}),s.forEach(function(l){var u=l.name;t.attributeLocation[u]=e.getAttribLocation(r,u)})},i._getUniformInfos=function(){for(var t=this._gl,e=this._glProgram,r=t.getProgramParameter(e,t.ACTIVE_UNIFORMS),o=new Array(r),s=0;s<r;++s){var l=t.getActiveUniform(e,s);o[s]=l}return o},i._getAttributeInfos=function(){for(var t=this._gl,e=this._glProgram,r=new Array,o=t.getProgramParameter(e,t.ACTIVE_ATTRIBUTES),s=0;s<o;++s){var l=t.getActiveAttrib(e,s);r[s]=l}return r},n._addLineNum=function(t){var e=t.split(`
`),r=(e.length+1).toString().length+6,o;return e.map(function(s,l){if(o="0:"+(l+1),o.length>=r)return o.substring(0,r)+s;for(var u=0;u<r-o.length;u++)o+=" ";return o+s}).join(`
`)},K(n,[{key:"isValid",get:function(){return this._isValid}}]),n}();T0._counter=0;var Bu=function(){function n(a,t){this._shaderPassId=0,this._shaderPassId=n._shaderPassCounter++,this._vertexSource=a,this._fragmentSource=t}var i=n.prototype;return i._getShaderProgram=function(t,e){var r=t._getShaderProgramPool(this),o=r.get(e);if(o)return o;var s=t._hardwareRenderer.isWebGL2,l=[];B._getNamesByMacros(e,l);var u=Vi.parseCustomMacros(l),c=s?"#version 300 es":"#version 100",d=s?"#define GRAPHICS_API_WEBGL2":"#define GRAPHICS_API_WEBGL1",_=`
    #ifdef GL_FRAGMENT_PRECISION_HIGH
      precision highp float;
      precision highp int;
    #else
      precision mediump float;
      precision mediump int;
    #endif
    `;t._hardwareRenderer.canIUse(Z.shaderTextureLod)&&(_+=`#define HAS_TEX_LOD
`),t._hardwareRenderer.canIUse(Z.standardDerivatives)&&(_+=`#define HAS_DERIVATIVES
`);var h=Vi.parseIncludes(" "+c+`
        `+d+`
        `+u+`
      `+this._vertexSource),f=Vi.parseIncludes(" "+c+`
        `+d+`
        `+(s?"":Vi.parseExtension(B._shaderExtension))+`
        `+_+`
        `+u+`
      `+this._fragmentSource);return s&&(h=Vi.convertTo300(h),f=Vi.convertTo300(f,!0)),o=new T0(t,h,f),r.cache(o),o},n}();Bu._shaderPassCounter=0;var N_=function(){function n(i){this.name=i,this._uniqueId=n._propertyNameCounter++}return K(n,[{key:"type",get:function(){return this._type}}]),n}();N_._propertyNameCounter=0;var B=function(){function n(a,t,e){if(this._passes=[],this.name=a,typeof t=="string")this._passes.push(new Bu(t,e));else{var r=t.length;if(r<1)throw"Shader pass count must large than 0.";for(var o=0;o<r;o++)this._passes.push(t[o])}}var i=n.prototype;return i.compileVariant=function(t,e){var r=n._compileMacros;r.clear();for(var o=0,s=e.length;o<s;o++)r.enable(n.getMacroByName(e[o]));for(var l=!0,u=this._passes,c=0,d=u.length;c<d;c++)l&&(l=u[c]._getShaderProgram(t,r).isValid);return l},n.create=function(t,e,r){var o=n._shaderMap;if(o[t])throw'Shader named "'+t+'" already exists.';return o[t]=new n(t,e,r)},n.find=function(t){return n._shaderMap[t]},n.getMacroByName=function(t,e){var r=e?t+" "+e:t,o=n._macroMap[r];if(!o){var s=n._macroMaskMap,l=n._macroCounter,u=Math.floor(l/32),c=l%32;o=new Du(t,e,u,1<<c),n._macroMap[r]=o,u==s.length&&(s.length++,s[u]=new Array(32)),s[u][c]=r,n._macroCounter++}return o},n.getPropertyByName=function(t){var e=n._propertyNameMap;if(e[t]!=null)return e[t];var r=new N_(t);return e[t]=r,n._propertyIdMap[r._uniqueId]=r,r},n._getShaderPropertyGroup=function(t){var e=n._propertyNameMap[t];return e==null?void 0:e._group},n._getNamesByMacros=function(t,e){var r=n._macroMaskMap,o=t._mask;e.length=0;for(var s=0,l=t._length;s<l;s++)for(var u=r[s],c=o[s],d=c<0?32:Math.floor(Math.log2(c))+1,_=0;_<d;_++)c&1<<_&&e.push(u[_])},K(n,[{key:"passes",get:function(){return this._passes}}]),n}();B._compileMacros=new En;B._shaderExtension=["GL_EXT_shader_texture_lod","GL_OES_standard_derivatives","GL_EXT_draw_buffers"];B._propertyIdMap=Object.create(null);B._shaderMap=Object.create(null);B._propertyNameMap=Object.create(null);B._macroMaskMap=[];B._macroCounter=0;B._macroMap=Object.create(null);var Bs=function(){function n(a){this._propertyValueMap=Object.create(null),this._macroCollection=new En,this._macroMap=Object.create(null),this._refCount=0,this._group=a}var i=n.prototype;return i.getFloat=function(t){return this.getPropertyValue(t)},i.setFloat=function(t,e){this._setPropertyValue(t,Xt.Float,e)},i.getInt=function(t){return this.getPropertyValue(t)},i.setInt=function(t,e){this._setPropertyValue(t,Xt.Int,e)},i.getFloatArray=function(t){return this.getPropertyValue(t)},i.setFloatArray=function(t,e){this._setPropertyValue(t,Xt.FloatArray,e)},i.getIntArray=function(t){return this.getPropertyValue(t)},i.setIntArray=function(t,e){this._setPropertyValue(t,Xt.IntArray,e)},i.getVector2=function(t){return this.getPropertyValue(t)},i.setVector2=function(t,e){this._setPropertyValue(t,Xt.Vector2,e)},i.getVector3=function(t){return this.getPropertyValue(t)},i.setVector3=function(t,e){this._setPropertyValue(t,Xt.Vector3,e)},i.getVector4=function(t){return this.getPropertyValue(t)},i.setVector4=function(t,e){this._setPropertyValue(t,Xt.Vector4,e)},i.getMatrix=function(t){return this.getPropertyValue(t)},i.setMatrix=function(t,e){this._setPropertyValue(t,Xt.Matrix,e)},i.getColor=function(t){return this.getPropertyValue(t)},i.setColor=function(t,e){this._setPropertyValue(t,Xt.Color,e)},i.getTexture=function(t){return this.getPropertyValue(t)},i.setTexture=function(t,e){if(this._getRefCount()>0){var r=this.getPropertyValue(t);r&&r._addRefCount(-1),e&&e._addRefCount(1)}this._setPropertyValue(t,Xt.Texture,e)},i.getTextureArray=function(t){return this.getPropertyValue(t)},i.setTextureArray=function(t,e){if(this._getRefCount()>0){var r=this.getPropertyValue(t);if(r)for(var o=0,s=r.length;o<s;o++)r[o]._addRefCount(-1);if(e)for(var l=0,u=e.length;l<u;l++)e[l]._addRefCount(1)}this._setPropertyValue(t,Xt.TextureArray,e)},i.getPropertyValue=function(t){return typeof t=="string"&&(t=B.getPropertyByName(t)),this._propertyValueMap[t._uniqueId]},i.enableMacro=function(t,e){typeof t=="string"&&(t=B.getMacroByName(t,e));var r=t._nameId,o=this._macroMap[r];if(o!==t){var s=this._macroCollection;o&&s.disable(o),s.enable(t),this._macroMap[r]=t}},i.disableMacro=function(t){var e;if(typeof t=="string"){if(e=Du._macroNameIdMap[t],e===void 0)return}else e=t._nameId;var r=this._macroMap[e];r&&(this._macroCollection.disable(r),delete this._macroMap[e])},i.getMacros=function(t){if(t){var e=this._macroMap;t.length=0;for(var r in e)t.push(e[r])}else return Object.values(this._macroMap)},i.getProperties=function(t){var e;t?(t.length=0,e=t):e=[];var r=this._propertyValueMap,o=B._propertyIdMap;for(var s in r)e.push(o[s]);if(!t)return e},i.clone=function(){var t=new n(this._group);return this.cloneTo(t),t},i.cloneTo=function(t){Gn.deepCloneObject(this._macroCollection,t._macroCollection),Object.assign(t._macroMap,this._macroMap);for(var e=this._propertyValueMap,r=t._propertyValueMap,o=Object.keys(e),s=0,l=o.length;s<l;s++){var u=o[s],c=e[u];if(c!=null)if(typeof c=="number")r[u]=c;else if(He(c,yr))r[u]=c;else if(He(c,Array)||He(c,Float32Array)||He(c,Int32Array))r[u]=c.slice();else{var d=r[u];d?d.copyFrom(c):r[u]=c.clone()}else r[u]=c}},i._setPropertyValue=function(t,e,r){if(typeof t=="string"&&(t=B.getPropertyByName(t)),t._group!==this._group)if(t._group===void 0)t._group=this._group;else throw"Shader property "+t.name+" has been used as "+er[t._group]+" group.";if(t._type!==e)if(t._type===void 0)t._type=e;else throw"Shader property "+t.name+" has been used as "+Xt[t._type]+" type.";this._propertyValueMap[t._uniqueId]=r},i._getRefCount=function(){return this._refCount},i._addRefCount=function(t){this._refCount+=t;var e=this._propertyValueMap;for(var r in e){var o=e[r];o&&He(o,yr)&&o._addRefCount(t)}},n}(),Pt=function(n){Q(i,n);function i(){var t;return t=n.apply(this,arguments)||this,t.intensity=1,t.cullingMask=Ut.Everything,t.shadowType=kr.None,t.shadowBias=1,t.shadowNormalBias=1,t.shadowNearPlane=.1,t.shadowStrength=1,t._color=new ne(1,1,1,1),t._lightColor=new ne,t._lightIndex=-1,t}var a=i.prototype;return a._getLightColor=function(){return this._lightColor.r=this.color.r*this.intensity,this._lightColor.g=this.color.g*this.intensity,this._lightColor.b=this.color.b*this.intensity,this._lightColor.a=this.color.a*this.intensity,this._lightColor},K(i,[{key:"color",get:function(){return this._color},set:function(e){this._color!==e&&this._color.copyFrom(e)}},{key:"viewMatrix",get:function(){return this._viewMat||(this._viewMat=new J),J.invert(this.entity.transform.worldMatrix,this._viewMat),this._viewMat}},{key:"inverseViewMatrix",get:function(){return this._inverseViewMat||(this._inverseViewMat=new J),J.invert(this.viewMatrix,this._inverseViewMat),this._inverseViewMat}}]),i}(vn);Pt._maxLight=10;O([Y],Pt.prototype,"_lightIndex",void 0);var xr=function(n){Q(i,n);function i(){var t;return t=n.apply(this,arguments)||this,t._forward=new w,t._reverseDirection=new w,t}var a=i.prototype;return a._appendData=function(e){var r=e*3,o=e*3,s=this._getLightColor(),l=this.direction,u=i._combinedData;u.color[r]=s.r,u.color[r+1]=s.g,u.color[r+2]=s.b,u.direction[o]=l.x,u.direction[o+1]=l.y,u.direction[o+2]=l.z},a._onEnable=function(){this.engine._lightManager._attachDirectLight(this)},a._onDisable=function(){this.engine._lightManager._detachDirectLight(this)},i._updateShaderData=function(e){var r=i._combinedData;e.setFloatArray(i._colorProperty,r.color),e.setFloatArray(i._directionProperty,r.direction)},K(i,[{key:"direction",get:function(){return this.entity.transform.getWorldForward(this._forward),this._forward}},{key:"reverseDirection",get:function(){return w.scale(this.direction,-1,this._reverseDirection),this._reverseDirection}},{key:"_shadowProjectionMatrix",get:function(){throw"Unknown!"}}]),i}(Pt);xr._colorProperty=B.getPropertyByName("u_directLightColor");xr._directionProperty=B.getPropertyByName("u_directLightDirection");xr._combinedData={color:new Float32Array(3*Pt._maxLight),direction:new Float32Array(3*Pt._maxLight)};var wr=function(n){Q(i,n);function i(){var t;return t=n.apply(this,arguments)||this,t.distance=100,t}var a=i.prototype;return a._appendData=function(e){var r=e*3,o=e*3,s=e,l=this._getLightColor(),u=this.position,c=i._combinedData;c.color[r]=l.r,c.color[r+1]=l.g,c.color[r+2]=l.b,c.position[o]=u.x,c.position[o+1]=u.y,c.position[o+2]=u.z,c.distance[s]=this.distance},a._onEnable=function(){this.engine._lightManager._attachPointLight(this)},a._onDisable=function(){this.engine._lightManager._detachPointLight(this)},i._updateShaderData=function(e){var r=i._combinedData;e.setFloatArray(i._colorProperty,r.color),e.setFloatArray(i._positionProperty,r.position),e.setFloatArray(i._distanceProperty,r.distance)},K(i,[{key:"position",get:function(){return this.entity.transform.worldPosition}},{key:"_shadowProjectionMatrix",get:function(){throw"Unknown!"}}]),i}(Pt);wr._colorProperty=B.getPropertyByName("u_pointLightColor");wr._positionProperty=B.getPropertyByName("u_pointLightPosition");wr._distanceProperty=B.getPropertyByName("u_pointLightDistance");wr._combinedData={color:new Float32Array(3*Pt._maxLight),position:new Float32Array(3*Pt._maxLight),distance:new Float32Array(Pt._maxLight)};var _n=function(n){Q(i,n);function i(){var t;return t=n.apply(this,arguments)||this,t.distance=100,t.angle=Math.PI/6,t.penumbra=Math.PI/12,t._forward=new w,t._inverseDirection=new w,t._projectMatrix=new J,t}var a=i.prototype;return a._appendData=function(e){var r=e*3,o=e*3,s=e*3,l=e,u=e,c=e,d=this._getLightColor(),_=this.position,h=this.direction,f=i._combinedData;f.color[r]=d.r,f.color[r+1]=d.g,f.color[r+2]=d.b,f.position[o]=_.x,f.position[o+1]=_.y,f.position[o+2]=_.z,f.direction[s]=h.x,f.direction[s+1]=h.y,f.direction[s+2]=h.z,f.distance[l]=this.distance,f.angleCos[c]=Math.cos(this.angle),f.penumbraCos[u]=Math.cos(this.angle+this.penumbra)},a._onEnable=function(){this.engine._lightManager._attachSpotLight(this)},a._onDisable=function(){this.engine._lightManager._detachSpotLight(this)},i._updateShaderData=function(e){var r=i._combinedData;e.setFloatArray(i._colorProperty,r.color),e.setFloatArray(i._positionProperty,r.position),e.setFloatArray(i._directionProperty,r.direction),e.setFloatArray(i._distanceProperty,r.distance),e.setFloatArray(i._angleCosProperty,r.angleCos),e.setFloatArray(i._penumbraCosProperty,r.penumbraCos)},K(i,[{key:"position",get:function(){return this.entity.transform.worldPosition}},{key:"direction",get:function(){return this.entity.transform.getWorldForward(this._forward),this._forward}},{key:"reverseDirection",get:function(){return w.scale(this.direction,-1,this._inverseDirection),this._inverseDirection}},{key:"_shadowProjectionMatrix",get:function(){var e=this._projectMatrix,r=Math.min(Math.PI/2,this.angle*2*Math.sqrt(2));return J.perspective(r,1,this.shadowNearPlane,this.distance+this.shadowNearPlane,e),e}}]),i}(Pt);_n._colorProperty=B.getPropertyByName("u_spotLightColor");_n._positionProperty=B.getPropertyByName("u_spotLightPosition");_n._directionProperty=B.getPropertyByName("u_spotLightDirection");_n._distanceProperty=B.getPropertyByName("u_spotLightDistance");_n._angleCosProperty=B.getPropertyByName("u_spotLightAngleCos");_n._penumbraCosProperty=B.getPropertyByName("u_spotLightPenumbraCos");_n._combinedData={color:new Float32Array(3*Pt._maxLight),position:new Float32Array(3*Pt._maxLight),direction:new Float32Array(3*Pt._maxLight),distance:new Float32Array(Pt._maxLight),angleCos:new Float32Array(Pt._maxLight),penumbraCos:new Float32Array(Pt._maxLight)};var mw=function(){function n(){this._spotLights=new ot,this._pointLights=new ot,this._directLights=new ot}var i=n.prototype;return i._attachSpotLight=function(t){t._lightIndex=this._spotLights.length,this._spotLights.add(t)},i._detachSpotLight=function(t){var e=this._spotLights.deleteByIndex(t._lightIndex);e&&(e._lightIndex=t._lightIndex),t._lightIndex=-1},i._attachPointLight=function(t){t._lightIndex=this._pointLights.length,this._pointLights.add(t)},i._detachPointLight=function(t){var e=this._pointLights.deleteByIndex(t._lightIndex);e&&(e._lightIndex=t._lightIndex),t._lightIndex=-1},i._attachDirectLight=function(t){t._lightIndex=this._directLights.length,this._directLights.add(t)},i._detachDirectLight=function(t){var e=this._directLights.deleteByIndex(t._lightIndex);e&&(e._lightIndex=t._lightIndex),t._lightIndex=-1},i._getSunLightIndex=function(){for(var t=this._directLights,e=-1,r=Number.NEGATIVE_INFINITY,o=!1,s=0,l=t.length;s<l;s++){var u=t.get(s);u.shadowType!==kr.None&&!o&&(r=Number.NEGATIVE_INFINITY,o=!0);var c=u.intensity*u.color.getBrightness();o?u.shadowType!==kr.None&&r<c&&(r=c,e=s):r<c&&(r=c,e=s)}return e},i._updateShaderData=function(t){for(var e=this._spotLights,r=this._pointLights,o=this._directLights,s=e.length,l=r.length,u=o.length,c=0,d=s;c<d;c++){var _=e.get(c);_._appendData(c)}for(var h=0,f=l;h<f;h++){var g=r.get(h);g._appendData(h)}for(var y=0,p=u;y<p;y++){var v=o.get(y);v._appendData(y)}u?(xr._updateShaderData(t),t.enableMacro("O3_DIRECT_LIGHT_COUNT",u.toString())):t.disableMacro("O3_DIRECT_LIGHT_COUNT"),l?(wr._updateShaderData(t),t.enableMacro("O3_POINT_LIGHT_COUNT",l.toString())):t.disableMacro("O3_POINT_LIGHT_COUNT"),s?(_n._updateShaderData(t),t.enableMacro("O3_SPOT_LIGHT_COUNT",s.toString())):t.disableMacro("O3_SPOT_LIGHT_COUNT")},n}(),yw=function(){this.enabled=!1,this.colorBlendOperation=xn.Add,this.alphaBlendOperation=xn.Add,this.sourceColorBlendFactor=oe.One,this.sourceAlphaBlendFactor=oe.One,this.destinationColorBlendFactor=oe.Zero,this.destinationAlphaBlendFactor=oe.Zero,this.colorWriteMask=Zn.All},xw=function(){function n(){this.targetBlendState=new yw,this.blendColor=new ne(0,0,0,0),this.alphaToCoverage=!1}var i=n.prototype;return i._apply=function(t,e){this._platformApply(t,e.blendState)},i._platformApply=function(t,e){var r=t.gl,o=e.targetBlendState,s=this.targetBlendState,l=s.enabled,u=s.colorBlendOperation,c=s.alphaBlendOperation,d=s.sourceColorBlendFactor,_=s.destinationColorBlendFactor,h=s.sourceAlphaBlendFactor,f=s.destinationAlphaBlendFactor,g=s.colorWriteMask;if(l!==o.enabled&&(l?r.enable(r.BLEND):r.disable(r.BLEND),o.enabled=l),l){(d!==o.sourceColorBlendFactor||_!==o.destinationColorBlendFactor||h!==o.sourceAlphaBlendFactor||f!==o.destinationAlphaBlendFactor)&&(r.blendFuncSeparate(n._getGLBlendFactor(t,d),n._getGLBlendFactor(t,_),n._getGLBlendFactor(t,h),n._getGLBlendFactor(t,f)),o.sourceColorBlendFactor=d,o.destinationColorBlendFactor=_,o.sourceAlphaBlendFactor=h,o.destinationAlphaBlendFactor=f),(u!==o.colorBlendOperation||c!==o.alphaBlendOperation)&&(r.blendEquationSeparate(n._getGLBlendOperation(t,u),n._getGLBlendOperation(t,c)),o.colorBlendOperation=u,o.alphaBlendOperation=c);var y=this.blendColor;ne.equals(e.blendColor,y)||(r.blendColor(y.r,y.g,y.b,y.a),e.blendColor.copyFrom(y))}g!==o.colorWriteMask&&(r.colorMask((g&Zn.Red)!==0,(g&Zn.Green)!==0,(g&Zn.Blue)!==0,(g&Zn.Alpha)!==0),o.colorWriteMask=g);var p=this.alphaToCoverage;p!==e.alphaToCoverage&&(p?r.enable(r.SAMPLE_ALPHA_TO_COVERAGE):r.disable(r.SAMPLE_ALPHA_TO_COVERAGE),e.alphaToCoverage=p)},n._getGLBlendFactor=function(t,e){var r=t.gl;switch(e){case oe.Zero:return r.ZERO;case oe.One:return r.ONE;case oe.SourceColor:return r.SRC_COLOR;case oe.OneMinusSourceColor:return r.ONE_MINUS_SRC_COLOR;case oe.DestinationColor:return r.DST_COLOR;case oe.OneMinusDestinationColor:return r.ONE_MINUS_DST_COLOR;case oe.SourceAlpha:return r.SRC_ALPHA;case oe.OneMinusSourceAlpha:return r.ONE_MINUS_SRC_ALPHA;case oe.DestinationAlpha:return r.DST_ALPHA;case oe.OneMinusDestinationAlpha:return r.ONE_MINUS_DST_ALPHA;case oe.SourceAlphaSaturate:return r.SRC_ALPHA_SATURATE;case oe.BlendColor:return r.CONSTANT_COLOR;case oe.OneMinusBlendColor:return r.ONE_MINUS_CONSTANT_COLOR}},n._getGLBlendOperation=function(t,e){var r=t.gl;switch(e){case xn.Add:return r.FUNC_ADD;case xn.Subtract:return r.FUNC_SUBTRACT;case xn.ReverseSubtract:return r.FUNC_REVERSE_SUBTRACT;case xn.Min:if(!t.canIUse(Z.blendMinMax))throw new Error("BlendOperation.Min is not supported in this context");return r.MIN;case xn.Max:if(!t.canIUse(Z.blendMinMax))throw new Error("BlendOperation.Max is not supported in this context");return r.MAX}},n}(),ww=function(){function n(){this.enabled=!0,this.writeEnabled=!0,this.compareFunction=ye.Less}var i=n.prototype;return i._apply=function(t,e){this._platformApply(t,e.depthState)},i._platformApply=function(t,e){var r=t.gl,o=this,s=o.enabled,l=o.compareFunction,u=o.writeEnabled;s!=e.enabled&&(s?r.enable(r.DEPTH_TEST):r.disable(r.DEPTH_TEST),e.enabled=s),s&&(l!=e.compareFunction&&(r.depthFunc(n._getGLCompareFunction(t,l)),e.compareFunction=l),u!=e.writeEnabled&&(r.depthMask(u),e.writeEnabled=u))},n._getGLCompareFunction=function(t,e){var r=t.gl;switch(e){case ye.Never:return r.NEVER;case ye.Less:return r.LESS;case ye.Equal:return r.EQUAL;case ye.LessEqual:return r.LEQUAL;case ye.Greater:return r.GREATER;case ye.NotEqual:return r.NOTEQUAL;case ye.GreaterEqual:return r.GEQUAL;case ye.Always:return r.ALWAYS}},n}(),Sw=function(){function n(){this.cullMode=kt.Back,this.depthBias=0,this.slopeScaledDepthBias=0,this._cullFaceEnable=!0,this._frontFaceInvert=!1}var i=n.prototype;return i._apply=function(t,e,r){this._platformApply(t,e.rasterState,r)},i._platformApply=function(t,e,r){var o=t.gl,s=this,l=s.cullMode,u=s.depthBias,c=s.slopeScaledDepthBias,d=l!==kt.Off;d!==e._cullFaceEnable&&(d?o.enable(o.CULL_FACE):o.disable(o.CULL_FACE),e._cullFaceEnable=d),d&&l!==e.cullMode&&(l==kt.Back?o.cullFace(o.BACK):o.cullFace(o.FRONT),e.cullMode=l),r!==e._frontFaceInvert&&(r?o.frontFace(o.CW):o.frontFace(o.CCW),e._frontFaceInvert=r),t._enableGlobalDepthBias||(u!==e.depthBias||c!==e.slopeScaledDepthBias)&&(u!==0||c!==0?(o.enable(o.POLYGON_OFFSET_FILL),o.polygonOffset(c,u)):o.disable(o.POLYGON_OFFSET_FILL),e.depthBias=u,e.slopeScaledDepthBias=c)},n}(),Cw=function(){function n(){this.enabled=!1,this.referenceValue=0,this.mask=255,this.writeMask=255,this.compareFunctionFront=ye.Always,this.compareFunctionBack=ye.Always,this.passOperationFront=Je.Keep,this.passOperationBack=Je.Keep,this.failOperationFront=Je.Keep,this.failOperationBack=Je.Keep,this.zFailOperationFront=Je.Keep,this.zFailOperationBack=Je.Keep}var i=n.prototype;return i._apply=function(t,e){this._platformApply(t,e.stencilState)},i._platformApply=function(t,e){var r=t.gl,o=this,s=o.enabled,l=o.referenceValue,u=o.mask,c=o.compareFunctionFront,d=o.compareFunctionBack,_=o.failOperationFront,h=o.zFailOperationFront,f=o.passOperationFront,g=o.failOperationBack,y=o.zFailOperationBack,p=o.passOperationBack,v=o.writeMask;if(s!=e.enabled&&(s?r.enable(r.STENCIL_TEST):r.disable(r.STENCIL_TEST),e.enabled=s),s){var m=l!==e.referenceValue||u!==e.mask;(m||c!==e.compareFunctionFront)&&(r.stencilFuncSeparate(r.FRONT,n._getGLCompareFunction(t,c),l,u),e.compareFunctionFront=c),(m||d!==e.compareFunctionBack)&&(r.stencilFuncSeparate(r.BACK,n._getGLCompareFunction(t,d),l,u),e.compareFunctionBack=this.compareFunctionBack),m&&(e.referenceValue=this.referenceValue,e.mask=this.mask),(_!==e.failOperationFront||h!==e.zFailOperationFront||f!==e.passOperationFront)&&(r.stencilOpSeparate(r.FRONT,n._getGLStencilOperation(t,_),n._getGLStencilOperation(t,h),n._getGLStencilOperation(t,f)),e.failOperationFront=_,e.zFailOperationFront=h,e.passOperationFront=f),(g!==e.failOperationBack||y!==e.zFailOperationBack||p!==e.passOperationBack)&&(r.stencilOpSeparate(r.BACK,n._getGLStencilOperation(t,g),n._getGLStencilOperation(t,y),n._getGLStencilOperation(t,p)),e.failOperationBack=g,e.zFailOperationBack=y,e.passOperationBack=p),v!==e.writeMask&&(r.stencilMask(v),e.writeMask=v)}},n._getGLCompareFunction=function(t,e){var r=t.gl;switch(e){case ye.Never:return r.NEVER;case ye.Less:return r.LESS;case ye.Equal:return r.EQUAL;case ye.LessEqual:return r.LEQUAL;case ye.Greater:return r.GREATER;case ye.NotEqual:return r.NOTEQUAL;case ye.GreaterEqual:return r.GEQUAL;case ye.Always:return r.ALWAYS}},n._getGLStencilOperation=function(t,e){var r=t.gl;switch(e){case Je.Keep:return r.KEEP;case Je.Zero:return r.ZERO;case Je.Replace:return r.REPLACE;case Je.IncrementSaturate:return r.INCR;case Je.DecrementSaturate:return r.DECR;case Je.Invert:return r.INVERT;case Je.IncrementWrap:return r.INCR_WRAP;case Je.DecrementWrap:return r.DECR_WRAP}},n}(),V_=function(){function n(){this.blendState=new xw,this.depthState=new ww,this.stencilState=new Cw,this.rasterState=new Sw,this.renderQueueType=Ot.Opaque}var i=n.prototype;return i._apply=function(t,e){var r=t._hardwareRenderer,o=t._lastRenderState;this.blendState._apply(r,o),this.depthState._apply(r,o),this.stencilState._apply(r,o),this.rasterState._apply(r,o,e)},n}(),Dr=function(n){Q(i,n);function i(t,e){var r;return r=n.call(this,t)||this,r.shaderData=new Bs(er.Material),r._renderStates=[],r.shader=e,r}var a=i.prototype;return a.clone=function(){var e=new i(this._engine,this.shader);return this.cloneTo(e),e},a.cloneTo=function(e){e.shader=this.shader,this.shaderData.cloneTo(e.shaderData),Gn.deepCloneObject(this.renderStates,e.renderStates)},a._addRefCount=function(e){n.prototype._addRefCount.call(this,e),this.shaderData._addRefCount(e)},a._preRender=function(e){},a._onDestroy=function(){},K(i,[{key:"shader",get:function(){return this._shader},set:function(e){this._shader=e;var r=this._renderStates,o=r.length,s=e.passes.length;if(o<s)for(var l=o;l<s;l++)r.push(new V_);else r.length=s}},{key:"renderState",get:function(){return this._renderStates[0]}},{key:"renderStates",get:function(){return this._renderStates}}]),i}(Xr),Da=function(){function n(a){this._elementPoolIndex=0,this._elementPool=[],this._type=a}var i=n.prototype;return i.getFromPool=function(){var t=this,e=t._elementPoolIndex,r=t._elementPool;if(this._elementPoolIndex++,r.length===e){var o=new this._type;return r.push(o),o}else return r[e]},i.resetPool=function(){this._elementPoolIndex=0},n}(),Iu=function(){},E0=function(n){Q(i,n);function i(){return n.apply(this,arguments)}var a=i.prototype;return a.setValue=function(e,r,o,s,l,u){this.component=e,this.mesh=r,this.subMesh=o,this.material=s,this.renderState=l,this.shaderPass=u},i}(Iu),Ki=function(){function n(){}var i=n.prototype;return i.applyVirtualCamera=function(t){this.virtualCamera=t;var e=this.camera.shaderData;e.setMatrix(n._viewMatrixProperty,t.viewMatrix),e.setMatrix(n._projectionMatrixProperty,t.projectionMatrix),e.setMatrix(n._vpMatrixProperty,t.viewProjectionMatrix)},n}();Ki._vpMatrixProperty=B.getPropertyByName("u_VPMat");Ki._viewMatrixProperty=B.getPropertyByName("u_viewMat");Ki._projectionMatrixProperty=B.getPropertyByName("u_projMat");var P0=function(n){Q(i,n);function i(){var t;return t=n.call(this)||this,t.multiRenderData=!1,t}var a=i.prototype;return a.setValue=function(e,r,o,s,l,u){this.component=e,this.renderData=r,this.material=o,this.texture=s,this.renderState=l,this.shaderPass=u},i}(Iu),Aw=function(n){Q(i,n);function i(){var t;return t=n.call(this)||this,t.isAdd=!0,t.multiRenderData=!1,t}var a=i.prototype;return a.setValue=function(e,r,o){this.component=e,this.renderData=r,this.material=o},i}(Iu),Un;(function(n){n[n.None=0]="None",n[n.VisibleInsideMask=1]="VisibleInsideMask",n[n.VisibleOutsideMask=2]="VisibleOutsideMask"})(Un||(Un={}));var dr,me=(dr=function(n){Q(i,n);function i(t){var e;e=n.call(this,t)||this,e.castShadows=!0,e.shaderData=new Bs(er.Renderer),e._onUpdateIndex=-1,e._rendererIndex=-1,e._globalShaderMacro=new En,e._bounds=new sn,e._overrideUpdate=!1,e._materials=[],e._dirtyUpdateFlag=0,e._mvMatrix=new J,e._mvpMatrix=new J,e._mvInvMatrix=new J,e._normalMatrix=new J,e._materialsInstanced=[],e._priority=0,e._receiveShadows=!0;var r=me.prototype;return e._overrideUpdate=e.update!==r.update,e.shaderData._addRefCount(1),e._onTransformChanged=e._onTransformChanged.bind(_e(e)),e._registerEntityTransformListener(),e.shaderData.enableMacro(me._receiveShadowMacro),e}var a=i.prototype;return a.getInstanceMaterial=function(e){e===void 0&&(e=0);var r=this._materials;if(r.length>e){var o=r[e];if(o)return this._materialsInstanced[e]?o:this._createInstanceMaterial(o,e)}return null},a.getMaterial=function(e){return e===void 0&&(e=0),this._materials[e]||null},a.setMaterial=function(e,r){r===void 0&&(r=null),typeof e=="number"?this._setMaterial(e,r):this._setMaterial(0,e)},a.getInstanceMaterials=function(){for(var e=this._materials,r=this._materialsInstanced,o=0,s=e.length;o<s;o++)r[o]||this._createInstanceMaterial(this._materials[o],o);return e},a.getMaterials=function(){return this._materials},a.setMaterials=function(e){for(var r=e.length,o=this._materials,s=this._materialsInstanced,l=r,u=o.length;l<u;l++){var c=o[l];c&&c._addRefCount(-1)}o.length!==r&&(o.length=r),s.length!==0&&(s.length=0);for(var d=0;d<r;d++){var _=o[d],h=e[d];_!==h&&(o[d]=h,_&&_._addRefCount(-1),h&&h._addRefCount(1))}},a.update=function(e){},a._onEnable=function(){var e=this.engine._componentsManager;this._overrideUpdate&&e.addOnUpdateRenderers(this),e.addRenderer(this)},a._onDisable=function(){var e=this.engine._componentsManager;this._overrideUpdate&&e.removeOnUpdateRenderers(this),e.removeRenderer(this)},a._prepareRender=function(e){var r=e.virtualCamera,o=r.position,s=this.bounds.getCenter(me._tempVector0);r.isOrthographic?(w.subtract(s,o,s),this._distanceForSort=w.dot(s,r.forward)):this._distanceForSort=w.distanceSquared(s,o),this._updateShaderData(e),this._render(e),En.unionCollection(e.camera._globalShaderMacro,this.shaderData._macroCollection,this._globalShaderMacro)},a._onDestroy=function(){this.entity.transform._updateFlagManager.removeListener(this._onTransformChanged),this.shaderData._addRefCount(-1);for(var e=this._materials,r=0,o=e.length;r<o;r++){var s;(s=e[r])==null||s._addRefCount(-1)}},a._updateShaderData=function(e){var r=this.entity.transform.worldMatrix;this._updateTransformShaderData(e,r)},a._updateTransformShaderData=function(e,r){var o=this.shaderData,s=e.virtualCamera,l=this._mvMatrix,u=this._mvpMatrix,c=this._mvInvMatrix,d=this._normalMatrix;J.multiply(s.viewMatrix,r,l),J.multiply(s.viewProjectionMatrix,r,u),J.invert(l,c),J.invert(r,d),d.transpose(),o.setMatrix(me._localMatrixProperty,this.entity.transform.localMatrix),o.setMatrix(me._worldMatrixProperty,r),o.setMatrix(me._mvMatrixProperty,l),o.setMatrix(me._mvpMatrixProperty,u),o.setMatrix(me._mvInvMatrixProperty,c),o.setMatrix(me._normalMatrixProperty,d)},a._registerEntityTransformListener=function(){this.entity.transform._updateFlagManager.addListener(this._onTransformChanged)},a._updateBounds=function(e){},a._render=function(e){throw"not implement"},a._createInstanceMaterial=function(e,r){var o=e.clone();return o.name=o.name+"(Instance)",e._addRefCount(-1),o._addRefCount(1),this._materialsInstanced[r]=!0,this._materials[r]=o,o},a._setMaterial=function(e,r){var o=this._materials;e>=o.length&&(o.length=e+1);var s=o[e];if(s!==r){var l=this._materialsInstanced;e<l.length&&(l[e]=!1),s&&s._addRefCount(-1),r&&r._addRefCount(1),o[e]=r}},a._onTransformChanged=function(e){this._dirtyUpdateFlag|=1},K(i,[{key:"isCulled",get:function(){return!(this._renderFrameCount===void 0||this._renderFrameCount===this._engine.time.frameCount-1)}},{key:"receiveShadows",get:function(){return this._receiveShadows},set:function(e){this._receiveShadows!==e&&(e?this.shaderData.enableMacro(me._receiveShadowMacro):this.shaderData.disableMacro(me._receiveShadowMacro),this._receiveShadows=e)}},{key:"materialCount",get:function(){return this._materials.length},set:function(e){var r=this._materials,o=this._materialsInstanced;r.length!==e&&(r.length=e),o.length>e&&(o.length=e)}},{key:"bounds",get:function(){return this._dirtyUpdateFlag&1&&(this._updateBounds(this._bounds),this._dirtyUpdateFlag&=-2),this._bounds}},{key:"priority",get:function(){return this._priority},set:function(e){this._priority=e}}]),i}(vn),dr._tempVector0=new w,dr._receiveShadowMacro=B.getMacroByName("OASIS_RECEIVE_SHADOWS"),dr._localMatrixProperty=B.getPropertyByName("u_localMat"),dr._worldMatrixProperty=B.getPropertyByName("u_modelMat"),dr._mvMatrixProperty=B.getPropertyByName("u_MVMat"),dr._mvpMatrixProperty=B.getPropertyByName("u_MVPMat"),dr._mvInvMatrixProperty=B.getPropertyByName("u_MVInvMat"),dr._normalMatrixProperty=B.getPropertyByName("u_normalMat"),dr);O([je],me.prototype,"shaderData",void 0);O([Y],me.prototype,"_distanceForSort",void 0);O([Y],me.prototype,"_onUpdateIndex",void 0);O([Y],me.prototype,"_rendererIndex",void 0);O([Y],me.prototype,"_globalShaderMacro",void 0);O([je],me.prototype,"_bounds",void 0);O([Y],me.prototype,"_renderFrameCount",void 0);O([Y],me.prototype,"_overrideUpdate",void 0);O([v0],me.prototype,"_materials",void 0);O([Y],me.prototype,"_dirtyUpdateFlag",void 0);O([Y],me.prototype,"_mvMatrix",void 0);O([Y],me.prototype,"_mvpMatrix",void 0);O([Y],me.prototype,"_mvInvMatrix",void 0);O([Y],me.prototype,"_normalMatrix",void 0);O([Y],me.prototype,"_materialsInstanced",void 0);O([Y],me.prototype,"_priority",void 0);O([Be],me.prototype,"_receiveShadows",void 0);O([Y],me.prototype,"_onTransformChanged",null);me=O([ua(fe)],me);var ht;(function(n){n[n.WorldVolume=1]="WorldVolume"})(ht||(ht={}));function or(){return function(n){}}var el,Br=(el=function(){function n(){}return n.resetData=function(a){var t=a._renderData,e=t.vertexCount=4,r=t.positions,o=t.uvs;if(r.length<e)for(var s=r.length;s<e;s++)r.push(new w),o.push(new W);t.triangles=Br._rectangleTriangles},n.updatePositions=function(a){var t=a.width,e=a.height,r=a.sprite,o=r.pivot,s=o.x,l=o.y,u=Br._worldMatrix,c=u.elements,d=a.entity.transform.worldMatrix,_=d.elements,h=a.flipX?-t:t,f=a.flipY?-e:e;c[0]=_[0]*h,c[1]=_[1]*h,c[2]=_[2]*h,c[4]=_[4]*f,c[5]=_[5]*f,c[6]=_[6]*f,c[8]=_[8],c[9]=_[9],c[10]=_[10],c[12]=_[12]-s*c[0]-l*c[4],c[13]=_[13]-s*c[1]-l*c[5],c[14]=_[14]-s*c[2]-l*c[6];for(var g=r._getPositions(),y=a._renderData.positions,p=0;p<4;p++){var v=g[p],m=v.x,x=v.y;y[p].set(c[0]*m+c[4]*x+c[12],c[1]*m+c[5]*x+c[13],c[2]*m+c[6]*x+c[14])}sn.transform(r._getBounds(),u,a._bounds)},n.updateUVs=function(a){var t=a.sprite._getUVs(),e=a._renderData.uvs,r=t[0],o=r.x,s=r.y,l=t[3],u=l.x,c=l.y;e[0].set(o,s),e[1].set(u,s),e[2].set(o,c),e[3].set(u,c)},n}(),el._rectangleTriangles=[0,1,2,2,1,3],el._worldMatrix=new J,el);Br=O([or()],Br);var U_=function(i,a,t,e,r){e===void 0&&(e=null),r===void 0&&(r=null),this.vertexCount=i,this.positions=a,this.uvs=t,this.triangles=e,this.color=r},eo;(function(n){n[n.Layer0=1]="Layer0",n[n.Layer1=2]="Layer1",n[n.Layer2=4]="Layer2",n[n.Layer3=8]="Layer3",n[n.Layer4=16]="Layer4",n[n.Layer5=32]="Layer5",n[n.Layer6=64]="Layer6",n[n.Layer7=128]="Layer7",n[n.Layer8=256]="Layer8",n[n.Layer9=512]="Layer9",n[n.Layer10=1024]="Layer10",n[n.Layer11=2048]="Layer11",n[n.Layer12=4096]="Layer12",n[n.Layer13=8192]="Layer13",n[n.Layer14=16384]="Layer14",n[n.Layer15=32768]="Layer15",n[n.Layer16=65536]="Layer16",n[n.Layer17=131072]="Layer17",n[n.Layer18=262144]="Layer18",n[n.Layer19=524288]="Layer19",n[n.Layer20=1048576]="Layer20",n[n.Layer21=2097152]="Layer21",n[n.Layer22=4194304]="Layer22",n[n.Layer23=8388608]="Layer23",n[n.Layer24=16777216]="Layer24",n[n.Layer25=33554432]="Layer25",n[n.Layer26=67108864]="Layer26",n[n.Layer27=134217728]="Layer27",n[n.Layer28=268435456]="Layer28",n[n.Layer29=536870912]="Layer29",n[n.Layer30=1073741824]="Layer30",n[n.Layer31=2147483648]="Layer31",n[n.Everything=4294967295]="Everything"})(eo||(eo={}));var Re;(function(n){n[n.texture=1]="texture",n[n.size=2]="size",n[n.atlasRotate=4]="atlasRotate",n[n.atlasRegion=8]="atlasRegion",n[n.atlasRegionOffset=16]="atlasRegionOffset",n[n.region=32]="region",n[n.pivot=64]="pivot",n[n.border=128]="border"})(Re||(Re={}));var hn=function(n){Q(i,n);function i(t){var e;return e=n.call(this,t)||this,e.influenceLayers=eo.Everything,e._sprite=null,e._width=void 0,e._height=void 0,e._flipX=!1,e._flipY=!1,e._alphaCutoff=.5,e._renderData=new U_(4,[],[]),Br.resetData(_e(e)),e.setMaterial(e._engine._spriteMaskDefaultMaterial),e.shaderData.setFloat(i._alphaCutoffProperty,e._alphaCutoff),e._onSpriteChange=e._onSpriteChange.bind(_e(e)),e}var a=i.prototype;return a._onDestroy=function(){var e;(e=this._sprite)==null||e._updateFlagManager.removeListener(this._onSpriteChange),this._sprite=null,this._renderData=null,n.prototype._onDestroy.call(this)},a._cloneTo=function(e){e.sprite=this._sprite},a._updateBounds=function(e){var r;!((r=this.sprite)!=null&&r.texture)||!this.width||!this.height?(e.min.set(0,0,0),e.max.set(0,0,0)):Br.updatePositions(this)},a._render=function(e){var r;if(!(!((r=this.sprite)!=null&&r.texture)||!this.width||!this.height)){this._dirtyUpdateFlag&ht.WorldVolume&&(Br.updatePositions(this),this._dirtyUpdateFlag&=~ht.WorldVolume),this._dirtyUpdateFlag&2&&(Br.updateUVs(this),this._dirtyUpdateFlag&=-3);var o=this._engine._spriteMaskElementPool,s=o.getFromPool();s.setValue(this,this._renderData,this.getMaterial()),e.camera._renderPipeline._allSpriteMasks.add(this),this._maskElement=s}},a._onSpriteChange=function(e){switch(e){case Re.texture:this.shaderData.setTexture(i._textureProperty,this.sprite.texture);break;case Re.region:case Re.atlasRegionOffset:this._dirtyUpdateFlag|=3;break;case Re.atlasRegion:this._dirtyUpdateFlag|=2;break}},K(i,[{key:"width",get:function(){return this._width===void 0&&this._sprite&&(this.width=this._sprite.width),this._width},set:function(e){this._width!==e&&(this._width=e,this._dirtyUpdateFlag|=ht.WorldVolume)}},{key:"height",get:function(){return this._height===void 0&&this._sprite&&(this.height=this._sprite.height),this._height},set:function(e){this._height!==e&&(this._height=e,this._dirtyUpdateFlag|=ht.WorldVolume)}},{key:"flipX",get:function(){return this._flipX},set:function(e){this._flipX!==e&&(this._flipX=e,this._dirtyUpdateFlag|=ht.WorldVolume)}},{key:"flipY",get:function(){return this._flipY},set:function(e){this._flipY!==e&&(this._flipY=e,this._dirtyUpdateFlag|=ht.WorldVolume)}},{key:"sprite",get:function(){return this._sprite},set:function(e){var r=this._sprite;r!==e&&(r&&r._updateFlagManager.removeListener(this._onSpriteChange),e?(e._updateFlagManager.addListener(this._onSpriteChange),this._dirtyUpdateFlag|=3,this.shaderData.setTexture(i._textureProperty,e.texture)):this.shaderData.setTexture(i._textureProperty,null),this._sprite=e)}},{key:"alphaCutoff",get:function(){return this._alphaCutoff},set:function(e){this._alphaCutoff!==e&&(this._alphaCutoff=e,this.shaderData.setFloat(i._alphaCutoffProperty,e))}}]),i}(me);hn._textureProperty=B.getPropertyByName("u_maskTexture");hn._alphaCutoffProperty=B.getPropertyByName("u_maskAlphaCutoff");O([Be],hn.prototype,"influenceLayers",void 0);O([Y],hn.prototype,"_sprite",void 0);O([Y],hn.prototype,"_width",void 0);O([Y],hn.prototype,"_height",void 0);O([Be],hn.prototype,"_flipX",void 0);O([Be],hn.prototype,"_flipY",void 0);O([Be],hn.prototype,"_alphaCutoff",void 0);O([Y],hn.prototype,"_onSpriteChange",null);var Af;(function(n){n[n.UV=2]="UV",n[n.All=3]="All"})(Af||(Af={}));var re;(function(n){n[n.Float=0]="Float",n[n.Vector2=1]="Vector2",n[n.Vector3=2]="Vector3",n[n.Vector4=3]="Vector4",n[n.Byte4=4]="Byte4",n[n.UByte4=5]="UByte4",n[n.NormalizedByte4=6]="NormalizedByte4",n[n.NormalizedUByte4=7]="NormalizedUByte4",n[n.Short2=8]="Short2",n[n.UShort2=9]="UShort2",n[n.NormalizedShort2=10]="NormalizedShort2",n[n.NormalizedUShort2=11]="NormalizedUShort2",n[n.Short4=12]="Short4",n[n.UShort4=13]="UShort4",n[n.NormalizedShort4=14]="NormalizedShort4",n[n.NormalizedUShort4=15]="NormalizedUShort4"})(re||(re={}));var mt;(function(n){n[n.Static=0]="Static",n[n.Dynamic=1]="Dynamic",n[n.Stream=2]="Stream"})(mt||(mt={}));var pt;(function(n){n[n.UInt8=0]="UInt8",n[n.UInt16=1]="UInt16",n[n.UInt32=2]="UInt32"})(pt||(pt={}));var gs=function(){function n(){}return n._getGLBufferUsage=function(a,t){switch(t){case mt.Static:return a.STATIC_DRAW;case mt.Dynamic:return a.DYNAMIC_DRAW;case mt.Stream:return a.STREAM_DRAW}},n._getGLIndexType=function(a){switch(a){case pt.UInt8:return qe.UNSIGNED_BYTE;case pt.UInt16:return qe.UNSIGNED_SHORT;case pt.UInt32:return qe.UNSIGNED_INT}},n._getGLIndexByteCount=function(a){switch(a){case pt.UInt8:return 1;case pt.UInt16:return 2;case pt.UInt32:return 4}},n._getElementInfo=function(a){var t,e,r=!1;switch(a){case re.Float:t=1,e=qe.FLOAT;break;case re.Vector2:t=2,e=qe.FLOAT;break;case re.Vector3:t=3,e=qe.FLOAT;break;case re.Vector4:t=4,e=qe.FLOAT;break;case re.Byte4:t=4,e=qe.BYTE;break;case re.UByte4:t=4,e=qe.UNSIGNED_BYTE;break;case re.NormalizedByte4:t=4,e=qe.BYTE,r=!0;break;case re.NormalizedUByte4:t=4,e=qe.UNSIGNED_BYTE,r=!0;break;case re.Short2:t=2,e=qe.SHORT;break;case re.UShort2:t=2,e=qe.UNSIGNED_SHORT;break;case re.NormalizedShort2:t=2,e=qe.SHORT,r=!0;break;case re.NormalizedUShort2:t=2,e=qe.UNSIGNED_SHORT,r=!0;break;case re.Short4:t=4,e=qe.SHORT;break;case re.UShort4:t=4,e=qe.UNSIGNED_SHORT;break;case re.NormalizedShort4:t=4,e=qe.SHORT,r=!0;break;case re.NormalizedUShort4:t=4,e=qe.UNSIGNED_SHORT,r=!0;break}return{size:t,type:e,normalized:r}},n}(),ke=function(){function n(i,a,t,e,r){r===void 0&&(r=0),this._semantic=i,this._offset=a,this._format=t,this._bindingIndex=e,this._glElementInfo=gs._getElementInfo(this.format),this._instanceStepRate=Math.floor(r)}return K(n,[{key:"semantic",get:function(){return this._semantic}},{key:"offset",get:function(){return this._offset},set:function(a){this._offset=a}},{key:"format",get:function(){return this._format}},{key:"bindingIndex",get:function(){return this._bindingIndex},set:function(a){this._bindingIndex=a}},{key:"instanceStepRate",get:function(){return this._instanceStepRate}}]),n}(),Pn;(function(n){n[n.VertexBuffer=0]="VertexBuffer",n[n.IndexBuffer=1]="IndexBuffer"})(Pn||(Pn={}));var ms;(function(n){n[n.None=0]="None",n[n.Discard=1]="Discard"})(ms||(ms={}));var ir=function(n){Q(i,n);function i(t,e,r,o){o===void 0&&(o=mt.Static);var s;s=n.call(this,t)||this,s._engine=t,s._type=e,s._bufferUsage=o;var l=t._hardwareRenderer,u=l.gl,c=gs._getGLBufferUsage(u,o),d=e===Pn.VertexBuffer?u.ARRAY_BUFFER:u.ELEMENT_ARRAY_BUFFER;return s._nativeBuffer=u.createBuffer(),s._hardwareRenderer=l,s._glBufferUsage=c,s._glBindTarget=d,s.bind(),typeof r=="number"?(s._byteLength=r,u.bufferData(d,r,c)):(s._byteLength=r.byteLength,u.bufferData(d,r,c)),u.bindBuffer(d,null),s}var a=i.prototype;return a.bind=function(){var e=this._hardwareRenderer.gl;e.bindBuffer(this._glBindTarget,this._nativeBuffer)},a.setData=function(e,r,o,s,l){r===void 0&&(r=0),o===void 0&&(o=0),l===void 0&&(l=ms.None);var u=this._hardwareRenderer.gl,c=this._hardwareRenderer.isWebGL2,d=this._glBindTarget;this.bind(),l===ms.Discard&&u.bufferData(d,this._byteLength,this._glBufferUsage);var _=e.BYTES_PER_ELEMENT||1,h=s?_*s:e.byteLength;if(o!==0||h<e.byteLength){var f=e.byteOffset!==void 0;if(c&&f)u.bufferSubData(d,r,e,o,h/_);else{var g=new Uint8Array(f?e.buffer:e,o*_,h);u.bufferSubData(d,r,g)}}else u.bufferSubData(d,r,e);u.bindBuffer(d,null)},a.getData=function(e,r,o,s){r===void 0&&(r=0),o===void 0&&(o=0);var l=this._hardwareRenderer.isWebGL2;if(l){var u=this._hardwareRenderer.gl;this.bind(),u.getBufferSubData(this._glBindTarget,r,e,o,s)}else throw"Buffer is write-only on WebGL1.0 platforms."},a._onDestroy=function(){var e=this._hardwareRenderer.gl;e.deleteBuffer(this._nativeBuffer),this._nativeBuffer=null,this._hardwareRenderer=null},a.resize=function(e){this.bind();var r=this._hardwareRenderer.gl;r.bufferData(this._glBindTarget,e,this._glBufferUsage),this._byteLength=e},K(i,[{key:"type",get:function(){return this._type}},{key:"byteLength",get:function(){return this._byteLength}},{key:"bufferUsage",get:function(){return this._bufferUsage}}]),i}(Xr),Ti;(function(n){n[n.Points=0]="Points",n[n.Lines=1]="Lines",n[n.LineLoop=2]="LineLoop",n[n.LineStrip=3]="LineStrip",n[n.Triangles=4]="Triangles",n[n.TriangleStrip=5]="TriangleStrip",n[n.TriangleFan=6]="TriangleFan"})(Ti||(Ti={}));var eu=function(){function n(i,a){this._buffer=i,this._format=a}return K(n,[{key:"buffer",get:function(){return this._buffer}},{key:"format",get:function(){return this._format}}]),n}(),k_=function(i,a,t){i===void 0&&(i=0),a===void 0&&(a=0),t===void 0&&(t=Ti.Triangles),this.start=i,this.count=a,this.topology=t},H_=function(n){Q(i,n);function i(t,e){var r;r=n.call(this,t)||this,r._vertexElementMap={},r._instanceCount=0,r._vertexBufferBindings=[],r._indexBufferBinding=null,r._vertexElements=[],r._enableVAO=!0,r._updateFlagManager=new Ja,r._bounds=new sn,r._subMeshes=[],r.name=e,r._platformPrimitive=r._engine._hardwareRenderer.createPlatformPrimitive(_e(r)),r._onBoundsChanged=r._onBoundsChanged.bind(_e(r));var o=r._bounds;return o.min._onValueChanged=r._onBoundsChanged,o.max._onValueChanged=r._onBoundsChanged,r}var a=i.prototype;return a.addSubMesh=function(e,r,o){return o===void 0&&(o=Ti.Triangles),typeof e=="number"&&(e=new k_(e,r,o)),this._subMeshes.push(e),e},a.removeSubMesh=function(e){var r=this._subMeshes,o=r.indexOf(e);o!==-1&&r.splice(o,1)},a.clearSubMesh=function(){this._subMeshes.length=0},a._clearVertexElements=function(){this._vertexElements.length=0;var e=this._vertexElementMap;for(var r in e)delete e[r]},a._addVertexElement=function(e){var r=e.semantic;this._vertexElementMap[r]=e,this._vertexElements.push(e),this._updateFlagManager.dispatch(2)},a._insertVertexElement=function(e,r){var o=r.semantic;this._vertexElementMap[o]=r,this._vertexElements.splice(e,0,r),this._updateFlagManager.dispatch(2)},a._setVertexBufferBinding=function(e,r){if(this._getRefCount()>0){var o=this._vertexBufferBindings[e];o&&o._buffer._addRefCount(-1),r._buffer._addRefCount(1)}this._vertexBufferBindings[e]=r},a._draw=function(e,r){this._platformPrimitive.draw(e,r)},a._addRefCount=function(e){n.prototype._addRefCount.call(this,e);for(var r=this._vertexBufferBindings,o=0,s=r.length;o<s;o++)r[o]._buffer._addRefCount(e)},a._onDestroy=function(){this._vertexBufferBindings=null,this._indexBufferBinding=null,this._vertexElements=null,this._vertexElementMap=null,this._platformPrimitive.destroy()},a._setVertexElements=function(e){this._clearVertexElements();for(var r=0,o=e.length;r<o;r++)this._addVertexElement(e[r])},a._setIndexBufferBinding=function(e){e?(this._indexBufferBinding=e,this._glIndexType=gs._getGLIndexType(e.format),this._glIndexByteCount=gs._getGLIndexByteCount(e.format)):(this._indexBufferBinding=null,this._glIndexType=void 0)},a._onBoundsChanged=function(){this._updateFlagManager.dispatch(1)},K(i,[{key:"bounds",get:function(){return this._bounds},set:function(e){this._bounds!==e&&this._bounds.copyFrom(e)}},{key:"subMesh",get:function(){return this._subMeshes[0]||null}},{key:"subMeshes",get:function(){return this._subMeshes}}]),i}(Xr),tu;(function(n){n[n.Bounds=1]="Bounds",n[n.VertexElements=2]="VertexElements"})(tu||(tu={}));var ys=function(){function n(i,a){this._buffer=i,this._stride=a}return K(n,[{key:"buffer",get:function(){return this._buffer}},{key:"stride",get:function(){return this._stride}}]),n}(),Ri=function(){function n(a,t){this._blendShapeCount=0,this._blendShapes=[],this._subDataDirtyFlags=[],this._vertexBuffers=[],this._uniformOccupiesCount=0,this._useBlendNormal=!1,this._useBlendTangent=!1,this._vertexElementCount=0,this._storeInVertexBufferInfo=[],this._maxCountSingleVertexBuffer=0,this._lastCreateHostInfo=new w(0,0,0),this._canUseTextureStoreData=!0,this._dataTextureInfo=new w,this._engine=a,this._modelMesh=t,this._canUseTextureStoreData=this._engine._hardwareRenderer.capability.canUseFloatTextureBlendShape,this._updateLayoutChange=this._updateLayoutChange.bind(this)}var i=n.prototype;return i._addBlendShape=function(t){this._blendShapes.push(t),this._blendShapeCount++,t._layoutChangeManager.addListener(this._updateLayoutChange),this._updateLayoutChange(0,t),this._subDataDirtyFlags.push(t._createSubDataDirtyFlag())},i._clearBlendShapes=function(){for(var t=this._blendShapes,e=0,r=t.length;e<r;e++)t[e]._layoutChangeManager.removeListener(this._updateLayoutChange);this._useBlendNormal=!1,this._useBlendTangent=!1,this._vertexElementCount=0,this._blendShapes.length=0,this._blendShapeCount=0;for(var o=this._subDataDirtyFlags,s=0,l=o.length;s<l;s++)o[s].destroy();o.length=0},i._updateShaderData=function(t,e){var r=this._blendShapeCount;if(r>0){if(t.enableMacro(n._blendShapeMacro),this._useTextureMode())t.enableMacro(n._blendShapeTextureMacro),t.setTexture(n._blendShapeTextureProperty,this._vertexTexture),t.setVector3(n._blendShapeTextureInfoProperty,this._dataTextureInfo),t.setFloatArray(n._blendShapeWeightsProperty,e.blendShapeWeights),t.enableMacro("OASIS_BLENDSHAPE_COUNT",r.toString()),this._uniformOccupiesCount=r+1;else{var o=this._getVertexBufferModeSupportCount();if(r>o){var s=e._condensedBlendShapeWeights;s||(s=new Float32Array(o),e._condensedBlendShapeWeights=s),this._filterCondensedBlendShapeWeights(e.blendShapeWeights,s),t.setFloatArray(n._blendShapeWeightsProperty,s),this._modelMesh._enableVAO=!1,r=o}else t.setFloatArray(n._blendShapeWeightsProperty,e.blendShapeWeights),this._modelMesh._enableVAO=!0;t.disableMacro(n._blendShapeTextureMacro),t.disableMacro("OASIS_BLENDSHAPE_COUNT"),this._uniformOccupiesCount=r}this._useBlendNormal?t.enableMacro(n._blendShapeNormalMacro):t.disableMacro(n._blendShapeNormalMacro),this._useBlendTangent?t.enableMacro(n._blendShapeTangentMacro):t.disableMacro(n._blendShapeTangentMacro)}else t.disableMacro(n._blendShapeMacro),t.disableMacro("OASIS_BLENDSHAPE_COUNT")},i._useTextureMode=function(){return this._canUseTextureStoreData?this._blendShapeCount>this._getVertexBufferModeSupportCount():!1},i._layoutOrCountChange=function(){var t=this._lastCreateHostInfo;return t.x!==this._blendShapeCount||!!t.y!==this._useBlendNormal||!!t.z!==this._useBlendTangent},i._vertexElementsNeedUpdate=function(){var t=this._getVertexBufferModeSupportCount(),e=this._lastCreateHostInfo;return Math.min(e.x,t)!==Math.min(this._blendShapeCount,t)||!!e.y!==this._useBlendNormal||!!e.z!==this._useBlendTangent},i._needUpdateData=function(){for(var t=this._subDataDirtyFlags,e=0,r=t.length;e<r;e++)if(t[e].flag)return!0;return!1},i._setAttributeModeOffsetInfo=function(t,e){this._vertexElementOffset=t,this._bufferBindingOffset=e},i._addVertexElements=function(t){for(var e=this._bufferBindingOffset,r=0,o=0,s=Math.min(this._blendShapeCount,this._getVertexBufferModeSupportCount());o<s;o++)t._addVertexElement(new ke("POSITION_BS"+o,r,re.Vector3,e)),r+=12,this._useBlendNormal&&(t._addVertexElement(new ke("NORMAL_BS"+o,r,re.Vector3,e)),r+=12),this._useBlendTangent&&(t._addVertexElement(new ke("TANGENT_BS"+o,r,re.Vector3,e)),r+=12)},i._update=function(t,e){var r=this._modelMesh.vertexCount,o=this._useTextureMode(),s=this._layoutOrCountChange()||t;s&&(o?this._createTextureArray(r):this._createVertexBuffers(r,e),this._lastCreateHostInfo.set(this._blendShapeCount,+this._useBlendNormal,+this._useBlendTangent)),this._needUpdateData()&&(o?this._updateTextureArray(r,s):this._updateVertexBuffers(r,s))},i._releaseMemoryCache=function(){for(var t=this,e=t._blendShapes,r=e.length,o=new Array(r),s=0;s<r;s++)o[s]=e[s].name;this._blendShapeNames=o;for(var l=0,u=e.length;l<u;l++)e[l]._layoutChangeManager.removeListener(this._updateLayoutChange);for(var c=this._subDataDirtyFlags,d=0,_=c.length;d<_;d++)c[d].destroy();this._subDataDirtyFlags=null,this._blendShapes=null,this._vertices=null},i._createVertexBuffers=function(t,e){var r=this,o=r._engine,s=r._modelMesh,l=r._blendShapeCount,u=r._vertexBuffers,c=this._vertexElementCount*3,d=c*4,_=Math.floor(255/d),h=Math.ceil(l/_),f=c*t*Math.min(_,l);u.length=h,this._vertices=new Float32Array(f),this._maxCountSingleVertexBuffer=_,this._storeInVertexBufferInfo.length=l;for(var g=this._bufferBindingOffset,y=0;y<h;y++){var p=h-1,v=y===p?l-p*_:_,m=v*d,x=m*t,S=e?mt.Static:mt.Dynamic,C=new ir(o,Pn.VertexBuffer,x,S);s._setVertexBufferBinding(g+y,new ys(C,m)),u[y]=C}},i._createTextureArray=function(t){var e=this._engine._hardwareRenderer.capability.maxTextureSize,r=this._vertexElementCount,o=r*t,s=1;o>e&&(s=Math.ceil(o/e),o=e);var l=this._vertexTexture,u=this._blendShapes.length;l&&l.destroy(),l=new O_(this._engine,o,s,u,j.R32G32B32A32,!1),l.filterMode=$t.Point,this._vertices=new Float32Array(u*o*s*4),this._vertexTexture=l,this._dataTextureInfo.set(r,o,s)},i._updateVertexBuffers=function(t,e){for(var r=this,o=r._blendShapes,s=r._maxCountSingleVertexBuffer,l=this,u=l._vertices,c=l._vertexBuffers,d=l._storeInVertexBufferInfo,_=this._subDataDirtyFlags,h=this._vertexElementCount*3,f=h*4,g=0,y=o.length;g<y;g++){var p=_[g];if(e||p.flag){var v=o[g].frames,m=v.length,x=v[m-1];if(m>0&&x.deltaPositions.length!==t)throw"BlendShape frame deltaPositions length must same with mesh vertexCount.";var S=Math.floor(g/s),C=g%s,A=c[S],T=A.byteLength/(t*4),E=C*h,P=d[g];P||(d[g]=P=new W),P.set(S+1,C*f);for(var b=x.deltaPositions,M=0;M<t;M++){var F=E+T*M,I=b[M];I&&(u[F]=I.x,u[F+1]=I.y,u[F+2]=I.z)}if(E+=3,this._useBlendNormal){var L=x.deltaNormals;if(L)for(var V=0;V<t;V++){var U=E+T*V,D=L[V];D&&(u[U]=D.x,u[U+1]=D.y,u[U+2]=D.z)}E+=3}if(this._useBlendTangent){var R=x.deltaTangents;if(R)for(var N=0;N<t;N++){var X=E+T*N,q=R[N];q&&(u[X]=q.x,u[X+1]=q.y,u[X+2]=q.z)}E+=3}(C===s-1||g===y-1)&&A.setData(u,0,0,A.byteLength/4),p.flag=!1}}},i._updateTextureArray=function(t,e){for(var r=this,o=r._blendShapes,s=r._vertexTexture,l=r._vertices,u=r._subDataDirtyFlags,c=0,d=o.length;c<d;c++){var _=u[c],h=s.width*s.height*4;if(e||_.flag){var f=o[c].frames,g=f.length,y=f[g-1];if(g>0&&y.deltaPositions.length!==t)throw"BlendShape frame deltaPositions length must same with mesh vertexCount.";for(var p=y.deltaPositions,v=y.deltaNormals,m=y.deltaTangents,x=c*h,S=0;S<t;S++){var C=p[S];if(l[x]=C.x,l[x+1]=C.y,l[x+2]=C.z,x+=4,v){var A=v[S];l[x]=A.x,l[x+1]=A.y,l[x+2]=A.z,x+=4}if(m){var T=m[S];l[x]=T.x,l[x+1]=T.y,l[x+2]=T.z,x+=4}}_.flag=!1}}s.setPixelBuffer(0,l)},i._updateLayoutChange=function(t,e){var r=this._blendShapeCount>1,o=1,s=e._useBlendShapeNormal,l=e._useBlendShapeTangent;r&&(s&&(s=this._useBlendNormal),l&&(l=this._useBlendTangent)),s&&o++,l&&o++,this._useBlendNormal=s,this._useBlendTangent=l,this._vertexElementCount=o},i._attributeModeUpdateVertexElement=function(t,e,r,o){var s=this._vertexElementOffset+this._vertexElementCount*o,l=e[r],u=l.x,c=l.y,d=t[s];if(d.bindingIndex=u,d.offset=c,this._useBlendNormal){var _=t[++s];c+=12,_.bindingIndex=u,_.offset=c}if(this._useBlendTangent){var h=t[++s];c+=12,h.bindingIndex=u,h.offset=c}},i._getVertexBufferModeSupportCount=function(){return this._useBlendNormal&&this._useBlendTangent?2:this._useBlendNormal||this._useBlendTangent?4:8},i._filterCondensedBlendShapeWeights=function(t,e){for(var r=e.length,o=this._modelMesh._vertexElements,s=this._storeInVertexBufferInfo,l=Number.POSITIVE_INFINITY,u,c=0,d=Math.min(t.length,this._blendShapeCount);c<d;c++){var _=t[c];if(c<r)this._attributeModeUpdateVertexElement(o,s,c,c),e[c]=_,_<l&&(l=_,u=c);else if(_>l){this._attributeModeUpdateVertexElement(o,s,c,u),e[u]=_,l=Number.POSITIVE_INFINITY;for(var h=0;h<r;h++){var f=e[h];f<l&&(l=f,u=h)}}}},n}();Ri._blendShapeMacro=B.getMacroByName("OASIS_BLENDSHAPE");Ri._blendShapeTextureMacro=B.getMacroByName("OASIS_BLENDSHAPE_TEXTURE");Ri._blendShapeNormalMacro=B.getMacroByName("OASIS_BLENDSHAPE_NORMAL");Ri._blendShapeTangentMacro=B.getMacroByName("OASIS_BLENDSHAPE_TANGENT");Ri._blendShapeWeightsProperty=B.getPropertyByName("u_blendShapeWeights");Ri._blendShapeTextureProperty=B.getPropertyByName("u_blendShapeTexture");Ri._blendShapeTextureInfoProperty=B.getPropertyByName("u_blendShapeTextureInfo");var $;(function(n){n.Position="POSITION",n.Normal="NORMAL",n.Color="COLOR_0",n.Tangent="TANGENT",n.BoneWeight="WEIGHTS_0",n.BoneIndex="JOINTS_0",n.UV="TEXCOORD_0",n.UV1="TEXCOORD_1",n.UV2="TEXCOORD_2",n.UV3="TEXCOORD_3",n.UV4="TEXCOORD_4",n.UV5="TEXCOORD_5",n.UV6="TEXCOORD_6",n.UV7="TEXCOORD_7"})($||($={}));var Et=function(n){Q(i,n);function i(t,e){var r;return r=n.call(this,t)||this,r._vertexCount=0,r._accessible=!0,r._verticesFloat32=null,r._verticesUint8=null,r._indices=null,r._indicesFormat=null,r._indicesChangeFlag=!1,r._positions=null,r._normals=null,r._colors=null,r._tangents=null,r._uv=null,r._uv1=null,r._uv2=null,r._uv3=null,r._uv4=null,r._uv5=null,r._uv6=null,r._uv7=null,r._boneWeights=null,r._boneIndices=null,r._bufferStrides=[],r._vertexBufferUpdateFlag=0,r._vertexDataUpdateFlag=0,r._vertexElementsUpdate=!1,r._customVertexElements=[],r._vertexCountChanged=!1,r.name=e,r._blendShapeManager=new Ri(t,_e(r)),r}var a=i.prototype;return a.setPositions=function(e){if(!this._accessible)throw"Not allowed to access data while accessible is false.";if(!(!this._positions&&!e)){var r=(e==null?void 0:e.length)||0;this._vertexCountChanged=this._vertexCount!=r,this._vertexCount=r,this._vertexElementsUpdate=!!this._positions!=!!e,this._vertexBufferUpdateFlag|=1,this._vertexDataUpdateFlag&=-2,this._positions=e}},a.getPositions=function(){if(!this._accessible)throw"Not allowed to access data while accessible is false.";return this._positions},a.setNormals=function(e){if(!this._accessible)throw"Not allowed to access data while accessible is false.";if(e){if(e.length!==this._vertexCount)throw"The array provided needs to be the same size as vertex count."}else if(!this._normals)return;this._vertexElementsUpdate=!!this._normals!=!!e,this._vertexBufferUpdateFlag|=2,this._vertexDataUpdateFlag&=-3,this._normals=e},a.getNormals=function(){if(!this._accessible)throw"Not allowed to access data while accessible is false.";return this._normals},a.setColors=function(e){if(!this._accessible)throw"Not allowed to access data while accessible is false.";if(e){if(e.length!==this._vertexCount)throw"The array provided needs to be the same size as vertex count."}else if(!this._colors)return;this._vertexElementsUpdate=!!this._colors!=!!e,this._vertexBufferUpdateFlag|=4,this._vertexDataUpdateFlag&=-5,this._colors=e},a.getColors=function(){if(!this._accessible)throw"Not allowed to access data while accessible is false.";return this._colors},a.setBoneWeights=function(e){if(!this._accessible)throw"Not allowed to access data while accessible is false.";if(e){if(e.length!==this._vertexCount)throw"The array provided needs to be the same size as vertex count."}else if(!this._boneWeights)return;this._vertexElementsUpdate=!!this._boneWeights!=!!e,this._vertexBufferUpdateFlag|=16,this._vertexDataUpdateFlag&=-17,this._boneWeights=e},a.getBoneWeights=function(){if(!this._accessible)throw"Not allowed to access data while accessible is false.";return this._boneWeights},a.setBoneIndices=function(e){if(!this._accessible)throw"Not allowed to access data while accessible is false.";if(e){if((e==null?void 0:e.length)!==this._vertexCount)throw"The array provided needs to be the same size as vertex count."}else if(!this._boneIndices)return;this._vertexElementsUpdate=!!this._boneIndices!=!!e,this._vertexBufferUpdateFlag|=32,this._vertexDataUpdateFlag&=-33,this._boneIndices=e},a.getBoneIndices=function(){if(!this._accessible)throw"Not allowed to access data while accessible is false.";return this._boneIndices},a.setTangents=function(e){if(!this._accessible)throw"Not allowed to access data while accessible is false.";if(e){if(e.length!==this._vertexCount)throw"The array provided needs to be the same size as vertex count."}else if(!this._tangents)return;this._vertexElementsUpdate=!!this._tangents!=!!e,this._vertexBufferUpdateFlag|=8,this._vertexDataUpdateFlag&=-9,this._tangents=e},a.getTangents=function(){if(!this._accessible)throw"Not allowed to access data while accessible is false.";return this._tangents},a.setUVs=function(e,r){if(!this._accessible)throw"Not allowed to access data while accessible is false.";if(e&&e.length!==this._vertexCount)throw"The array provided needs to be the same size as vertex count.";switch(r=r??0,r){case 0:if(!this._uv&&!e)return;this._vertexElementsUpdate=!!this._uv!=!!e,this._vertexBufferUpdateFlag|=64,this._vertexDataUpdateFlag&=-65,this._uv=e;break;case 1:if(!this._uv1&&!e)return;this._vertexElementsUpdate=!!this._uv1!=!!e,this._vertexBufferUpdateFlag|=128,this._vertexDataUpdateFlag&=-129,this._uv1=e;break;case 2:if(!this._uv2&&!e)return;this._vertexElementsUpdate=!!this._uv2!=!!e,this._vertexBufferUpdateFlag|=256,this._vertexDataUpdateFlag&=-257,this._uv2=e;break;case 3:if(!this._uv3&&!e)return;this._vertexElementsUpdate=!!this._uv3!=!!e,this._vertexBufferUpdateFlag|=512,this._vertexDataUpdateFlag&=-513,this._uv3=e;break;case 4:if(!this._uv4&&!e)return;this._vertexElementsUpdate=!!this._uv4!=!!e,this._vertexBufferUpdateFlag|=1024,this._vertexDataUpdateFlag&=-1025,this._uv4=e;break;case 5:if(!this._uv5&&!e)return;this._vertexElementsUpdate=!!this._uv5!=!!e,this._vertexBufferUpdateFlag|=2048,this._vertexDataUpdateFlag&=-2049,this._uv5=e;break;case 6:if(!this._uv6&&!e)return;this._vertexElementsUpdate=!!this._uv6!=!!e,this._vertexBufferUpdateFlag|=4096,this._vertexDataUpdateFlag&=-4097,this._uv6=e;break;case 7:if(!this._uv7&&!e)return;this._vertexElementsUpdate=!!this._uv7!=!!e,this._vertexBufferUpdateFlag|=8192,this._vertexDataUpdateFlag&=-8193,this._uv7=e;break;default:throw"The index of channel needs to be in range [0 - 7]."}},a.getUVs=function(e){if(!this._accessible)throw"Not allowed to access data while accessible is false.";switch(e=e??0,e){case 0:return this._uv;case 1:return this._uv1;case 2:return this._uv2;case 3:return this._uv3;case 4:return this._uv4;case 5:return this._uv5;case 6:return this._uv6;case 7:return this._uv7}throw"The index of channel needs to be in range [0 - 7]."},a.setIndices=function(e){if(!this._accessible)throw"Not allowed to access data while accessible is false.";this._indices!==e&&(this._indices=e,He(e,Uint8Array)?this._indicesFormat=pt.UInt8:He(e,Uint16Array)?this._indicesFormat=pt.UInt16:He(e,Uint32Array)&&(this._indicesFormat=pt.UInt32)),this._indicesChangeFlag=!0},a.getIndices=function(){if(!this._accessible)throw"Not allowed to access data while accessible is false.";return this._indices},a.setVertexElements=function(e){if(!this._accessible)throw"Not allowed to access data while accessible is false.";var r=this._customVertexElements;r.length=0;for(var o={},s=0,l=e.length;s<l;s++){var u=e[s];r.push(u),o[u.semantic]=u}if(o[$.Position]){var c=this.getPositions();c&&(this._vertexBufferUpdateFlag|=1)}else this.setPositions(null);if(o[$.Normal]){var d=this.getNormals();d&&(this._vertexBufferUpdateFlag|=2)}else this.setNormals(null);if(o[$.Color]){var _=this.getColors();_&&(this._vertexBufferUpdateFlag|=4)}else this.setColors(null);if(o[$.BoneWeight]){var h=this.getBoneWeights();h&&(this._vertexBufferUpdateFlag|=16)}else this.setBoneWeights(null);if(o[$.BoneIndex]){var f=this.getBoneIndices();f&&(this._vertexBufferUpdateFlag|=32)}else this.setBoneIndices(null);if(o[$.Tangent]){var g=this.getTangents();g&&(this._vertexBufferUpdateFlag|=8)}else this.setTangents(null);if(o[$.UV]){var y=this.getUVs(0);y&&(this._vertexBufferUpdateFlag|=64)}else this.setUVs(null,0);if(o[$.UV1]){var p=this.getUVs(1);p&&(this._vertexBufferUpdateFlag|=128)}else this.setUVs(null,1);if(o[$.UV2]){var v=this.getUVs(2);v&&(this._vertexBufferUpdateFlag|=256)}else this.setUVs(null,2);if(o[$.UV3]){var m=this.getUVs(3);m&&(this._vertexBufferUpdateFlag|=512)}else this.setUVs(null,3);if(o[$.UV4]){var x=this.getUVs(4);x&&(this._vertexBufferUpdateFlag|=1024)}else this.setUVs(null,4);if(o[$.UV5]){var S=this.getUVs(5);S&&(this._vertexBufferUpdateFlag|=2048)}else this.setUVs(null,5);if(o[$.UV6]){var C=this.getUVs(6);C&&(this._vertexBufferUpdateFlag|=4096)}else this.setUVs(null,6);if(o[$.UV7]){var A=this.getUVs(7);A&&(this._vertexBufferUpdateFlag|=8192)}else this.setUVs(null,7);this._vertexElementsUpdate=!0},a.setVertexBufferBinding=function(e,r,o){r===void 0&&(r=0),o===void 0&&(o=0);var s=e,l=s.buffer!==void 0;l||(s=new ys(e,r));var u=this._vertexBufferBindings;u.length<=o&&(u.length=o+1),this._setVertexBufferBinding(l?r:o,s),this._vertexDataUpdateFlag|=1},a.setVertexBufferBindings=function(e,r){r===void 0&&(r=0);var o=this._vertexBufferBindings,s=e.length,l=r+s;o.length<l&&(o.length=l);for(var u=0;u<s;u++)this._setVertexBufferBinding(r+u,e[u])},a.addBlendShape=function(e){if(!this._accessible)throw"Not allowed to access data while accessible is false.";this._blendShapeManager._addBlendShape(e)},a.clearBlendShapes=function(){if(!this._accessible)throw"Not allowed to access data while accessible is false.";this._blendShapeManager._clearBlendShapes()},a.getBlendShapeName=function(e){if(this._accessible){var r=this._blendShapeManager._blendShapes;return r[e].name}else return this._blendShapeManager._blendShapeNames[e]},a.uploadData=function(e){var r,o;if(!this._accessible)throw"Not allowed to access data while accessible is false.";this._updateVertexElements();var s=(r=this._vertexBufferBindings[0])==null?void 0:r._buffer;if(this._vertexCountChanged){this._vertexBufferUpdateFlag=65535,s==null||s.destroy();var l=this._bufferStrides[0]/4,u=l*this.vertexCount,c=new Float32Array(u);this._verticesFloat32=c,this._verticesUint8=new Uint8Array(c.buffer),this._updateVertices(c);var d=e?mt.Static:mt.Dynamic,_=new ir(this._engine,Pn.VertexBuffer,c,d);this._setVertexBufferBinding(0,new ys(_,l*4)),this._vertexCountChanged=!1}else if(this._vertexBufferUpdateFlag&65535){var h=this._verticesFloat32;this._updateVertices(h),s.setData(h)}var f=this,g=f._indices,y=(o=this._indexBufferBinding)==null?void 0:o._buffer;if(g)if(!y||g.byteLength!=y.byteLength){y==null||y.destroy();var p=new ir(this._engine,Pn.IndexBuffer,g);this._setIndexBufferBinding(new eu(p,this._indicesFormat)),this._indicesChangeFlag=!1}else this._indicesChangeFlag&&(y.setData(g),this._indexBufferBinding._format!==this._indicesFormat&&this._setIndexBufferBinding(new eu(y,this._indicesFormat)),this._indicesChangeFlag=!1);else y&&(y.destroy(),this._setIndexBufferBinding(null));var v=this,m=v._blendShapeManager;m._blendShapeCount>0&&m._update(this._vertexCountChanged,e),e&&(this._accessible=!1,this._releaseCache())},a.calculateTangents=function(){if(!this._normals||!this._uv)throw"Set normal and uv before calculation.";for(var e=this,r=e._indices,o=e._positions,s=e._normals,l=e._uv,u=e._vertexCount,c=i._tempVec0,d=i._tempVec1,_=i._tempVec2,h=i._tempVec3,f=i._tempVec4,g=r?r.length/3:o.length/3,y=new Array(u),p=new Array(u),v=0;v<u;v++)y[v]=new he,p[v]=new w;for(var m=0;m<g;m++){var x=3*m,S=3*m+1,C=3*m+2;r&&(x=r[x],S=r[S],C=r[C]);var A=o[x],T=o[S],E=o[C],P=l[x],b=l[S],M=l[C];w.subtract(T,A,c),w.subtract(E,A,d);var F=b.x-P.x,I=M.x-P.x,L=b.y-P.y,V=M.y-P.y,U=1/(F*V-I*L);w.scale(c,V*U,_),w.scale(d,L*U,f),w.subtract(_,f,_),w.scale(d,F*U,h),w.scale(c,I*U,f),w.subtract(h,f,h);var D=y[x];D.set(D.x+_.x,D.y+_.y,D.z+_.z,1),D=y[S],D.set(D.x+_.x,D.y+_.y,D.z+_.z,1),D=y[C],D.set(D.x+_.x,D.y+_.y,D.z+_.z,1),p[x].add(h),p[S].add(h),p[C].add(h)}for(var R=0;R<u;R++){var N=s[R],X=p[R],q=y[R];_.set(q.x,q.y,q.z),w.cross(_,X,f);var te=w.dot(f,N)>0?1:-1;w.scale(N,w.dot(_,N),f),w.subtract(_,f,_),_.normalize(),q.set(_.x,_.y,_.z,te)}this.setTangents(y)},a._onDestroy=function(){n.prototype._onDestroy.call(this),this._accessible&&this._releaseCache()},a._supplementaryVertexElements=function(){this._clearVertexElements();for(var e=this._customVertexElements,r=0,o=e.length;r<o;r++)this._addVertexElement(e[r]);var s=this._vertexElementMap;this._positions&&!s[$.Position]&&this._insertVertexAttribute($.Position),this._normals&&!s[$.Normal]&&this._insertVertexAttribute($.Normal),this._colors&&!s[$.Color]&&this._insertVertexAttribute($.Color),this._boneWeights&&!s[$.BoneWeight]&&this._insertVertexAttribute($.BoneWeight),this._boneIndices&&!s[$.BoneIndex]&&this._insertVertexAttribute($.BoneIndex),this._tangents&&!s[$.Tangent]&&this._insertVertexAttribute($.Tangent),this._uv&&!s[$.UV]&&this._insertVertexAttribute($.UV),this._uv1&&!s[$.UV1]&&this._insertVertexAttribute($.UV1),this._uv2&&!s[$.UV2]&&this._insertVertexAttribute($.UV2),this._uv3&&!s[$.UV3]&&this._insertVertexAttribute($.UV3),this._uv4&&!s[$.UV4]&&this._insertVertexAttribute($.UV4),this._uv5&&!s[$.UV5]&&this._insertVertexAttribute($.UV5),this._uv6&&!s[$.UV6]&&this._insertVertexAttribute($.UV6),this._uv7&&!s[$.UV7]&&this._insertVertexAttribute($.UV7)},a._updateVertexElements=function(){var e=this._blendShapeManager,r=!e._useTextureMode()&&e._vertexElementsNeedUpdate();(this._vertexElementsUpdate||r)&&(this._supplementaryVertexElements(),r&&e._blendShapeCount>0&&(e._setAttributeModeOffsetInfo(this._vertexElements.length,this._vertexBufferBindings.length||1),e._addVertexElements(this)),this._vertexElementsUpdate=!1)},a._updateVertices=function(e){var r=this,o=r._bufferStrides,s=r._vertexCount,l=r._positions,u=r._normals,c=r._colors,d=r._vertexBufferUpdateFlag,_=r._boneWeights,h=r._boneIndices,f=r._tangents,g=r._uv,y=r._uv1,p=r._uv2,v=r._uv3,m=r._uv4,x=r._uv5,S=r._uv6,C=r._uv7,A=o[0]/4;if(d&1)for(var T=0;T<s;T++){var E=A*T,P=l[T];e[E]=P.x,e[E+1]=P.y,e[E+2]=P.z}var b=3;if(u){if(d&2)for(var M=0;M<s;M++){var F=A*M+b,I=u[M];I&&(e[F]=I.x,e[F+1]=I.y,e[F+2]=I.z)}b+=3}if(c){if(d&4)for(var L=0;L<s;L++){var V=A*L+b,U=c[L];U&&(e[V]=U.r,e[V+1]=U.g,e[V+2]=U.b,e[V+3]=U.a)}b+=4}if(_){if(d&16)for(var D=0;D<s;D++){var R=A*D+b,N=_[D];N&&(e[R]=N.x,e[R+1]=N.y,e[R+2]=N.z,e[R+3]=N.w)}b+=4}if(h){if(d&32)for(var X=this._verticesUint8,q=0;q<s;q++){var te=A*q+b,ie=h[q];if(ie){var ce=te*4;X[ce]=ie.x,X[ce+1]=ie.y,X[ce+2]=ie.z,X[ce+3]=ie.w}}b+=1}if(f){if(d&8)for(var le=0;le<s;le++){var ae=A*le+b,Ee=f[le];Ee&&(e[ae]=Ee.x,e[ae+1]=Ee.y,e[ae+2]=Ee.z,e[ae+3]=Ee.w)}b+=4}if(g){if(d&64)for(var Ne=0;Ne<s;Ne++){var tt=A*Ne+b,ct=g[Ne];ct&&(e[tt]=ct.x,e[tt+1]=ct.y)}b+=2}if(y){if(d&128)for(var Ke=0;Ke<s;Ke++){var pn=A*Ke+b,nt=y[Ke];nt&&(e[pn]=nt.x,e[pn+1]=nt.y)}b+=2}if(p){if(d&256)for(var rt=0;rt<s;rt++){var tn=A*rt+b,Gt=p[rt];Gt&&(e[tn]=Gt.x,e[tn+1]=Gt.y)}b+=2}if(v){if(d&512)for(var wt=0;wt<s;wt++){var Yn=A*wt+b,nn=v[wt];nn&&(e[Yn]=nn.x,e[Yn+1]=nn.y)}b+=2}if(m){if(d&1024)for(var Fn=0;Fn<s;Fn++){var ho=A*Fn+b,fo=m[Fn];fo&&(e[ho]=fo.x,e[ho+1]=fo.y)}b+=2}if(x){if(d&2048)for(var qr=0;qr<s;qr++){var vo=A*qr+b,Qr=x[qr];Qr&&(e[vo]=Qr.x,e[vo+1]=Qr.y)}b+=2}if(S){if(d&4096)for(var $r=0;$r<s;$r++){var po=A*$r+b,_a=S[$r];_a&&(e[po]=_a.x,e[po+1]=_a.y)}b+=2}if(C){if(d&8192)for(var Cr=0;Cr<s;Cr++){var oh=A*Cr+b,Uu=C[Cr];Uu&&(e[oh]=Uu.x,e[oh+1]=Uu.y)}b+=2}this._vertexBufferUpdateFlag=0},a._insertVertexAttribute=function(e){for(var r=this._getAttributeFormat(e),o=this._getAttributeByteLength(e),s=this._vertexElements,l=0,u=0,c=s.length;l<c;l++){var d=s[l];if(d.bindingIndex==0){if(d.offset-u>=o)break;u=d.offset+this._getAttributeByteLength(d.semantic)}}this._insertVertexElement(l,new ke(e,u,r,0)),this._bufferStrides[0]=u+o},a._getAttributeFormat=function(e){switch(e){case $.Position:return re.Vector3;case $.Normal:return re.Vector3;case $.Color:return re.Vector4;case $.BoneWeight:return re.Vector4;case $.BoneIndex:return re.UByte4;case $.Tangent:return re.Vector4;case $.UV:case $.UV1:case $.UV2:case $.UV3:case $.UV4:case $.UV5:case $.UV6:case $.UV7:return re.Vector2}},a._getAttributeByteLength=function(e){switch(e){case $.Position:return 12;case $.Normal:return 12;case $.Color:return 16;case $.BoneWeight:return 16;case $.BoneIndex:return 4;case $.Tangent:return 16;case $.UV:case $.UV1:case $.UV2:case $.UV3:case $.UV4:case $.UV5:case $.UV6:case $.UV7:return 8}},a._releaseCache=function(){this._verticesUint8=null,this._indices=null,this._verticesFloat32=null,this._positions=null,this._tangents=null,this._normals=null,this._colors=null,this._uv=null,this._uv1=null,this._uv2=null,this._uv3=null,this._uv4=null,this._uv5=null,this._uv6=null,this._uv7=null,this._blendShapeManager._releaseMemoryCache()},K(i,[{key:"accessible",get:function(){return this._accessible}},{key:"vertexCount",get:function(){if(this._vertexDataUpdateFlag&1){var e=0,r=this._vertexElementMap[$.Position];if(r){var o=this._vertexBufferBindings[r.bindingIndex];o&&(e=o.buffer.byteLength/o.stride)}this._vertexCount=e,this._vertexDataUpdateFlag&=-2}return this._vertexCount}},{key:"vertexElements",get:function(){return this._updateVertexElements(),this._vertexElements}},{key:"vertexBufferBindings",get:function(){return this._vertexBufferBindings}},{key:"blendShapes",get:function(){if(!this._accessible)throw"Not allowed to access data while accessible is false.";return this._blendShapeManager._blendShapes}},{key:"blendShapeCount",get:function(){return this._blendShapeManager._blendShapeCount}}]),i}(H_);Et._tempVec0=new w;Et._tempVec1=new w;Et._tempVec2=new w;Et._tempVec3=new w;Et._tempVec4=new w;var Tf;(function(n){n[n.Position=1]="Position",n[n.Normal=2]="Normal",n[n.Color=4]="Color",n[n.Tangent=8]="Tangent",n[n.BoneWeight=16]="BoneWeight",n[n.BoneIndex=32]="BoneIndex",n[n.UV=64]="UV",n[n.UV1=128]="UV1",n[n.UV2=256]="UV2",n[n.UV3=512]="UV3",n[n.UV4=1024]="UV4",n[n.UV5=2048]="UV5",n[n.UV6=4096]="UV6",n[n.UV7=8192]="UV7",n[n.All=65535]="All"})(Tf||(Tf={}));var b0=function(n){Q(i,n);function i(a){var t;return t=n.call(this,null)||this,t.name=a,t.inverseBindMatrices=[],t.joints=[],t.skeleton="none",t}return i}(ar),et=function(n){Q(i,n);function i(t){var e;return e=n.call(this,t)||this,e._onMeshChanged=e._onMeshChanged.bind(_e(e)),e}var a=i.prototype;return a._onDestroy=function(){n.prototype._onDestroy.call(this);var e=this._mesh;e&&!e.destroyed&&(e._addRefCount(-1),this._mesh=null)},a._cloneTo=function(e){e.mesh=this._mesh},a._updateBounds=function(e){var r=this._mesh;if(r){var o=r.bounds,s=this._entity.transform.worldMatrix;sn.transform(o,s,e)}else e.min.set(0,0,0),e.max.set(0,0,0)},a._render=function(e){var r=this._mesh;if(r){if(this._dirtyUpdateFlag&2){var o=this.shaderData,s=r._vertexElements;o.disableMacro(i._uvMacro),o.disableMacro(i._uv1Macro),o.disableMacro(i._normalMacro),o.disableMacro(i._tangentMacro),o.disableMacro(i._vertexColorMacro);for(var l=0,u=s.length;l<u;l++)switch(s[l].semantic){case"TEXCOORD_0":o.enableMacro(i._uvMacro);break;case"TEXCOORD_1":o.enableMacro(i._uv1Macro);break;case"NORMAL":o.enableMacro(i._normalMacro);break;case"TANGENT":o.enableMacro(i._tangentMacro);break;case"COLOR_0":o.enableMacro(i._vertexColorMacro);break}this._dirtyUpdateFlag&=-3}for(var c=r.subMeshes,d=e.camera._renderPipeline,_=this._engine._renderElementPool,h=0,f=c.length;h<f;h++){var g=this._materials[h];if(g)for(var y=g.renderStates,p=g.shader.passes,v=0,m=p.length;v<m;v++){var x=_.getFromPool();x.setValue(this,r,c[h],g,y[v],p[v]),d.pushPrimitive(x)}}}else we.error("mesh is null.")},a._setMesh=function(e){var r=this._mesh;r&&(r._addRefCount(-1),r._updateFlagManager.removeListener(this._onMeshChanged)),e&&(e._addRefCount(1),e._updateFlagManager.addListener(this._onMeshChanged),this._dirtyUpdateFlag|=3),this._mesh=e},a._onMeshChanged=function(e){e&tu.Bounds&&(this._dirtyUpdateFlag|=ht.WorldVolume),e&tu.VertexElements&&(this._dirtyUpdateFlag|=2)},K(i,[{key:"mesh",get:function(){return this._mesh},set:function(e){this._mesh!==e&&this._setMesh(e)}}]),i}(me);et._uvMacro=B.getMacroByName("O3_HAS_UV");et._uv1Macro=B.getMacroByName("O3_HAS_UV1");et._normalMacro=B.getMacroByName("O3_HAS_NORMAL");et._tangentMacro=B.getMacroByName("O3_HAS_TANGENT");et._vertexColorMacro=B.getMacroByName("O3_HAS_VERTEXCOLOR");O([Y],et.prototype,"_mesh",void 0);O([Y],et.prototype,"_onMeshChanged",null);var Ef;(function(n){n[n.VertexElementMacro=2]="VertexElementMacro",n[n.All=3]="All"})(Ef||(Ef={}));var nu=function(){function n(){}return n._floatMatrixMultiply=function(a,t,e,r,o){var s=a.elements,l=s[0],u=s[1],c=s[2],d=s[3],_=s[4],h=s[5],f=s[6],g=s[7],y=s[8],p=s[9],v=s[10],m=s[11],x=s[12],S=s[13],C=s[14],A=s[15],T=t[e],E=t[e+1],P=t[e+2],b=t[e+3],M=t[e+4],F=t[e+5],I=t[e+6],L=t[e+7],V=t[e+8],U=t[e+9],D=t[e+10],R=t[e+11],N=t[e+12],X=t[e+13],q=t[e+14],te=t[e+15];r[o]=l*T+_*E+y*P+x*b,r[o+1]=u*T+h*E+p*P+S*b,r[o+2]=c*T+f*E+v*P+C*b,r[o+3]=d*T+g*E+m*P+A*b,r[o+4]=l*M+_*F+y*I+x*L,r[o+5]=u*M+h*F+p*I+S*L,r[o+6]=c*M+f*F+v*I+C*L,r[o+7]=d*M+g*F+m*I+A*L,r[o+8]=l*V+_*U+y*D+x*R,r[o+9]=u*V+h*U+p*D+S*R,r[o+10]=c*V+f*U+v*D+C*R,r[o+11]=d*V+g*U+m*D+A*R,r[o+12]=l*N+_*X+y*q+x*te,r[o+13]=u*N+h*X+p*q+S*te,r[o+14]=c*N+f*X+v*q+C*te,r[o+15]=d*N+g*X+m*q+A*te},n._reflectGet=function(a,t){for(var e=this._stringToPath(t),r=a,o=0,s=e.length;r!=null&&o<s;)r=r[e[o++]];return o&&o==s?r:void 0},n._stringToPath=function(a){var t=[];return a.charCodeAt(0)===Tw&&t.push(""),a.replace(Pw,function(e,r,o,s){var l=e;o?l=s.replace(Ew,"$1"):r&&(l=r.trim()),t.push(l)}),t},n}(),Tw=".".charCodeAt(0),Ew=/\\(\\)?/g,Pw=RegExp(`[^.[\\]]+|\\[(?:([^"'][^[]*)|(["'])((?:(?!\\2)[^\\\\]|\\\\.)*?)\\2)\\]|(?=(?:\\.|\\[\\])(?:\\.|\\[\\]|$))`,"g"),ut=function(n){Q(i,n);function i(t){var e;e=n.call(this,t)||this,e._hasInitSkin=!1,e._jointDataCreateCache=new W(-1,-1),e._localBounds=new sn,e._skin=null;var r=e.entity.engine._hardwareRenderer,o=r.renderStates.getParameter(r.gl.MAX_VERTEX_UNIFORM_VECTORS);r.renderer==="Apple GPU"&&(o=Math.min(o,256)),e._maxVertexUniformVectors=o,e._onLocalBoundsChanged=e._onLocalBoundsChanged.bind(_e(e));var s=e._localBounds;return s.min._onValueChanged=e._onLocalBoundsChanged,s.max._onValueChanged=e._onLocalBoundsChanged,e}var a=i.prototype;return a.update=function(){this._hasInitSkin||(this._initSkin(),this._hasInitSkin=!0);var e=this._skin;if(e)for(var r=e.inverseBindMatrices,o=this._rootBone.getInvModelMatrix(),s=this,l=s._jointEntities,u=s._jointMatrices,c=l.length-1;c>=0;c--){var d=l[c],_=c*16;d?nu._floatMatrixMultiply(d.transform.worldMatrix,r[c].elements,0,u,_):u.set(r[c].elements,_),nu._floatMatrixMultiply(o,u,_,u,_)}},a._updateShaderData=function(e){var r=this._rootBone?this._rootBone.transform.worldMatrix:this.entity.transform.worldMatrix;this._updateTransformShaderData(e,r);var o=this.shaderData,s=this.mesh,l=s._blendShapeManager;l._updateShaderData(o,this);var u=this._skin;if(u){var c=l._uniformOccupiesCount,d=u.joints.length,_=this._jointDataCreateCache,h=d!==_.x;if(h||c!==_.y){var f=Math.ceil((this._maxVertexUniformVectors-(44+c))/4);if(d>f){var g=this.engine;if(g._hardwareRenderer.canIUseMoreJoints){if(h){var y;(y=this._jointTexture)==null||y.destroy(),this._jointTexture=new dn(g,4,d,j.R32G32B32A32,!1),this._jointTexture.filterMode=$t.Point}o.disableMacro("O3_JOINTS_NUM"),o.enableMacro("O3_USE_JOINT_TEXTURE"),o.setTexture(i._jointSamplerProperty,this._jointTexture)}else we.error("component's joints count("+d+") greater than device's MAX_VERTEX_UNIFORM_VECTORS number "+this._maxVertexUniformVectors+", and don't support jointTexture in this device. suggest joint count less than "+f+".",this)}else{var p;(p=this._jointTexture)==null||p.destroy(),o.disableMacro("O3_USE_JOINT_TEXTURE"),o.enableMacro("O3_JOINTS_NUM",f.toString()),o.setFloatArray(i._jointMatrixProperty,this._jointMatrices)}_.set(d,c)}this._jointTexture&&this._jointTexture.setPixelBuffer(this._jointMatrices)}},a._cloneTo=function(e){n.prototype._cloneTo.call(this,e),this._blendShapeWeights&&(e._blendShapeWeights=this._blendShapeWeights.slice())},a._registerEntityTransformListener=function(){},a._updateBounds=function(e){if(this._rootBone){var r=this._localBounds,o=this._rootBone.transform.worldMatrix;sn.transform(r,o,e)}else n.prototype._updateBounds.call(this,e)},a._initSkin=function(){var e=this.entity.engine._hardwareRenderer;if(e){var r=this,o=r._skin,s=r.shaderData;if(!o){s.disableMacro("O3_HAS_SKIN");return}for(var l=o.joints,u=l.length,c=new Array(u),d=u-1;d>=0;d--)c[d]=this._findByEntityName(this.entity,l[d]);this._jointEntities=c,this._jointMatrices=new Float32Array(u*16);var _=this._rootBone,h=this._findByEntityName(this.entity,o.skeleton);_&&_.transform._updateFlagManager.removeListener(this._onTransformChanged),h.transform._updateFlagManager.addListener(this._onTransformChanged);var f=l.indexOf(o.skeleton);if(f!==-1)sn.transform(this._mesh.bounds,o.inverseBindMatrices[f],this._localBounds);else{for(var g=0,y=new J(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0),p=o.inverseBindMatrices,v=h.children,m=0;m<u;m++){var x=c.indexOf(v[m]);x!==-1&&(J.add(y,p[x],y),g++)}g!==0?(J.multiplyScalar(y,1/g,y),sn.transform(this._mesh.bounds,y,this._localBounds)):this._localBounds.copyFrom(this._mesh.bounds)}this._rootBone=h,u?(s.enableMacro("O3_HAS_SKIN"),s.setInt(i._jointCountProperty,u)):s.disableMacro("O3_HAS_SKIN")}},a._findByEntityName=function(e,r){if(!e)return null;var o=e.findByName(r);return o||this._findByEntityName(e.parent,r)},a._checkBlendShapeWeightLength=function(){var e=this._mesh,r=e?e.blendShapeCount:0,o=this._blendShapeWeights;if(o){var s=o.length;if(s!==r){var l=new Float32Array(r);if(r>s)l.set(o);else for(var u=0;u<r;u++)l[u]=o[u];this._blendShapeWeights=l}}else this._blendShapeWeights=new Float32Array(r)},a._onLocalBoundsChanged=function(){this._dirtyUpdateFlag|=ht.WorldVolume},K(i,[{key:"blendShapeWeights",get:function(){return this._checkBlendShapeWeightLength(),this._blendShapeWeights},set:function(e){this._checkBlendShapeWeightLength();var r=this._blendShapeWeights;if(e.length<=r.length)r.set(e);else for(var o=0,s=r.length;o<s;o++)r[o]=e[o]}},{key:"skin",get:function(){return this._skin},set:function(e){this._skin!==e&&(this._skin=e,this._hasInitSkin=!1)}},{key:"localBounds",get:function(){return this._localBounds},set:function(e){this._localBounds!==e&&this._localBounds.copyFrom(e)}},{key:"rootBone",get:function(){return this._rootBone},set:function(e){this._skin.skeleton=e.name,this._hasInitSkin=!1,this._dirtyUpdateFlag|=ht.WorldVolume}}]),i}(et);ut._tempMatrix=new J;ut._jointCountProperty=B.getPropertyByName("u_jointCount");ut._jointSamplerProperty=B.getPropertyByName("u_jointSampler");ut._jointMatrixProperty=B.getPropertyByName("u_jointMatrix");O([Y],ut.prototype,"_hasInitSkin",void 0);O([Y],ut.prototype,"_jointDataCreateCache",void 0);O([Y],ut.prototype,"_blendShapeWeights",void 0);O([Y],ut.prototype,"_maxVertexUniformVectors",void 0);O([Y],ut.prototype,"_rootBone",void 0);O([Y],ut.prototype,"_localBounds",void 0);O([Y],ut.prototype,"_jointMatrices",void 0);O([Y],ut.prototype,"_jointTexture",void 0);O([Y],ut.prototype,"_jointEntities",void 0);O([Y],ut.prototype,"_condensedBlendShapeWeights",void 0);O([Y],ut.prototype,"_onLocalBoundsChanged",null);var to=function(){function n(){}return n.createSphere=function(a,t,e,r){t===void 0&&(t=.5),e===void 0&&(e=18),r===void 0&&(r=!0);var o=new Et(a);e=Math.max(2,Math.floor(e));for(var s=e+1,l=s*s,u=e*e,c=n._generateIndices(a,l,u*6),d=Math.PI,_=d*2,h=1/s,f=1/e,g=new Array(l),y=new Array(l),p=new Array(l),v=0;v<l;++v){var m=v%s,x=v*h|0,S=m*f,C=x*f,A=S*_,T=C*d,E=Math.sin(T),P=-t*Math.cos(A)*E,b=t*Math.cos(T),M=t*Math.sin(A)*E;g[v]=new w(P,b,M),y[v]=new w(P,b,M),p[v]=new W(S,C)}for(var F=0,I=0;I<u;++I){var L=I%e,V=I*f|0,U=V*s+L,D=U+1,R=U+s,N=R+1;c[F++]=D,c[F++]=U,c[F++]=N,c[F++]=U,c[F++]=R,c[F++]=N}var X=o.bounds;return X.min.set(-t,-t,-t),X.max.set(t,t,t),n._initialize(o,g,y,p,c,r),o},n.createCuboid=function(a,t,e,r,o){t===void 0&&(t=1),e===void 0&&(e=1),r===void 0&&(r=1),o===void 0&&(o=!0);var s=new Et(a),l=t/2,u=e/2,c=r/2,d=new Array(24),_=new Array(24),h=new Array(24);d[0]=new w(-l,u,-c),d[1]=new w(l,u,-c),d[2]=new w(l,u,c),d[3]=new w(-l,u,c),_[0]=new w(0,1,0),_[1]=new w(0,1,0),_[2]=new w(0,1,0),_[3]=new w(0,1,0),h[0]=new W(0,0),h[1]=new W(1,0),h[2]=new W(1,1),h[3]=new W(0,1),d[4]=new w(-l,-u,-c),d[5]=new w(l,-u,-c),d[6]=new w(l,-u,c),d[7]=new w(-l,-u,c),_[4]=new w(0,-1,0),_[5]=new w(0,-1,0),_[6]=new w(0,-1,0),_[7]=new w(0,-1,0),h[4]=new W(0,1),h[5]=new W(1,1),h[6]=new W(1,0),h[7]=new W(0,0),d[8]=new w(-l,u,-c),d[9]=new w(-l,u,c),d[10]=new w(-l,-u,c),d[11]=new w(-l,-u,-c),_[8]=new w(-1,0,0),_[9]=new w(-1,0,0),_[10]=new w(-1,0,0),_[11]=new w(-1,0,0),h[8]=new W(0,0),h[9]=new W(1,0),h[10]=new W(1,1),h[11]=new W(0,1),d[12]=new w(l,u,-c),d[13]=new w(l,u,c),d[14]=new w(l,-u,c),d[15]=new w(l,-u,-c),_[12]=new w(1,0,0),_[13]=new w(1,0,0),_[14]=new w(1,0,0),_[15]=new w(1,0,0),h[12]=new W(1,0),h[13]=new W(0,0),h[14]=new W(0,1),h[15]=new W(1,1),d[16]=new w(-l,u,c),d[17]=new w(l,u,c),d[18]=new w(l,-u,c),d[19]=new w(-l,-u,c),_[16]=new w(0,0,1),_[17]=new w(0,0,1),_[18]=new w(0,0,1),_[19]=new w(0,0,1),h[16]=new W(0,0),h[17]=new W(1,0),h[18]=new W(1,1),h[19]=new W(0,1),d[20]=new w(-l,u,-c),d[21]=new w(l,u,-c),d[22]=new w(l,-u,-c),d[23]=new w(-l,-u,-c),_[20]=new w(0,0,-1),_[21]=new w(0,0,-1),_[22]=new w(0,0,-1),_[23]=new w(0,0,-1),h[20]=new W(1,0),h[21]=new W(0,0),h[22]=new W(0,1),h[23]=new W(1,1);var f=new Uint16Array(36);f[0]=0,f[1]=2,f[2]=1,f[3]=2,f[4]=0,f[5]=3,f[6]=4,f[7]=6,f[8]=7,f[9]=6,f[10]=4,f[11]=5,f[12]=8,f[13]=10,f[14]=9,f[15]=10,f[16]=8,f[17]=11,f[18]=12,f[19]=14,f[20]=15,f[21]=14,f[22]=12,f[23]=13,f[24]=16,f[25]=18,f[26]=17,f[27]=18,f[28]=16,f[29]=19,f[30]=20,f[31]=22,f[32]=23,f[33]=22,f[34]=20,f[35]=21;var g=s.bounds;return g.min.set(-l,-u,-c),g.max.set(l,u,c),n._initialize(s,d,_,h,f,o),s},n.createPlane=function(a,t,e,r,o,s){t===void 0&&(t=1),e===void 0&&(e=1),r===void 0&&(r=1),o===void 0&&(o=1),s===void 0&&(s=!0);var l=new Et(a);r=Math.max(1,Math.floor(r)),o=Math.max(1,Math.floor(o));for(var u=r+1,c=o+1,d=t/2,_=e/2,h=t/r,f=e/o,g=u*c,y=o*r,p=n._generateIndices(a,g,y*6),v=1/u,m=1/r,x=1/o,S=new Array(g),C=new Array(g),A=new Array(g),T=0;T<g;++T){var E=T%u,P=T*v|0;S[T]=new w(E*h-d,0,P*f-_),C[T]=new w(0,1,0),A[T]=new W(E*m,P*x)}debugger;for(var b=0,M=0;M<y;++M){var F=M%r,I=M*m|0,L=I*u+F,V=L+1,U=L+u,D=U+1;p[b++]=L,p[b++]=U,p[b++]=V,p[b++]=U,p[b++]=D,p[b++]=V}var R=l.bounds;return R.min.set(-d,0,-_),R.max.set(d,0,_),n._initialize(l,S,C,A,p,s),l},n.createCylinder=function(a,t,e,r,o,s,l){t===void 0&&(t=.5),e===void 0&&(e=.5),r===void 0&&(r=2),o===void 0&&(o=20),s===void 0&&(s=1),l===void 0&&(l=!0);var u=new Et(a);o=Math.floor(o),s=Math.floor(s);for(var c=o+1,d=s+1,_=r*.5,h=r/s,f=c*d,g=o*s,y=o*2,p=f+2+y,v=n._generateIndices(a,p,g*6+y*3),m=1/c,x=1/o,S=1/s,C=new Array(p),A=new Array(p),T=new Array(p),E=0,P=Math.PI,b=Math.PI*2,M=e-t,F=M/r,I=M/s,L=0;L<f;++L){var V=L%c,U=L*m|0,D=V*x,R=U*S,N=P+D*b,X=Math.sin(N),q=Math.cos(N),te=e-U*I,ie=te*X,ce=U*h-_,le=te*q;C[L]=new w(ie,ce,le),A[L]=new w(X,F,q),T[L]=new W(D,1-R)}for(var ae=0;ae<g;++ae){var Ee=ae%o,Ne=ae*x|0,tt=Ne*c+Ee,ct=tt+1,Ke=tt+c,pn=Ke+1;v[E++]=ct,v[E++]=Ke,v[E++]=tt,v[E++]=ct,v[E++]=pn,v[E++]=Ke}C[f]=new w(0,-_,0),A[f]=new w(0,-1,0),T[f]=new W(.5,.5),C[f+1]=new w(0,_,0),A[f+1]=new w(0,1,0),T[f+1]=new W(.5,.5);for(var nt=f+2,rt=1/(t*2),tn=1/(e*2),Gt=c*s,wt=0;wt<o;++wt){var Yn=C[wt],nn=Yn.x,Fn=Yn.z;C[nt]=new w(nn,-_,Fn),A[nt]=new w(0,-1,0),T[nt++]=new W(nn*tn+.5,.5-Fn*tn);var ho=C[wt+Gt];nn=ho.x,Fn=ho.z,C[nt]=new w(nn,_,Fn),A[nt]=new w(0,1,0),T[nt++]=new W(nn*rt+.5,Fn*rt+.5)}for(var fo=f+1,qr=f+2,vo=qr+1,Qr=0;Qr<o;++Qr){var $r=Qr*2,po=Qr===o-1?0:$r+2;v[E++]=f,v[E++]=qr+po,v[E++]=qr+$r,v[E++]=fo,v[E++]=vo+$r,v[E++]=vo+po}var _a=u.bounds,Cr=Math.max(t,e);return _a.min.set(-Cr,-_,-Cr),_a.max.set(Cr,_,Cr),n._initialize(u,C,A,T,v,l),u},n.createTorus=function(a,t,e,r,o,s,l){t===void 0&&(t=.5),e===void 0&&(e=.1),r===void 0&&(r=30),o===void 0&&(o=30),s===void 0&&(s=360),l===void 0&&(l=!0);var u=new Et(a);r=Math.floor(r),o=Math.floor(o);var c=(r+1)*(o+1),d=r*o,_=n._generateIndices(a,c,d*6),h=new Array(c),f=new Array(c),g=new Array(c);s=s/180*Math.PI;for(var y=0,p=0;p<=r;p++)for(var v=0;v<=o;v++){var m=v/o*s,x=p/r*Math.PI*2,S=Math.cos(x),C=Math.sin(x),A=Math.cos(m),T=Math.sin(m),E=new w((t+e*S)*A,(t+e*S)*T,e*C);h[y]=E;var P=t*A,b=t*T;f[y]=new w(E.x-P,E.y-b,E.z).normalize(),g[y++]=new W(v/o,p/r)}y=0;for(var M=1;M<=r;M++)for(var F=1;F<=o;F++){var I=(o+1)*M+F-1,L=(o+1)*(M-1)+F-1,V=(o+1)*(M-1)+F,U=(o+1)*M+F;_[y++]=I,_[y++]=L,_[y++]=U,_[y++]=L,_[y++]=V,_[y++]=U}var D=u.bounds,R=t+e;return D.min.set(-R,-R,-e),D.max.set(R,R,e),n._initialize(u,h,f,g,_,l),u},n.createCone=function(a,t,e,r,o,s){t===void 0&&(t=.5),e===void 0&&(e=2),r===void 0&&(r=20),o===void 0&&(o=1),s===void 0&&(s=!0);var l=new Et(a);r=Math.floor(r),o=Math.floor(o);for(var u=r+1,c=o+1,d=e*.5,_=e/o,h=u*c,f=r*o,g=h+1+r,y=n._generateIndices(a,g,f*6+r*3),p=1/u,v=1/r,m=1/o,x=new Array(g),S=new Array(g),C=new Array(g),A=0,T=Math.PI,E=Math.PI*2,P=t/e,b=0;b<h;++b){var M=b%u,F=b*p|0,I=M*v,L=F*m,V=T+I*E,U=Math.sin(V),D=Math.cos(V),R=t-F*t,N=R*U,X=F*_-d,q=R*D;x[b]=new w(N,X,q),S[b]=new w(U,P,D),C[b]=new W(I,1-L)}for(var te=0;te<f;++te){var ie=te%r,ce=te*v|0,le=ce*u+ie,ae=le+1,Ee=le+u,Ne=Ee+1;y[A++]=ae,y[A++]=Ee,y[A++]=le,y[A++]=ae,y[A++]=Ne,y[A++]=Ee}x[h]=new w(0,-d,0),S[h]=new w(0,-1,0),C[h]=new W(.5,.5);for(var tt=h+1,ct=1/(t*2),Ke=0;Ke<r;++Ke){var pn=x[Ke],nt=pn.x,rt=pn.z;x[tt]=new w(nt,-d,rt),S[tt]=new w(0,-1,0),C[tt++]=new W(nt*ct+.5,.5-rt*ct)}for(var tn=h+1,Gt=0;Gt<r;++Gt){var wt=Gt,Yn=Gt===r-1?0:wt+1;y[A++]=h,y[A++]=tn+Yn,y[A++]=tn+wt}var nn=l.bounds;return nn.min.set(-t,-d,-t),nn.max.set(t,d,t),n._initialize(l,x,S,C,y,s),l},n.createCapsule=function(a,t,e,r,o,s){t===void 0&&(t=.5),e===void 0&&(e=2),r===void 0&&(r=6),o===void 0&&(o=1),s===void 0&&(s=!0);var l=new Et(a);r=Math.max(2,Math.floor(r)),o=Math.floor(o);for(var u=r+1,c=o+1,d=e*.5,_=e/o,h=u*c,f=r*o,g=u*u,y=r*r,p=h+2*g,v=n._generateIndices(a,p,(f+2*y)*6),m=1/u,x=1/r,S=1/o,C=Math.PI,A=Math.PI*2,T=new Array(p),E=new Array(p),P=new Array(p),b=0,M=0;M<h;++M){var F=M%u,I=M*m|0,L=F*x,V=I*S,U=C+L*A,D=Math.sin(U),R=Math.cos(U);T[M]=new w(t*D,I*_-d,t*R),E[M]=new w(D,0,R),P[M]=new W(L,1-V)}for(var N=0;N<f;++N){var X=N%r,q=N*x|0,te=q*u+X,ie=te+1,ce=te+u,le=ce+1;v[b++]=ie,v[b++]=ce,v[b++]=te,v[b++]=ie,v[b++]=le,v[b++]=ce}n._createCapsuleCap(t,e,r,A,h,1,T,E,P,v,b),n._createCapsuleCap(t,e,r,-A,h+g,-1,T,E,P,v,b+6*y);var ae=l.bounds;return ae.min.set(-t,-t-d,-t),ae.max.set(t,t+d,t),n._initialize(l,T,E,P,v,s),l},n._initialize=function(a,t,e,r,o,s){a.setPositions(t),a.setNormals(e),a.setUVs(r),a.setIndices(o),a.calculateTangents(),a.uploadData(s),a.addSubMesh(0,o.length)},n._generateIndices=function(a,t,e){var r=null;if(t>65535)if(a._hardwareRenderer.canIUse(Z.elementIndexUint))r=new Uint32Array(e);else throw Error("The vertex count is over limit.");else r=new Uint16Array(e);return r},n._createCapsuleCap=function(a,t,e,r,o,s,l,u,c,d,_){for(var h=e+1,f=t*.5*s,g=h*h,y=e*e,p=1/h,v=1/e,m=0;m<g;++m){var x=m%h,S=m*p|0,C=x*v,A=S*v,T=C*r,E=A*Math.PI/2,P=Math.sin(E),b=-a*Math.cos(T)*P,M=a*Math.cos(E)*s+f,F=a*Math.sin(T)*P,I=m+o;l[I]=new w(b,M,F),u[I]=new w(b,M-f,F),c[I]=new W(C,A)}for(var L=0;L<y;++L){var V=L%e,U=L*v|0,D=U*h+V+o,R=D+1,N=D+h,X=N+1;d[_++]=R,d[_++]=D,d[_++]=X,d[_++]=D,d[_++]=N,d[_++]=X}},n}(),Lu=function(n){Q(i,n);function i(){return n.apply(this,arguments)}var a=i.prototype;return a.setVertexElements=function(e){this._setVertexElements(e)},a.setVertexBufferBinding=function(e,r,o){r===void 0&&(r=0),o===void 0&&(o=0);var s=e,l=s.buffer!==void 0;l||(s=new ys(e,r));var u=this._vertexBufferBindings;u.length<=o&&(u.length=o+1),this._setVertexBufferBinding(l?r:o,s)},a.setVertexBufferBindings=function(e,r){r===void 0&&(r=0);var o=this._vertexBufferBindings,s=e.length,l=r+s;o.length<l&&(o.length=l);for(var u=0;u<s;u++)this._setVertexBufferBinding(r+u,e[u])},a.setIndexBufferBinding=function(e,r){var o=e;if(o){var s=o.buffer!==void 0;s||(o=new eu(e,r))}this._setIndexBufferBinding(o)},K(i,[{key:"instanceCount",get:function(){return this._instanceCount},set:function(e){this._instanceCount=e}},{key:"vertexBufferBindings",get:function(){return this._vertexBufferBindings}},{key:"indexBufferBinding",get:function(){return this._indexBufferBinding}},{key:"vertexElements",get:function(){return this._vertexElements}}]),i}(H_),M0=function(i,a,t,e){if(t===void 0&&(t=null),e===void 0&&(e=null),t&&t.length!==a.length)throw"deltaNormals length must same with deltaPositions length.";if(e&&e.length!==a.length)throw"deltaTangents length must same with deltaPositions length.";this.weight=i,this.deltaPositions=a,this.deltaNormals=t,this.deltaTangents=e},G_=function(){function n(a){this._useBlendShapeNormal=!0,this._useBlendShapeTangent=!0,this._layoutChangeManager=new Ja,this._dataChangeManager=new Ja,this._frames=[],this.name=a}var i=n.prototype;return i.addFrame=function(t,e,r,o){if(typeof t=="number"){var s=new M0(t,e,r,o);return this._addFrame(s),s}else this._addFrame(t)},i.clearFrames=function(){this._frames.length=0,this._updateUseNormalAndTangent(!0,!0),this._dataChangeManager.dispatch()},i._addDataDirtyFlag=function(t){this._dataChangeManager.addFlag(t)},i._createSubDataDirtyFlag=function(){return this._dataChangeManager.createFlag(Ru)},i._addFrame=function(t){var e=this._frames,r=e.length;if(r>0&&t.deltaPositions.length!==e[r-1].deltaPositions.length)throw"Frame's deltaPositions length must same with before frame deltaPositions length.";this._frames.push(t),this._updateUseNormalAndTangent(!!t.deltaNormals,!!t.deltaTangents),this._dataChangeManager.dispatch()},i._updateUseNormalAndTangent=function(t,e){var r=this._useBlendShapeNormal&&t,o=this._useBlendShapeTangent&&e;(this._useBlendShapeNormal!==r||this._useBlendShapeTangent!==o)&&(this._useBlendShapeNormal=r,this._useBlendShapeTangent=o,this._layoutChangeManager.dispatch(0,this))},K(n,[{key:"frames",get:function(){return this._frames}}]),n}(),zu=function(){function n(a){this._subMeshPool=new Da(k_),this._batchedQueue=[],this._meshes=[],this._meshCount=1,this._vertexBuffers=[],this._indiceBuffers=[],this._flushId=0,this._vertexCount=0,this._elementCount=0,this._engine=a;var t=n.MAX_VERTEX_COUNT;this._vertices=new Float32Array(t*9),this._indices=new Uint16Array(t*3);for(var e=this,r=e._meshes,o=e._meshCount,s=0;s<o;s++)r[s]=this._createMesh(a,s)}var i=n.prototype;return i.drawElement=function(t,e,r){if(t.multiRenderData)for(var o=t.charElements,s=0,l=o.length;s<l;++s)this._drawSubElement(o[s],e,r);else this._drawSubElement(t,e,r)},i._drawSubElement=function(t,e,r){var o=t.renderData.vertexCount;this._vertexCount+o>n.MAX_VERTEX_COUNT&&this.flush(e,r),this._vertexCount+=o,this._batchedQueue[this._elementCount++]=t},i.flush=function(t,e){var r=this._batchedQueue;r.length!==0&&(this._updateData(this._engine),this.drawBatches(t,e),n._canUploadSameBuffer||this._flushId++,r.length=0,this._subMeshPool.resetPool(),this._vertexCount=0,this._elementCount=0)},i.clear=function(){this._flushId=0,this._vertexCount=0,this._elementCount=0,this._batchedQueue.length=0},i.destroy=function(){this._batchedQueue=null;for(var t=this,e=t._meshes,r=t._vertexBuffers,o=t._indiceBuffers,s=0,l=e.length;s<l;++s)e[s].destroy();this._meshes=null;for(var u=0,c=r.length;u<c;++u)r[u].destroy();this._vertexBuffers=null;for(var d=0,_=o.length;d<_;++d)o[d].destroy();this._indiceBuffers=null},i._createMesh=function(t,e){var r=n.MAX_VERTEX_COUNT,o=new Lu(t,"BufferMesh"+e),s=[],l=this.createVertexElements(s);return this._vertexBuffers[e]=new ir(t,Pn.VertexBuffer,r*4*l,mt.Dynamic),this._indiceBuffers[e]=new ir(t,Pn.IndexBuffer,r*3,mt.Dynamic),o.setVertexBufferBinding(this._vertexBuffers[e],l),o.setIndexBufferBinding(this._indiceBuffers[e],pt.UInt16),o.setVertexElements(s),o},i._updateData=function(t){var e=this,r=e._meshes,o=e._flushId;!n._canUploadSameBuffer&&this._meshCount<=o&&(this._meshCount++,r[o]=this._createMesh(t,o));var s=this,l=s._batchedQueue,u=s._vertices,c=s._indices,d=r[o];d.clearSubMesh();for(var _=0,h=0,f=0,g=0,y=0,p=0,v=null,m=0,x=l.length;m<x;m++){var S=l[m];_=this.updateVertices(S,u,_);for(var C=S.renderData.triangles,A=C.length,T=0;T<A;T++)c[h++]=C[T]+y;y+=S.renderData.vertexCount,v===null||this.canBatch(v,S)?g+=A:(d.addSubMesh(this._getSubMeshFromPool(f,g)),f+=g,g=A,l[p++]=v),v=S}d.addSubMesh(this._getSubMeshFromPool(f,g)),l[p]=v,this._vertexBuffers[o].setData(u,0,0,_),this._indiceBuffers[o].setData(c,0,0,h)},i._getSubMeshFromPool=function(t,e){var r=this._subMeshPool.getFromPool();return r.start=t,r.count=e,r.topology=Ti.Triangles,r},n}();zu.MAX_VERTEX_COUNT=4096;zu._canUploadSameBuffer=!0;var bw=function(n){Q(i,n);function i(){return n.apply(this,arguments)}var a=i.prototype;return a.createVertexElements=function(e){return e[0]=new ke("POSITION",0,re.Vector3,0),e[1]=new ke("TEXCOORD_0",12,re.Vector2,0),20},a.canBatch=function(e,r){if(e.isAdd!==r.isAdd)return!1;var o=e.component.shaderData,s=r.component.shaderData,l=hn._textureProperty,u=hn._alphaCutoffProperty;return o.getTexture(l)===s.getTexture(l)&&o.getTexture(u)===s.getTexture(u)},a.updateVertices=function(e,r,o){for(var s=e.renderData,l=s.positions,u=s.uvs,c=s.vertexCount,d=0;d<c;d++){var _=l[d],h=u[d];r[o++]=_.x,r[o++]=_.y,r[o++]=_.z,r[o++]=h.x,r[o++]=h.y}return o},a.drawBatches=function(e){for(var r=this,o=r._engine,s=r._batchedQueue,l=this._meshes[this._flushId],u=l.subMeshes,c=e.scene.shaderData,d=e.shaderData,_=0,h=u.length;_<h;_++){var f=u[_],g=s[_];if(!f||!g)return;var y=g.component,p=g.material,v=B._compileMacros;En.unionCollection(y._globalShaderMacro,p.shaderData._macroCollection,v);var m=p.renderState.stencilState,x=g.isAdd?Je.IncrementSaturate:Je.DecrementSaturate;m.passOperationFront=x,m.passOperationBack=x;var S=p.shader.passes[0]._getShaderProgram(o,v);if(!S.isValid)return;S.bind(),S.groupingOtherUniformBlock(),S.uploadAll(S.sceneUniformBlock,c),S.uploadAll(S.cameraUniformBlock,d),S.uploadAll(S.rendererUniformBlock,y.shaderData),S.uploadAll(S.materialUniformBlock,p.shaderData),p.renderState._apply(o,!1),o._hardwareRenderer.drawPrimitive(l,f,S)}},i}(zu),Mw=function(){function n(a){this._preMaskLayer=0,this._batcher=new bw(a)}var i=n.prototype;return i.clear=function(){this._preMaskLayer=0,this._batcher.clear()},i.preRender=function(t,e){e.maskInteraction!==Un.None&&(this._batcher.clear(),this._processMasksDiff(t,e),this._batcher.flush(t,null))},i.postRender=function(t){t.maskInteraction!==Un.None&&(this._preMaskLayer=t.maskLayer)},i.destroy=function(){this._batcher.destroy(),this._batcher=null},i._processMasksDiff=function(t,e){var r=this._preMaskLayer,o=e.maskLayer;if(r!==o)for(var s=t._renderPipeline._allSpriteMasks,l=r&o,u=o&~r,c=r&~o,d=s._elements,_=0,h=s.length;_<h;_++){var f=d[_],g=f.influenceLayers;if(!(g&l)){if(g&u){var y=f._maskElement;y.isAdd=!0,this._batcher.drawElement(y,t,null);continue}if(g&c){var p=f._maskElement;p.isAdd=!1,this._batcher.drawElement(p,t,null)}}}},n}(),Rw=function(n){Q(i,n);function i(){var a;return a=n.call(this)||this,a.charElements=[],a.multiRenderData=!0,a}return i}(Iu),Cn;(function(n){n[n.SolidColor=0]="SolidColor",n[n.Sky=1]="Sky",n[n.Texture=2]="Texture"})(Cn||(Cn={}));var ci;(function(n){n[n.AspectFitWidth=0]="AspectFitWidth",n[n.AspectFitHeight=1]="AspectFitHeight",n[n.Fill=2]="Fill"})(ci||(ci={}));var no=function(){function n(){}var i=n.prototype;return i._render=function(t){var e=this,r=e.material,o=e.mesh;if(!r){we.warn("The material of sky is not defined.");return}if(!o){we.warn("The mesh of sky is not defined.");return}var s=t.camera,l=s.engine,u=s.aspectRatio,c=s.fieldOfView,d=s.viewMatrix,_=s.shaderData,h=n._viewProjMatrix,f=n._projectionMatrix,g=l._hardwareRenderer,y=r.shaderData,p=r.shader,v=r.renderState;h.copyFrom(d);var m=h.elements;m[12]=m[13]=m[14]=0;var x=1/Math.tan(H.degreeToRadian(c)/2);f.elements[0]=x/u,f.elements[5]=x,J.multiply(f,h,h);var S=_.getMatrix(Ki._vpMatrixProperty);_.setMatrix(Ki._vpMatrixProperty,h);var C=B._compileMacros;En.unionCollection(t.camera._globalShaderMacro,y._macroCollection,C);var A=p.passes[0]._getShaderProgram(l,C);A.bind(),A.groupingOtherUniformBlock(),A.uploadAll(A.cameraUniformBlock,_),A.uploadAll(A.materialUniformBlock,y),A.uploadUnGroupTextures(),v._apply(l,!1),g.drawPrimitive(o,o.subMesh,A),_.setMatrix(Ki._vpMatrixProperty,S)},n}();no._epsilon=1e-6;no._viewProjMatrix=new J;no._projectionMatrix=new J(1,0,0,0,0,1,0,0,0,0,no._epsilon-1,-1,0,0,0,0);var R0=function(){function n(a){this._engine=a,this.mode=Cn.SolidColor,this.solidColor=new ne(.25,.25,.25,1),this.sky=new no,this._textureFillMode=ci.AspectFitHeight,this._texture=null,this._mesh=this._createPlane(a)}var i=n.prototype;return i._resizeBackgroundTexture=function(){if(this._texture){var t=this._engine.canvas,e=t.width,r=t.height,o=this,s=o._mesh,l=s.getPositions();switch(this._textureFillMode){case ci.Fill:l[0].set(-1,-1,1),l[1].set(1,-1,1),l[2].set(-1,1,1),l[3].set(1,1,1);break;case ci.AspectFitWidth:var u=this._texture.height*e/this.texture.width/r;l[0].set(-1,-u,1),l[1].set(1,-u,1),l[2].set(-1,u,1),l[3].set(1,u,1);break;case ci.AspectFitHeight:var c=this._texture.width*r/this.texture.height/e;l[0].set(-c,-1,1),l[1].set(c,-1,1),l[2].set(-c,1,1),l[3].set(c,1,1);break}s.setPositions(l),s.uploadData(!1)}},i._createPlane=function(t){var e=new Et(t);e.isGCIgnored=!0;for(var r=new Uint8Array([1,2,0,1,3,2]),o=new Array(4),s=new Array(4),l=0;l<4;++l)o[l]=new w,s[l]=new W(l%2,1-(l*.5|0));return e.setPositions(o),e.setUVs(s),e.setIndices(r),e.uploadData(!1),e.addSubMesh(0,r.length),e},K(n,[{key:"texture",get:function(){return this._texture},set:function(t){this._texture!==t&&(this._texture=t,this._engine._backgroundTextureMaterial.shaderData.setTexture("u_baseTexture",t))}},{key:"textureFillMode",get:function(){return this._textureFillMode},set:function(t){t!==this._textureFillMode&&(this._textureFillMode=t,this._resizeBackgroundTexture())}}]),n}(),ru;(function(n){n[n.None=0]="None",n[n.Linear=1]="Linear",n[n.Exponential=2]="Exponential",n[n.ExponentialSquared=3]="ExponentialSquared"})(ru||(ru={}));var ro;(function(n){n[n.SolidColor=0]="SolidColor",n[n.SphericalHarmonics=1]="SphericalHarmonics"})(ro||(ro={}));var Xn=function(){function n(){this._diffuseSolidColor=new ne(.212,.227,.259),this._diffuseIntensity=1,this._specularIntensity=1,this._diffuseMode=ro.SolidColor,this._shArray=new Float32Array(27),this._scenes=[],this._specularTextureDecodeRGBM=!1}var i=n.prototype;return i._addToScene=function(t){this._scenes.push(t);var e=t.shaderData;e.setColor(n._diffuseColorProperty,this._diffuseSolidColor),e.setFloat(n._diffuseIntensityProperty,this._diffuseIntensity),e.setFloat(n._specularIntensityProperty,this._specularIntensity),e.setFloatArray(n._diffuseSHProperty,this._shArray),this._setDiffuseMode(e),this._setSpecularTextureDecodeRGBM(e),this._setSpecularTexture(e)},i._removeFromScene=function(t){var e=this._scenes,r=e.indexOf(t);e.splice(r,1)},i._setDiffuseMode=function(t){this._diffuseMode===ro.SphericalHarmonics?t.enableMacro(n._shMacro):t.disableMacro(n._shMacro)},i._setSpecularTexture=function(t){this._specularTexture?(t.setTexture(n._specularTextureProperty,this._specularTexture),t.setFloat(n._mipLevelProperty,this._specularTexture.mipmapCount-1),t.enableMacro(n._specularMacro)):t.disableMacro(n._specularMacro)},i._setSpecularTextureDecodeRGBM=function(t){this._specularTextureDecodeRGBM?t.enableMacro(n._decodeRGBMMacro):t.disableMacro(n._decodeRGBMMacro)},i._preComputeSH=function(t,e){var r=t.coefficients;e[0]=r[0]*.886227,e[1]=r[1]*.886227,e[2]=r[2]*.886227,e[3]=r[3]*-1.023327,e[4]=r[4]*-1.023327,e[5]=r[5]*-1.023327,e[6]=r[6]*1.023327,e[7]=r[7]*1.023327,e[8]=r[8]*1.023327,e[9]=r[9]*-1.023327,e[10]=r[10]*-1.023327,e[11]=r[11]*-1.023327,e[12]=r[12]*.858086,e[13]=r[13]*.858086,e[14]=r[14]*.858086,e[15]=r[15]*-.858086,e[16]=r[16]*-.858086,e[17]=r[17]*-.858086,e[18]=r[18]*.247708,e[19]=r[19]*.247708,e[20]=r[20]*.247708,e[21]=r[21]*-.858086,e[22]=r[22]*-.858086,e[23]=r[23]*-.858086,e[24]=r[24]*.429042,e[25]=r[25]*.429042,e[26]=r[26]*.429042},K(n,[{key:"specularTextureDecodeRGBM",get:function(){return this._specularTextureDecodeRGBM},set:function(t){this._specularTextureDecodeRGBM=t;for(var e=this._scenes,r=0,o=e.length;r<o;r++)this._setSpecularTextureDecodeRGBM(e[r].shaderData)}},{key:"diffuseMode",get:function(){return this._diffuseMode},set:function(t){this._diffuseMode=t;for(var e=this._scenes,r=0,o=e.length;r<o;r++)this._setDiffuseMode(e[r].shaderData)}},{key:"diffuseSolidColor",get:function(){return this._diffuseSolidColor},set:function(t){t!==this._diffuseSolidColor&&this._diffuseSolidColor.copyFrom(t)}},{key:"diffuseSphericalHarmonics",get:function(){return this._diffuseSphericalHarmonics},set:function(t){if(this._diffuseSphericalHarmonics=t,t){this._preComputeSH(t,this._shArray);for(var e=this._scenes,r=0,o=e.length;r<o;r++)e[r].shaderData.setFloatArray(n._diffuseSHProperty,this._shArray)}}},{key:"diffuseIntensity",get:function(){return this._diffuseIntensity},set:function(t){this._diffuseIntensity=t;for(var e=this._scenes,r=0,o=e.length;r<o;r++)e[r].shaderData.setFloat(n._diffuseIntensityProperty,t)}},{key:"specularTexture",get:function(){return this._specularTexture},set:function(t){this._specularTexture=t;for(var e=this._scenes,r=0,o=e.length;r<o;r++)this._setSpecularTexture(e[r].shaderData)}},{key:"specularIntensity",get:function(){return this._specularIntensity},set:function(t){this._specularIntensity=t;for(var e=0,r=this._scenes.length;e<r;e++)this._scenes[e].shaderData.setFloat(n._specularIntensityProperty,t)}}]),n}();Xn._shMacro=B.getMacroByName("O3_USE_SH");Xn._specularMacro=B.getMacroByName("O3_USE_SPECULAR_ENV");Xn._decodeRGBMMacro=B.getMacroByName("O3_DECODE_ENV_RGBM");Xn._diffuseColorProperty=B.getPropertyByName("u_envMapLight.diffuse");Xn._diffuseSHProperty=B.getPropertyByName("u_env_sh");Xn._diffuseIntensityProperty=B.getPropertyByName("u_envMapLight.diffuseIntensity");Xn._specularTextureProperty=B.getPropertyByName("u_env_specularSampler");Xn._specularIntensityProperty=B.getPropertyByName("u_envMapLight.specularIntensity");Xn._mipLevelProperty=B.getPropertyByName("u_envMapLight.mipMapLevel");var Is=function(n){Q(i,n);function i(t,e){var r;r=n.call(this,t)||this,r.background=new R0(r._engine),r.shaderData=new Bs(er.Scene),r.castShadows=!0,r.shadowResolution=ui.Medium,r.shadowTwoCascadeSplits=1/3,r.shadowFourCascadeSplits=new w(1/15,3/15,7/15),r.shadowDistance=50,r._activeCameras=[],r._isActiveInEngine=!1,r._globalShaderMacro=new En,r._rootEntities=[],r._shadowCascades=Bn.NoCascades,r._fogMode=ru.None,r._fogColor=new ne(.5,.5,.5,1),r._fogStart=0,r._fogEnd=300,r._fogDensity=.01,r._fogParams=new he,r.name=e||"";var o=r.shaderData;return o._addRefCount(1),r.ambientLight=new Xn,t.sceneManager._allScenes.push(_e(r)),o.enableMacro("OASIS_FOG_MODE",r._fogMode.toString()),o.enableMacro("CASCADED_COUNT",r.shadowCascades.toString()),o.setColor(i._fogColorProperty,r._fogColor),o.setVector4(i._fogParamsProperty,r._fogParams),r._computeLinearFogParams(r._fogStart,r._fogEnd),r._computeExponentialFogParams(r._fogDensity),r}var a=i.prototype;return a.createRootEntity=function(e){var r=new Fr(this._engine,e);return this.addRootEntity(r),r},a.addRootEntity=function(e,r){var o;typeof e=="number"?o=e:(o=void 0,r=e);var s=r._isRoot;s||(r._isRoot=!0,r._removeFromParent());var l=r._scene;l!==this?(l&&s&&l._removeFromEntityList(r),this._addToRootEntityList(o,r),Fr._traverseSetOwnerScene(r,this)):s||this._addToRootEntityList(o,r),this._isActiveInEngine?!r._isActiveInHierarchy&&r._isActive&&r._processActive():r._isActiveInHierarchy&&r._processInActive()},a.removeRootEntity=function(e){e._isRoot&&e._scene==this&&(this._removeFromEntityList(e),e._isRoot=!1,this._isActiveInEngine&&e._isActiveInHierarchy&&e._processInActive(),Fr._traverseSetOwnerScene(e,null))},a.getRootEntity=function(e){return e===void 0&&(e=0),this._rootEntities[e]},a.findEntityByName=function(e){for(var r=this._rootEntities,o=0,s=r.length;o<s;o++){var l=r[o].findByName(e);if(l)return l}return null},a.findEntityByPath=function(e){for(var r=e.split("/").filter(Boolean),o=0,s=this.rootEntitiesCount;o<s;o++){var l=this.getRootEntity(o);if(l.name==r[0]){for(var u=1,c=r.length;u<c&&(l=Fr._findChildByName(l,r[u]),!!l);++u);return l}}return null},a.destroy=function(){if(!this._destroyed){this._destroy();var e=this.engine.sceneManager._allScenes;e.splice(e.indexOf(this),1)}},a._attachRenderCamera=function(e){var r=this._activeCameras.indexOf(e);r===-1?this._activeCameras.push(e):we.warn("Camera already attached.")},a._detachRenderCamera=function(e){var r=this._activeCameras.indexOf(e);r!==-1&&this._activeCameras.splice(r,1)},a._processActive=function(e){this._isActiveInEngine=e;for(var r=this._rootEntities,o=r.length-1;o>=0;o--){var s=r[o];s._isActive&&(e?s._processActive():s._processInActive())}},a._updateShaderData=function(){var e=this.shaderData,r=this._engine._lightManager;r._updateShaderData(this.shaderData);var o=r._getSunLightIndex();o!==-1&&(this._sunLight=r._directLights.get(o)),this.castShadows&&this._sunLight&&this._sunLight.shadowType!==kr.None?e.enableMacro("SHADOW_TYPE",this._sunLight.shadowType.toString()):e.disableMacro("SHADOW_TYPE"),En.unionCollection(this.engine._macroCollection,e._macroCollection,this._globalShaderMacro)},a._removeFromEntityList=function(e){var r=this._rootEntities,o=e._siblingIndex;r.splice(o,1);for(var s=r.length;o<s;o++)r[o]._siblingIndex--;e._siblingIndex=-1},a._destroy=function(){for(this._isActiveInEngine&&(this._engine.sceneManager.activeScene=null);this.rootEntitiesCount>0;)this._rootEntities[0].destroy();this._activeCameras.length=0,this.shaderData._addRefCount(-1)},a._addToRootEntityList=function(e,r){var o=this._rootEntities,s=o.length;if(e===void 0)r._siblingIndex=s,o.push(r);else{if(e<0||e>s)throw"The index "+e+" is out of child list bounds "+s;r._siblingIndex=e,o.splice(e,0,r);for(var l=e+1,u=s+1;l<u;l++)o[l]._siblingIndex++}},a._computeLinearFogParams=function(e,r){var o=r-e,s=this._fogParams;s.x=-1/o,s.y=r/o},a._computeExponentialFogParams=function(e){this._fogParams.z=e/Math.LN2,this._fogParams.w=e/Math.sqrt(Math.LN2)},K(i,[{key:"shadowCascades",get:function(){return this._shadowCascades},set:function(e){this._shadowCascades!==e&&(this.shaderData.enableMacro("CASCADED_COUNT",e.toString()),this._shadowCascades=e)}},{key:"ambientLight",get:function(){return this._ambientLight},set:function(e){if(!e){we.warn("The scene must have one ambient light");return}var r=this._ambientLight;r!==e&&(r&&r._removeFromScene(this),e._addToScene(this),this._ambientLight=e)}},{key:"fogMode",get:function(){return this._fogMode},set:function(e){this._fogMode!==e&&(this.shaderData.enableMacro("OASIS_FOG_MODE",e.toString()),this._fogMode=e)}},{key:"fogColor",get:function(){return this._fogColor},set:function(e){this._fogColor!==e&&this._fogColor.copyFrom(e)}},{key:"fogStart",get:function(){return this._fogStart},set:function(e){this._fogStart!==e&&(this._computeLinearFogParams(e,this._fogEnd),this._fogStart=e)}},{key:"fogEnd",get:function(){return this._fogEnd},set:function(e){this._fogEnd!==e&&(this._computeLinearFogParams(this._fogStart,e),this._fogEnd=e)}},{key:"fogDensity",get:function(){return this._fogDensity},set:function(e){this._fogDensity!==e&&(this._computeExponentialFogParams(e),this._fogDensity=e)}},{key:"rootEntitiesCount",get:function(){return this._rootEntities.length}},{key:"rootEntities",get:function(){return this._rootEntities}}]),i}(ar);Is._fogColorProperty=B.getPropertyByName("oasis_FogColor");Is._fogParamsProperty=B.getPropertyByName("oasis_FogParams");var F0=function(){function n(a){this.engine=a,this._allScenes=[]}var i=n.prototype;return i.loadScene=function(t,e){e===void 0&&(e=!0);var r=this,o=this.engine.resourceManager.load(t);return o.then(function(s){var l=r._activeScene;r.activeScene=s,l&&e&&l.destroy()}),o},i.mergeScenes=function(t,e){for(var r=t.rootEntities,o=0,s=r.length;o<s;o++)e.addRootEntity(r[o])},i._destroyAllScene=function(){for(var t=this._allScenes,e=0,r=t.length;e<r;e++)t[e]._destroy();t.length=0},K(n,[{key:"activeScene",get:function(){return this._activeScene},set:function(t){var e=this._activeScene;e!==t&&(e&&e._processActive(!1),t&&t._processActive(!0),this._activeScene=t)}}]),n}(),Fw=`#define GLSLIFY 1
#include <common>
#include <camera_declare>
#include <uv_share>
#include <normal_share>
#include <color_share>
#include <worldpos_share>
#include <light_frag_define>
#include <ShadowFragmentDeclaration>
#include <mobile_material_frag>
#include <FogFragmentDeclaration>
#include <normal_get>
void main(){
#include <begin_mobile_frag>
#include <begin_viewdir_frag>
#include <mobile_blinnphong_frag>
gl_FragColor=emission+ambient+diffuse+specular;
#ifdef OASIS_TRANSPARENT
gl_FragColor.a=diffuse.a;
#else
gl_FragColor.a=1.0;
#endif
#include <FogFragment>
#ifndef OASIS_COLORSPACE_GAMMA
gl_FragColor=linearToGamma(gl_FragColor);
#endif
}`,Dw=`#define GLSLIFY 1
#include <common>
#include <common_vert>
#include <blendShape_input>
#include <uv_share>
#include <color_share>
#include <normal_share>
#include <worldpos_share>
#include <ShadowVertexDeclaration>
#include <FogVertexDeclaration>
void main(){
#include <begin_position_vert>
#include <begin_normal_vert>
#include <blendShape_vert>
#include <skinning_vert>
#include <uv_vert>
#include <color_vert>
#include <normal_vert>
#include <worldpos_vert>
#include <position_vert>
#include <ShadowVertex>
#include <FogVertex>
}`,Bw=`#define GLSLIFY 1
varying vec4 v_color;varying float v_lifeLeft;varying vec2 v_uv;uniform sampler2D u_texture;void main(){if(v_lifeLeft==1.0){discard;}float alphaFactor=1.0;
#ifdef fadeIn
float fadeInFactor=step(0.5,v_lifeLeft);alphaFactor=2.0*fadeInFactor*(1.0-v_lifeLeft)+(1.0-fadeInFactor);
#endif
#ifdef fadeOut
float fadeOutFactor=step(0.5,v_lifeLeft);alphaFactor=alphaFactor*2.0*(1.0-fadeOutFactor)*v_lifeLeft+alphaFactor*fadeOutFactor;
#endif
#ifdef particleTexture
vec4 tex=texture2D(u_texture,v_uv);
#ifdef useOriginColor
gl_FragColor=vec4(tex.rgb,alphaFactor*tex.a*v_color.w);
#else
gl_FragColor=vec4(v_color.xyz*tex.rgb,alphaFactor*tex.a*v_color.w);
#endif
#else
gl_FragColor=vec4(v_color.xyz,alphaFactor*v_color.w);
#endif
}`,Iw=`#define GLSLIFY 1
attribute vec3 a_position;attribute vec3 a_velocity;attribute vec3 a_acceleration;attribute vec4 a_color;attribute vec4 a_lifeAndSize;attribute vec2 a_rotation;attribute vec3 a_uv;attribute vec2 a_normalizedUv;uniform float u_time;uniform bool u_once;uniform mat4 u_MVPMat;varying vec4 v_color;varying float v_lifeLeft;varying vec2 v_uv;
#ifdef is2d
uniform mat4 u_viewInvMat;uniform mat4 u_projMat;uniform mat4 u_viewMat;uniform mat4 u_modelMat;
#endif
mat2 rotation2d(float angle){float s=sin(angle);float c=cos(angle);return mat2(c,-s,s,c);}void main(){v_color=a_color;v_uv=a_uv.xy;float life=a_lifeAndSize.y;float startTime=a_lifeAndSize.x;float deltaTime=max(mod(u_time-startTime,life),0.0);if((u_once&&u_time>life+startTime)){deltaTime=0.0;}v_lifeLeft=1.0-deltaTime/life;float scale=a_lifeAndSize.z;vec3 position=a_position+(a_velocity+a_acceleration*deltaTime*0.5)*deltaTime;
#ifdef isScaleByLifetime
scale*=v_lifeLeft;
#else
scale*=pow(a_lifeAndSize.w,deltaTime);
#endif
#ifdef rotateToVelocity
vec3 v=a_velocity+a_acceleration*deltaTime;float angle=atan(v.z,v.x)*2.0;
#else
float deltaAngle=deltaTime*a_rotation.y;float angle=a_rotation.x+deltaAngle;
#endif
#ifdef is2d
vec2 rotatedPoint=rotation2d(angle)*vec2(a_normalizedUv.x,a_normalizedUv.y*a_uv.z);vec3 basisX=u_viewInvMat[0].xyz;vec3 basisZ=u_viewInvMat[1].xyz;vec3 localPosition=vec3(basisX*rotatedPoint.x+basisZ*rotatedPoint.y)*scale+position;gl_Position=u_projMat*u_viewMat*vec4(localPosition+u_modelMat[3].xyz,1.);
#else
#ifdef rotateToVelocity
float s=sin(angle);float c=cos(angle);
#else
float s=sin(angle);float c=cos(angle);
#endif
vec4 rotatedPoint=vec4((a_normalizedUv.x*c+a_normalizedUv.y*a_uv.z*s)*scale,0.,(a_normalizedUv.x*s-a_normalizedUv.y*a_uv.z*c)*scale,1.);vec4 orientation=vec4(0,0,0,1);vec4 q2=orientation+orientation;vec4 qx=orientation.xxxw*q2.xyzx;vec4 qy=orientation.xyyw*q2.xyzy;vec4 qz=orientation.xxzw*q2.xxzz;mat4 localMatrix=mat4((1.0-qy.y)-qz.z,qx.y+qz.w,qx.z-qy.w,0,qx.y-qz.w,(1.0-qx.x)-qz.z,qy.z+qx.w,0,qx.z+qy.w,qy.z-qx.w,(1.0-qx.x)-qy.y,0,position.x,position.y,position.z,1);rotatedPoint=localMatrix*rotatedPoint;gl_Position=u_MVPMat*rotatedPoint;
#endif
}`,Lw=`#define GLSLIFY 1
#define IS_METALLIC_WORKFLOW
#include <common>
#include <camera_declare>
#include <FogFragmentDeclaration>
#include <uv_share>
#include <normal_share>
#include <color_share>
#include <worldpos_share>
#include <light_frag_define>
#include <pbr_frag_define>
#include <pbr_helper>
void main(){
#include <clip_plane>
#include <pbr_frag>
#include <FogFragment>
#ifndef OASIS_COLORSPACE_GAMMA
gl_FragColor=linearToGamma(gl_FragColor);
#endif
}`,zw=`#define GLSLIFY 1
#include <common>
#include <camera_declare>
#include <FogFragmentDeclaration>
#include <uv_share>
#include <normal_share>
#include <color_share>
#include <worldpos_share>
#include <light_frag_define>
#include <pbr_frag_define>
#include <pbr_helper>
void main(){
#include <pbr_frag>
#include <FogFragment>
#ifndef OASIS_COLORSPACE_GAMMA
gl_FragColor=linearToGamma(gl_FragColor);
#endif
}`,Pf=`#define GLSLIFY 1
#include <common>
#include <common_vert>
#include <blendShape_input>
#include <uv_share>
#include <color_share>
#include <normal_share>
#include <worldpos_share>
#include <ShadowVertexDeclaration>
#include <FogVertexDeclaration>
void main(){
#include <begin_position_vert>
#include <begin_normal_vert>
#include <blendShape_vert>
#include <skinning_vert>
#include <uv_vert>
#include <color_vert>
#include <normal_vert>
#include <worldpos_vert>
#include <position_vert>
#include <ShadowVertex>
#include <FogVertex>
}`,Ow=`#define GLSLIFY 1
#ifdef OASIS_NO_DEPTH_TEXTURE
vec4 pack(float depth){const vec4 bitShift=vec4(1.0,256.0,256.0*256.0,256.0*256.0*256.0);const vec4 bitMask=vec4(1.0/256.0,1.0/256.0,1.0/256.0,0.0);vec4 rgbaDepth=fract(depth*bitShift);rgbaDepth-=rgbaDepth.gbaa*bitMask;return rgbaDepth;}
#endif
void main(){
#ifdef OASIS_NO_DEPTH_TEXTURE
gl_FragColor=pack(gl_FragCoord.z);
#else
gl_FragColor=vec4(0.0,0.0,0.0,0.0);
#endif
}`,Nw=`#define GLSLIFY 1
#include <common>
#include <common_vert>
#include <blendShape_input>
#include <normal_share>
uniform mat4 u_VPMat;uniform vec2 u_shadowBias;uniform vec3 u_lightDirection;vec3 applyShadowBias(vec3 positionWS){positionWS-=u_lightDirection*u_shadowBias.x;return positionWS;}vec3 applyShadowNormalBias(vec3 positionWS,vec3 normalWS){float invNdotL=1.0-clamp(dot(-u_lightDirection,normalWS),0.0,1.0);float scale=invNdotL*u_shadowBias.y;positionWS+=normalWS*vec3(scale);return positionWS;}void main(){
#include <begin_position_vert>
#include <begin_normal_vert>
#include <blendShape_vert>
#include <skinning_vert>
vec4 positionWS=u_modelMat*position;positionWS.xyz=applyShadowBias(positionWS.xyz);
#ifndef OMIT_NORMAL
#ifdef O3_HAS_NORMAL
vec3 normalWS=normalize(mat3(u_normalMat)*normal);positionWS.xyz=applyShadowNormalBias(positionWS.xyz,normalWS);
#endif
#endif
vec4 positionCS=u_VPMat*positionWS;positionCS.z=max(positionCS.z,-1.0);gl_Position=positionCS;}`,Vw=`#define GLSLIFY 1
#include <common>
#include <worldpos_share>
uniform samplerCube u_cube;varying vec3 v_cubeUV;uniform vec4 u_cubeDecodeParam;void main(){
#include <clip_plane>
vec4 textureColor=textureCube(u_cube,v_cubeUV);if(u_cubeDecodeParam.x>0.0){textureColor=RGBMToLinear(textureColor,u_cubeDecodeParam.y);textureColor=linearToGamma(textureColor);}gl_FragColor=textureColor;}`,Uw=`#define GLSLIFY 1
#include <common_vert>
#include <worldpos_share>
uniform mat4 u_VPMat;varying vec3 v_cubeUV;void main(){
#include <begin_position_vert>
#include <worldpos_vert>
v_cubeUV=vec3(-POSITION.x,POSITION.yz);gl_Position=u_VPMat*vec4(POSITION,1.0);}`,kw=`#define GLSLIFY 1
uniform sampler2D u_maskTexture;uniform float u_maskAlphaCutoff;varying vec2 v_uv;void main(){vec4 color=texture2D(u_maskTexture,v_uv);if(color.a<u_maskAlphaCutoff){discard;}gl_FragColor=color;}`,Hw=`#define GLSLIFY 1
uniform mat4 u_VPMat;attribute vec3 POSITION;attribute vec2 TEXCOORD_0;varying vec2 v_uv;void main(){gl_Position=u_VPMat*vec4(POSITION,1.0);v_uv=TEXCOORD_0;}`,Gw=`#define GLSLIFY 1
#ifdef USE_CUSTOM_TEXTURE
uniform sampler2D u_cusTomTexture;
#else
uniform sampler2D u_spriteTexture;
#endif
varying vec2 v_uv;varying vec4 v_color;void main(){
#ifdef USE_CUSTOM_TEXTURE
vec4 baseColor=texture2D(u_cusTomTexture,v_uv);
#else
vec4 baseColor=texture2D(u_spriteTexture,v_uv);
#endif
gl_FragColor=baseColor*v_color;}`,Ww=`#define GLSLIFY 1
#ifdef USE_MODEL_MATRIX
uniform mat4 u_MVPMat;
#else
uniform mat4 u_VPMat;
#endif
attribute vec3 POSITION;attribute vec2 TEXCOORD_0;attribute vec4 COLOR_0;varying vec2 v_uv;varying vec4 v_color;void main(){
#ifdef USE_MODEL_MATRIX
gl_Position=u_MVPMat*vec4(POSITION,1.0);
#else
gl_Position=u_VPMat*vec4(POSITION,1.0);
#endif
v_uv=TEXCOORD_0;v_color=COLOR_0;}`,Xw=`#define GLSLIFY 1
#include <common>
#include <uv_share>
#include <FogFragmentDeclaration>
#include <worldpos_share>
uniform vec4 u_baseColor;uniform float u_alphaCutoff;
#ifdef BASETEXTURE
uniform sampler2D u_baseTexture;
#endif
void main(){
#include <clip_plane>
vec4 baseColor=u_baseColor;
#ifdef BASETEXTURE
vec4 textureColor=texture2D(u_baseTexture,v_uv);
#ifndef OASIS_COLORSPACE_GAMMA
textureColor=gammaToLinear(textureColor);
#endif
baseColor*=textureColor;
#endif
#ifdef ALPHA_CUTOFF
if(baseColor.a<u_alphaCutoff){discard;}
#endif
gl_FragColor=baseColor;
#ifndef OASIS_TRANSPARENT
gl_FragColor.a=1.0;
#endif
#include <FogFragment>
#ifndef OASIS_COLORSPACE_GAMMA
gl_FragColor=linearToGamma(gl_FragColor);
#endif
}`,jw=`#define GLSLIFY 1
#include <common>
#include <common_vert>
#include <blendShape_input>
#include <uv_share>
#include <FogVertexDeclaration>
#include <worldpos_share>
void main(){
#include <begin_position_vert>
#include <blendShape_vert>
#include <skinning_vert>
#include <uv_vert>
#include <position_vert>
#include <worldpos_vert>
#include <FogVertex>
}`,Yw=`#define GLSLIFY 1
attribute vec3 POSITION;attribute vec2 TEXCOORD_0;varying vec2 v_uv;void main(){gl_Position=vec4(POSITION,1.0);v_uv=TEXCOORD_0;}`,qw=`#define GLSLIFY 1
uniform sampler2D u_baseTexture;varying vec2 v_uv;void main(){gl_FragColor=texture2D(u_baseTexture,v_uv);}`,Qw=function(){function n(){}return n.init=function(){B.create("blinn-phong",Dw,Fw),B.create("pbr",Pf,Lw),B.create("pbr-specular",Pf,zw),B.create("unlit",jw,Xw),B.create("shadow-map",Nw,Ow),B.create("skybox",Uw,Vw),B.create("particle-shader",Iw,Bw),B.create("SpriteMask",Hw,kw),B.create("Sprite",Ww,Gw),B.create("background-texture",Yw,qw)},n}(),$w=function(){function n(){this._cacheHierarchy=1,this._cacheMap=Object.create(null)}var i=n.prototype;return i.get=function(t){var e=this._cacheMap,r=t._length;r>this._cacheHierarchy&&this._resizeCacheMapHierarchy(e,0,r);for(var o=t._mask,s=t._length-1,l=this._cacheHierarchy-1,u=0;u<l;u++){var c=s<u?0:o[u],d=e[c];d||(e[c]=d=Object.create(null)),e=d}var _=s<l?0:o[l],h=e[_];return h||(this._lastQueryKey=_,this._lastQueryMap=e),h},i.cache=function(t){this._lastQueryMap[this._lastQueryKey]=t},i._resizeCacheMapHierarchy=function(t,e,r){var o=this._cacheHierarchy-1;if(e==o){for(var s in t)for(var l=t[s],u=t,c=0,d=r-o;c<d;c++)c==d-1?u[0]=l:u=u[c==0?s:0]=Object.create(null);this._cacheHierarchy=r}else for(var _ in t)this._resizeCacheMapHierarchy(t[_],++e,r)},n}();Qw.init();var Hr=function(n){Q(i,n);function i(t,e,r){var o;o=n.call(this)||this,o._lightManager=new mw,o._componentsManager=new K1,o._lastRenderState=new V_,o._renderElementPool=new Da(E0),o._spriteElementPool=new Da(P0),o._spriteMaskElementPool=new Da(Aw),o._textElementPool=new Da(Rw),o._renderContext=new Ki,o._renderCount=0,o._shaderProgramPools=[],o._canSpriteBatch=!0,o._macroCollection=new En,o._settings={},o._resourceManager=new Ds(_e(o)),o._sceneManager=new F0(_e(o)),o._vSyncCount=1,o._targetFrameRate=60,o._time=new g0,o._isPaused=!0,o._vSyncCounter=1,o._targetFrameInterval=1e3/60,o._destroyed=!1,o._frameInProcess=!1,o._waittingDestroy=!1,o._animate=function(){o._vSyncCount?(o._requestId=requestAnimationFrame(o._animate),o._vSyncCounter++%o._vSyncCount===0&&(o.update(),o._vSyncCounter=1)):(o._timeoutId=window.setTimeout(o._animate,o._targetFrameInterval),o.update())},o._hardwareRenderer=e,o._hardwareRenderer.init(t),o.physicsManager=new Rn(_e(o)),o._canvas=t,o._sceneManager.activeScene=new Is(_e(o),"DefaultScene"),o._spriteMaskManager=new Mw(_e(o)),o._spriteDefaultMaterial=o._createSpriteMaterial(),o._spriteMaskDefaultMaterial=o._createSpriteMaskMaterial(),o._textDefaultFont=ia.createFromOS(_e(o),"Arial"),o._textDefaultFont.isGCIgnored=!1,o.inputManager=new A0(_e(o));var s=new Uint8Array([255,0,255,255]),l=new dn(_e(o),1,1,j.R8G8B8A8,!1);l.setPixelBuffer(s),l.isGCIgnored=!0;var u=new yn(_e(o),1,j.R8G8B8A8,!1);if(u.setPixelBuffer(an.PositiveX,s),u.setPixelBuffer(an.NegativeX,s),u.setPixelBuffer(an.PositiveY,s),u.setPixelBuffer(an.NegativeY,s),u.setPixelBuffer(an.PositiveZ,s),u.setPixelBuffer(an.NegativeZ,s),u.isGCIgnored=!0,!e.canIUse(Z.depthTexture))o._macroCollection.enable(i._noDepthTextureMacro);else{var c=new dn(_e(o),1,1,j.Depth16,!1);c.isGCIgnored=!0,o._depthTexture2D=c}if(o._magentaTexture2D=l,o._magentaTextureCube=u,e.isWebGL2){var d=new O_(_e(o),1,1,1,j.R8G8B8A8,!1);d.setPixelBuffer(0,s),d.isGCIgnored=!0,o._magentaTexture2DArray=d}var _=new Dr(_e(o),B.find("unlit"));_.shaderData.setColor("u_baseColor",new U1(1,0,1.01,1)),o._magentaMaterial=_;var h=new Dr(_e(o),B.find("background-texture"));h.isGCIgnored=!0,h.renderState.depthState.compareFunction=ye.LessEqual,o._backgroundTextureMaterial=h;var f=o._settings,g=(r==null?void 0:r.colorSpace)||xi.Linear;return g===xi.Gamma&&o._macroCollection.enable(i._gammaMacro),f.colorSpace=g,o}var a=i.prototype;return a.createEntity=function(e){return new Fr(this,e)},a.pause=function(){this._isPaused=!0,cancelAnimationFrame(this._requestId),clearTimeout(this._timeoutId)},a.resume=function(){this._isPaused&&(this._isPaused=!1,this.time.reset(),this._requestId=requestAnimationFrame(this._animate))},a.update=function(){var e=this._time;e.tick();var r=e.deltaTime;this._frameInProcess=!0,this._renderElementPool.resetPool(),this._spriteElementPool.resetPool(),this._spriteMaskElementPool.resetPool(),this._textElementPool.resetPool();var o=this._sceneManager._activeScene,s=this._componentsManager;o&&(o._activeCameras.sort(function(l,u){return l.priority-u.priority}),s.callScriptOnStart(),this.physicsManager._initialized&&this.physicsManager._update(r/1e3),this.inputManager._update(),s.callScriptOnUpdate(r),s.callAnimationUpdate(r),s.callScriptOnLateUpdate(r),this._render(o)),this._waittingDestroy||s.handlingInvalidScripts(),this._waittingDestroy&&this._destroy(),this._frameInProcess=!1},a.run=function(){this.resume(),this.trigger(new pd("run",this))},a._destroy=function(){this._sceneManager._destroyAllScene(),this._componentsManager.handlingInvalidScripts(),this._resourceManager._destroy(),this._magentaTexture2D.destroy(!0),this._magentaTextureCube.destroy(!0),this._textDefaultFont.destroy(!0),this.inputManager._destroy(),this.trigger(new pd("shutdown",this)),this.pause(),this._animate=null,this._sceneManager=null,this._resourceManager=null,this._canvas=null,this._time=null,this._spriteMaskManager.destroy(),this.removeAllEventListeners(),this._waittingDestroy=!1,this._destroyed=!0},a.destroy=function(){this._destroyed||(this._frameInProcess?this._waittingDestroy=!0:this._destroy())},a._getShaderProgramPool=function(e){var r=e._shaderPassId,o=this._shaderProgramPools,s=o[r];if(!s){var l=r+1;l>o.length&&(o.length=l),o[r]=s=new $w}return s},a._render=function(e){var r=e._activeCameras,o=this._componentsManager,s=this.time.deltaTime;if(o.callRendererOnUpdate(s),e._updateShaderData(),r.length>0)for(var l=0,u=r.length;l<u;l++){var c=r[l];o.callCameraOnBeginRender(c),c.render(),o.callCameraOnEndRender(c),this._hardwareRenderer._options._forceFlush&&this._hardwareRenderer.flush()}else we.debug("NO active camera.")},a._createSpriteMaterial=function(){var e=new Dr(this,B.find("Sprite")),r=e.renderState,o=r.blendState.targetBlendState;return o.enabled=!0,o.sourceColorBlendFactor=oe.SourceAlpha,o.destinationColorBlendFactor=oe.OneMinusSourceAlpha,o.sourceAlphaBlendFactor=oe.One,o.destinationAlphaBlendFactor=oe.OneMinusSourceAlpha,o.colorBlendOperation=o.alphaBlendOperation=xn.Add,r.depthState.writeEnabled=!1,r.rasterState.cullMode=kt.Off,e.renderState.renderQueueType=Ot.Transparent,e.isGCIgnored=!0,e},a._createSpriteMaskMaterial=function(){var e=new Dr(this,B.find("SpriteMask")),r=e.renderState;return r.blendState.targetBlendState.colorWriteMask=Zn.None,r.rasterState.cullMode=kt.Off,r.stencilState.enabled=!0,r.depthState.enabled=!1,e.isGCIgnored=!0,e},K(i,[{key:"settings",get:function(){return this._settings}},{key:"canvas",get:function(){return this._canvas}},{key:"resourceManager",get:function(){return this._resourceManager}},{key:"sceneManager",get:function(){return this._sceneManager}},{key:"time",get:function(){return this._time}},{key:"isPaused",get:function(){return this._isPaused}},{key:"vSyncCount",get:function(){return this._vSyncCount},set:function(e){this._vSyncCount=Math.max(0,Math.floor(e))}},{key:"targetFrameRate",get:function(){return this._targetFrameRate},set:function(e){e=Math.max(1e-6,e),this._targetFrameRate=e,this._targetFrameInterval=1e3/e}},{key:"destroyed",get:function(){return this._destroyed}}]),i}(p0);Hr._gammaMacro=B.getMacroByName("OASIS_COLORSPACE_GAMMA");Hr._noDepthTextureMacro=B.getMacroByName("OASIS_NO_DEPTH_TEXTURE");Hr._pixelsPerUnit=100;var Ji=function(){function n(){}return n._initialization=function(){{if(typeof navigator>"u")return;var a=navigator.userAgent;/iPhone/i.test(a)?n.platform=On.IPhone:/iPad/i.test(a)?n.platform=On.IPad:/Android/i.test(a)&&(n.platform=On.Android);var t;switch(n.platform){case On.IPhone:t=a.match(/OS (\d+)_?(\d+)?_?(\d+)?/),this.operatingSystem=t?"iPhone OS "+t[1]+"."+(t[2]||0)+"."+(t[3]||0):"iPhone OS";break;case On.IPad:t=a.match(/OS (\d+)_?(\d+)?_?(\d+)?/),this.operatingSystem=t?"iPad OS "+t[1]+"."+(t[2]||0)+"."+(t[3]||0):"iPad OS";break;case On.Android:t=a.match(/Android (\d+).?(\d+)?.?(\d+)?/),this.operatingSystem=t?"Android "+t[1]+"."+(t[2]||0)+"."+(t[3]||0):"Android";break}}},K(n,null,[{key:"devicePixelRatio",get:function(){return window.devicePixelRatio}}]),n}();Ji.platform=On.Unknown;Ji.operatingSystem="";Ji._initialization();var Ft=function(n){Q(i,n);function i(){var t;return t=n.apply(this,arguments)||this,t._started=!1,t._onStartIndex=-1,t._onUpdateIndex=-1,t._onLateUpdateIndex=-1,t._onPhysicsUpdateIndex=-1,t._onPreRenderIndex=-1,t._onPostRenderIndex=-1,t._entityScriptsIndex=-1,t._waitHandlingInValid=!1,t}var a=i.prototype;return a.onAwake=function(){},a.onEnable=function(){},a.onStart=function(){},a.onUpdate=function(e){},a.onLateUpdate=function(e){},a.onBeginRender=function(e){},a.onEndRender=function(e){},a.onPhysicsUpdate=function(){},a.onTriggerEnter=function(e){},a.onTriggerExit=function(e){},a.onTriggerStay=function(e){},a.onCollisionEnter=function(e){},a.onCollisionExit=function(e){},a.onCollisionStay=function(e){},a.onPointerDown=function(e){},a.onPointerUp=function(e){},a.onPointerClick=function(e){},a.onPointerEnter=function(e){},a.onPointerExit=function(e){},a.onPointerDrag=function(e){},a.onDisable=function(){},a.onDestroy=function(){},a._onAwake=function(){this.onAwake()},a._onEnable=function(){if(this._waitHandlingInValid)this._waitHandlingInValid=!1;else{var e=this.engine,r=e._componentsManager,o=i.prototype;this._started||r.addOnStartScript(this),this.onUpdate!==o.onUpdate&&r.addOnUpdateScript(this),this.onLateUpdate!==o.onLateUpdate&&r.addOnLateUpdateScript(this),this.onPhysicsUpdate!==o.onPhysicsUpdate&&r.addOnPhysicsUpdateScript(this),this._entity._addScript(this)}this.onEnable()},a._onDisable=function(){this._waitHandlingInValid=!0,this._engine._componentsManager.addDisableScript(this),this.onDisable()},a._onDestroy=function(){this._engine._componentsManager.addPendingDestroyScript(this)},a._handlingInValid=function(){var e=this.engine._componentsManager,r=i.prototype;this.onUpdate!==r.onUpdate&&e.removeOnUpdateScript(this),this.onLateUpdate!==r.onLateUpdate&&e.removeOnLateUpdateScript(this),this.onPhysicsUpdate!==r.onPhysicsUpdate&&e.removeOnPhysicsUpdateScript(this),this._entity._removeScript(this),this._waitHandlingInValid=!1},i}(vn);O([Y],Ft.prototype,"_started",void 0);O([Y],Ft.prototype,"_onStartIndex",void 0);O([Y],Ft.prototype,"_onUpdateIndex",void 0);O([Y],Ft.prototype,"_onLateUpdateIndex",void 0);O([Y],Ft.prototype,"_onPhysicsUpdateIndex",void 0);O([Y],Ft.prototype,"_onPreRenderIndex",void 0);O([Y],Ft.prototype,"_onPostRenderIndex",void 0);O([Y],Ft.prototype,"_entityScriptsIndex",void 0);O([Y],Ft.prototype,"_waitHandlingInValid",void 0);var D0=function(n){Q(i,n);function i(){return n.apply(this,arguments)}var a=i.prototype;return a.createVertexElements=function(e){return e[0]=new ke("POSITION",0,re.Vector3,0),e[1]=new ke("TEXCOORD_0",12,re.Vector2,0),e[2]=new ke("COLOR_0",20,re.Vector4,0),36},a.canBatch=function(e,r){if(!this._engine._canSpriteBatch)return!1;var o=e.component,s=r.component;return!this.checkBatchWithMask(o,s)||e.texture!==r.texture?!1:e.material===r.material},a.checkBatchWithMask=function(e,r){var o=e.maskInteraction;return o!==r.maskInteraction?!1:o===Un.None?!0:e.maskLayer===r.maskLayer},a.updateVertices=function(e,r,o){for(var s=e.renderData,l=s.positions,u=s.uvs,c=s.color,d=s.vertexCount,_=0;_<d;_++){var h=l[_],f=u[_];r[o++]=h.x,r[o++]=h.y,r[o++]=h.z,r[o++]=f.x,r[o++]=f.y,r[o++]=c.r,r[o++]=c.g,r[o++]=c.b,r[o++]=c.a}return o},a.drawBatches=function(e,r){for(var o=this,s=o._engine,l=o._batchedQueue,u=this._meshes[this._flushId],c=u.subMeshes,d=s._spriteMaskManager,_=e.scene.shaderData,h=e.shaderData,f=0,g=c.length;f<g;f++){var y=c[f],p=l[f];if(!y||!p)return;var v=p.component,m=p.material;d.preRender(e,v);var x=B._compileMacros;En.unionCollection(v._globalShaderMacro,m.shaderData._macroCollection,x),(r||m)._preRender(p);var S=p.shaderPass._getShaderProgram(s,x);if(!S.isValid)return;v.shaderData.setTexture(i._textureProperty,p.texture),S.bind(),S.groupingOtherUniformBlock(),S.uploadAll(S.sceneUniformBlock,_),S.uploadAll(S.cameraUniformBlock,h),S.uploadAll(S.rendererUniformBlock,v.shaderData),S.uploadAll(S.materialUniformBlock,m.shaderData),p.renderState._apply(s,!1),s._hardwareRenderer.drawPrimitive(u,y,S),d.postRender(v)}},a.destroy=function(){this._batchedQueue=null;for(var e=this,r=e._meshes,o=e._vertexBuffers,s=e._indiceBuffers,l=0,u=r.length;l<u;++l)r[l].destroy();this._meshes=null;for(var c=0,d=o.length;c<d;++c)o[c].destroy();this._vertexBuffers=null;for(var _=0,h=s.length;_<h;++_)s[_].destroy();this._indiceBuffers=null},i}(zu);D0._textureProperty=B.getPropertyByName("u_spriteTexture");var br=function(){function n(a){this.items=[],this._spriteBatcher=new D0(a)}var i=n.prototype;return i.pushPrimitive=function(t){this.items.push(t)},i.render=function(t,e,r,o){var s=this.items;if(s.length!==0){for(var l=t.engine,u=t.scene,c=l._renderCount,d=l._hardwareRenderer,_=u.shaderData,h=t.shaderData,f=0,g=s.length;f<g;f++){var y=s[f],p=y.component.entity.layer;if(p&r)if(y.mesh){this._spriteBatcher.flush(t,e);var v=B._compileMacros,m=y,x=m.component,S=m.material.destroyed?l._magentaMaterial:m.material,C=x.shaderData,A=S.shaderData;(e||S)._preRender(m),En.unionCollection(x._globalShaderMacro,A._macroCollection,v);var T=((o==null?void 0:o.passes[0])||(e==null?void 0:e.shader.passes[0])||m.shaderPass)._getShaderProgram(l,v);if(!T.isValid)continue;var E=T.bind(),P=c!==T._uploadRenderCount;P?(T.groupingOtherUniformBlock(),T.uploadAll(T.sceneUniformBlock,_),T.uploadAll(T.cameraUniformBlock,h),T.uploadAll(T.rendererUniformBlock,C),T.uploadAll(T.materialUniformBlock,A),T.uploadUnGroupTextures(),T._uploadScene=u,T._uploadCamera=t,T._uploadRenderer=x,T._uploadMaterial=S,T._uploadRenderCount=c):(T._uploadScene!==u?(T.uploadAll(T.sceneUniformBlock,_),T._uploadScene=u):E&&T.uploadTextures(T.sceneUniformBlock,_),T._uploadCamera!==t?(T.uploadAll(T.cameraUniformBlock,h),T._uploadCamera=t):E&&T.uploadTextures(T.cameraUniformBlock,h),T._uploadRenderer!==x?(T.uploadAll(T.rendererUniformBlock,C),T._uploadRenderer=x):E&&T.uploadTextures(T.rendererUniformBlock,C),T._uploadMaterial!==S?(T.uploadAll(T.materialUniformBlock,A),T._uploadMaterial=S):E&&T.uploadTextures(T.materialUniformBlock,A),E&&T.uploadUnGroupTextures()),m.renderState._apply(l,x.entity.transform._isFrontFaceInvert()),d.drawPrimitive(m.mesh,m.subMesh,T)}else{var b=y;this._spriteBatcher.drawElement(b,t,e)}}this._spriteBatcher.flush(t,e)}},i.clear=function(){this.items.length=0,this._spriteBatcher.clear()},i.destroy=function(){this._spriteBatcher.destroy(),this._spriteBatcher=null},i.sort=function(t){this._quickSort(this.items,0,this.items.length,t)},i._quickSort=function(t,e,r,o){for(;;){if(r-e<=10){this._insertionSort(t,e,r,o);return}var s=e+r>>1,l=t[e],u=t[r-1],c=t[s],d=o(l,u);if(d>0){var _=l;l=u,u=_}var h=o(l,c);if(h>=0){var f=l;l=c,c=u,u=f}else{var g=o(u,c);if(g>0){var y=u;u=c,c=y}}t[e]=l,t[r-1]=c;var p=u,v=e+1,m=r-1;t[s]=t[v],t[v]=p;e:for(var x=v+1;x<m;x++){var S=t[x],C=o(S,p);if(C<0)t[x]=t[v],t[v]=S,v++;else if(C>0){do{if(m--,m==x)break e;var A=t[m];C=o(A,p)}while(C>0);t[x]=t[m],t[m]=S,C<0&&(S=t[x],t[x]=t[v],t[v]=S,v++)}}r-m<v-e?(this._quickSort(t,m,r,o),r=v):(this._quickSort(t,e,v,o),e=m)}},i._insertionSort=function(t,e,r,o){for(var s=e+1;s<r;s++){var l=void 0,u=t[s];for(l=s-1;l>=e;l--){var c=t[l],d=o(c,u);if(d>0)t[l+1]=c;else break}t[l+1]=u}},n._compareFromNearToFar=function(t,e){return t.component.priority-e.component.priority||t.component._distanceForSort-e.component._distanceForSort},n._compareFromFarToNear=function(t,e){return t.component.priority-e.component.priority||e.component._distanceForSort-t.component._distanceForSort},n}(),B0=function(){this.position=new w,this.isOrthographic=!1,this.viewMatrix=new J,this.projectionMatrix=new J,this.viewProjectionMatrix=new J,this.forward=new w},Kw=function(){this.virtualCamera=new B0,this.cullPlanes=[new Le(new w),new Le(new w),new Le(new w),new Le(new w),new Le(new w),new Le(new w),new Le(new w),new Le(new w),new Le(new w),new Le(new w)],this.splitBoundSphere=new f0(new w,0)},bf;(function(n){n[n.FarBottomLeft=0]="FarBottomLeft",n[n.FarTopLeft=1]="FarTopLeft",n[n.FarTopRight=2]="FarTopRight",n[n.FarBottomRight=3]="FarBottomRight",n[n.nearBottomLeft=4]="nearBottomLeft",n[n.nearTopLeft=5]="nearTopLeft",n[n.nearTopRight=6]="nearTopRight",n[n.nearBottomRight=7]="nearBottomRight",n[n.unknown=8]="unknown"})(bf||(bf={}));var dt=function(){function n(){}return n.shadowResolution=function(a){switch(a){case ui.Low:return 512;case ui.Medium:return 1024;case ui.High:return 2048;case ui.VeryHigh:return 4096}},n.shadowDepthFormat=function(a,t){return t?j.Depth16:j.R8G8B8A8},n.cullingRenderBounds=function(a,t,e){for(var r=a.min,o=a.max,s=0;s<t;s++){var l=e[s],u=l.normal;if(u.x*(u.x>=0?o.x:r.x)+u.y*(u.y>=0?o.y:r.y)+u.z*(u.z>=0?o.z:r.z)<-l.distance)return!1}return!0},n.shadowCullFrustum=function(a,t,e,r){var o=e._entity.layer;a.camera.cullingMask&o&&t.cullingMask&o&&e.castShadows&&n.cullingRenderBounds(e.bounds,r.cullPlaneCount,r.cullPlanes)&&(e._renderFrameCount=e.engine.time._frameCount,e._prepareRender(a))},n.getBoundSphereByFrustum=function(a,t,e,r,o){var s=e.aspectRatio,l=e.fieldOfView,u,c,d=Math.sqrt(1+s*s)*Math.tan(H.degreeToRadian(l)/2),_=d*d,h=t-a,f=t+a;_>h/f?(u=t,c=t*d):(u=.5*f*(1+_),c=.5*Math.sqrt(h*h+2*(t*t+a*a)*_+f*f*_*_));var g=o.splitBoundSphere.center;o.splitBoundSphere.radius=c,w.scale(r,u,g),w.add(e.entity.transform.worldPosition,g,g),o.sphereCenterZ=u},n.getDirectionLightShadowCullPlanes=function(a,t,e,r,o){var s=n._frustumCorners,l=n._backPlaneFaces,u=n._frustumPlaneNeighbors,c=n._frustumTwoPlaneCorners,d=n._edgePlanePoint2,_=o.cullPlanes,h=a.getPlane(pe.Near),f=a.getPlane(pe.Far),g=a.getPlane(pe.Left),y=a.getPlane(pe.Right),p=a.getPlane(pe.Bottom),v=a.getPlane(pe.Top),m=t-e,x=n._adjustNearPlane,S=n._adjustFarPlane;x.normal.copyFrom(h.normal),S.normal.copyFrom(f.normal),x.distance=h.distance-m,S.distance=Math.min(-h.distance+o.sphereCenterZ+o.splitBoundSphere.radius,f.distance),zt.intersectionPointThreePlanes(x,p,y,s[7]),zt.intersectionPointThreePlanes(x,v,y,s[6]),zt.intersectionPointThreePlanes(x,v,g,s[5]),zt.intersectionPointThreePlanes(x,p,g,s[4]),zt.intersectionPointThreePlanes(S,p,y,s[3]),zt.intersectionPointThreePlanes(S,v,y,s[2]),zt.intersectionPointThreePlanes(S,v,g,s[1]),zt.intersectionPointThreePlanes(S,p,g,s[0]);for(var C=0,A=0;A<6;A++){var T=void 0;switch(A){case pe.Near:T=x;break;case pe.Far:T=S;break;default:T=a.getPlane(A);break}w.dot(T.normal,r)<0&&(_[C].copyFrom(T),l[C]=A,C++)}for(var E=C,P=0;P<C;P++)for(var b=l[P],M=u[b],F=0;F<4;F++){for(var I=M[F],L=!0,V=0;V<C;V++)if(I==l[V]){L=!1;break}if(L){var U=c[b][I],D=s[U[0]],R=s[U[1]];w.add(D,r,d),Le.fromPoints(D,R,d,_[E++])}}o.cullPlaneCount=E},n.getDirectionalLightMatrices=function(a,t,e,r,o,s,l,u){var c=l.splitBoundSphere;l.resolution=s;var d=c.center,_=c.radius,h=s/2,f=_*h/(h-n.atlasBorderSize),g=f*2,y=s/g,p=g/s,v=Math.ceil(w.dot(d,a)*y)*p,m=Math.ceil(w.dot(d,t)*y)*p,x=w.dot(d,e);d.x=a.x*v+t.x*m+e.x*x,d.y=a.y*v+t.y*m+e.y*x,d.z=a.z*v+t.z*m+e.z*x;var S=l.virtualCamera,C=S.position,A=S.viewMatrix,T=S.projectionMatrix;w.scale(e,_+o,C),w.subtract(d,C,C),J.lookAt(C,d,a,A),J.ortho(-f,f,-f,f,0,_*2+o,T);var E=S.viewProjectionMatrix;J.multiply(T,A,E),nu._floatMatrixMultiply(n._shadowMapCoordMatrix,E.elements,0,u,r*16)},n.getMaxTileResolutionInAtlas=function(a,t,e){for(var r=Math.min(a,t),o=Math.floor(a/r)*Math.floor(t/r);o<e;)r=Math.floor(r>>1),o=Math.floor(a/r)*Math.floor(t/r);return r},n.getShadowBias=function(a,t,e,r){var o=2/t.elements[0],s=o/e,l=-a.shadowBias*s,u=-a.shadowNormalBias*s;if(a.shadowType==kr.SoftHigh){var c=2.5;l*=c,u*=c}r.set(l,u)},n.applySliceTransform=function(a,t,e,r,o,s){var l=n._tempMatrix0,u=l.elements,c=1/t,d=1/e,_=a*c,h=a*d,f=o.x*c,g=o.y*d;u[0]=_,u[1]=0,u[2]=0,u[3]=0,u[4]=0,u[5]=h,u[6]=0,u[7]=0,u[8]=0,u[9]=0,u[10]=1,u[11]=0,u[12]=f,u[13]=g,u[14]=0,u[15]=1;var y=r*16;nu._floatMatrixMultiply(l,s,y,s,y)},n}();dt._tempMatrix0=new J;dt._shadowMapCoordMatrix=new J(.5,0,0,0,0,.5,0,0,0,0,.5,0,.5,.5,.5,1);dt._frustumCorners=[new w,new w,new w,new w,new w,new w,new w,new w];dt._adjustNearPlane=new Le(new w);dt._adjustFarPlane=new Le(new w);dt._backPlaneFaces=new Array(5);dt._edgePlanePoint2=new w;dt._frustumPlaneNeighbors=[[pe.Left,pe.Right,pe.Top,pe.Bottom],[pe.Left,pe.Right,pe.Top,pe.Bottom],[pe.Near,pe.Far,pe.Top,pe.Bottom],[pe.Near,pe.Far,pe.Top,pe.Bottom],[pe.Near,pe.Far,pe.Left,pe.Right],[pe.Near,pe.Far,pe.Left,pe.Right]];dt._frustumTwoPlaneCorners=[[[8,8],[8,8],[4,5],[6,7],[7,4],[5,6]],[[8,8],[8,8],[1,0],[3,2],[0,3],[2,1]],[[5,4],[0,1],[8,8],[8,8],[4,0],[1,5]],[[7,6],[2,3],[8,8],[8,8],[3,7],[6,2]],[[4,7],[3,0],[0,4],[7,3],[8,8],[8,8]],[[6,5],[1,2],[5,1],[2,6],[8,8],[8,8]]];dt.atlasBorderSize=4;var fn=function(){function n(a){this._shadowMapSize=new he,this._shadowBias=new W,this._shadowSliceData=new Kw,this._lightUp=new w,this._lightSide=new w,this._existShadowMap=!1,this._splitBoundSpheres=new Float32Array(n._maxCascades*4),this._shadowMatrices=new Float32Array((n._maxCascades+1)*16),this._shadowInfos=new w,this._viewportOffsets=[new W,new W,new W,new W],this._camera=a,this._engine=a.engine,this._supportDepthTexture=a.engine._hardwareRenderer.canIUse(Z.depthTexture),this._shadowCasterShader=B.find("shadow-map"),this._shadowSliceData.virtualCamera.isOrthographic=!0}var i=n.prototype;return i._render=function(t){this._updateShadowSettings(),this._existShadowMap=!1,this._renderDirectShadowMap(t),this._existShadowMap&&this._updateReceiversShaderData()},i._renderDirectShadowMap=function(t){var e=this,r=e._engine,o=e._camera,s=e._shadowCasterShader,l=e._viewportOffsets,u=e._shadowSliceData,c=e._splitBoundSpheres,d=e._shadowMatrices,_=o._renderPipeline,h=_._opaqueQueue,f=_._alphaTestQueue,g=_._transparentQueue,y=r._componentsManager,p=r._hardwareRenderer,v=o.scene.shadowCascades,m=n._cascadesSplitDistance,x=u.splitBoundSphere,S=n._tempMatrix0,C=S.elements,A=this._lightUp,T=this._lightSide,E=u.virtualCamera.forward,P=r._lightManager._getSunLightIndex();if(P!==-1){var b=o.scene._sunLight,M=Math.min(o.scene.shadowDistance,o.farClipPlane);this._getCascadesSplitDistance(M);var F=this._getAvailableRenderTarget();p.activeRenderTarget(F,null,0),this._supportDepthTexture?p.clearRenderTarget(r,Kt.Depth,null):p.clearRenderTarget(r,Kt.All,n._clearColor),this._shadowInfos.x=b.shadowStrength,this._shadowInfos.z=P,J.rotationQuaternion(b.entity.transform.worldRotationQuaternion,S),T.set(C[0],C[1],C[2]),A.set(C[4],C[5],C[6]),E.set(-C[8],-C[9],-C[10]),o.entity.transform.getWorldForward(n._tempVector);for(var I=this._shadowTileResolution,L=0;L<v;L++){if(dt.getBoundSphereByFrustum(m[L],m[L+1],o,n._tempVector.normalize(),u),dt.getDirectionLightShadowCullPlanes(o._frustum,m[L],o.nearClipPlane,E,u),dt.getDirectionalLightMatrices(A,T,E,L,b.shadowNearPlane,I,u,d),v>1){var V=this._shadowMapSize;dt.applySliceTransform(I,V.z,V.w,L,this._viewportOffsets[L],d)}this._updateSingleShadowCasterShaderData(b,u,t);var U=x.center,D=x.radius,R=L*4;c[R]=U.x,c[R+1]=U.y,c[R+2]=U.z,c[R+3]=D*D,h.clear(),f.clear(),g.clear();for(var N=y._renderers,X=N._elements,q=N.length-1;q>=0;--q)dt.shadowCullFrustum(t,b,X[q],u);if(h.items.length||f.items.length){h.sort(br._compareFromNearToFar),f.sort(br._compareFromNearToFar);var te=l[L],ie=te.x,ce=te.y;p.setGlobalDepthBias(1,1),p.viewport(ie,ce,I,I),p.scissor(ie+1,ce+1,I-2,I-2),r._renderCount++,h.render(o,null,Ut.Everything,s),f.render(o,null,Ut.Everything,s),p.setGlobalDepthBias(0,0)}}this._existShadowMap=!0}},i._updateReceiversShaderData=function(){var t=this._camera.scene,e=this._splitBoundSpheres,r=this._shadowMatrices,o=t.shadowCascades;if(o>1)for(var s=o*4,l=e.length;s<l;s++)e[s]=0;for(var u=o*16,c=r.length;u<c;u++)r[u]=0;var d=t.shaderData;d.setFloatArray(n._shadowMatricesProperty,this._shadowMatrices),d.setVector3(n._shadowInfosProperty,this._shadowInfos),d.setTexture(n._shadowMapsProperty,this._depthTexture),d.setFloatArray(n._shadowSplitSpheresProperty,this._splitBoundSpheres),d.setVector4(n._shadowMapSize,this._shadowMapSize)},i._getCascadesSplitDistance=function(t){var e=n._cascadesSplitDistance,r=this._camera.scene,o=r.shadowTwoCascadeSplits,s=r.shadowFourCascadeSplits,l=r.shadowCascades,u=this._camera,c=u.nearClipPlane,d=u.aspectRatio,_=u.fieldOfView;e[0]=c;var h=t-c,f=Math.tan(H.degreeToRadian(_)*.5),g=1+f*f*(d*d+1);switch(l){case Bn.NoCascades:e[1]=this._getFarWithRadius(t,g);break;case Bn.TwoCascades:e[1]=this._getFarWithRadius(c+h*o,g),e[2]=this._getFarWithRadius(t,g);break;case Bn.FourCascades:e[1]=this._getFarWithRadius(c+h*s.x,g),e[2]=this._getFarWithRadius(c+h*s.y,g),e[3]=this._getFarWithRadius(c+h*s.z,g),e[4]=this._getFarWithRadius(t,g);break}},i._getFarWithRadius=function(t,e){return Math.sqrt(t*t/e)},i._getAvailableRenderTarget=function(){var t=this._engine,e=this._shadowMapFormat,r=this._shadowMapSize,o=r.z,s=r.w,l=this._depthTexture,u=this._renderTargets;return(u==null||(l==null?void 0:l.width)!==o||(l==null?void 0:l.height)!==s||(l==null?void 0:l.format)!==e)&&(l=this._depthTexture=new dn(t,o,s,e,!1),l.wrapModeV=l.wrapModeU=Vt.Clamp,t._hardwareRenderer._isWebGL2&&(l.depthCompareFunction=Dn.Less),this._supportDepthTexture?u=this._renderTargets=new Ka(t,o,s,null,l):u=this._renderTargets=new Ka(t,o,s,l)),u},i._updateShadowSettings=function(){var t=this._camera.scene,e=dt.shadowDepthFormat(t.shadowResolution,this._supportDepthTexture),r=dt.shadowResolution(t.shadowResolution),o=t.shadowCascades;if(e!==this._shadowMapFormat||r!==this._shadowMapResolution||o!==this._shadowCascadeMode){if(this._shadowMapFormat=e,this._shadowMapResolution=r,this._shadowCascadeMode=o,o==Bn.NoCascades)this._shadowTileResolution=r,this._shadowMapSize.set(1/r,1/r,r,r);else{var s=dt.getMaxTileResolutionInAtlas(r,r,o);this._shadowTileResolution=s;var l=s*2,u=o==Bn.TwoCascades?s:s*2;this._shadowMapSize.set(1/l,1/u,l,u)}this._renderTargets=null;var c=this._viewportOffsets,d=this._shadowTileResolution;switch(o){case Bn.NoCascades:c[0].set(0,0);break;case Bn.TwoCascades:c[0].set(0,0),c[1].set(d,0);break;case Bn.FourCascades:c[0].set(0,0),c[1].set(d,0),c[2].set(0,d),c[3].set(d,d)}}},i._updateSingleShadowCasterShaderData=function(t,e,r){var o=e.virtualCamera;dt.getShadowBias(t,o.projectionMatrix,this._shadowTileResolution,this._shadowBias);var s=this._camera.scene.shaderData;s.setVector2(n._lightShadowBiasProperty,this._shadowBias),s.setVector3(n._lightDirectionProperty,t.direction),r.applyVirtualCamera(o)},n}();fn._lightShadowBiasProperty=B.getPropertyByName("u_shadowBias");fn._lightDirectionProperty=B.getPropertyByName("u_lightDirection");fn._shadowMatricesProperty=B.getPropertyByName("u_shadowMatrices");fn._shadowMapSize=B.getPropertyByName("u_shadowMapSize");fn._shadowInfosProperty=B.getPropertyByName("u_shadowInfo");fn._shadowMapsProperty=B.getPropertyByName("u_shadowMap");fn._shadowSplitSpheresProperty=B.getPropertyByName("u_shadowSplitSpheres");fn._maxCascades=4;fn._cascadesSplitDistance=new Array(fn._maxCascades+1);fn._clearColor=new ne(1,1,1,1);fn._tempVector=new w;fn._tempMatrix0=new J;var Jw=0,Io=function(){function n(a,t,e,r,o){a===void 0&&(a="RENDER_PASS"+Jw++),t===void 0&&(t=0),e===void 0&&(e=null),r===void 0&&(r=null),o===void 0&&(o=null),this.name=a,this.enabled=!0,this.priority=t,this.renderTarget=e,this.replaceMaterial=r,this.mask=o||Ut.Everything,this.renderOverride=!1}var i=n.prototype;return i.render=function(t,e,r,o){},i.preRender=function(t,e,r,o){},i.postRender=function(t,e,r,o){},n}(),Ou=function(){function n(a){this._allSpriteMasks=new ot,this._lastCanvasSize=new W,this._camera=a;var t=a.engine;this._opaqueQueue=new br(t),this._alphaTestQueue=new br(t),this._transparentQueue=new br(t),this._cascadedShadowCaster=new fn(a),this._renderPassArray=[],this._defaultPass=new Io("default",0,null,null,0),this.addRenderPass(this._defaultPass)}var i=n.prototype;return i.addRenderPass=function(t,e,r,o,s){if(e===void 0&&(e=null),r===void 0&&(r=null),o===void 0&&(o=null),s===void 0&&(s=null),typeof t=="string"){var l=new Io(t,e,r,o,s);this._renderPassArray.push(l)}else He(t,Io)&&this._renderPassArray.push(t);this._renderPassArray.sort(function(u,c){return u.priority-c.priority})},i.removeRenderPass=function(t){var e;if(typeof t=="string"?e=this.getRenderPass(t):He(t,Io)&&(e=t),e){var r=this._renderPassArray.indexOf(e);this._renderPassArray.splice(r,1)}},i.getRenderPass=function(t){for(var e=0,r=this._renderPassArray.length;e<r;e++){var o=this._renderPassArray[e];if(o.name===t)return o}return null},i.destroy=function(){this._opaqueQueue.destroy(),this._alphaTestQueue.destroy(),this._transparentQueue.destroy(),this._allSpriteMasks=null,this._renderPassArray=null,this._defaultPass=null,this._camera=null},i.render=function(t,e,r){var o,s=this._camera,l=s.scene,u=this._opaqueQueue,c=this._alphaTestQueue,d=this._transparentQueue;s.engine._spriteMaskManager.clear(),l.castShadows&&((o=l._sunLight)==null?void 0:o.shadowType)!==kr.None&&this._cascadedShadowCaster._render(t),u.clear(),c.clear(),d.clear(),this._allSpriteMasks.length=0,t.applyVirtualCamera(s._virtualCamera),this._callRender(t),u.sort(br._compareFromNearToFar),c.sort(br._compareFromNearToFar),d.sort(br._compareFromFarToNear);for(var _=0,h=this._renderPassArray.length;_<h;_++)this._drawRenderPass(t,this._renderPassArray[_],s,e,r)},i._drawRenderPass=function(t,e,r,o,s){if(e.preRender(r,this._opaqueQueue,this._alphaTestQueue,this._transparentQueue),e.enabled){var l=r.engine,u=r.scene,c=u.background,d=l._hardwareRenderer,_=r.renderTarget||e.renderTarget;d.activeRenderTarget(_,r.viewport,s),_==null||_._setRenderTargetInfo(o,s);var h,f=(h=e.clearFlags)!=null?h:r.clearFlags,g,y=(g=e.clearColor)!=null?g:c.solidColor;f!==Kt.None&&d.clearRenderTarget(r.engine,f,y),e.renderOverride?e.render(r,this._opaqueQueue,this._alphaTestQueue,this._transparentQueue):(this._opaqueQueue.render(r,e.replaceMaterial,e.mask,null),this._alphaTestQueue.render(r,e.replaceMaterial,e.mask,null),(r.clearFlags&Kt.Color||r.drawBackgroundForce)&&(c.mode===Cn.Sky?c.sky._render(t):c.mode===Cn.Texture&&c.texture&&this._drawBackgroundTexture(l,c)),this._transparentQueue.render(r,e.replaceMaterial,e.mask,null)),_==null||_._blitRenderTarget(),_==null||_.generateMipmaps()}e.postRender(r,this._opaqueQueue,this._alphaTestQueue,this._transparentQueue)},i.pushPrimitive=function(t){switch(t.renderState.renderQueueType){case Ot.Transparent:this._transparentQueue.pushPrimitive(t);break;case Ot.AlphaTest:this._alphaTestQueue.pushPrimitive(t);break;case Ot.Opaque:this._opaqueQueue.pushPrimitive(t);break}},i._drawBackgroundTexture=function(t,e){var r=t._hardwareRenderer,o=t._backgroundTextureMaterial,s=t.canvas,l=e._mesh;(this._lastCanvasSize.x!==s.width||this._lastCanvasSize.y!==s.height)&&e._textureFillMode!==ci.Fill&&(this._lastCanvasSize.set(s.width,s.height),e._resizeBackgroundTexture());var u=o.shader.passes[0]._getShaderProgram(t,B._compileMacros);u.bind(),u.uploadAll(u.materialUniformBlock,o.shaderData),u.uploadUnGroupTextures(),o.renderState._apply(t,!1),r.drawPrimitive(l,l.subMesh,u)},i._callRender=function(t){for(var e=t.camera.engine,r=e._componentsManager._renderers,o=t.camera,s=r._elements,l=r.length-1;l>=0;--l){var u=s[l];o.cullingMask&u._entity.layer&&(o.enableFrustumCulling&&!o._frustum.intersectsBox(u.bounds)||(u._renderFrameCount=e.time._frameCount,u._prepareRender(t)))}},K(n,[{key:"defaultRenderPass",get:function(){return this._defaultPass}}]),n}();Ou._tempVector0=new w;Ou._tempVector1=new w;var fa,Wi=function(){};Wi.tempVec4=new he;Wi.tempVec3=new w;Wi.tempVec2=new W;var Pe=(fa=function(n){Q(i,n);function i(t){var e;e=n.call(this,t)||this,e.shaderData=new Bs(er.Camera),e.priority=0,e.enableFrustumCulling=!0,e.clearFlags=Kt.All,e.drawBackgroundForce=!1,e.cullingMask=Ut.Everything,e._globalShaderMacro=new En,e._isProjMatSetting=!1,e._nearClipPlane=.1,e._farClipPlane=100,e._fieldOfView=45,e._orthographicSize=10,e._isProjectionDirty=!0,e._isInvProjMatDirty=!0,e._isFrustumProjectDirty=!0,e._customAspectRatio=void 0,e._renderTarget=null,e._frustum=new z1,e._virtualCamera=new B0,e._viewport=new he(0,0,1,1),e._inverseProjectionMatrix=new J,e._lastAspectSize=new W(0,0),e._invViewProjMat=new J,e._clipPlane=void 0,e._mirrorPlane=void 0,e._mirrorMatrix=new J;var r=e.entity.transform;return e._transform=r,e._isViewMatrixDirty=r.registerWorldChangeFlag(),e._isInvViewProjDirty=r.registerWorldChangeFlag(),e._frustumViewChangeFlag=r.registerWorldChangeFlag(),e._renderPipeline=new Ou(_e(e)),e.shaderData._addRefCount(1),e}var a=i.prototype;return a.resetProjectionMatrix=function(){this._isProjMatSetting=!1,this._projMatChange()},a.resetAspectRatio=function(){this._customAspectRatio=void 0,this._projMatChange()},a.worldToViewportPoint=function(e,r){var o=Wi.tempVec3,s=Wi.tempVec4;w.transformCoordinate(e,this.viewMatrix,o),w.transformToVec4(o,this.projectionMatrix,s);var l=s.w;return r.set((s.x/l+1)*.5,(1-s.y/l)*.5,-o.z),r},a.viewportToWorldPoint=function(e,r){var o=this,s=o.nearClipPlane,l=o.farClipPlane,u=1/(s-l),c;if(this.isOrthographic)c=-e.z*2*u,c+=(l+s)*u;else{var d=e.z;c=-d*(s+l)*u,c+=2*s*l*u,c=c/d}return this._innerViewportToWorldPoint(e.x,e.y,(c+1)/2,this._getInvViewProjMat(),r),r},a.viewportPointToRay=function(e,r){var o=this._getInvViewProjMat(),s=this._innerViewportToWorldPoint(e.x,e.y,0,o,r.origin),l=this._innerViewportToWorldPoint(e.x,e.y,1,o,r.direction);return w.subtract(l,s,l),l.normalize(),r},a.screenToViewportPoint=function(e,r){var o=this.engine.canvas,s=this.viewport;return r.x=(e.x/o.width-s.x)/s.z,r.y=(e.y/o.height-s.y)/s.w,e.z!==void 0&&(r.z=e.z),r},a.viewportToScreenPoint=function(e,r){var o=this.engine.canvas,s=this.viewport;return r.x=(s.x+e.x*s.z)*o.width,r.y=(s.y+e.y*s.w)*o.height,e.z!==void 0&&(r.z=e.z),r},a.worldToScreenPoint=function(e,r){return this.worldToViewportPoint(e,r),this.viewportToScreenPoint(r,r)},a.screenToWorldPoint=function(e,r){return this.screenToViewportPoint(e,r),this.viewportToWorldPoint(r,r)},a.screenPointToRay=function(e,r){var o=Wi.tempVec2;return this.screenToViewportPoint(e,o),this.viewportPointToRay(o,r)},a.render=function(e,r){r===void 0&&(r=0);var o=this.engine._renderContext,s=this._virtualCamera,l=this.entity.transform;J.multiply(this.projectionMatrix,this.viewMatrix,s.viewProjectionMatrix),s.forward.copyFrom(l.worldPosition),s.isOrthographic&&l.getWorldForward(s.forward),o.camera=this,o.virtualCamera=s,this.enableFrustumCulling&&(this._frustumViewChangeFlag.flag||this._isFrustumProjectDirty)&&(this._frustum.calculateFromMatrix(s.viewProjectionMatrix),this._frustumViewChangeFlag.flag=!1,this._isFrustumProjectDirty=!1),this._updateShaderData(),En.unionCollection(this.scene._globalShaderMacro,this.shaderData._macroCollection,this._globalShaderMacro),r>0&&!this.engine._hardwareRenderer.isWebGL2&&(r=0,we.error("mipLevel only take effect in WebGL2.0")),this._renderPipeline.render(o,e,r),this._engine._renderCount++},a._onEnable=function(){this.entity.scene._attachRenderCamera(this)},a._onDisable=function(){this.entity.scene._detachRenderCamera(this)},a._onDestroy=function(){var e;(e=this._renderPipeline)==null||e.destroy(),this._isInvViewProjDirty.destroy(),this._isViewMatrixDirty.destroy(),this.shaderData._addRefCount(-1)},a._projMatChange=function(){this._isFrustumProjectDirty=!0,this._isProjectionDirty=!0,this._isInvProjMatDirty=!0,this._isInvViewProjDirty.flag=!0},a._innerViewportToWorldPoint=function(e,r,o,s,l){var u=Wi.tempVec3;return u.set(e*2-1,1-r*2,o*2-1),w.transformCoordinate(u,s,l),l},a._updateShaderData=function(){var e=this.shaderData;e.setMatrix(Pe._inverseViewMatrixProperty,this._transform.worldMatrix),e.setVector3(Pe._cameraPositionProperty,this._transform.worldPosition)},a._getInvViewProjMat=function(){return this._isInvViewProjDirty.flag&&(this._isInvViewProjDirty.flag=!1,J.multiply(this._transform.worldMatrix,this._getInverseProjectionMatrix(),this._invViewProjMat)),this._invViewProjMat},a._getInverseProjectionMatrix=function(){return this._isInvProjMatDirty&&(this._isInvProjMatDirty=!1,J.invert(this.projectionMatrix,this._inverseProjectionMatrix)),this._inverseProjectionMatrix},K(i,[{key:"mirrorPlane",get:function(){return this._mirrorPlane},set:function(e){(e!==this._mirrorPlane||e&&this.mirrorPlane&&he.equals(e,this._mirrorPlane))&&(this._mirrorPlane=e,this._mirrorPlane&&J.relectFromPlane(this._mirrorPlane,this._mirrorMatrix),this._isViewMatrixDirty.dispatch())}},{key:"clipPlane",get:function(){return this._clipPlane},set:function(e){e?(!this._clipPlane||!he.equals(e,this._clipPlane))&&(this._clipPlane=e,this.shaderData.setVector4(Pe._clipPlaneProperty,e),this.shaderData.enableMacro(Pe._clipPlaneMacro),this.shaderData.enableMacro("O3_NEED_WORLDPOS")):(this._clipPlane=void 0,this.shaderData.disableMacro(Pe._clipPlaneMacro))}},{key:"nearClipPlane",get:function(){return this._nearClipPlane},set:function(e){this._nearClipPlane=e,this._projMatChange()}},{key:"farClipPlane",get:function(){return this._farClipPlane},set:function(e){this._farClipPlane=e,this._projMatChange()}},{key:"fieldOfView",get:function(){return this._fieldOfView},set:function(e){this._fieldOfView=e,this._projMatChange()}},{key:"aspectRatio",get:function(){var e=this._entity.engine.canvas,r;return(r=this._customAspectRatio)!=null?r:e.width*this._viewport.z/(e.height*this._viewport.w)},set:function(e){this._customAspectRatio=e,this._projMatChange()}},{key:"viewport",get:function(){return this._viewport},set:function(e){e!==this._viewport&&this._viewport.copyFrom(e),this._projMatChange()}},{key:"isOrthographic",get:function(){return this._virtualCamera.isOrthographic},set:function(e){this._virtualCamera.isOrthographic=e,this._projMatChange()}},{key:"orthographicSize",get:function(){return this._orthographicSize},set:function(e){this._orthographicSize=e,this._projMatChange()}},{key:"viewMatrix",get:function(){var e=this._virtualCamera.viewMatrix;if(this._isViewMatrixDirty.flag){this._isViewMatrixDirty.flag=!1;var r=this._transform;J.rotationTranslation(r.worldRotationQuaternion,r.worldPosition,e),e.invert(),this.mirrorPlane&&J.multiply(e,this._mirrorMatrix,e)}return e}},{key:"projectionMatrix",get:function(){var e=this._virtualCamera,r=e.projectionMatrix,o=this._entity.engine.canvas;if((!this._isProjectionDirty||this._isProjMatSetting)&&this._lastAspectSize.x===o.width&&this._lastAspectSize.y===o.height)return r;this._isProjectionDirty=!1,this._lastAspectSize.x=o.width,this._lastAspectSize.y=o.height;var s=this.aspectRatio;if(!e.isOrthographic)J.perspective(H.degreeToRadian(this._fieldOfView),s,this._nearClipPlane,this._farClipPlane,r);else{var l=this._orthographicSize*s,u=this._orthographicSize;J.ortho(-l,l,-u,u,this._nearClipPlane,this._farClipPlane,r)}return r},set:function(e){this._virtualCamera.projectionMatrix.copyFrom(e),this._isProjMatSetting=!0,this._projMatChange()}},{key:"enableHDR",get:function(){return console.log("not implementation"),!1},set:function(e){console.log("not implementation")}},{key:"renderTarget",get:function(){return this._renderTarget},set:function(e){this._renderTarget=e}}]),i}(vn),fa._inverseViewMatrixProperty=B.getPropertyByName("u_viewInvMat"),fa._cameraPositionProperty=B.getPropertyByName("u_cameraPos"),fa._clipPlaneProperty=B.getPropertyByName("u_clip_plane"),fa._clipPlaneMacro=B.getMacroByName("OASIS_CLIP_PLANE"),fa);O([je],Pe.prototype,"_frustum",void 0);O([Y],Pe.prototype,"_renderPipeline",void 0);O([Y],Pe.prototype,"_virtualCamera",void 0);O([Y],Pe.prototype,"_frustumViewChangeFlag",void 0);O([Y],Pe.prototype,"_transform",void 0);O([Y],Pe.prototype,"_isViewMatrixDirty",void 0);O([Y],Pe.prototype,"_isInvViewProjDirty",void 0);O([je],Pe.prototype,"_viewport",void 0);O([je],Pe.prototype,"_inverseProjectionMatrix",void 0);O([je],Pe.prototype,"_lastAspectSize",void 0);O([je],Pe.prototype,"_invViewProjMat",void 0);O([je],Pe.prototype,"_clipPlane",void 0);O([je],Pe.prototype,"_mirrorPlane",void 0);O([je],Pe.prototype,"_mirrorMatrix",void 0);Pe=O([ua(fe)],Pe);var Zw={json:"json",gltf:"json",mtl:"json",prefab:"json",txt:"text",bin:"arraybuffer",png:"image",webp:"image",jpg:"image"},eS=1,tS=1/0,nS=500;function wi(n,i){return i===void 0&&(i={}),new Ae(function(a,t,e){var r,o=(r=i.retryCount)!=null?r:eS,s,l=(s=i.retryInterval)!=null?s:nS,u;i.timeout=(u=i.timeout)!=null?u:tS;var c;i.type=(c=i.type)!=null?c:aS(n);var d=i.type==="image"?rS:iS,_,h=new oS(function(){return d(n,i).onProgress(e).then(function(f){a(f),h.stop()}).catch(function(f){return _=f})},o,l);h.start(function(){t(_)})})}function rS(n,i){return new Ae(function(a,t){var e=i.timeout,r=new Image,o=function(){t(new Error("request "+n+" fail"))};r.onerror=o,r.onabort=o;var s=-1;e!=1/0&&(s=window.setTimeout(function(){t(new Error("request "+n+" timeout"))},e)),r.onload=function(l){return function(){requestAnimationFrame(function(){a(r),r.onload=null,r.onerror=null,r.onabort=null}),clearTimeout(l)}}(s),r.crossOrigin="anonymous",r.src=n})}function iS(n,i){return new Ae(function(a,t,e){var r=new XMLHttpRequest;r.timeout=i.timeout;var o;i.method=(o=i.method)!=null?o:"get",r.onload=function(){if(r.status<200||r.status>=300){t(new Error("request failed from: "+n));return}var l,u=(l=r.response)!=null?l:r.responseText;a(u)},r.onerror=function(){t(new Error("request failed from: "+n))},r.ontimeout=function(){t(new Error("request timeout from: "+n))},r.onprogress=function(l){e(l.loaded/l.total)},r.open(i.method,n,!0),r.withCredentials=i.credentials==="include",r.responseType=i.type;var s=i.headers;s&&Object.keys(s).forEach(function(l){r.setRequestHeader(l,s[l])}),r.send(i.body)})}function aS(n){var i=n.substring(n.lastIndexOf(".")+1);return Zw[i]}var oS=function(){function n(a,t,e){this.execFunc=a,this.totalCount=t,this.interval=e,this._timeoutId=-100,this._currentCount=0,this.exec=this.exec.bind(this)}var i=n.prototype;return i.start=function(t){this.done=t,this.exec()},i.stop=function(){clearTimeout(this._timeoutId)},i.exec=function(){var t=this;if(this._currentCount>=this.totalCount){this.done&&this.done();return}this._currentCount++,this.execFunc(this._currentCount).then(function(){t._timeoutId=setTimeout(t.exec,t.interval)})},n}(),Oe=function(){function n(i){this.useCache=i,this.request=wi}return n.registerClass=function(a,t){this._engineObjects[a]=t},n.getClass=function(a){return this._engineObjects[a]},n}();Oe._engineObjects={};var Xe;(function(n){n.Text="text",n.JSON="json",n.Buffer="buffer",n.Texture2D="texture2d",n.TextureCube="texture-cube",n.Material="material",n.Mesh="mesh",n.AnimationClip="AnimationClip",n.AnimatorController="AnimatorController",n.Prefab="prefab",n.KTX="ktx",n.KTXCube="ktx-cube",n.Sprite="sprite",n.SpriteAtlas="sprite-atlas",n.Env="environment",n.Scene="scene",n.HDR="HDR",n.Font="font",n.SourceFont="source-font"})(Xe||(Xe={}));var Xi;(function(n){n[n.Normal=0]="Normal",n[n.Additive=1]="Additive"})(Xi||(Xi={}));var Ir;(function(n){n[n.Front=0]="Front",n[n.Back=1]="Back",n[n.Double=2]="Double"})(Ir||(Ir={}));var xt=function(n){Q(i,n);function i(t,e){var r;return r=n.call(this,t,e)||this,r._renderFace=Ir.Front,r._isTransparent=!1,r._blendMode=Xi.Normal,r.shaderData.setFloat(i._alphaCutoffProp,0),r}var a=i.prototype;return a.setIsTransparent=function(e,r){var o=this.renderStates;if(o.length<e)throw"Pass should less than pass count.";var s=o[e];r?(s.blendState.targetBlendState.enabled=!0,s.depthState.writeEnabled=!1,s.renderQueueType=Ot.Transparent,this.shaderData.enableMacro(i._transparentMacro)):(s.blendState.targetBlendState.enabled=!1,s.depthState.writeEnabled=!0,s.renderQueueType=this.shaderData.getFloat(i._alphaCutoffProp)?Ot.AlphaTest:Ot.Opaque,this.shaderData.disableMacro(i._transparentMacro))},a.setBlendMode=function(e,r){var o=this.renderStates;if(o.length<e)throw"Pass should less than pass count.";var s=o[e].blendState,l=s.targetBlendState;switch(r){case Xi.Normal:l.sourceColorBlendFactor=oe.SourceAlpha,l.destinationColorBlendFactor=oe.OneMinusSourceAlpha,l.sourceAlphaBlendFactor=oe.One,l.destinationAlphaBlendFactor=oe.OneMinusSourceAlpha,l.colorBlendOperation=l.alphaBlendOperation=xn.Add;break;case Xi.Additive:l.sourceColorBlendFactor=oe.SourceAlpha,l.destinationColorBlendFactor=oe.One,l.sourceAlphaBlendFactor=oe.One,l.destinationAlphaBlendFactor=oe.OneMinusSourceAlpha,l.colorBlendOperation=l.alphaBlendOperation=xn.Add;break}},a.setRenderFace=function(e,r){var o=this.renderStates;if(o.length<e)throw"Pass should less than pass count.";switch(r){case Ir.Front:o[e].rasterState.cullMode=kt.Back;break;case Ir.Back:o[e].rasterState.cullMode=kt.Front;break;case Ir.Double:o[e].rasterState.cullMode=kt.Off;break}},a.clone=function(){var e=new i(this._engine,this.shader);return this.cloneTo(e),e},a.cloneTo=function(e){n.prototype.cloneTo.call(this,e),e._renderFace=this._renderFace,e._isTransparent=this._isTransparent,e._blendMode=this._blendMode},K(i,[{key:"shader",get:function(){return this._shader},set:function(e){this._shader=e;var r=this._renderStates,o=r.length,s=e.passes.length;if(o<s)for(var l=o;l<s;l++)r.push(new V_),this.setBlendMode(l,Xi.Normal);else r.length=s}},{key:"isTransparent",get:function(){return this._isTransparent},set:function(e){e!==this._isTransparent&&(this.setIsTransparent(0,e),this._isTransparent=e)}},{key:"blendMode",get:function(){return this._blendMode},set:function(e){e!==this._blendMode&&(this.setBlendMode(0,e),this._blendMode=e)}},{key:"alphaCutoff",get:function(){return this.shaderData.getFloat(i._alphaCutoffProp)},set:function(e){var r=this.shaderData;if(r.getFloat(i._alphaCutoffProp)!==e){e?r.enableMacro(i._alphaCutoffMacro):r.disableMacro(i._alphaCutoffMacro);for(var o=this.renderStates,s=0,l=o.length;s<l;s++){var u=o[s];e>0?u.renderQueueType=u.blendState.targetBlendState.enabled?Ot.Transparent:Ot.AlphaTest:u.renderQueueType=u.blendState.targetBlendState.enabled?Ot.Transparent:Ot.Opaque}r.setFloat(i._alphaCutoffProp,e)}}},{key:"renderFace",get:function(){return this._renderFace},set:function(e){e!==this._renderFace&&(this.setRenderFace(0,e),this._renderFace=e)}}]),i}(Dr);xt._baseColorProp=B.getPropertyByName("u_baseColor");xt._baseTextureProp=B.getPropertyByName("u_baseTexture");xt._baseTextureMacro=B.getMacroByName("BASETEXTURE");xt._tilingOffsetProp=B.getPropertyByName("u_tilingOffset");xt._normalTextureProp=B.getPropertyByName("u_normalTexture");xt._normalIntensityProp=B.getPropertyByName("u_normalIntensity");xt._normalTextureMacro=B.getMacroByName("NORMALTEXTURE");xt._emissiveColorProp=B.getPropertyByName("u_emissiveColor");xt._emissiveTextureProp=B.getPropertyByName("u_emissiveTexture");xt._emissiveTextureMacro=B.getMacroByName("EMISSIVETEXTURE");xt._transparentMacro=B.getMacroByName("OASIS_TRANSPARENT");xt._alphaCutoffProp=B.getPropertyByName("u_alphaCutoff");xt._alphaCutoffMacro=B.getMacroByName("ALPHA_CUTOFF");var uo=function(n){Q(i,n);function i(t){var e;e=n.call(this,t,B.find("blinn-phong"))||this;var r=e.shaderData;return r.enableMacro("O3_NEED_WORLDPOS"),r.enableMacro("O3_NEED_TILINGOFFSET"),r.setColor(i._baseColorProp,new ne(1,1,1,1)),r.setColor(i._specularColorProp,new ne(1,1,1,1)),r.setColor(i._emissiveColorProp,new ne(0,0,0,1)),r.setVector4(i._tilingOffsetProp,new he(1,1,0,0)),r.setFloat(i._shininessProp,16),r.setFloat(i._normalIntensityProp,1),e}var a=i.prototype;return a.clone=function(){var e=new i(this._engine);return this.cloneTo(e),e},K(i,[{key:"baseColor",get:function(){return this.shaderData.getColor(i._baseColorProp)},set:function(e){var r=this.shaderData.getColor(i._baseColorProp);e!==r&&r.copyFrom(e)}},{key:"baseTexture",get:function(){return this.shaderData.getTexture(i._baseTextureProp)},set:function(e){this.shaderData.setTexture(i._baseTextureProp,e),e?this.shaderData.enableMacro(i._baseTextureMacro):this.shaderData.disableMacro(i._baseTextureMacro)}},{key:"specularColor",get:function(){return this.shaderData.getColor(i._specularColorProp)},set:function(e){var r=this.shaderData.getColor(i._specularColorProp);e!==r&&r.copyFrom(e)}},{key:"specularTexture",get:function(){return this.shaderData.getTexture(i._specularTextureProp)},set:function(e){this.shaderData.setTexture(i._specularTextureProp,e),e?this.shaderData.enableMacro("O3_SPECULAR_TEXTURE"):this.shaderData.disableMacro("O3_SPECULAR_TEXTURE")}},{key:"emissiveColor",get:function(){return this.shaderData.getColor(i._emissiveColorProp)},set:function(e){var r=this.shaderData.getColor(i._emissiveColorProp);e!==r&&r.copyFrom(e)}},{key:"emissiveTexture",get:function(){return this.shaderData.getTexture(i._emissiveTextureProp)},set:function(e){this.shaderData.setTexture(i._emissiveTextureProp,e),e?this.shaderData.enableMacro(i._emissiveTextureMacro):this.shaderData.disableMacro(i._emissiveTextureMacro)}},{key:"normalTexture",get:function(){return this.shaderData.getTexture(i._normalTextureProp)},set:function(e){this.shaderData.setTexture(i._normalTextureProp,e),e?this.shaderData.enableMacro(i._normalTextureMacro):this.shaderData.disableMacro(i._normalTextureMacro)}},{key:"normalIntensity",get:function(){return this.shaderData.getFloat(i._normalIntensityProp)},set:function(e){this.shaderData.setFloat(i._normalIntensityProp,e)}},{key:"shininess",get:function(){return this.shaderData.getFloat(i._shininessProp)},set:function(e){this.shaderData.setFloat(i._shininessProp,Math.max(e,1e-4))}},{key:"tilingOffset",get:function(){return this.shaderData.getVector4(i._tilingOffsetProp)},set:function(e){var r=this.shaderData.getVector4(i._tilingOffsetProp);e!==r&&r.copyFrom(e)}}]),i}(xt);uo._specularColorProp=B.getPropertyByName("u_specularColor");uo._shininessProp=B.getPropertyByName("u_shininess");uo._specularTextureProp=B.getPropertyByName("u_specularTexture");var Si;(function(n){n[n.UV0=0]="UV0",n[n.UV1=1]="UV1",n[n.UV2=2]="UV2",n[n.UV3=3]="UV3",n[n.UV4=4]="UV4",n[n.UV5=5]="UV5",n[n.UV6=6]="UV6",n[n.UV7=7]="UV7"})(Si||(Si={}));var jn=function(n){Q(i,n);function i(a,t){var e;e=n.call(this,a,t)||this;var r=e.shaderData;return r.enableMacro("O3_NEED_WORLDPOS"),r.enableMacro("O3_NEED_TILINGOFFSET"),r.setColor(i._baseColorProp,new ne(1,1,1,1)),r.setColor(i._emissiveColorProp,new ne(0,0,0,1)),r.setVector4(i._tilingOffsetProp,new he(1,1,0,0)),r.setFloat(i._normalIntensityProp,1),r.setFloat(i._occlusionTextureIntensityProp,1),r.setFloat(i._occlusionTextureCoordProp,Si.UV0),r.setFloat(i._clearCoatProp,0),r.setFloat(i._clearCoatRoughnessProp,0),e}return K(i,[{key:"baseColor",get:function(){return this.shaderData.getColor(i._baseColorProp)},set:function(t){var e=this.shaderData.getColor(i._baseColorProp);t!==e&&e.copyFrom(t)}},{key:"baseTexture",get:function(){return this.shaderData.getTexture(i._baseTextureProp)},set:function(t){this.shaderData.setTexture(i._baseTextureProp,t),t?this.shaderData.enableMacro(i._baseTextureMacro):this.shaderData.disableMacro(i._baseTextureMacro)}},{key:"normalTexture",get:function(){return this.shaderData.getTexture(i._normalTextureProp)},set:function(t){this.shaderData.setTexture(i._normalTextureProp,t),t?this.shaderData.enableMacro(i._normalTextureMacro):this.shaderData.disableMacro(i._normalTextureMacro)}},{key:"normalTextureIntensity",get:function(){return this.shaderData.getFloat(i._normalIntensityProp)},set:function(t){this.shaderData.setFloat(i._normalIntensityProp,t)}},{key:"emissiveColor",get:function(){return this.shaderData.getColor(i._emissiveColorProp)},set:function(t){var e=this.shaderData.getColor(i._emissiveColorProp);t!==e&&e.copyFrom(t)}},{key:"emissiveTexture",get:function(){return this.shaderData.getTexture(i._emissiveTextureProp)},set:function(t){this.shaderData.setTexture(i._emissiveTextureProp,t),t?this.shaderData.enableMacro(i._emissiveTextureMacro):this.shaderData.disableMacro(i._emissiveTextureMacro)}},{key:"occlusionTexture",get:function(){return this.shaderData.getTexture(i._occlusionTextureProp)},set:function(t){this.shaderData.setTexture(i._occlusionTextureProp,t),t?this.shaderData.enableMacro("OCCLUSIONTEXTURE"):this.shaderData.disableMacro("OCCLUSIONTEXTURE")}},{key:"occlusionTextureIntensity",get:function(){return this.shaderData.getFloat(i._occlusionTextureIntensityProp)},set:function(t){this.shaderData.setFloat(i._occlusionTextureIntensityProp,t)}},{key:"occlusionTextureCoord",get:function(){return this.shaderData.getFloat(i._occlusionTextureCoordProp)},set:function(t){t>Si.UV1&&we.warn("Occlusion texture uv coordinate must be UV0 or UV1."),this.shaderData.setFloat(i._occlusionTextureCoordProp,t)}},{key:"tilingOffset",get:function(){return this.shaderData.getVector4(i._tilingOffsetProp)},set:function(t){var e=this.shaderData.getVector4(i._tilingOffsetProp);t!==e&&e.copyFrom(t)}},{key:"clearCoat",get:function(){return this.shaderData.getFloat(i._clearCoatProp)},set:function(t){!!this.shaderData.getFloat(i._clearCoatProp)!=!!t&&(t===0?this.shaderData.disableMacro("CLEARCOAT"):this.shaderData.enableMacro("CLEARCOAT")),this.shaderData.setFloat(i._clearCoatProp,t)}},{key:"clearCoatTexture",get:function(){return this.shaderData.getTexture(i._clearCoatTextureProp)},set:function(t){this.shaderData.setTexture(i._clearCoatTextureProp,t),t?this.shaderData.enableMacro("HAS_CLEARCOATTEXTURE"):this.shaderData.disableMacro("HAS_CLEARCOATTEXTURE")}},{key:"clearCoatRoughness",get:function(){return this.shaderData.getFloat(i._clearCoatRoughnessProp)},set:function(t){this.shaderData.setFloat(i._clearCoatRoughnessProp,t)}},{key:"clearCoatRoughnessTexture",get:function(){return this.shaderData.getTexture(i._clearCoatRoughnessTextureProp)},set:function(t){this.shaderData.setTexture(i._clearCoatRoughnessTextureProp,t),t?this.shaderData.enableMacro("HAS_CLEARCOATROUGHNESSTEXTURE"):this.shaderData.disableMacro("HAS_CLEARCOATROUGHNESSTEXTURE")}},{key:"clearCoatNormalTexture",get:function(){return this.shaderData.getTexture(i._clearCoatNormalTextureProp)},set:function(t){this.shaderData.setTexture(i._clearCoatNormalTextureProp,t),t?this.shaderData.enableMacro("HAS_CLEARCOATNORMALTEXTURE"):this.shaderData.disableMacro("HAS_CLEARCOATNORMALTEXTURE")}}]),i}(xt);jn._occlusionTextureIntensityProp=B.getPropertyByName("u_occlusionIntensity");jn._occlusionTextureCoordProp=B.getPropertyByName("u_occlusionTextureCoord");jn._occlusionTextureProp=B.getPropertyByName("u_occlusionTexture");jn._clearCoatProp=B.getPropertyByName("u_clearCoat");jn._clearCoatTextureProp=B.getPropertyByName("u_clearCoatTexture");jn._clearCoatRoughnessProp=B.getPropertyByName("u_clearCoatRoughness");jn._clearCoatRoughnessTextureProp=B.getPropertyByName("u_clearCoatRoughnessTexture");jn._clearCoatNormalTextureProp=B.getPropertyByName("u_clearCoatNormalTexture");var co=function(n){Q(i,n);function i(t){var e;return e=n.call(this,t,B.find("pbr"))||this,e.shaderData.setFloat(i._metallicProp,1),e.shaderData.setFloat(i._roughnessProp,1),e}var a=i.prototype;return a.clone=function(){var e=new i(this._engine);return this.cloneTo(e),e},K(i,[{key:"metallic",get:function(){return this.shaderData.getFloat(i._metallicProp)},set:function(e){this.shaderData.setFloat(i._metallicProp,e)}},{key:"roughness",get:function(){return this.shaderData.getFloat(i._roughnessProp)},set:function(e){this.shaderData.setFloat(i._roughnessProp,e)}},{key:"roughnessMetallicTexture",get:function(){return this.shaderData.getTexture(i._roughnessMetallicTextureProp)},set:function(e){this.shaderData.setTexture(i._roughnessMetallicTextureProp,e),e?this.shaderData.enableMacro("ROUGHNESSMETALLICTEXTURE"):this.shaderData.disableMacro("ROUGHNESSMETALLICTEXTURE")}}]),i}(jn);co._metallicProp=B.getPropertyByName("u_metal");co._roughnessProp=B.getPropertyByName("u_roughness");co._roughnessMetallicTextureProp=B.getPropertyByName("u_roughnessMetallicTexture");var ca=function(n){Q(i,n);function i(t){var e;return e=n.call(this,t,B.find("pbr-specular"))||this,e.shaderData.setColor(i._specularColorProp,new ne(1,1,1,1)),e.shaderData.setFloat(i._glossinessProp,1),e}var a=i.prototype;return a.clone=function(){var e=new i(this._engine);return this.cloneTo(e),e},K(i,[{key:"specularColor",get:function(){return this.shaderData.getColor(i._specularColorProp)},set:function(e){var r=this.shaderData.getColor(i._specularColorProp);e!==r&&r.copyFrom(e)}},{key:"glossiness",get:function(){return this.shaderData.getFloat(i._glossinessProp)},set:function(e){this.shaderData.setFloat(i._glossinessProp,e)}},{key:"specularGlossinessTexture",get:function(){return this.shaderData.getTexture(i._specularGlossinessTextureProp)},set:function(e){this.shaderData.setTexture(i._specularGlossinessTextureProp,e),e?this.shaderData.enableMacro(i._specularGlossinessTextureMacro):this.shaderData.disableMacro(i._specularGlossinessTextureMacro)}}]),i}(jn);ca._specularColorProp=B.getPropertyByName("u_PBRSpecularColor");ca._glossinessProp=B.getPropertyByName("u_glossiness");ca._specularGlossinessTextureProp=B.getPropertyByName("u_specularGlossinessTexture");ca._specularGlossinessTextureMacro=B.getMacroByName("SPECULARGLOSSINESSTEXTURE");var aa=function(n){Q(i,n);function i(t){var e;e=n.call(this,t,B.find("unlit"))||this;var r=e.shaderData;return r.enableMacro("OMIT_NORMAL"),r.enableMacro("O3_NEED_TILINGOFFSET"),r.setColor(i._baseColorProp,new ne(1,1,1,1)),r.setVector4(i._tilingOffsetProp,new he(1,1,0,0)),e}var a=i.prototype;return a.clone=function(){var e=new i(this._engine);return this.cloneTo(e),e},K(i,[{key:"baseColor",get:function(){return this.shaderData.getColor(i._baseColorProp)},set:function(e){var r=this.shaderData.getColor(i._baseColorProp);e!==r&&r.copyFrom(e)}},{key:"baseTexture",get:function(){return this.shaderData.getTexture(i._baseTextureProp)},set:function(e){this.shaderData.setTexture(i._baseTextureProp,e),e?this.shaderData.enableMacro(i._baseTextureMacro):this.shaderData.disableMacro(i._baseTextureMacro)}},{key:"tilingOffset",get:function(){return this.shaderData.getVector4(i._tilingOffsetProp)},set:function(e){var r=this.shaderData.getVector4(i._tilingOffsetProp);e!==r&&r.copyFrom(e)}}]),i}(xt),ji;(function(n){n[n.Left=0]="Left",n[n.Center=1]="Center",n[n.Right=2]="Right"})(ji||(ji={}));var Yi;(function(n){n[n.Top=0]="Top",n[n.Center=1]="Center",n[n.Bottom=2]="Bottom"})(Yi||(Yi={}));var oa;(function(n){n[n.Overflow=0]="Overflow",n[n.Truncate=1]="Truncate"})(oa||(oa={}));var di;(function(n){n[n.None=0]="None",n[n.Bold=1]="Bold",n[n.Italic=2]="Italic"})(di||(di={}));var I0=function(n){Q(i,n);function i(t){var e;return e=n.call(this,t)||this,e._sprites=new Array,e._spriteNamesToIndex={},e}var a=i.prototype;return a.getSprite=function(e){var r=this._sprites[this._spriteNamesToIndex[e]];return r||console.warn("There is no sprite named "+e+" in the atlas."),r},a.getSprites=function(e,r){r.length=0;var o=this._spriteNamesToIndex[e];if(o!==void 0)for(var s=this._sprites;o>=0;o--){var l=s[o];l.name===e&&r.push(l)}else console.warn("The name of the sprite you want to find is not exit in SpriteAtlas.");return r},a._addSprite=function(e){this._spriteNamesToIndex[e.name]=this._sprites.push(e)-1},a._onDestroy=function(){this._sprites=null,this._spriteNamesToIndex=null},K(i,[{key:"sprites",get:function(){return this._sprites}}]),i}(Xr),oi;(function(n){n[n.Simple=0]="Simple",n[n.Sliced=1]="Sliced"})(oi||(oi={}));var W_=function(n){Q(i,n);function i(t,e,r,o,s,l){e===void 0&&(e=null),r===void 0&&(r=null),o===void 0&&(o=null),s===void 0&&(s=null),l===void 0&&(l=null);var u;return u=n.call(this,t)||this,u._width=void 0,u._height=void 0,u._positions=[new W,new W,new W,new W],u._uvs=[new W,new W,new W,new W],u._bounds=new sn,u._texture=null,u._atlasRotated=!1,u._atlasRegion=new fd(0,0,1,1),u._atlasRegionOffset=new he(0,0,0,0),u._region=new fd(0,0,1,1),u._pivot=new W(.5,.5),u._border=new he(0,0,0,0),u._dirtyUpdateFlag=3,u._updateFlagManager=new Ja,u._texture=e,r&&u._region.copyFrom(r),o&&u._pivot.copyFrom(o),s&&u._border.copyFrom(s),u.name=l,u}var a=i.prototype;return a.clone=function(){var e=new i(this._engine,this._texture,this._region,this._pivot,this._border,this.name);return e._assetID=this._assetID,e._atlasRotated=this._atlasRotated,e._atlasRegion.copyFrom(this._atlasRegion),e._atlasRegionOffset.copyFrom(this._atlasRegionOffset),e},a._getPositions=function(){return this._dirtyUpdateFlag&1&&this._updatePositions(),this._positions},a._getUVs=function(){return this._dirtyUpdateFlag&2&&this._updateUVs(),this._uvs},a._getBounds=function(){return this._dirtyUpdateFlag&1&&this._updatePositions(),this._bounds},a._onDestroy=function(){this._texture&&(this._texture=null)},a._calDefaultSize=function(){if(this._texture){var e=this,r=e._texture,o=e._atlasRegion,s=e._atlasRegionOffset,l=e._region,u=1/Hr._pixelsPerUnit;this.width=r.width*o.width/(1-s.x-s.z)*l.width*u,this.height=r.height*o.height/(1-s.y-s.w)*l.height*u}},a._updatePositions=function(){var e=this._atlasRegionOffset,r=this._region,o=r.x,s=r.y,l=r.width,u=r.height,c=1-o-l,d=1-s-u,_=Math.max(e.x-o,0)/l,h=Math.max(e.w-s,0)/u,f=1-Math.max(e.z-c,0)/l,g=1-Math.max(e.y-d,0)/u,y=this._positions;y[0].set(_,h),y[1].set(f,h),y[2].set(_,g),y[3].set(f,g);var p=this._bounds,v=p.min,m=p.max;v.set(_,h,0),m.set(f,g,0),this._dirtyUpdateFlag&=-2},a._updateUVs=function(){var e=this,r=e._uvs,o=e._atlasRegionOffset,s=this._region,l=s.x,u=s.y,c=s.width,d=s.height,_=1-l-c,h=1-u-d,f=this._atlasRegion,g=f.x,y=f.y,p=f.width,v=f.height,m=o.x,x=o.y,S=o.z,C=o.w,A=p/(1-m-S),T=v/(1-x-C),E=Math.max(l-m,0)*A+g,P=Math.max(h-x,0)*T+y,b=p+g-Math.max(_-S,0)*A,M=v+y-Math.max(u-C,0)*T,F=this._border,I=F.x,L=F.y,V=F.z,U=F.w;r[0].set(E,M),r[1].set((l-m+I*c)*A+g,v+y-(u-C+L*d)*T),r[2].set(p+g-(_-S+V*c)*A,(h-x+U*d)*T+y),r[3].set(b,P),this._dirtyUpdateFlag&=-3},a._dispatchSpriteChange=function(e){switch(e){case Re.atlasRegionOffset:case Re.region:this._dirtyUpdateFlag|=3;break;case Re.atlasRegion:case Re.border:this._dirtyUpdateFlag|=2;break}this._updateFlagManager.dispatch(e)},K(i,[{key:"texture",get:function(){return this._texture},set:function(e){this._texture!==e&&(this._texture=e,this._dispatchSpriteChange(Re.texture))}},{key:"width",get:function(){return this._width===void 0&&this._calDefaultSize(),this._width},set:function(e){this._width!==e&&(this._width=e,this._dispatchSpriteChange(Re.size))}},{key:"height",get:function(){return this._height===void 0&&this._calDefaultSize(),this._height},set:function(e){this._height!==e&&(this._height=e,this._dispatchSpriteChange(Re.size))}},{key:"atlasRotated",get:function(){return this._atlasRotated},set:function(e){this._atlasRotated!=e&&(this._atlasRotated=e)}},{key:"atlasRegion",get:function(){return this._atlasRegion},set:function(e){var r=H.clamp(e.x,0,1),o=H.clamp(e.y,0,1);this._atlasRegion.set(r,o,H.clamp(e.width,0,1-r),H.clamp(e.height,0,1-o)),this._dispatchSpriteChange(Re.atlasRegion)}},{key:"atlasRegionOffset",get:function(){return this._atlasRegionOffset},set:function(e){var r=H.clamp(e.x,0,1),o=H.clamp(e.y,0,1);this._atlasRegionOffset.set(r,o,H.clamp(e.z,0,1-r),H.clamp(e.w,0,1-o)),this._dispatchSpriteChange(Re.atlasRegionOffset)}},{key:"region",get:function(){return this._region},set:function(e){var r=this._region,o=H.clamp(e.x,0,1),s=H.clamp(e.y,0,1);r.set(o,s,H.clamp(e.width,0,1-o),H.clamp(e.height,0,1-s)),this._dispatchSpriteChange(Re.region)}},{key:"pivot",get:function(){return this._pivot},set:function(e){var r=this._pivot;if(r===e)this._dispatchSpriteChange(Re.pivot);else{var o=e.x,s=e.y;(r.x!==o||r.y!==s)&&(r.set(o,s),this._dispatchSpriteChange(Re.pivot))}}},{key:"border",get:function(){return this._border},set:function(e){var r=this._border,o=H.clamp(e.x,0,1),s=H.clamp(e.y,0,1);r.set(o,s,H.clamp(e.z,0,1-o),H.clamp(e.w,0,1-s)),this._dispatchSpriteChange(Re.border)}}]),i}(Xr),Mf;(function(n){n[n.positions=1]="positions",n[n.uvs=2]="uvs",n[n.all=3]="all"})(Mf||(Mf={}));var hc,iu=(hc=function(){function n(){}return n.resetData=function(a){var t=a._renderData,e=t.positions,r=t.uvs;if(e.length<16)for(var o=e.length;o<16;o++)e.push(new w),r.push(new W);t.triangles=[]},n.updatePositions=function(a){var t=a.width,e=a.height,r=a.sprite,o=a._renderData,s=o.positions,l=o.uvs,u=o.triangles,c=r.border,d=r._getUVs(),_=r._getPositions(),h=_[0],f=h.x,g=h.y,y=_[3],p=y.x,v=y.y,m=r.width,x=r.height,S=m*c.x,C=x*c.y,A=m*c.z,T=x*c.w,E,P;if(S+A>t){var b=t/(S+A);E=[m*f*b,S*b,S*b,t-m*(1-p)*b]}else E=[m*f,S,t-A,t-m*(1-p)];if(T+C>e){var M=e/(T+C);P=[x*g*M,C*M,C*M,e-x*(1-v)*M]}else P=[x*g,C,e-T,e-x*(1-v)];var F=a.sprite.pivot,I=F.x,L=F.y,V=a.width*I,U=a.height*L,D=iu._worldMatrix,R=D.elements,N=a.entity.transform.worldMatrix,X=N.elements,q=a.flipX?-1:1,te=a.flipY?-1:1;R[0]=X[0]*q,R[1]=X[1]*q,R[2]=X[2]*q,R[4]=X[4]*te,R[5]=X[5]*te,R[6]=X[6]*te,R[8]=X[8],R[9]=X[9],R[10]=X[10],R[12]=X[12]-V*R[0]-U*R[4],R[13]=X[13]-V*R[1]-U*R[5],R[14]=X[14]-V*R[2]-U*R[6];for(var ie=0,ce=0,le=0;le<4;le++){for(var ae=E[le],Ee=d[le].x,Ne=0;Ne<4;Ne++){var tt=P[Ne];s[ie].set(R[0]*ae+R[4]*tt+R[12],R[1]*ae+R[5]*tt+R[13],R[2]*ae+R[6]*tt+R[14]),l[ie].set(Ee,d[Ne].y),++ie}++ce}for(var ct=ie/ce,Ke=0,pn=0;pn<ce-1;++pn)for(var nt=0;nt<ct-1;++nt){var rt=pn*ct+nt;u[Ke++]=rt,u[Ke++]=rt+1,u[Ke++]=rt+ct,u[Ke++]=rt+1,u[Ke++]=rt+ct+1,u[Ke++]=rt+ct}a._renderData.vertexCount=ce*ct,u.length=(ce-1)*(ct-1)*6;var tn=a._bounds,Gt=tn.min,wt=tn.max;Gt.set(E[0],P[0],0),wt.set(E[3],P[3],0),a._bounds.transform(D)},n.updateUVs=function(a){},n}(),hc._worldMatrix=new J,hc);iu=O([or()],iu);var en=function(n){Q(i,n);function i(t){var e;return e=n.call(this,t)||this,e._color=new ne(1,1,1,1),e._sprite=null,e._width=void 0,e._height=void 0,e._flipX=!1,e._flipY=!1,e._maskLayer=eo.Layer0,e._maskInteraction=Un.None,e._renderData=new U_(4,[],[],null,e._color),e.drawMode=oi.Simple,e.setMaterial(e._engine._spriteDefaultMaterial),e._onSpriteChange=e._onSpriteChange.bind(_e(e)),e}var a=i.prototype;return a._cloneTo=function(e){e.sprite=this._sprite},a._onDestroy=function(){var e;(e=this._sprite)==null||e._updateFlagManager.removeListener(this._onSpriteChange),this._color=null,this._sprite=null,this._assembler=null,this._renderData=null,n.prototype._onDestroy.call(this)},a._updateBounds=function(e){var r;!((r=this.sprite)!=null&&r.texture)||!this.width||!this.height?(e.min.set(0,0,0),e.max.set(0,0,0)):this._assembler.updatePositions(this)},a._render=function(e){var r;if(!(!((r=this.sprite)!=null&&r.texture)||!this.width||!this.height)){this._dirtyUpdateFlag&ht.WorldVolume&&(this._assembler.updatePositions(this),this._dirtyUpdateFlag&=~ht.WorldVolume),this._dirtyUpdateFlag&2&&(this._assembler.updateUVs(this),this._dirtyUpdateFlag&=-3);for(var o=this.getMaterial(),s=o.shader.passes,l=o.renderStates,u=this.sprite.texture,c=0,d=s.length;c<d;c++){var _=this._engine._spriteElementPool.getFromPool();_.setValue(this,this._renderData,o,u,l[c],s[c]),e.camera._renderPipeline.pushPrimitive(_)}}},a._updateStencilState=function(){var e=this.getInstanceMaterial(),r=e.renderState.stencilState,o=this._maskInteraction;if(o===Un.None)r.enabled=!1,r.writeMask=255,r.referenceValue=0,r.compareFunctionFront=r.compareFunctionBack=ye.Always;else{r.enabled=!0,r.writeMask=0,r.referenceValue=1;var s=o===Un.VisibleInsideMask?ye.LessEqual:ye.Greater;r.compareFunctionFront=s,r.compareFunctionBack=s}},a._onSpriteChange=function(e){switch(e){case Re.texture:this.shaderData.setTexture(i._textureProperty,this.sprite.texture);break;case Re.size:this._drawMode===oi.Sliced&&(this._dirtyUpdateFlag|=ht.WorldVolume);break;case Re.border:this._drawMode===oi.Sliced&&(this._dirtyUpdateFlag|=3);break;case Re.region:case Re.atlasRegionOffset:this._dirtyUpdateFlag|=3;break;case Re.atlasRegion:this._dirtyUpdateFlag|=2;break;case Re.pivot:this._dirtyUpdateFlag|=ht.WorldVolume;break}},K(i,[{key:"drawMode",get:function(){return this._drawMode},set:function(e){if(this._drawMode!==e){switch(this._drawMode=e,e){case oi.Simple:this._assembler=Br;break;case oi.Sliced:this._assembler=iu;break}this._assembler.resetData(this),this._dirtyUpdateFlag|=3}}},{key:"sprite",get:function(){return this._sprite},set:function(e){var r=this._sprite;r!==e&&(r&&r._updateFlagManager.removeListener(this._onSpriteChange),e?(e._updateFlagManager.addListener(this._onSpriteChange),this._dirtyUpdateFlag|=3,this.shaderData.setTexture(i._textureProperty,e.texture)):this.shaderData.setTexture(i._textureProperty,null),this._sprite=e)}},{key:"color",get:function(){return this._color},set:function(e){this._color!==e&&this._color.copyFrom(e)}},{key:"width",get:function(){return this._width===void 0&&this._sprite&&(this.width=this._sprite.width),this._width},set:function(e){this._width!==e&&(this._width=e,this._dirtyUpdateFlag|=ht.WorldVolume)}},{key:"height",get:function(){return this._height===void 0&&this._sprite&&(this.height=this._sprite.height),this._height},set:function(e){this._height!==e&&(this._height=e,this._dirtyUpdateFlag|=ht.WorldVolume)}},{key:"flipX",get:function(){return this._flipX},set:function(e){this._flipX!==e&&(this._flipX=e,this._dirtyUpdateFlag|=ht.WorldVolume)}},{key:"flipY",get:function(){return this._flipY},set:function(e){this._flipY!==e&&(this._flipY=e,this._dirtyUpdateFlag|=ht.WorldVolume)}},{key:"maskLayer",get:function(){return this._maskLayer},set:function(e){this._maskLayer=e}},{key:"maskInteraction",get:function(){return this._maskInteraction},set:function(e){this._maskInteraction!==e&&(this._maskInteraction=e,this._updateStencilState())}}]),i}(me);en._textureProperty=B.getPropertyByName("u_spriteTexture");O([Y],en.prototype,"_renderData",void 0);O([Y],en.prototype,"_drawMode",void 0);O([Y],en.prototype,"_assembler",void 0);O([je],en.prototype,"_color",void 0);O([Y],en.prototype,"_sprite",void 0);O([Y],en.prototype,"_width",void 0);O([Y],en.prototype,"_height",void 0);O([Be],en.prototype,"_flipX",void 0);O([Be],en.prototype,"_flipY",void 0);O([Be],en.prototype,"_maskLayer",void 0);O([Be],en.prototype,"_maskInteraction",void 0);O([Y],en.prototype,"_onSpriteChange",null);var Rf;(function(n){n[n.UV=2]="UV",n[n.All=3]="All"})(Rf||(Rf={}));var L0=function n(){this.localPositions=new he;var i=[new w,new w,new w,new w];this.renderData=new U_(4,i,null,n.triangles,null)};L0.triangles=[0,2,1,2,0,3];var sS=function(){function n(a,t){this._elements=[],this._type=a;for(var e=this._elements,r=0;r<t;++r)e[r]=new a}var i=n.prototype;return i.get=function(){return this._elements.length>0?this._elements.pop():new this._type},i.put=function(t){this._elements.push(t)},n}(),Gr=function(){function n(){}return n.textContext=function(){var a=n._textContext;if(!a){var t;try{t=new OffscreenCanvas(0,0)}catch{t=document.createElement("canvas")}var e=t.getContext("2d");a={canvas:t,context:e},n._textContext=a}return a},n.measureFont=function(a){var t=n._fontSizeInfoCache,e=t[a];return e||(e=n._measureFontOrChar(a),t[a]=e,e)},n.getNativeFontString=function(a,t,e){var r=e&di.Bold?"bold ":"";return e&di.Italic&&(r+="italic "),!/([\"\'])[^\'\"]+\1/.test(a)&&n._genericFontFamilies.indexOf(a)==-1&&(a='"'+a+'"'),r+=t+"px "+a,r},n.measureChar=function(a,t){return n._measureFontOrChar(t,a)},n.measureTextWithWrap=function(a){for(var t=a.fontSize,e=a.fontStyle,r=a._subFont,o=a.font.name,s=n.getNativeFontString(o,t,e),l=n.measureFont(s),u=a.text.split(/(?:\r\n|\r|\n)/),c=new Array,d=new Array,_=new Array,h=Hr._pixelsPerUnit,f=l.size+a.lineSpacing*h,g=a.width*h,y=0,p=0,v=u.length;p<v;++p){for(var m=u[p],x="",S=0,C=-1,A=-1,T=0,E=m.length;T<E;++T){var P=m[T],b=n._getCharInfo(P,s,r),M=b.w,F=b.offsetY,I=b.h*.5,L=I+F,V=I-F;S+M>g?S===0?(c.push(P),d.push(M),_.push({ascent:L,descent:V,size:L+V})):(c.push(x),d.push(S),_.push({ascent:C,descent:A,size:C+A}),x=P,S=b.xAdvance,C=L,A=V):(x+=P,S+=b.xAdvance,C<L&&(C=L),A<V&&(A=V))}S>0&&(c.push(x),d.push(S),_.push({ascent:C,descent:A,size:C+A}))}var U=a.height*h;return a.overflowMode===oa.Overflow&&(U=f*c.length),{width:y,height:U,lines:c,lineWidths:d,lineHeight:f,lineMaxSizes:_}},n.measureTextWithoutWrap=function(a){var t=a.fontSize,e=a.fontStyle,r=a._subFont,o=a.font.name,s=n.getNativeFontString(o,t,e),l=n.measureFont(s),u=a.text.split(/(?:\r\n|\r|\n)/),c=u.length,d=new Array,_=new Array,h=Hr._pixelsPerUnit,f=l.size+a.lineSpacing*h,g=0,y=a.height*h;a.overflowMode===oa.Overflow&&(y=f*c);for(var p=0;p<c;++p){for(var v=u[p],m=0,x=-1,S=-1,C=0,A=v.length;C<A;++C){var T=n._getCharInfo(v[C],s,r);m+=T.xAdvance;var E=T.offsetY,P=T.h*.5,b=P+E,M=P-E;x<b&&(x=b),S<M&&(S=M)}d[p]=m,_[p]={ascent:x,descent:S,size:x+S},m>g&&(g=m)}return{width:g,height:y,lines:u,lineWidths:d,lineHeight:f,lineMaxSizes:_}},n.getNativeFontHash=function(a,t,e){var r=e&di.Bold?"bold":"";return e&di.Italic&&(r+="italic"),!/([\"\'])[^\'\"]+\1/.test(a)&&n._genericFontFamilies.indexOf(a)==-1&&(a=""+a),r+=t+"px"+a,r},n._measureFontOrChar=function(a,t){t===void 0&&(t="");var e=n.textContext(),r=e.canvas,o=e.context;o.font=a;var s=t||n._measureString,l=Math.max(1,Math.round(o.measureText(s).width)),u=Math.ceil(o.measureText(n._measureBaseline).width),c=u*n._heightMultiplier;u=n._baselineMultiplier*u|0,r.width=l,r.height=c,o.font=a,o.fillStyle="#000",o.clearRect(0,0,l,c),o.textBaseline="middle",o.fillStyle="#fff",o.fillText(s,0,u);for(var d=o.getImageData(0,0,l,c).data,_=d.length,h=-1,f=-1,g,y=0,p=0,v=0,m=r.width,x=1/m,S=0;S<_;S+=4)if(d[S+3]!==0){var C=S*.25;g=~~(C*x),h===-1&&(h=g),g>f&&(f=g)}else d[S]=d[S+1]=d[S+2]=255;h!==-1&&f!==-1&&(y=u-h,p=f-u+1,v=y+p);var A={ascent:y,descent:p,size:v};if(t){var T=null;if(v>0){var E=m*4;T=new Uint8Array(d.buffer,h*E,v*E)}return{x:0,y:0,w:l,h:v,offsetX:0,offsetY:(y-p)*.5,xAdvance:l,uvs:[new W,new W,new W,new W],ascent:y,descent:p,index:0,data:T}}else return A},n._getCharInfo=function(a,t,e){var r=e._getCharInfo(a);return r||(r=n.measureChar(a,t),e._uploadCharTexture(r),e._addCharInfo(a,r)),r},n}();Gr._genericFontFamilies=["serif","sans-serif","monospace","cursive","fantasy","system-ui","math","emoji","fangsong"];Gr._measureString="|q";Gr._measureBaseline="M";Gr._heightMultiplier=2;Gr._baselineMultiplier=1.4;Gr._fontSizeInfoCache={};Gr._textContext=null;var Ye=function(n){Q(i,n);function i(t){var e;e=n.call(this,t)||this,e._subFont=null,e._charRenderDatas=[],e._dirtyFlag=15,e._color=new ne(1,1,1,1),e._text="",e._width=0,e._height=0,e._localBounds=new sn,e._font=null,e._fontSize=24,e._fontStyle=di.None,e._lineSpacing=0,e._horizontalAlignment=ji.Center,e._verticalAlignment=Yi.Center,e._enableWrapping=!1,e._overflowMode=oa.Overflow,e._maskInteraction=Un.None,e._maskLayer=eo.Layer0;var r=_e(e).engine;return e._font=r._textDefaultFont,e._font._addRefCount(1),e.setMaterial(r._spriteDefaultMaterial),e}var a=i.prototype;return a._onDestroy=function(){for(var e=this._charRenderDatas,r=0,o=e.length;r<o;++r)i._charRenderDataPool.put(e[r]);e.length=0,this._font&&(this._font._addRefCount(-1),this._font=null),this._subFont&&(this._subFont=null),n.prototype._onDestroy.call(this)},a._cloneTo=function(e){e.font=this._font,e._subFont=this._subFont},a._isContainDirtyFlag=function(e){return(this._dirtyFlag&e)!=0},a._setDirtyFlagTrue=function(e){this._dirtyFlag|=e},a._setDirtyFlagFalse=function(e){this._dirtyFlag&=~e},a._updateBounds=function(e){sn.transform(this._localBounds,this._entity.transform.worldMatrix,e)},a._render=function(e){if(!(this._text===""||this.enableWrapping&&this.width<=0||this.overflowMode===oa.Truncate&&this.height<=0)){this._isContainDirtyFlag(16)&&(this._updateStencilState(),this._setDirtyFlagFalse(16)),this._isContainDirtyFlag(1)&&(this._resetSubFont(),this._setDirtyFlagFalse(1)),this._isContainDirtyFlag(2)&&(this._updateLocalData(),this._setDirtyFlagFalse(2)),this._isContainDirtyFlag(4)&&(this._updatePosition(),this._setDirtyFlagFalse(4));var r=this._engine._spriteElementPool,o=this._engine._textElementPool.getFromPool(),s=o.charElements,l=this.getMaterial(),u=this._charRenderDatas,c=u.length,d=l.shader.passes,_=l.renderStates;o.component=this,o.material=l,s.length=c,o.renderState=_[0];for(var h=0;h<c;++h){var f=u[h],g=r.getFromPool();g.setValue(this,f.renderData,l,f.texture,_[0],d[0]),s[h]=g}e.camera._renderPipeline.pushPrimitive(o)}},a._updateStencilState=function(){var e=this.getInstanceMaterial(),r=e.renderState.stencilState,o=this._maskInteraction;if(o===Un.None)r.enabled=!1,r.writeMask=255,r.referenceValue=0,r.compareFunctionFront=r.compareFunctionBack=ye.Always;else{r.enabled=!0,r.writeMask=0,r.referenceValue=1;var s=o===Un.VisibleInsideMask?ye.LessEqual:ye.Greater;r.compareFunctionFront=s,r.compareFunctionBack=s}},a._resetSubFont=function(){this._subFont=this._font._getSubFont(this.fontSize,this.fontStyle)},a._updatePosition=function(){for(var e=this.entity.transform,r=e.worldMatrix.elements,o=this._charRenderDatas,s=r[0],l=r[1],u=r[2],c=r[4],d=r[5],_=r[6],h=r[12],f=r[13],g=r[14],y=i._tempVec31.set(c,d,_),p=i._tempVec30.set(s,l,u),v=0,m=o.length;v<m;++v){var x=o[v],S=x.localPositions,C=x.renderData.positions,A=S.x,T=S.y,E=C[0];E.x=A*s+T*c+h,E.y=A*l+T*d+f,E.z=A*u+T*_+g;var P=C[1];w.scale(p,S.z-A,P),w.add(E,P,P);var b=C[2];w.scale(y,S.w-T,b),w.add(E,b,C[3]),w.add(P,b,b)}},a._updateLocalData=function(){var e=this,r=e.color,o=e.horizontalAlignment,s=e.verticalAlignment,l=e._charRenderDatas,u=this._localBounds,c=u.min,d=u.max;c.set(0,0,0),d.set(0,0,0);var _=Hr._pixelsPerUnit,h=1/_,f=this._subFont,g=this.width*_,y=g*.5,p=this.height*_,v=this.enableWrapping?Gr.measureTextWithWrap(this):Gr.measureTextWithoutWrap(this),m=v.height,x=v.lines,S=v.lineWidths,C=v.lineHeight,A=v.lineMaxSizes,T=i._charRenderDataPool,E=C*.5,P=x.length,b=0,M=C*.5-A[0].ascent,F=C*.5-A[P-1].descent-1;switch(s){case Yi.Top:b=p*.5-E+M;break;case Yi.Center:b=m*.5-E-(F-M)*.5;break;case Yi.Bottom:b=m-p*.5-E-F;break}for(var I=0,L=Number.MAX_SAFE_INTEGER,V=Number.MAX_SAFE_INTEGER,U=Number.MIN_SAFE_INTEGER,D=Number.MIN_SAFE_INTEGER,R=P-1,N=0;N<P;++N){var X=x[N],q=S[N],te=0;switch(o){case ji.Left:te=-y;break;case ji.Center:te=-q*.5;break;case ji.Right:te=y-q;break}for(var ie=0,ce=X.length-1;ie<=ce;++ie){var le=X[ie],ae=f._getCharInfo(le);if(ae.h>0){var Ee=l[I]||T.get(),Ne=Ee.renderData,tt=Ee.localPositions;Ee.texture=f._getTextureByIndex(ae.index),Ne.color=r,Ne.uvs=ae.uvs;var ct=ae.w,Ke=ae.ascent,pn=ae.descent,nt=te*h,rt=(te+ct)*h,tn=(b+Ke)*h,Gt=(b-pn+1)*h;tt.set(nt,tn,rt,Gt),l[I]=Ee,I++,N===0&&(D=Math.max(D,tn)),N===R&&(V=Math.min(V,Gt)),ie===0&&(L=Math.min(L,nt)),ie===ce&&(U=Math.max(U,rt))}te+=ae.xAdvance}b-=C}c.set(L,V,0),d.set(U,D,0);var wt=l.length;if(wt>I){for(var Yn=I;Yn<wt;++Yn)T.put(l[Yn]);l.length=I}f._getLastIndex()>0&&l.sort(function(nn,Fn){return nn.texture.instanceId-Fn.texture.instanceId})},a._onTransformChanged=function(e){n.prototype._onTransformChanged.call(this,e),this._setDirtyFlagTrue(12)},K(i,[{key:"color",get:function(){return this._color},set:function(e){this._color!==e&&this._color.copyFrom(e)}},{key:"text",get:function(){return this._text},set:function(e){e=e||"",this._text!==e&&(this._text=e,this._setDirtyFlagTrue(14))}},{key:"width",get:function(){return this._width},set:function(e){this._width!==e&&(this._width=e,this._setDirtyFlagTrue(14))}},{key:"height",get:function(){return this._height},set:function(e){this._height!==e&&(this._height=e,this._setDirtyFlagTrue(14))}},{key:"font",get:function(){return this._font},set:function(e){var r=this._font;r!==e&&(r&&r._addRefCount(-1),e&&e._addRefCount(1),this._font=e,this._setDirtyFlagTrue(15))}},{key:"fontSize",get:function(){return this._fontSize},set:function(e){this._fontSize!==e&&(this._fontSize=e,this._setDirtyFlagTrue(15))}},{key:"fontStyle",get:function(){return this._fontStyle},set:function(e){this.fontStyle!==e&&(this._fontStyle=e,this._setDirtyFlagTrue(15))}},{key:"lineSpacing",get:function(){return this._lineSpacing},set:function(e){this._lineSpacing!==e&&(this._lineSpacing=e,this._setDirtyFlagTrue(14))}},{key:"horizontalAlignment",get:function(){return this._horizontalAlignment},set:function(e){this._horizontalAlignment!==e&&(this._horizontalAlignment=e,this._setDirtyFlagTrue(14))}},{key:"verticalAlignment",get:function(){return this._verticalAlignment},set:function(e){this._verticalAlignment!==e&&(this._verticalAlignment=e,this._setDirtyFlagTrue(14))}},{key:"enableWrapping",get:function(){return this._enableWrapping},set:function(e){this._enableWrapping!==e&&(this._enableWrapping=e,this._setDirtyFlagTrue(14))}},{key:"overflowMode",get:function(){return this._overflowMode},set:function(e){this._overflowMode!==e&&(this._overflowMode=e,this._setDirtyFlagTrue(14))}},{key:"maskInteraction",get:function(){return this._maskInteraction},set:function(e){this._maskInteraction!==e&&(this._maskInteraction=e,this._setDirtyFlagTrue(16))}},{key:"maskLayer",get:function(){return this._maskLayer},set:function(e){this._maskLayer=e}},{key:"bounds",get:function(){return this._isContainDirtyFlag(1)&&this._resetSubFont(),this._isContainDirtyFlag(2)&&this._updateLocalData(),this._isContainDirtyFlag(4)&&this._updatePosition(),this._isContainDirtyFlag(8)&&this._updateBounds(this._bounds),this._setDirtyFlagFalse(15),this._bounds}}]),i}(me);Ye._charRenderDataPool=new sS(L0,50);Ye._tempVec30=new w;Ye._tempVec31=new w;O([Be],Ye.prototype,"_subFont",void 0);O([Y],Ye.prototype,"_charRenderDatas",void 0);O([Y],Ye.prototype,"_dirtyFlag",void 0);O([je],Ye.prototype,"_color",void 0);O([Be],Ye.prototype,"_text",void 0);O([Be],Ye.prototype,"_width",void 0);O([Be],Ye.prototype,"_height",void 0);O([Y],Ye.prototype,"_localBounds",void 0);O([Be],Ye.prototype,"_font",void 0);O([Be],Ye.prototype,"_fontSize",void 0);O([Be],Ye.prototype,"_fontStyle",void 0);O([Be],Ye.prototype,"_lineSpacing",void 0);O([Be],Ye.prototype,"_horizontalAlignment",void 0);O([Be],Ye.prototype,"_verticalAlignment",void 0);O([Be],Ye.prototype,"_enableWrapping",void 0);O([Be],Ye.prototype,"_overflowMode",void 0);O([Be],Ye.prototype,"_maskInteraction",void 0);O([Be],Ye.prototype,"_maskLayer",void 0);var Ff;(function(n){n[n.SubFont=1]="SubFont",n[n.LocalPositionBounds=2]="LocalPositionBounds",n[n.WorldPosition=4]="WorldPosition",n[n.WorldBounds=8]="WorldBounds",n[n.MaskInteraction=16]="MaskInteraction",n[n.Position=14]="Position",n[n.Font=15]="Font"})(Ff||(Ff={}));var lS=function(){function n(){}var i=n.prototype;return i.initialize=function(t){for(var e=t.component,r=t.property.split("."),o=r.length-1,s=0;s<o;s++)e=e[r[s]];this._mounted=e,this._propertyName=r[o]},i.getTargetValue=function(){return this._mounted[this._propertyName]},i.setTargetValue=function(t){this._mounted[this._propertyName]=t},n}(),_o=function(){function n(a,t,e,r){this.crossCurveMark=0,this.hasSavedDefaultValue=!1,this.baseEvaluateData={curKeyframeIndex:0,value:null},this.crossEvaluateData={curKeyframeIndex:0,value:null},this.target=a,this.type=t,this.property=e,this.component=a.getComponent(t),this._cureType=r;var o=n.getAssemblerType(t,e);this._assembler=new o,this._assembler.initialize(this),r._isReferenceType&&(this.referenceTargetValue=this._assembler.getTargetValue())}var i=n.prototype;return i.evaluateAndApplyValue=function(t,e,r,o){if(t.keys.length)if(o){var s=t._evaluateAdditive(e,this.baseEvaluateData),l=this._cureType;if(l._isReferenceType)l._additiveValue(s,r,this.referenceTargetValue);else{var u=this._assembler,c=u.getTargetValue(),d=l._additiveValue(s,r,c);u.setTargetValue(d)}}else{var _=t._evaluate(e,this.baseEvaluateData);this._applyValue(_,r)}},i.crossFadeAndApplyValue=function(t,e,r,o,s,l,u){var c=t&&t.keys.length?u?t._evaluateAdditive(r,this.baseEvaluateData):t._evaluate(r,this.baseEvaluateData):u?this._cureType._getZeroValue(this.baseEvaluateData.value):this.defaultValue,d=e&&e.keys.length?u?e._evaluateAdditive(o,this.crossEvaluateData):e._evaluate(o,this.crossEvaluateData):u?this._cureType._getZeroValue(this.crossEvaluateData.value):this.defaultValue;this._applyCrossValue(c,d,s,l,u)},i.crossFadeFromPoseAndApplyValue=function(t,e,r,o,s){var l=s?this._cureType._subtractValue(this.fixedPoseValue,this.defaultValue,this.baseEvaluateData.value):this.fixedPoseValue,u=t&&t.keys.length?s?t._evaluateAdditive(e,this.crossEvaluateData):t._evaluate(e,this.crossEvaluateData):s?this._cureType._getZeroValue(this.crossEvaluateData.value):this.defaultValue;this._applyCrossValue(l,u,r,o,s)},i.revertDefaultValue=function(){this._assembler.setTargetValue(this.defaultValue)},i.saveDefaultValue=function(){this._cureType._isReferenceType?this._cureType._copyValue(this.referenceTargetValue,this.defaultValue):this.defaultValue=this._assembler.getTargetValue(),this.hasSavedDefaultValue=!0},i.saveFixedPoseValue=function(){this._cureType._isReferenceType?this._cureType._copyValue(this.referenceTargetValue,this.fixedPoseValue):this.fixedPoseValue=this._assembler.getTargetValue()},i._applyValue=function(t,e){if(e===1)this._cureType._isReferenceType?this._cureType._copyValue(t,this.referenceTargetValue):this._assembler.setTargetValue(t);else if(this._cureType._isReferenceType){var r=this.referenceTargetValue;this._cureType._lerpValue(r,t,e,r)}else{var o=this._assembler.getTargetValue(),s=this._cureType._lerpValue(o,t,e);this._assembler.setTargetValue(s)}},i._applyCrossValue=function(t,e,r,o,s){var l;if(this._cureType._isReferenceType?(l=this.baseEvaluateData.value,this._cureType._lerpValue(t,e,r,l)):l=this._cureType._lerpValue(t,e,r),s)if(this._cureType._isReferenceType)this._cureType._additiveValue(l,o,this.referenceTargetValue);else{var u=this._assembler.getTargetValue(),c=this._cureType._additiveValue(l,o,u);this._assembler.setTargetValue(c)}else this._applyValue(l,o)},n.registerAssembler=function(t,e,r){var o=n._assemblerMap.get(t);o||(o={},n._assemblerMap.set(t,o)),o[e]=r},n.getAssemblerType=function(t,e){var r=n._assemblerMap.get(t),o=r?r[e]:void 0;return o??lS},n}();_o._assemblerMap=new Map;var uS=function(){function n(){}var i=n.prototype;return i.initialize=function(t){this._transform=t.target.transform},i.getTargetValue=function(){return this._transform.position},i.setTargetValue=function(t){this._transform.position=t},n}();_o.registerAssembler(fe,"position",uS);var cS=function(){function n(){}var i=n.prototype;return i.initialize=function(t){this._transform=t.target.transform},i.getTargetValue=function(){return this._transform.rotationQuaternion},i.setTargetValue=function(t){this._transform.rotationQuaternion=t},n}();_o.registerAssembler(fe,"rotationQuaternion",cS);var dS=function(){function n(){}var i=n.prototype;return i.initialize=function(t){this._transform=t.target.transform},i.getTargetValue=function(){return this._transform.scale},i.setTargetValue=function(t){this._transform.scale=t},n}();_o.registerAssembler(fe,"scale",dS);var _S=function(){function n(){}var i=n.prototype;return i.initialize=function(t){this._skinnedMeshRenderer=t.target.getComponent(ut)},i.getTargetValue=function(){return this._skinnedMeshRenderer.blendShapeWeights},i.setTargetValue=function(t){this._skinnedMeshRenderer.blendShapeWeights=t},n}();_o.registerAssembler(ut,"blendShapeWeights",_S);var z0=function(){function n(){this._tempCurveOwner={}}var i=n.prototype;return i._createCurveOwner=function(t){var e=this.curve.constructor,r=new _o(t,this.type,this.property,e);return e._initializeOwner(r),r},i._getTempCurveOwner=function(t){var e=t.instanceId;return this._tempCurveOwner[e]||(this._tempCurveOwner[e]=this._createCurveOwner(t)),this._tempCurveOwner[e]},n}(),X_=function(){},j_=function(){function n(a){this.name=a,this._curveBindings=[],this._length=0,this._events=[]}var i=n.prototype;return i.addEvent=function(t,e,r){if(typeof t=="string"){var o=new X_;o.functionName=t,o.time=e,o.parameter=r,this._events.push(o)}else this._events.push(t);this._events.sort(function(s,l){return s.time-l.time})},i.clearEvents=function(){this._events.length=0},i.addCurveBinding=function(t,e,r,o){var s=new z0;s.relativePath=t,s.type=e,s.property=r,s.curve=o,o.length>this._length&&(this._length=o.length),this._curveBindings.push(s)},i.clearCurveBindings=function(){this._curveBindings.length=0,this._length=0},i._sampleAnimation=function(t,e){for(var r=this,o=r._curveBindings,s=o.length-1;s>=0;s--){var l=o[s],u=t.findByPath(l.relativePath);if(u){var c=l._getTempCurveOwner(u);c.evaluateAndApplyValue(l.curve,e,1,!1)}}},K(n,[{key:"events",get:function(){return this._events}},{key:"curveBindings",get:function(){return this._curveBindings}},{key:"length",get:function(){return this._length}}]),n}(),Tt;(function(n){n[n.Linear=0]="Linear",n[n.CubicSpine=1]="CubicSpine",n[n.Step=2]="Step",n[n.Hermite=3]="Hermite"})(Tt||(Tt={}));var Sr=function(){function n(){this.keys=[],this._evaluateData={curKeyframeIndex:0,value:null},this._length=0;var a=this.constructor;this._interpolation=a._isInterpolationType?Tt.Linear:Tt.Step,this._type=a}var i=n.prototype;return i.addKey=function(t){var e=t.time,r=this.keys;if(e>=this._length)r.push(t),this._length=e;else{for(var o=r.length;--o>=0&&e<r[o].time;);r.splice(o+1,0,t)}},i.evaluate=function(t){return this._evaluate(t,this._evaluateData)},i.removeKey=function(t){this.keys.splice(t,1);for(var e=this.keys,r=0,o=e.length-1;o>=0;o--){var s=e[o];s.time>length&&(r=s.time)}this._length=r},i._evaluate=function(t,e){var r=this.keys.length;if(!r){console.warn("This curve don't have any keyframes: ",this);return}var o=this,s=o.keys,l=o.interpolation,u=e.curKeyframeIndex;u!==-1&&(u>=r||t<s[u].time)&&(u=-1);for(var c=u+1;c<r&&!(t<s[c].time);)u++,c++;e.curKeyframeIndex=u;var d;if(u===-1)d=this._type._copyValue(s[0].value,e.value);else if(c===r)d=this._type._copyValue(s[u].value,e.value);else{var _=s[u],h=s[c],f=_.time,g=h.time-f,y=(t-f)/g;switch(l){case Tt.Linear:d=this._type._lerpValue(_.value,h.value,y,e.value);break;case Tt.Step:d=this._type._copyValue(_.value,e.value);break;case Tt.CubicSpine:case Tt.Hermite:d=this._type._hermiteInterpolationValue(_,h,y,g,e.value);break}}return d},i._evaluateAdditive=function(t,e){var r=this._evaluate(t,e);return this._type._subtractValue(r,this.keys[0].value,e.value)},K(n,[{key:"interpolation",get:function(){return this._interpolation},set:function(t){!this._type._isInterpolationType&&t!==Tt.Step?(this._interpolation=Tt.Step,console.warn("The interpolation type must be `InterpolationType.Step`.")):this._interpolation=t}},{key:"length",get:function(){return this._length}}]),n}(),tl,au=(tl=function(n){Q(i,n);function i(){var a;return a=n.call(this)||this,a._evaluateData.value=[],a}return i._initializeOwner=function(t){t.defaultValue=[],t.fixedPoseValue=[],t.baseEvaluateData.value=[],t.crossEvaluateData.value=[]},i._lerpValue=function(t,e,r,o){for(var s=0,l=o.length;s<l;++s){var u=t[s];o[s]=u+(e[s]-u)*r}return o},i._subtractValue=function(t,e,r){for(var o=0,s=t.length;o<s;o++)r[o]=t[o]-e[o];return r},i._getZeroValue=function(t){for(var e=0,r=t.length;e<r;e++)t[e]=0;return t},i._additiveValue=function(t,e,r){for(var o=0,s=r.length;o<s;++o)r[o]+=t[o]*e;return r},i._copyValue=function(t,e){for(var r=0,o=e.length;r<o;++r)e[r]=t[r];return e},i._hermiteInterpolationValue=function(t,e,r,o,s){for(var l=t.outTangent,u=e.inTangent,c=t.value,d=e.value,_=r*r,h=_*r,f=2*h-3*_+1,g=h-2*_+r,y=h-_,p=-2*h+3*_,v=0,m=c.length;v<m;++v)Number.isFinite(l[v])&&Number.isFinite(u[v])?s[v]=f*c[v]+g*l[v]*o+y*u[v]*o+p*d[v]:s[v]=t.value[v];return s},i}(Sr),tl._isReferenceType=!0,tl._isInterpolationType=!0,tl);au=O([or()],au);var nl,Sd=(nl=function(n){Q(i,n);function i(){var a;return a=n.call(this)||this,a._evaluateData.value=!1,a}return i._initializeOwner=function(t){t.defaultValue=!1,t.fixedPoseValue=!1,t.baseEvaluateData.value=!1,t.crossEvaluateData.value=!1},i._lerpValue=function(t,e){return e},i._subtractValue=function(t,e,r){return t},i._getZeroValue=function(){return!1},i._additiveValue=function(t,e,r){return t},i._copyValue=function(t){return t},i._hermiteInterpolationValue=function(t){return t.value},i}(Sr),nl._isReferenceType=!1,nl._isInterpolationType=!1,nl);Sd=O([or()],Sd);var rl,ou=(rl=function(n){Q(i,n);function i(){var a;return a=n.call(this)||this,a._evaluateData.value=new ne,a}return i._initializeOwner=function(t){t.defaultValue=new ne,t.fixedPoseValue=new ne,t.baseEvaluateData.value=new ne,t.crossEvaluateData.value=new ne},i._lerpValue=function(t,e,r,o){return ne.lerp(t,e,r,o),o},i._subtractValue=function(t,e,r){return ne.subtract(t,e,r),r},i._getZeroValue=function(t){return t.set(0,0,0,0),t},i._additiveValue=function(t,e,r){return ne.scale(t,e,t),ne.add(r,t,r),r},i._copyValue=function(t,e){return e.copyFrom(t),e},i._hermiteInterpolationValue=function(t,e,r,o,s){var l=t.value,u=t.outTangent,c=e.value,d=e.inTangent,_=r*r,h=_*r,f=2*h-3*_+1,g=h-2*_+r,y=h-_,p=-2*h+3*_,v=u.x,m=d.x;return Number.isFinite(v)&&Number.isFinite(m)?s.r=f*l.r+g*v*o+y*m*o+p*c.r:s.r=l.r,v=u.y,m=d.y,Number.isFinite(v)&&Number.isFinite(m)?s.g=f*l.g+g*v*o+y*m*o+p*c.g:s.g=l.g,v=u.z,m=d.z,Number.isFinite(v)&&Number.isFinite(m)?s.b=f*l.b+g*v*o+y*m*o+p*c.b:s.b=l.b,v=u.w,m=d.w,Number.isFinite(v)&&Number.isFinite(m)?s.a=f*l.a+g*v*o+y*m*o+p*c.a:s.a=l.a,s},i}(Sr),rl._isReferenceType=!0,rl._isInterpolationType=!0,rl);ou=O([or()],ou);var il,xs=(il=function(n){Q(i,n);function i(){return n.apply(this,arguments)}var a=i.prototype;return a.addKey=function(e){n.prototype.addKey.call(this,e);var r=this._evaluateData;if(!r.value||r.value.length!==e.value.length){var o=e.value.length;r.value=new Float32Array(o)}},i._initializeOwner=function(e){var r=e.referenceTargetValue.length;e.defaultValue=new Float32Array(r),e.fixedPoseValue=new Float32Array(r),e.baseEvaluateData.value=new Float32Array(r),e.crossEvaluateData.value=new Float32Array(r)},i._lerpValue=function(e,r,o,s){for(var l=0,u=s.length;l<u;++l){var c=e[l];s[l]=c+(r[l]-c)*o}return s},i._subtractValue=function(e,r,o){for(var s=0,l=e.length;s<l;s++)o[s]=e[s]-r[s];return o},i._getZeroValue=function(e){for(var r=0,o=e.length;r<o;r++)e[r]=0;return e},i._additiveValue=function(e,r,o){for(var s=0,l=o.length;s<l;++s)o[s]+=e[s]*r;return o},i._copyValue=function(e,r){for(var o=0,s=r.length;o<s;++o)r[o]=e[o];return r},i._hermiteInterpolationValue=function(e,r,o,s,l){for(var u=e.outTangent,c=r.inTangent,d=e.value,_=r.value,h=o*o,f=h*o,g=2*f-3*h+1,y=f-2*h+o,p=f-h,v=-2*f+3*h,m=0,x=d.length;m<x;++m)Number.isFinite(u[m])&&Number.isFinite(c[m])?l[m]=g*d[m]+y*u[m]*s+p*c[m]*s+v*_[m]:l[m]=e.value[m];return l},i}(Sr),il._isReferenceType=!0,il._isInterpolationType=!0,il);xs=O([or()],xs);var al,su=(al=function(n){Q(i,n);function i(){var a;return a=n.call(this)||this,a._evaluateData.value=0,a}return i._initializeOwner=function(t){t.defaultValue=0,t.fixedPoseValue=0,t.baseEvaluateData.value=0,t.crossEvaluateData.value=0},i._lerpValue=function(t,e,r){return t+(e-t)*r},i._additiveValue=function(t,e,r){return r+=t*e},i._subtractValue=function(t,e){return t-e},i._getZeroValue=function(){return 0},i._copyValue=function(t){return t},i._hermiteInterpolationValue=function(t,e,r,o){var s=t.outTangent,l=e.inTangent;if(Number.isFinite(s)&&Number.isFinite(l)){var u=r*r,c=u*r,d=2*c-3*u+1,_=c-2*u+r,h=c-u,f=-2*c+3*u;return d*t.value+_*s*o+h*l*o+f*e.value}else return t.value},i}(Sr),al._isReferenceType=!1,al._isInterpolationType=!0,al);su=O([or()],su);var Eo,io=(Eo=function(n){Q(i,n);function i(){var a;return a=n.call(this)||this,a._evaluateData.value=new ve,a}return i._initializeOwner=function(t){t.defaultValue=new ve,t.fixedPoseValue=new ve,t.baseEvaluateData.value=new ve,t.crossEvaluateData.value=new ve},i._lerpValue=function(t,e,r,o){return ve.slerp(t,e,r,o),o},i._additiveValue=function(t,e,r){return t.x=t.x*e,t.y=t.y*e,t.z=t.z*e,t.normalize(),r.multiply(t),r},i._subtractValue=function(t,e,r){var o=io._tempConjugateQuat;return ve.conjugate(e,o),ve.multiply(o,t,r),r},i._getZeroValue=function(t){return t.set(0,0,0,1),t},i._copyValue=function(t,e){return e.copyFrom(t),e},i._hermiteInterpolationValue=function(t,e,r,o,s){var l=t.value,u=t.outTangent,c=e.value,d=e.inTangent,_=r*r,h=_*r,f=2*h-3*_+1,g=h-2*_+r,y=h-_,p=-2*h+3*_,v=u.x,m=d.x;return Number.isFinite(v)&&Number.isFinite(m)?s.x=f*l.x+g*v*o+y*m*o+p*c.x:s.x=l.x,v=u.y,m=d.y,Number.isFinite(v)&&Number.isFinite(m)?s.y=f*l.y+g*v*o+y*m*o+p*c.y:s.y=l.y,v=u.z,m=d.z,Number.isFinite(v)&&Number.isFinite(m)?s.z=f*l.z+g*v*o+y*m*o+p*c.z:s.z=l.z,v=u.w,m=d.w,Number.isFinite(v)&&Number.isFinite(m)?s.w=f*l.w+g*v*o+y*m*o+p*c.w:s.w=l.w,s},i}(Sr),Eo._isInterpolationType=!0,Eo._isReferenceType=!0,Eo._tempConjugateQuat=new ve,Eo);io=O([or()],io);var ol,lu=(ol=function(n){Q(i,n);function i(){var a;return a=n.call(this)||this,a._evaluateData.value=new W,a}return i._initializeOwner=function(t){t.defaultValue=new W,t.fixedPoseValue=new W,t.baseEvaluateData.value=new W,t.crossEvaluateData.value=new W},i._lerpValue=function(t,e,r,o){return W.lerp(t,e,r,o),o},i._additiveValue=function(t,e,r){return W.scale(t,e,t),W.add(r,t,r),r},i._subtractValue=function(t,e,r){return W.subtract(t,e,r),r},i._getZeroValue=function(t){return t.set(0,0),t},i._copyValue=function(t,e){return e.copyFrom(t),e},i._hermiteInterpolationValue=function(t,e,r,o,s){var l=t.value,u=t.outTangent,c=e.value,d=e.inTangent,_=r*r,h=_*r,f=2*h-3*_+1,g=h-2*_+r,y=h-_,p=-2*h+3*_,v=u.x,m=d.x;return Number.isFinite(v)&&Number.isFinite(m)?s.x=f*l.x+g*v*o+y*m*o+p*c.x:s.x=l.x,v=u.y,m=d.y,Number.isFinite(v)&&Number.isFinite(m)?s.y=f*l.y+g*v*o+y*m*o+p*c.y:s.y=l.y,s},i}(Sr),ol._isReferenceType=!0,ol._isInterpolationType=!0,ol);lu=O([or()],lu);var sl,ws=(sl=function(n){Q(i,n);function i(){var a;return a=n.call(this)||this,a._evaluateData.value=new w,a}return i._initializeOwner=function(t){t.defaultValue=new w,t.fixedPoseValue=new w,t.baseEvaluateData.value=new w,t.crossEvaluateData.value=new w},i._lerpValue=function(t,e,r,o){return w.lerp(t,e,r,o),o},i._relativeBaseValue=function(t,e){return w.subtract(e,t,e),e},i._additiveValue=function(t,e,r){return w.scale(t,e,t),w.add(r,t,r),r},i._subtractValue=function(t,e,r){return w.subtract(t,e,r),r},i._getZeroValue=function(t){return t.set(0,0,0),t},i._copyValue=function(t,e){return e.copyFrom(t),e},i._hermiteInterpolationValue=function(t,e,r,o,s){var l=t.value,u=t.outTangent,c=e.value,d=e.inTangent,_=r*r,h=_*r,f=2*h-3*_+1,g=h-2*_+r,y=h-_,p=-2*h+3*_,v=u.x,m=d.x;return Number.isFinite(v)&&Number.isFinite(m)?s.x=f*l.x+g*v*o+y*m*o+p*c.x:s.x=l.x,v=u.y,m=d.y,Number.isFinite(v)&&Number.isFinite(m)?s.y=f*l.y+g*v*o+y*m*o+p*c.y:s.y=l.y,v=u.z,m=d.z,Number.isFinite(v)&&Number.isFinite(m)?s.z=f*l.z+g*v*o+y*m*o+p*c.z:s.z=l.z,s},i}(Sr),sl._isReferenceType=!0,sl._isInterpolationType=!0,sl);ws=O([or()],ws);var ll,uu=(ll=function(n){Q(i,n);function i(){var a;return a=n.call(this)||this,a._evaluateData.value=new he,a}return i._initializeOwner=function(t){t.defaultValue=new he,t.fixedPoseValue=new he,t.baseEvaluateData.value=new he,t.crossEvaluateData.value=new he},i._lerpValue=function(t,e,r,o){return he.lerp(t,e,r,o),o},i._additiveValue=function(t,e,r){return he.scale(t,e,t),he.add(r,t,r),r},i._subtractValue=function(t,e,r){return he.subtract(t,e,r),r},i._getZeroValue=function(t){return t.set(0,0,0,0),t},i._copyValue=function(t,e){return e.copyFrom(t),e},i._hermiteInterpolationValue=function(t,e,r,o,s){var l=t.value,u=t.outTangent,c=e.value,d=e.inTangent,_=r*r,h=_*r,f=2*h-3*_+1,g=h-2*_+r,y=h-_,p=-2*h+3*_,v=u.x,m=d.x;return Number.isFinite(v)&&Number.isFinite(m)?s.x=f*l.x+g*v*o+y*m*o+p*c.x:s.x=l.x,v=u.y,m=d.y,Number.isFinite(v)&&Number.isFinite(m)?s.y=f*l.y+g*v*o+y*m*o+p*c.y:s.y=l.y,v=u.z,m=d.z,Number.isFinite(v)&&Number.isFinite(m)?s.z=f*l.z+g*v*o+y*m*o+p*c.z:s.z=l.z,v=u.w,m=d.w,Number.isFinite(v)&&Number.isFinite(m)?s.w=f*l.w+g*v*o+y*m*o+p*c.w:s.w=l.w,s},i}(Sr),ll._isReferenceType=!0,ll._isInterpolationType=!0,ll);uu=O([or()],uu);var Ss;(function(n){n[n.None=0]="None",n[n.Complete=1]="Complete"})(Ss||(Ss={}));var Cs;(function(n){n[n.Override=0]="Override",n[n.Additive=1]="Additive"})(Cs||(Cs={}));var jt;(function(n){n[n.UnStarted=0]="UnStarted",n[n.Playing=1]="Playing",n[n.Finished=2]="Finished"})(jt||(jt={}));var at;(function(n){n[n.Standby=0]="Standby",n[n.Playing=1]="Playing",n[n.CrossFading=2]="CrossFading",n[n.FixedCrossFading=3]="FixedCrossFading"})(at||(at={}));var hS=function(){this.handlers=[]},Y_=function(){this.duration=0,this.offset=0,this.exitTime=1},As;(function(n){n[n.Once=0]="Once",n[n.Loop=1]="Loop"})(As||(As={}));var Df=function(){function n(){}var i=n.prototype;return i.reset=function(t,e,r){this.state=t,this.frameTime=r,this.stateData=e,this.playState=jt.UnStarted,this.clipTime=t.clipStartTime*t.clip.length,this.currentEventIndex=0},i.update=function(t){var e=this.state,r=this.frameTime,o=e._getDuration();this.playState=jt.Playing,e.wrapMode===As.Loop?r=o?r%o:0:Math.abs(r)>o&&(r=r<0?-o:o,this.playState=jt.Finished),t&&r===0?this.clipTime=e.clipEndTime*e.clip.length:(r<0&&(r+=o),this.clipTime=r+e.clipStartTime*e.clip.length)},n}(),fS=function(){function n(){this.animatorStateDataMap={},this.srcPlayData=new Df,this.destPlayData=new Df,this.layerState=at.Standby,this.crossCurveMark=0,this.manuallyTransition=new Y_}var i=n.prototype;return i.switchPlayData=function(){var t=this.destPlayData,e=this.srcPlayData;this.srcPlayData=t,this.destPlayData=e},n}(),vS=function(){this.curveOwners=[],this.eventHandlers=[]},sr=function(n){Q(i,n);function i(t){var e;return e=n.call(this,t)||this,e.cullingMode=Ss.None,e.speed=1,e._animatorLayersData=[],e._crossOwnerCollection=[],e._animationCurveOwners=[],e._animationEventHandlerPool=new Da(hS),e._tempAnimatorStateInfo={layerIndex:-1,state:null},e._controlledRenderers=[],e}var a=i.prototype;return a.play=function(e,r,o){r===void 0&&(r=-1),o===void 0&&(o=0);var s;(s=this._controllerUpdateFlag)!=null&&s.flag&&this._reset();var l=this._getAnimatorStateInfo(e,r),u=l.state;if(u){if(!u.clip){console.warn("The state named "+e+" has no AnimationClip data.");return}var c=this._getAnimatorLayerData(l.layerIndex),d=this._getAnimatorStateData(e,u,c);this._preparePlay(c,u,d),c.layerState=at.Playing,c.srcPlayData.reset(u,d,u._getDuration()*o)}},a.crossFade=function(e,r,o,s){o===void 0&&(o=-1),s===void 0&&(s=0);var l;(l=this._controllerUpdateFlag)!=null&&l.flag&&this._reset();var u=this._getAnimatorStateInfo(e,o).state,c=this._getAnimatorLayerData(o).manuallyTransition;c.duration=r,c.offset=s,c.destinationState=u,this._crossFadeByTransition(c,o)},a.update=function(e){var r,o;if(this.cullingMode===Ss.Complete){o=!1;for(var s=this._controlledRenderers,l=0,u=s.length;l<u;l++)if(!s[l].isCulled){o=!0;break}}else o=!0;var c=this,d=c._animatorController;if(d){if((r=this._controllerUpdateFlag)!=null&&r.flag){this._checkAutoPlay();return}e*=this.speed;for(var _=0,h=d.layers.length;_<h;_++){var f=this._getAnimatorLayerData(_);f.layerState!==at.Standby&&this._updateLayer(_,_===0,e/1e3,o)}}},a.getCurrentAnimatorState=function(e){var r,o;return(r=this._animatorLayersData[e])==null||(o=r.srcPlayData)==null?void 0:o.state},a.findAnimatorState=function(e,r){return r===void 0&&(r=-1),this._getAnimatorStateInfo(e,r).state},a._onEnable=function(){this.engine._componentsManager.addOnUpdateAnimations(this),this.animatorController&&this._checkAutoPlay(),this._entity.getComponentsIncludeChildren(me,this._controlledRenderers)},a._onDisable=function(){this.engine._componentsManager.removeOnUpdateAnimations(this)},a._reset=function(){var e=this,r=e._animationCurveOwners;for(var o in r){var s=r[o];for(var l in s){var u=s[l];u.hasSavedDefaultValue&&u.revertDefaultValue()}}this._animatorLayersData.length=0,this._crossOwnerCollection.length=0,this._animationCurveOwners.length=0,this._animationEventHandlerPool.resetPool(),this._controllerUpdateFlag&&(this._controllerUpdateFlag.flag=!1)},a._getAnimatorStateInfo=function(e,r){var o=this,s=o._animatorController,l=o._tempAnimatorStateInfo,u=null;if(s){var c=s.layers;if(r===-1){for(var d=0,_=c.length;d<_;d++)if(u=c[d].stateMachine.findStateByName(e),u){r=d;break}}else u=c[r].stateMachine.findStateByName(e)}return l.layerIndex=r,l.state=u,l},a._saveDefaultValues=function(e){for(var r=e.curveOwners,o=r.length-1;o>=0;o--){var s;(s=r[o])==null||s.saveDefaultValue()}},a._getAnimatorStateData=function(e,r,o){var s=o.animatorStateDataMap,l=s[e];return l||(l=new vS,s[e]=l,this._saveAnimatorStateData(r,l),this._saveAnimatorEventHandlers(r,l)),l},a._saveAnimatorStateData=function(e,r){for(var o=this,s=o.entity,l=o._animationCurveOwners,u=r.curveOwners,c=e.clip,d=c._curveBindings,_=d.length-1;_>=0;_--){var h=d[_],f=h.relativePath===""?s:s.findByPath(h.relativePath);if(f){var g=h.property,y=f.instanceId,p=l[y]||(l[y]={});u[_]=p[g]||(p[g]=h._createCurveOwner(f))}else u[_]=null,console.warn("The entity don't have the child entity which path is "+h.relativePath+".")}},a._saveAnimatorEventHandlers=function(e,r){var o=this._animationEventHandlerPool,s=this._entity._scripts,l=s.length,u=r.eventHandlers,c=e.clip.events;u.length=0;for(var d=0,_=c.length;d<_;d++){var h=c[d],f=o.getFromPool(),g=h.functionName,y=f.handlers;f.event=h,y.length=0;for(var p=l-1;p>=0;p--){var v=s.get(p)[g];v&&y.push(v)}u.push(f)}},a._clearCrossData=function(e){e.crossCurveMark++,this._crossOwnerCollection.length=0},a._addCrossCurveData=function(e,r,o,s){r.crossSrcCurveIndex=o,r.crossDestCurveIndex=s,e.push(r)},a._prepareCrossFading=function(e){var r=this._crossOwnerCollection,o=e.crossCurveMark;this._prepareSrcCrossData(r,e.srcPlayData,o,!1),this._prepareDestCrossData(r,e.destPlayData,o,!1)},a._prepareStandbyCrossFading=function(e){var r=this._crossOwnerCollection,o=e.srcPlayData,s=e.crossCurveMark;o.state&&this._prepareSrcCrossData(r,o,s,!0),this._prepareDestCrossData(r,e.destPlayData,s,!0)},a._prepareFixedPoseCrossFading=function(e){for(var r=this._crossOwnerCollection,o=r.length-1;o>=0;o--){var s=r[o];s.saveFixedPoseValue(),s.crossDestCurveIndex=-1}this._prepareDestCrossData(r,e.destPlayData,e.crossCurveMark,!0)},a._prepareSrcCrossData=function(e,r,o,s){for(var l=r.stateData.curveOwners,u=l.length-1;u>=0;u--){var c=l[u];c&&(c.crossCurveMark=o,c.crossCurveDataIndex=e.length,s&&c.saveFixedPoseValue(),this._addCrossCurveData(e,c,u,-1))}},a._prepareDestCrossData=function(e,r,o,s){for(var l=r.stateData.curveOwners,u=l.length-1;u>=0;u--){var c=l[u];c&&(c.crossCurveMark===o?e[c.crossCurveDataIndex].crossDestCurveIndex=u:(c.saveDefaultValue(),s&&c.saveFixedPoseValue(),c.crossCurveMark=o,c.crossCurveDataIndex=e.length,this._addCrossCurveData(e,c,-1,u)))}},a._getAnimatorLayerData=function(e){var r=this._animatorLayersData[e];return r||(this._animatorLayersData[e]=r=new fS),r},a._updateLayer=function(e,r,o,s){var l=this._animatorController.layers[e],u=l.blendingMode,c=l.weight,d=this._animatorLayersData[e],_=d.srcPlayData,h=d.destPlayData,f=d.crossFadeTransition,g=u===Cs.Additive;switch(r&&(c=1),d.layerState!==at.FixedCrossFading&&this._checkTransition(_,f,e),d.layerState){case at.Playing:this._updatePlayingState(_,d,e,c,o,g,s);break;case at.FixedCrossFading:this._updateCrossFadeFromPose(h,d,e,c,o,g,s);break;case at.CrossFading:this._updateCrossFade(_,h,d,e,c,o,g,s);break}},a._updatePlayingState=function(e,r,o,s,l,u,c){var d=e.stateData,_=d.curveOwners,h=d.eventHandlers,f=e.state,g=e.playState,y=e.clipTime,p=f.clip,v=p._curveBindings;if(e.update(this.speed<0),!!c){var m=e.clipTime,x=e.playState;h.length&&this._fireAnimationEvents(e,h,y,m);for(var S=v.length-1;S>=0;S--){var C=_[S];C==null||C.evaluateAndApplyValue(v[S].curve,m,s,u)}e.frameTime+=f.speed*l,x===jt.Finished&&(r.layerState=at.Standby),g===jt.UnStarted&&this._callAnimatorScriptOnEnter(f,o),x===jt.Finished?this._callAnimatorScriptOnExit(f,o):this._callAnimatorScriptOnUpdate(f,o)}},a._updateCrossFade=function(e,r,o,s,l,u,c,d){var _=this,h=_._crossOwnerCollection,f=e.state.clip,g=f._curveBindings,y=e.state,p=e.stateData,v=e.playState,m=p.eventHandlers,x=r.state,S=r.stateData,C=r.playState,A=S.eventHandlers,T=x.clip,E=T._curveBindings,P=e.clipTime,b=r.clipTime,M=Math.abs(r.frameTime)/(x._getDuration()*o.crossFadeTransition.duration);M>=1&&(M=1),e.update(this.speed<0),r.update(this.speed<0);var F=e.playState,I=r.playState;if(this._updateCrossFadeData(o,M,u,!1),!!d){var L=e.clipTime,V=r.clipTime;m.length&&this._fireAnimationEvents(e,m,P,L),A.length&&this._fireAnimationEvents(r,A,b,V),v===jt.UnStarted&&this._callAnimatorScriptOnEnter(y,s),M===1||F===jt.Finished?this._callAnimatorScriptOnExit(y,s):this._callAnimatorScriptOnUpdate(y,s),C===jt.UnStarted&&this._callAnimatorScriptOnEnter(x,s),I===jt.Finished?this._callAnimatorScriptOnExit(x,s):this._callAnimatorScriptOnUpdate(x,s);for(var U=h.length-1;U>=0;U--){var D=h[U],R=D.crossSrcCurveIndex,N=D.crossDestCurveIndex;D.crossFadeAndApplyValue(R>=0?g[R].curve:null,N>=0?E[N].curve:null,L,V,M,l,c)}}},a._updateCrossFadeFromPose=function(e,r,o,s,l,u,c){var d=this._crossOwnerCollection,_=e.state,h=e.stateData,f=e.playState,g=h.eventHandlers,y=_.clip,p=y._curveBindings,v=e.clipTime,m=Math.abs(e.frameTime)/(_._getDuration()*r.crossFadeTransition.duration);m>=1&&(m=1),e.update(this.speed<0);var x=e.playState;if(this._updateCrossFadeData(r,m,l,!0),!!c){var S=e.clipTime;g.length&&this._fireAnimationEvents(e,g,v,S),f===jt.UnStarted&&this._callAnimatorScriptOnEnter(_,o),x===jt.Finished?this._callAnimatorScriptOnExit(_,o):this._callAnimatorScriptOnUpdate(_,o);for(var C=d.length-1;C>=0;C--){var A=d[C],T=A.crossDestCurveIndex;A.crossFadeFromPoseAndApplyValue(T>=0?p[T].curve:null,S,m,s,u)}}},a._updateCrossFadeData=function(e,r,o,s){var l=e.destPlayData;l.frameTime+=l.state.speed*o,r===1?(l.playState===jt.Finished?e.layerState=at.Standby:e.layerState=at.Playing,e.switchPlayData(),e.crossFadeTransition=null):s||(e.srcPlayData.frameTime+=e.srcPlayData.state.speed*o)},a._preparePlay=function(e,r,o){if(e.layerState===at.Playing){var s=e.srcPlayData;if(s.state!==r){for(var l=s.stateData.curveOwners,u=l.length-1;u>=0;u--){var c=l[u];c!=null&&c.hasSavedDefaultValue&&c.revertDefaultValue()}this._saveDefaultValues(o)}}else{for(var d=this._crossOwnerCollection,_=d.length-1;_>=0;_--){var h=d[_];h.hasSavedDefaultValue&&h.revertDefaultValue()}this._saveDefaultValues(o)}},a._checkTransition=function(e,r,o){for(var s=e.state,l=e.clipTime,u=s.transitions,c=s._getDuration(),d=0,_=u.length;d<_;++d){var h=u[d];c*h.exitTime<=l&&r!==h&&this._crossFadeByTransition(h,o)}},a._crossFadeByTransition=function(e,r){var o=e.destinationState.name,s=this._getAnimatorStateInfo(o,r),l=s.state;if(l){if(!l.clip){console.warn("The state named "+o+" has no AnimationClip data.");return}var u=this._getAnimatorLayerData(s.layerIndex),c=u.layerState,d=u.destPlayData,_=this._getAnimatorStateData(o,l,u),h=l._getDuration(),f=h*e.offset;switch(d.reset(l,_,f),c){case at.Standby:u.layerState=at.FixedCrossFading,this._clearCrossData(u),this._prepareStandbyCrossFading(u);break;case at.Playing:u.layerState=at.CrossFading,this._clearCrossData(u),this._prepareCrossFading(u);break;case at.CrossFading:u.layerState=at.FixedCrossFading,this._prepareFixedPoseCrossFading(u);break;case at.FixedCrossFading:this._prepareFixedPoseCrossFading(u);break}u.crossFadeTransition=e}},a._fireAnimationEvents=function(e,r,o,s){var l=e.state,u=l.clip.length;this.speed>=0?s<o?(this._fireSubAnimationEvents(e,r,o,l.clipEndTime*u),e.currentEventIndex=0,this._fireSubAnimationEvents(e,r,l.clipStartTime*u,s)):this._fireSubAnimationEvents(e,r,o,s):s>o?(this._fireBackwardSubAnimationEvents(e,r,o,l.clipStartTime*u),e.currentEventIndex=r.length-1,this._fireBackwardSubAnimationEvents(e,r,l.clipEndTime*u,s)):this._fireBackwardSubAnimationEvents(e,r,o,s)},a._fireSubAnimationEvents=function(e,r,o,s){for(var l=e.currentEventIndex,u=r.length;l<u;l++){var c=r[l],d=c.event,_=d.time,h=d.parameter;if(_>s)break;var f=c.handlers;if(_>=o){for(var g=f.length-1;g>=0;g--)f[g](h);e.currentEventIndex=Math.min(l+1,u-1)}}},a._fireBackwardSubAnimationEvents=function(e,r,o,s){for(var l=e.currentEventIndex;l>=0;l--){var u=r[l],c=u.event,d=c.time,_=c.parameter;if(d<s)break;if(d<=o){for(var h=u.handlers,f=h.length-1;f>=0;f--)h[f](_);e.currentEventIndex=Math.max(l-1,0)}}},a._callAnimatorScriptOnEnter=function(e,r){for(var o=e._onStateEnterScripts,s=0,l=o.length;s<l;s++)o[s].onStateEnter(this,e,r)},a._callAnimatorScriptOnUpdate=function(e,r){for(var o=e._onStateUpdateScripts,s=0,l=o.length;s<l;s++)o[s].onStateUpdate(this,e,r)},a._callAnimatorScriptOnExit=function(e,r){for(var o=e._onStateExitScripts,s=0,l=o.length;s<l;s++)o[s].onStateExit(this,e,r)},a._checkAutoPlay=function(){for(var e=this._animatorController.layers,r=0,o=e.length;r<o;++r){var s=e[r].stateMachine;s!=null&&s.defaultState&&this.play(s.defaultState.name,r)}},K(i,[{key:"animatorController",get:function(){return this._animatorController},set:function(e){e!==this._animatorController&&(this._reset(),this._controllerUpdateFlag&&this._controllerUpdateFlag.destroy(),this._controllerUpdateFlag=e&&e._registerChangeFlag(),this._animatorController=e)}}]),i}(vn);O([Be],sr.prototype,"speed",void 0);O([Y],sr.prototype,"_controllerUpdateFlag",void 0);O([Y],sr.prototype,"_animatorLayersData",void 0);O([Y],sr.prototype,"_crossOwnerCollection",void 0);O([Y],sr.prototype,"_animationCurveOwners",void 0);O([Y],sr.prototype,"_animationEventHandlerPool",void 0);O([Y],sr.prototype,"_tempAnimatorStateInfo",void 0);O([Y],sr.prototype,"_controlledRenderers",void 0);var q_=function(){function n(){this._updateFlagManager=new Ja,this._layers=[],this._layersMap={}}var i=n.prototype;return i.findLayerByName=function(t){return this._layersMap[t]},i.addLayer=function(t){this._layers.push(t),this._layersMap[t.name]=t,this._updateFlagManager.dispatch()},i.removeLayer=function(t){var e=this.layers[t];this._layers.splice(t,1),delete this._layersMap[e.name],this._updateFlagManager.dispatch()},i.clearLayers=function(){this._layers.length=0;for(var t in this._layersMap)delete this._layersMap[t];this._updateFlagManager.dispatch()},i._registerChangeFlag=function(){return this._updateFlagManager.createFlag(Ru)},K(n,[{key:"layers",get:function(){return this._layers}}]),n}(),Q_=function(i){this.name=i,this.weight=1,this.blendingMode=Cs.Override},Cd=function(){function n(){this._destroyed=!1}var i=n.prototype;return i.onStateEnter=function(t,e,r){},i.onStateUpdate=function(t,e,r){},i.onStateExit=function(t,e,r){},i.destroy=function(){this._destroyed||(this._state._removeStateMachineScript(this),this._destroyed=!0)},n}(),O0=function(){function n(a){this.name=a,this.speed=1,this.wrapMode=As.Loop,this._onStateEnterScripts=[],this._onStateUpdateScripts=[],this._onStateExitScripts=[],this._clipStartTime=0,this._clipEndTime=1,this._transitions=[]}var i=n.prototype;return i.addTransition=function(t){this._transitions.push(t)},i.removeTransition=function(t){var e=this._transitions.indexOf(t);e!==-1&&this._transitions.splice(e,1)},i.addStateMachineScript=function(t){var e=new t;e._state=this;var r=Cd.prototype;return e.onStateEnter!==r.onStateEnter&&this._onStateEnterScripts.push(e),e.onStateUpdate!==r.onStateUpdate&&this._onStateUpdateScripts.push(e),e.onStateExit!==r.onStateExit&&this._onStateExitScripts.push(e),e},i.clearTransitions=function(){this._transitions.length=0},i._getDuration=function(){return this.clip?(this._clipEndTime-this._clipStartTime)*this.clip.length:null},i._removeStateMachineScript=function(t){var e=Cd.prototype;if(t.onStateEnter!==e.onStateEnter){var r=this._onStateEnterScripts.indexOf(t);r!==-1&&this._onStateEnterScripts.splice(r,1)}if(t.onStateUpdate!==e.onStateUpdate){var o=this._onStateUpdateScripts.indexOf(t);o!==-1&&this._onStateUpdateScripts.splice(o,1)}if(t.onStateExit!==e.onStateExit){var s=this._onStateExitScripts.indexOf(t);s!==-1&&this._onStateExitScripts.splice(s,1)}},K(n,[{key:"transitions",get:function(){return this._transitions}},{key:"clip",get:function(){return this._clip},set:function(t){this._clip=t,this._clipEndTime=Math.min(this._clipEndTime,1)}},{key:"clipStartTime",get:function(){return this._clipStartTime},set:function(t){this._clipStartTime=Math.max(t,0)}},{key:"clipEndTime",get:function(){return this._clipEndTime},set:function(t){this._clipEndTime=Math.min(t,1)}}]),n}(),$_=function(){function n(){this.states=[],this._statesMap={}}var i=n.prototype;return i.addState=function(t){var e=this.findStateByName(t);return e?console.warn("The state named "+t+" has existed."):(e=new O0(t),this.states.push(e),this._statesMap[t]=e),e},i.removeState=function(t){var e=t.name,r=this.states.indexOf(t);r>-1&&this.states.splice(r,1),delete this._statesMap[e]},i.findStateByName=function(t){return this._statesMap[t]},i.makeUniqueStateName=function(t){for(var e=this._statesMap,r=t,o=0;e[t];)t=r+" "+o,o++;return t},n}(),Ad;(function(n){n[n.If=0]="If",n[n.IfNot=1]="IfNot",n[n.Greater=2]="Greater",n[n.Less=3]="Less",n[n.Equals=4]="Equals",n[n.NotEquals=5]="NotEquals"})(Ad||(Ad={}));var In=function(){},K_=function(n){Q(i,n);function i(a){var t;return t=n.call(this,a,B.find("skybox"))||this,t._decodeParam=new he(0,5,0,0),t.renderState.rasterState.cullMode=kt.Off,t.renderState.depthState.compareFunction=ye.LessEqual,t.shaderData.setVector4("u_cubeDecodeParam",t._decodeParam),t}return K(i,[{key:"textureDecodeRGBM",get:function(){return Boolean(this._decodeParam.x)},set:function(t){this._decodeParam.x=Number(t)}},{key:"RGBMDecodeFactor",get:function(){return this._decodeParam.y},set:function(t){this._decodeParam.y=t}},{key:"textureCubeMap",get:function(){return this.shaderData.getTexture("u_cube")},set:function(t){this.shaderData.setTexture("u_cube",t)}}]),i}(Dr),Bf;(function(n){n[n.Position=1]="Position",n[n.Velocity=2]="Velocity",n[n.Acceleration=4]="Acceleration",n[n.Color=8]="Color",n[n.Alpha=16]="Alpha",n[n.Size=32]="Size",n[n.StartAngle=64]="StartAngle",n[n.StartTime=128]="StartTime",n[n.LifeTime=256]="LifeTime",n[n.RotateVelocity=512]="RotateVelocity",n[n.Scale=1024]="Scale",n[n.Everything=4294967295]="Everything"})(Bf||(Bf={}));var Td;(function(n){n[n.Transparent=0]="Transparent",n[n.Additive=1]="Additive"})(Td||(Td={}));var Nu=function(n){Q(i,n);function i(t){var e;return e=n.call(this,t)||this,e._maxCount=1e3,e._position=new w,e._positionRandomness=new w,e._velocity=new w,e._velocityRandomness=new w,e._acceleration=new w,e._accelerationRandomness=new w,e._color=new ne(1,1,1,1),e._colorRandomness=0,e._size=1,e._sizeRandomness=0,e._alpha=1,e._alphaRandomness=0,e._startAngle=0,e._startAngleRandomness=0,e._rotateVelocity=0,e._rotateVelocityRandomness=0,e._lifetime=5,e._startTimeRandomness=0,e._scale=1,e._isOnce=!1,e._onceTime=0,e._time=0,e._isInit=!1,e._isStart=!1,e._updateDirtyFlag=4294967295,e._isRotateToVelocity=!1,e._isUseOriginColor=!1,e._isScaleByLifetime=!1,e._is2d=!0,e._isFadeIn=!1,e._isFadeOut=!1,e._playOnEnable=!0,e._blendMode=0,e._onColorChanged=e._onColorChanged.bind(_e(e)),e._color._onValueChanged=e._onColorChanged,e.setMaterial(e._createMaterial()),e}var a=i.prototype;return a.update=function(e){if(!(!this._isInit||!this._isStart)){if(this._isOnce&&this._time>this._onceTime)return this.stop();this._updateDirtyFlag&&(this._updateBuffer(),this._updateDirtyFlag=0),this._time+=e/1e3,this.shaderData.setFloat("u_time",this._time)}},a._onEnable=function(){n.prototype._onEnable.call(this),this._playOnEnable&&this.start()},a.start=function(){this._isStart=!0,this._time=0},a.stop=function(){this._isStart=!1},a._createMaterial=function(){var e=new Dr(this.engine,B.find("particle-shader")),r=e.renderState,o=r.blendState.targetBlendState;return o.enabled=!0,o.sourceColorBlendFactor=oe.SourceAlpha,o.destinationColorBlendFactor=oe.OneMinusSourceAlpha,o.sourceAlphaBlendFactor=oe.One,o.destinationAlphaBlendFactor=oe.OneMinusSourceAlpha,r.depthState.writeEnabled=!1,e.renderState.renderQueueType=Ot.Transparent,this.isUseOriginColor=!0,this.is2d=!0,this.isFadeOut=!0,e},a._createMesh=function(){var e=new Lu(this._entity.engine,"particleMesh"),r=96,o=this._maxCount*4,s=o*r,l=new Float32Array(s),u=null,c=!1;if(o>i._uint16VertexLimit)if(this.engine._hardwareRenderer.canIUse(Z.elementIndexUint))c=!0,u=new Uint32Array(6*this._maxCount);else throw Error("The vertex count is over limit.");else u=new Uint16Array(6*this._maxCount);for(var d=0,_=0;d<this._maxCount;++d){var h=d*4;u[_++]=h,u[_++]=h+1,u[_++]=h+2,u[_++]=h,u[_++]=h+2,u[_++]=h+3}var f=[new ke("a_position",0,re.Vector3,0),new ke("a_velocity",12,re.Vector3,0),new ke("a_acceleration",24,re.Vector3,0),new ke("a_color",36,re.Vector4,0),new ke("a_lifeAndSize",52,re.Vector4,0),new ke("a_rotation",68,re.Vector2,0),new ke("a_uv",76,re.Vector3,0),new ke("a_normalizedUv",88,re.Vector2,0)],g=new ir(this.engine,Pn.VertexBuffer,s*4,mt.Dynamic),y=new ir(this.engine,Pn.IndexBuffer,u,mt.Dynamic);return e.setVertexBufferBinding(g,r),e.setIndexBufferBinding(y,c?pt.UInt32:pt.UInt16),e.setVertexElements(f),e.addSubMesh(0,u.length),this._vertexBuffer=g,this._vertexStride=r/4,this._vertices=l,e},a._updateBuffer=function(){for(var e=0;e<this._maxCount;e++)this._updateSingleBuffer(e);this._vertexBuffer.setData(this._vertices)},a._updateSingleBuffer=function(e){var r=this,o=r._updateDirtyFlag,s=r._vertices,l=r._vertexStride,u=i._getRandom,c=e*4,d=c*l,_=(c+1)*l,h=(c+2)*l,f=(c+3)*l;if(o&1){var g=this._position,y=g.x,p=g.y,v=g.z,m=this,x=m._positionArray,S=m._positionRandomness;if(x){if(x.length!==this._maxCount)throw Error("The length of positionArray must be equal to maxCount.");var C=x[e];y+=C.x,p+=C.y,v+=C.z}else y+=u()*S.x,p+=u()*S.y,v+=u()*S.z;s[d]=s[_]=s[h]=s[f]=y,s[d+1]=s[_+1]=s[h+1]=s[f+1]=p,s[d+2]=s[_+2]=s[h+2]=s[f+2]=v}if(o&2){var A=this,T=A._velocity,E=A._velocityRandomness;s[d+3]=s[_+3]=s[h+3]=s[f+3]=T.x+u()*E.x,s[d+4]=s[_+4]=s[h+4]=s[f+4]=T.y+u()*E.y,s[d+5]=s[_+5]=s[h+5]=s[f+5]=T.z+u()*E.z}if(o&4){var P=this,b=P._acceleration,M=P._accelerationRandomness;s[d+6]=s[_+6]=s[h+6]=s[f+6]=b.x+u()*M.x,s[d+7]=s[_+7]=s[h+7]=s[f+7]=b.y+u()*M.y,s[d+8]=s[_+8]=s[h+8]=s[f+8]=b.z+u()*M.z}if(o&8){var F=this,I=F._color,L=F._colorRandomness;s[d+9]=s[_+9]=s[h+9]=s[f+9]=H.clamp(I.r+u()*L,0,1),s[d+10]=s[_+10]=s[h+10]=s[f+10]=H.clamp(I.g+u()*L,0,1),s[d+11]=s[_+11]=s[h+11]=s[f+11]=H.clamp(I.b+u()*L,0,1)}if(o&16&&(s[d+12]=s[_+12]=s[h+12]=s[f+12]=H.clamp(this._alpha+u()*this._alphaRandomness,0,1)),o&128&&(s[d+13]=s[_+13]=s[h+13]=s[f+13]=Math.random()*this._startTimeRandomness),o&256){var V=this._lifetime;s[d+14]=s[_+14]=s[h+14]=s[f+14]=V+u()*V}if((o&128||o&256)&&(this._onceTime=Math.max(this._onceTime,s[d+13]+s[d+14])),o&32){var U=this._size;s[d+15]=s[_+15]=s[h+15]=s[f+15]=Math.max(U+u()*this._sizeRandomness*U*2,0)}o&1024&&(s[d+16]=s[_+16]=s[h+16]=s[f+16]=this._scale),o&64&&(s[d+17]=s[_+17]=s[h+17]=s[f+17]=this._startAngle+u()*Math.PI*this._startAngleRandomness*2),o&512&&(s[d+18]=s[_+18]=s[h+18]=s[f+18]=this._rotateVelocity+u()*this._rotateVelocityRandomness),this._updateSingleUv(e,d,_,h,f)},a._updateSingleUv=function(e,r,o,s,l){var u=this.spriteSheet,c=this.getMaterial().shaderData.getTexture("u_texture"),d=this._vertices;if(c){var _=c.width,h=c.height;if(u){var f=u[e%u.length],g=f.x,y=f.y,p=f.w,v=f.h,m=g/_,x=y/h,S=m+p/_,C=x+v/h,A=v/p;d[r+19]=m,d[r+20]=C,d[r+21]=A,d[o+19]=S,d[o+20]=C,d[o+21]=A,d[s+19]=S,d[s+20]=x,d[s+21]=A,d[l+19]=m,d[l+20]=x,d[l+21]=A}else{var T=h/_;d[r+19]=0,d[r+20]=1,d[r+21]=T,d[o+19]=1,d[o+20]=1,d[o+21]=T,d[s+19]=1,d[s+20]=0,d[s+21]=T,d[l+19]=0,d[l+20]=0,d[l+21]=T}}else d[r+19]=0,d[r+20]=0,d[r+21]=1,d[o+19]=1,d[o+20]=0,d[o+21]=1,d[s+19]=1,d[s+20]=1,d[s+21]=1,d[l+19]=0,d[l+20]=1,d[l+21]=1;d[r+22]=-.5,d[r+23]=-.5,d[o+22]=.5,d[o+23]=-.5,d[s+22]=.5,d[s+23]=.5,d[l+22]=-.5,d[l+23]=.5},a._onColorChanged=function(){this._updateDirtyFlag|=8},i._getRandom=function(){return Math.random()-.5},K(i,[{key:"texture",get:function(){return this.getMaterial().shaderData.getTexture("u_texture")},set:function(e){e?(this.shaderData.enableMacro("particleTexture"),this.getMaterial().shaderData.setTexture("u_texture",e)):this.shaderData.disableMacro("particleTexture")}},{key:"position",get:function(){return this._position},set:function(e){this._updateDirtyFlag|=1,this._position=e}},{key:"positionRandomness",get:function(){return this._positionRandomness},set:function(e){this._updateDirtyFlag|=1,this._positionRandomness=e}},{key:"positionArray",get:function(){return this._positionArray},set:function(e){this._updateDirtyFlag|=1,this._positionArray=e}},{key:"velocity",get:function(){return this._velocity},set:function(e){this._updateDirtyFlag|=2,this._velocity=e}},{key:"velocityRandomness",get:function(){return this._velocityRandomness},set:function(e){this._updateDirtyFlag|=2,this._velocityRandomness=e}},{key:"acceleration",get:function(){return this._acceleration},set:function(e){this._updateDirtyFlag|=4,this._acceleration=e}},{key:"accelerationRandomness",get:function(){return this._accelerationRandomness},set:function(e){this._updateDirtyFlag|=4,this._accelerationRandomness=e}},{key:"color",get:function(){return this._color},set:function(e){this._color.copyFrom(e)}},{key:"colorRandomness",get:function(){return this._colorRandomness},set:function(e){this._updateDirtyFlag|=8,this._colorRandomness=e}},{key:"size",get:function(){return this._size},set:function(e){this._updateDirtyFlag|=32,this._size=e}},{key:"sizeRandomness",get:function(){return this._sizeRandomness},set:function(e){this._updateDirtyFlag|=32,this._sizeRandomness=e}},{key:"alpha",get:function(){return this._alpha},set:function(e){this._updateDirtyFlag|=16,this._alpha=e}},{key:"alphaRandomness",get:function(){return this._alphaRandomness},set:function(e){this._updateDirtyFlag|=16,this._alphaRandomness=e}},{key:"angle",get:function(){return this._startAngle},set:function(e){this._updateDirtyFlag|=64,this._startAngle=e}},{key:"angleRandomness",get:function(){return this._startAngleRandomness},set:function(e){this._updateDirtyFlag|=64,this._startAngleRandomness=e}},{key:"rotateVelocity",get:function(){return this._rotateVelocity},set:function(e){this._updateDirtyFlag|=512,this._rotateVelocity=e}},{key:"rotateVelocityRandomness",get:function(){return this._rotateVelocityRandomness},set:function(e){this._updateDirtyFlag|=512,this._rotateVelocityRandomness=e}},{key:"lifetime",get:function(){return this._lifetime},set:function(e){this._updateDirtyFlag|=256,this._lifetime=e,this._onceTime=0}},{key:"startTimeRandomness",get:function(){return this._startTimeRandomness},set:function(e){this._updateDirtyFlag|=128,this._startTimeRandomness=e,this._onceTime=0}},{key:"scale",get:function(){return this._scale},set:function(e){this._updateDirtyFlag|=1024,this._scale=e}},{key:"maxCount",get:function(){return this._maxCount},set:function(e){this._isStart=!1,this._isInit=!1,this._maxCount=e,this._updateDirtyFlag=4294967295,this.mesh=this._createMesh(),this._updateBuffer(),this._isInit=!0,this.shaderData.setFloat("u_time",0)}},{key:"isOnce",get:function(){return this._isOnce},set:function(e){this._time=0,this.shaderData.setInt("u_once",e?1:0),this._isOnce=e}},{key:"isRotateToVelocity",get:function(){return this._isRotateToVelocity},set:function(e){e?this.shaderData.enableMacro("rotateToVelocity"):this.shaderData.disableMacro("rotateToVelocity"),this._isRotateToVelocity=e}},{key:"isUseOriginColor",get:function(){return this._isUseOriginColor},set:function(e){e?this.shaderData.enableMacro("useOriginColor"):this.shaderData.disableMacro("useOriginColor"),this._isUseOriginColor=e}},{key:"isScaleByLifetime",get:function(){return this._isScaleByLifetime},set:function(e){e?this.shaderData.enableMacro("isScaleByLifetime"):this.shaderData.disableMacro("isScaleByLifetime"),this._isScaleByLifetime=e}},{key:"is2d",get:function(){return this._is2d},set:function(e){e?this.shaderData.enableMacro("is2d"):(this.shaderData.disableMacro("is2d"),this.getMaterial().renderState.rasterState.cullMode=kt.Off),this._is2d=e}},{key:"isFadeIn",get:function(){return this._isFadeIn},set:function(e){e?this.shaderData.enableMacro("fadeIn"):this.shaderData.disableMacro("fadeIn"),this._isFadeIn=e}},{key:"isFadeOut",get:function(){return this._isFadeOut},set:function(e){e?this.shaderData.enableMacro("fadeOut"):this.shaderData.disableMacro("fadeOut"),this._isFadeOut=e}},{key:"playOnEnable",get:function(){return this._playOnEnable},set:function(e){this._playOnEnable=e,e?this.start():this.stop()}},{key:"blendMode",get:function(){return this._blendMode},set:function(e){var r=this.getMaterial().renderState.blendState,o=r.targetBlendState;e===0?(o.enabled=!0,o.sourceColorBlendFactor=oe.SourceAlpha,o.destinationColorBlendFactor=oe.OneMinusSourceAlpha,o.sourceAlphaBlendFactor=oe.One,o.destinationAlphaBlendFactor=oe.OneMinusSourceAlpha):e===1&&(o.enabled=!0,o.sourceColorBlendFactor=oe.SourceAlpha,o.destinationColorBlendFactor=oe.One,o.sourceAlphaBlendFactor=oe.One,o.destinationAlphaBlendFactor=oe.OneMinusSourceAlpha),this._blendMode=e}}]),i}(et);Nu._uint16VertexLimit=65535;O([Y],Nu.prototype,"_onColorChanged",null);var pS=`#define GLSLIFY 1
varying vec2 v_uv;uniform sampler2D u_texture;void main(void){gl_FragColor=texture2D(u_texture,v_uv);}`,gS=`#define GLSLIFY 1
attribute vec3 POSITION;attribute vec2 TEXCOORD_0;varying vec2 v_uv;uniform mat4 u_projMat;uniform mat4 u_viewMat;void main(){gl_Position=u_projMat*u_viewMat*vec4(POSITION,1.0);v_uv=TEXCOORD_0;}`;B.create("trail",gS,pS);var N0=function(n){Q(i,n);function i(a){var t;t=n.call(this,a,B.find("trail"))||this;var e=t.renderState.blendState.targetBlendState;return e.enabled=!0,e.sourceColorBlendFactor=e.sourceAlphaBlendFactor=oe.SourceAlpha,e.destinationColorBlendFactor=e.destinationAlphaBlendFactor=oe.One,t.renderState.depthState.writeEnabled=!1,t}return i}(Dr),If=new w,mS=function(n){Q(i,n);function i(t,e){var r;r=n.call(this,t)||this,r._stroke=e.stroke||.2,r._minSeg=e.minSeg||.02,r._lifetime=e.lifetime||1e3,r._maxPointNum=r._lifetime/1e3*t.engine.targetFrameRate,r._points=[],r._pointStates=[],r._strapPoints=[];for(var o=0;o<r._maxPointNum;o++)r._points.push(new w),r._pointStates.push(r._lifetime),r._strapPoints.push(new w),r._strapPoints.push(new w);r._curPointNum=0;var s=e.material||new N0(r.engine);return r.setMaterial(s),r.setTexture(e.texture),r._initGeometry(),r}var a=i.prototype;return a.update=function(e){for(var r=0,o=0,s=0;s<this._curPointNum;s++)this._pointStates[s]-=e,this._pointStates[s]<0?r++:r>0&&(o=s-r,this._pointStates[o]=this._pointStates[s],this._points[o].copyFrom(this._points[s]));this._curPointNum-=r;var l=!0;if(this._curPointNum===this._maxPointNum)l=!1;else if(this._curPointNum>0){var u=this._points[this._points.length-1];w.distance(this.entity.transform.worldPosition,u)<this._minSeg&&(l=!1)}l&&(this._pointStates[this._curPointNum]=this._lifetime,this._points[this._curPointNum].copyFrom(this.entity.transform.worldPosition),this._curPointNum++)},a.setTexture=function(e){e&&this.getMaterial().shaderData.setTexture("u_texture",e)},a._render=function(e){this._updateStrapVertices(e.camera,this._points),this._updateStrapCoords(),this._vertexBuffer.setData(this._vertices),n.prototype._render.call(this,e)},a._initGeometry=function(){var e=new Lu(this._entity.engine),r=20,o=this._maxPointNum*2,s=o*r,l=new Float32Array(s),u=[new ke("POSITION",0,re.Vector3,0),new ke("TEXCOORD_0",12,re.Vector2,0)],c=new ir(this.engine,s*4,mt.Dynamic);e.setVertexBufferBinding(c,r),e.setVertexElements(u),e.addSubMesh(0,o,Ti.TriangleStrip),this._vertexBuffer=c,this._vertexStride=r,this._vertices=l,this.mesh=e},a._updateStrapVertices=function(e,r){var o=e.viewMatrix,s=o.elements,l=new w(s[0],s[4],s[8]),u=new w(s[1],s[5],s[9]),c=new w(s[2],s[6],s[10]),d=this._stroke;u.scale(d);var _=new w,h=new w,f=new ve;w.transformByQuat(l,f,l),w.transformByQuat(u,f,u);var g=new w,y=new w,p=new w;l.normalize();for(var v=this._vertices,m=0;m<this._maxPointNum;m++){if(m<this._curPointNum){var x=r[m];m===this._curPointNum-1&&m!==0?w.subtract(x,r[m-1],p):w.subtract(r[m+1],x,p),this._projectOnPlane(p,c,p),p.normalize();var S=Math.acos(w.dot(l,p));w.cross(l,p,y),w.dot(y,c)<=0&&(S=Math.PI*2-S),ve.rotationAxisAngle(c,S,f),w.transformByQuat(u,f,g),w.add(x,g,_),w.subtract(x,g,h)}var C=m*2*this._vertexStride/4,A=(m*2+1)*this._vertexStride/4;v[C]=_.x,v[C+1]=_.y,v[C+2]=_.z,v[A]=h.x,v[A+1]=h.y,v[A+2]=h.z}},a._updateStrapCoords=function(){if(this._prePointsNum!==this._curPointNum){this._prePointsNum=this._curPointNum;for(var e=this._curPointNum,r=1/e,o=this._vertices,s=0;s<e;s++){var l=1-s*r,u=s*2*this._vertexStride/4,c=(s*2+1)*this._vertexStride/4;o[u]=0,o[u+1]=l,o[c]=1,o[c+1]=l}}},a._projectOnVector=function(e,r,o){var s=r.clone();w.normalize(s,s);var l=w.dot(e,s);o.x=s.x*l,o.y=s.y*l,o.z=s.z*l},a._projectOnPlane=function(e,r,o){this._projectOnVector(e,r,If),w.subtract(e,If,o)},i}(et),V0=function(n){Q(i,n);function i(){var t;return t=n.apply(this,arguments)||this,t.probeLayer=Ut.Everything,t.width=1024,t.height=1024,t.antiAliasing=1,t._isCube=!1,t}var a=i.prototype;return a.onTextureChange=function(e){},a.onBeginRender=function(e){this.enabled&&(this._camera=e,this._oriCameraCullingMask=e.cullingMask,e.cullingMask=this.probeLayer,(!this._activeRenderTarget||this._activeRenderTarget.width!==this.width||this._activeRenderTarget.height!==this.height||this._activeRenderTarget.antiAliasing!==this.antiAliasing)&&(this._renderTarget=new Ka(this.engine,this.width,this.height,this._isCube?new yn(this.engine,this.width):new dn(this.engine,this.width,this.height),At.Depth,this.antiAliasing),this._renderTargetSwap=new Ka(this.engine,this.width,this.height,this._isCube?new yn(this.engine,this.width):new dn(this.engine,this.width,this.height),At.Depth,this.antiAliasing),this._activeRenderTarget=this._renderTarget),this._oriCameraRenderTarget=e.renderTarget,e.renderTarget=this._activeRenderTarget)},a.onEndRender=function(e){this.enabled&&(this.onTextureChange&&this.onTextureChange(this._texture),this._activeRenderTarget=this._activeRenderTarget===this._renderTarget?this._renderTargetSwap:this._renderTarget)},a._reset=function(){this.enabled&&(this._camera.renderTarget=this._oriCameraRenderTarget,this._camera.cullingMask=this._oriCameraCullingMask)},K(i,[{key:"_texture",get:function(){var e;return(e=this._activeRenderTarget)==null?void 0:e.getColorTexture()}}]),i}(Ft),Lf=new w,Bi=new w,Ii=new w,yS=function(n){Q(i,n);function i(){var t;return t=n.apply(this,arguments)||this,t.position=new w(0,0,0),t._isCube=!0,t.oriViewMatrix=new J,t}var a=i.prototype;return a.onBeginRender=function(e){if(this.enabled){n.prototype.onBeginRender.call(this,e),this._storeCamera(e);for(var r=0;r<6;r++)this._setCamera(r,e),e.render(an.PositiveX+r);this._restoreCamera(e),n.prototype._reset.call(this)}},a._storeCamera=function(e){this.oriViewMatrix.copyFrom(e.viewMatrix),this._oriFieldOfView=e.fieldOfView},a._restoreCamera=function(e){e.viewMatrix.copyFrom(this.oriViewMatrix),e.fieldOfView=this._oriFieldOfView},a._setCamera=function(e,r){switch(e){case 0:Bi.set(0,-1,0),Ii.set(1,0,0);break;case 1:Bi.set(0,-1,0),Ii.set(-1,0,0);break;case 2:Bi.set(0,0,1),Ii.set(0,1,0);break;case 3:Bi.set(0,0,-1),Ii.set(0,-1,0);break;case 4:Bi.set(0,-1,0),Ii.set(0,0,1);break;case 5:Bi.set(0,-1,0),Ii.set(0,0,-1);break}w.add(this.position,Ii,Lf),J.lookAt(this.position,Lf,Bi,r.viewMatrix),r.fieldOfView=90},i}(V0);const zf=Object.freeze(Object.defineProperty({__proto__:null,AmbientLight:Xn,get AnimationArrayCurve(){return au},get AnimationBoolCurve(){return Sd},AnimationClip:j_,AnimationClipCurveBinding:z0,get AnimationColorCurve(){return ou},AnimationCurve:Sr,AnimationEvent:X_,get AnimationFloatArrayCurve(){return xs},get AnimationFloatCurve(){return su},get AnimationQuaternionCurve(){return io},get AnimationVector2Curve(){return lu},get AnimationVector3Curve(){return ws},get AnimationVector4Curve(){return uu},Animator:sr,get AnimatorConditionMode(){return Ad},AnimatorController:q_,AnimatorControllerLayer:Q_,get AnimatorCullingMode(){return Ss},get AnimatorLayerBlendingMode(){return Cs},AnimatorState:O0,AnimatorStateMachine:$_,AnimatorStateTransition:Y_,AssetPromise:Ae,get AssetType(){return Xe},Background:R0,get BackgroundMode(){return Cn},get BackgroundTextureFillMode(){return ci},BaseMaterial:xt,BasicRenderPipeline:Ou,get BlendFactor(){return oe},get BlendMode(){return Xi},get BlendOperation(){return xn},BlendShape:G_,BlendShapeFrame:M0,BlinnPhongMaterial:uo,BoolUpdateFlag:Ru,BoxColliderShape:w0,Buffer:ir,get BufferBindFlag(){return Pn},BufferMesh:Lu,get BufferUsage(){return mt},BufferUtil:gs,get Camera(){return Pe},get CameraClearFlags(){return Kt},CapsuleColliderShape:C0,CharacterController:tx,CloneManager:Gn,get Collider(){return Tn},ColliderShape:lo,get ColliderShapeUpAxis(){return $i},get CollisionDetectionMode(){return yd},get ColorSpace(){return xi},get ColorWriteMask(){return Zn},get CompareFunction(){return ye},Component:vn,get ControllerCollisionFlag(){return md},get ControllerNonWalkableMode(){return Zl},CubeProbe:yS,get CullMode(){return kt},get DataType(){return qe},get DiffuseMode(){return ro},DirectLight:xr,DynamicCollider:ux,get DynamicColliderConstraints(){return xd},Engine:Hr,EngineObject:ar,Entity:Fr,Event:pd,EventDispatcher:p0,FixedJoint:rx,get FogMode(){return ru},Font:ia,get FontStyle(){return di},get GLCapabilityType(){return Z},HingeJoint:ix,HitResult:y0,IndexBufferBinding:eu,get IndexFormat(){return pt},InputManager:A0,get InterpolationType(){return Tt},get Joint(){return Za},JointLimits:ox,JointMotor:sx,Keyframe:In,get Keys(){return Me},get Layer(){return Ut},Light:Pt,Loader:Oe,Logger:we,Material:Dr,Mesh:H_,MeshRenderElement:E0,MeshRenderer:et,get MeshTopology(){return Ti},ModelMesh:Et,ObjectValues:gd,get OverflowMode(){return oa},PBRBaseMaterial:jn,PBRMaterial:co,PBRSpecularMaterial:ca,ParticleRenderer:Nu,get ParticleRendererBlendMode(){return Td},PhysicsManager:Rn,PhysicsMaterial:x0,get PhysicsMaterialCombineMode(){return ps},PlaneColliderShape:nx,get Platform(){return On},PointLight:wr,Pointer:m0,get PointerButton(){return qt},get PointerPhase(){return St},PrimitiveMesh:to,Probe:V0,RefObject:Xr,get RenderBufferDepthFormat(){return At},get RenderFace(){return Ir},RenderPass:Io,RenderQueue:br,get RenderQueueType(){return Ot},RenderTarget:Ka,get Renderer(){return me},ResourceManager:Ds,Scene:Is,SceneManager:F0,Script:Ft,get SetDataOptions(){return ms},Shader:B,ShaderData:Bs,ShaderFactory:Vi,ShaderPass:Bu,ShaderProperty:N_,get ShaderPropertyType(){return Xt},get ShadowCascadesMode(){return Bn},get ShadowResolution(){return ui},get ShadowType(){return kr},Skin:b0,SkinnedMeshRenderer:ut,Sky:no,SkyBoxMaterial:K_,SphereColliderShape:S0,SpotLight:_n,SpringJoint:ax,Sprite:W_,SpriteAtlas:I0,get SpriteDrawMode(){return oi},SpriteElement:P0,SpriteMask:hn,get SpriteMaskInteraction(){return Un},get SpriteMaskLayer(){return eo},SpriteRenderer:en,StateMachineScript:Cd,StaticCollider:lx,get StencilOperation(){return Je},SubMesh:k_,SystemInfo:Ji,get TextHorizontalAlignment(){return ji},TextRenderer:Ye,get TextVerticalAlignment(){return Yi},Texture:yr,Texture2D:dn,Texture2DArray:O_,get TextureCoordinate(){return Si},TextureCube:yn,get TextureCubeFace(){return an},get TextureDepthCompareFunction(){return Dn},get TextureFilterMode(){return $t},get TextureFormat(){return j},get TextureWrapMode(){return Vt},Time:g0,TrailMaterial:N0,TrailRenderer:mS,Transform:fe,UnlitMaterial:aa,Util:Tl,VertexBufferBinding:ys,VertexElement:ke,get VertexElementFormat(){return re},get WrapMode(){return As},assignmentClone:Be,deepClone:je,dependentComponents:ua,ignoreClone:Y,request:wi,resourceLoader:lt,shallowClone:v0},Symbol.toStringTag,{value:"Module"}));function Of(n,i){for(var a=0;a<i.length;a++){var t=i[a];t.enumerable=t.enumerable||!1,t.configurable=!0,"value"in t&&(t.writable=!0),Object.defineProperty(n,t.key,t)}}function xS(n,i,a){return i&&Of(n.prototype,i),a&&Of(n,a),n}var wS=function(){function n(a,t){var e=this;this._costs={},this._currentLoad=0,this._callbacks={},this._worker=new Worker(a),this._worker.onmessage=function(r){var o=r.data;switch(o.type){case"decode":e._callbacks[o.id].resolve(o.geometry);break;case"error":e._callbacks[o.id].reject(o);break;default:we.error('DRACOWorker: Unexpected message, "'+o.type+'"')}},t?this._worker.postMessage({type:"init",decoderConfig:{wasmBinary:t}}):this._worker.postMessage({type:"init",decoderConfig:{}})}var i=n.prototype;return i.setCosts=function(t,e){this._costs[t]=e},i.addCurrentLoad=function(t){this._currentLoad+=t},i.setCallback=function(t,e,r){this._callbacks[t]={resolve:e,reject:r}},i.decode=function(t,e,r){this._worker.postMessage({type:"decode",id:t,taskConfig:e,buffer:r},[r])},i.releaseTask=function(t){this._currentLoad-=this._costs[t],delete this._callbacks[t],delete this._costs[t]},xS(n,[{key:"currentLoad",get:function(){return this._currentLoad}}]),n}(),Nf=`let decoderPending;
let decoderConfig;

onmessage = function(e) {
  const message = e.data;

  switch (message.type) {
    case "init":
      decoderConfig = message.decoderConfig;
      decoderPending = new Promise(function(resolve /*, reject*/) {
        decoderConfig.onModuleLoaded = function(draco) {
          // Module is Promise-like. Wrap before resolving to avoid loop.
          resolve({ draco: draco });
        };
        DracoDecoderModule(decoderConfig);
      });
      break;

    case "decode":
      const buffer = message.buffer;
      const taskConfig = message.taskConfig;
      decoderPending.then(module => {
        const draco = module.draco;
        const decoder = new draco.Decoder();
        const decoderBuffer = new draco.DecoderBuffer();
        decoderBuffer.Init(new Int8Array(buffer), buffer.byteLength);
        try {
          const geometry = decodeGeometry(draco, decoder, decoderBuffer, taskConfig);
          const buffers = geometry.attributes.map(attr => attr.array.buffer);
          if (geometry.index) buffers.push(geometry.index.array.buffer);
          self.postMessage({ type: "decode", id: message.id, geometry }, buffers);
        } catch (error) {
          console.error(error);
          self.postMessage({ type: "error", id: message.id, error: error.message });
        } finally {
          draco.destroy(decoderBuffer);
          draco.destroy(decoder);
        }
      });
      break;
  }
};

function decodeGeometry(draco, decoder, decoderBuffer, taskConfig) {
  const attributeIDs = taskConfig.attributeIDs;
  const attributeTypes = taskConfig.attributeTypes;

  let dracoGeometry;
  let decodingStatus;

  const geometryType = decoder.GetEncodedGeometryType(decoderBuffer);
  if (geometryType === draco.TRIANGULAR_MESH) {
    dracoGeometry = new draco.Mesh();
    decodingStatus = decoder.DecodeBufferToMesh(decoderBuffer, dracoGeometry);
  } else {
    throw new Error("DRACODecoder worker: Unexpected geometry type.");
  }

  if (!decodingStatus.ok() || dracoGeometry.ptr === 0) {
    throw new Error("DRACODecoder worker: Decoding failed: " + decodingStatus.error_msg());
  }

  const geometry = { index: null, attributes: [] };

  // Gather all vertex attributes.
  for (let attributeName in attributeIDs) {
    const attributeType = self[attributeTypes[attributeName]];

    let attribute;
    let attributeID;

    // A Draco file may be created with default vertex attributes, whose attribute IDs
    // are mapped 1:1 from their semantic name (POSITION, NORMAL, ...). Alternatively,
    // a Draco file may contain a custom set of attributes, identified by known unique
    // IDs. glTF files always do the latter, and .drc files typically do the former.
    if (taskConfig.useUniqueIDs) {
      attributeID = attributeIDs[attributeName];
      attribute = decoder.GetAttributeByUniqueId(dracoGeometry, attributeID);
    } else {
      attributeID = decoder.GetAttributeId(dracoGeometry, draco[attributeIDs[attributeName]]);
      if (attributeID === -1) continue;
      attribute = decoder.GetAttribute(dracoGeometry, attributeID);
    }
    geometry.attributes.push(decodeAttribute(draco, decoder, dracoGeometry, attributeName, attributeType, attribute));
  }
  // Add index.
  if (geometryType === draco.TRIANGULAR_MESH) {
    // Generate mesh faces.
    const numFaces = dracoGeometry.num_faces();
    const numIndices = numFaces * 3;
    let dataSize;
    let ptr;
    let index;
    const indexType = self[taskConfig.indexType];

    switch (indexType) {
      case Uint16Array:
        dataSize = numIndices * 2;
        ptr = draco._malloc(dataSize);
        decoder.GetTrianglesUInt16Array(dracoGeometry, dataSize, ptr);
        index = new Uint16Array(draco.HEAPU16.buffer, ptr, numIndices).slice();
        draco._free(ptr);
        break;
      case Uint32Array:
        dataSize = numIndices * 4;
        ptr = draco._malloc(dataSize);
        decoder.GetTrianglesUInt32Array(dracoGeometry, dataSize, ptr);
        index = new Uint32Array(draco.HEAPU32.buffer, ptr, numIndices).slice();
        draco._free(ptr);
        break;
      default:
        throw new Error("DRACODecoder: Unexpected index type.");
    }
    geometry.index = { array: index, itemSize: 1 };
  }
  draco.destroy(dracoGeometry);
  return geometry;
}

function decodeAttribute(draco, decoder, dracoGeometry, attributeName, attributeType, attribute) {
  const numComponents = attribute.num_components();
  const numPoints = dracoGeometry.num_points();
  const numValues = numPoints * numComponents;
  let ptr;
  let array;
  let dataSize;
  switch (attributeType) {
    case Float32Array:
      dataSize = numValues * 4;
      ptr = draco._malloc(dataSize);
      decoder.GetAttributeDataArrayForAllPoints(dracoGeometry, attribute, draco.DT_FLOAT32, dataSize, ptr);
      array = new Float32Array(draco.HEAPF32.buffer, ptr, numValues).slice();
      draco._free(ptr);
      break;

    case Int8Array:
      ptr = draco._malloc(numValues);
      decoder.GetAttributeDataArrayForAllPoints(dracoGeometry, attribute, draco.DT_INT8, numValues, ptr);
      array = new Int8Array(draco.HEAP8.buffer, ptr, numValues).slice();
      draco._free(ptr);
      break;

    case Int16Array:
      dataSize = numValues * 2;
      ptr = draco._malloc(dataSize);
      decoder.GetAttributeDataArrayForAllPoints(dracoGeometry, attribute, draco.DT_INT16, dataSize, ptr);
      array = new Int16Array(draco.HEAP16.buffer, ptr, numValues).slice();
      draco._free(ptr);
      break;

    case Int32Array:
      dataSize = numValues * 4;
      ptr = draco._malloc(dataSize);
      decoder.GetAttributeDataArrayForAllPoints(dracoGeometry, attribute, draco.DT_INT32, dataSize, ptr);
      array = new Int32Array(draco.HEAP32.buffer, ptr, numValues).slice();
      draco._free(ptr);
      break;

    case Uint8Array:
      ptr = draco._malloc(numValues);
      decoder.GetAttributeDataArrayForAllPoints(dracoGeometry, attribute, draco.DT_UINT8, numValues, ptr);
      array = new Uint8Array(draco.HEAPU8.buffer, ptr, numValues).slice();
      draco._free(ptr);
      break;

    case Uint16Array:
      dataSize = numValues * 2;
      ptr = draco._malloc(dataSize);
      decoder.GetAttributeDataArrayForAllPoints(dracoGeometry, attribute, draco.DT_UINT16, dataSize, ptr);
      array = new Uint16Array(draco.HEAPU16.buffer, ptr, numValues).slice();
      draco._free(ptr);
      break;

    case Uint32Array:
      dataSize = numValues * 4;
      ptr = draco._malloc(dataSize);
      decoder.GetAttributeDataArrayForAllPoints(dracoGeometry, attribute, draco.DT_UINT32, dataSize, ptr);
      array = new Uint32Array(draco.HEAPU32.buffer, ptr, numValues).slice();
      draco._free(ptr);
      break;

    default:
      throw new Error("DRACODecoder: Unexpected attribute type.");
  }

  return {
    name: attributeName,
    array: array,
    itemSize: numComponents
  };
}
`,fc="https://gw.alipayobjects.com/os/lib/alipay/draco-javascript/1.3.6/lib/",SS="draco_decoder_gltf.js",CS="draco_decoder_gltf.r3bin",AS="draco_wasm_wrapper_gltf.js",TS=function(){function n(a){if(a===void 0&&(a={type:"wasm",workerLimit:4}),this.pool=[],this.workerLimit=Math.min(navigator.hardwareConcurrency||4,4),this.currentTaskId=1,this.taskCache=new WeakMap,a.workerLimit>this.workerLimit)we.warn("DRACOWorkerPool: Can not initialize worker pool with limit:"+a.workerLimit);else{var t;this.workerLimit=(t=a.workerLimit)!=null?t:4}this.useJS=typeof WebAssembly!="object"||a.type==="js",this.loadLibPromise=this.preloadLib()}var i=n.prototype;return i.preloadLib=function(){var t=this;return this.loadLibPromise?this.loadLibPromise:new Promise(function(e,r){t.useJS?wi(""+fc+SS,{type:"text"}).then(function(o){var s=[o,Nf].join(`
`),l=URL.createObjectURL(new Blob([s]));e({workerSourceURL:l,decoderWASMBinary:null})}).catch(function(o){r(o)}):Promise.all([wi(""+fc+AS,{type:"text"}),wi(""+fc+CS,{type:"arraybuffer"})]).then(function(o){var s=o[0],l=o[1],u=[s,Nf].join(`
`),c=URL.createObjectURL(new Blob([u]));e({workerSourceURL:c,decoderWASMBinary:l})}).catch(function(o){r(o)})})},i.getWorker=function(){var t=this;return this.preloadLib().then(function(e){if(t.pool.length<t.workerLimit){var r=new wS(e.workerSourceURL,e.decoderWASMBinary);t.pool.push(r)}else t.pool.sort(function(o,s){return o.currentLoad>s.currentLoad?-1:1});return t.pool[t.pool.length-1]})},i.decode=function(t,e){var r=this,o=JSON.stringify(e);if(this.taskCache.has(t)){var s=this.taskCache.get(t);if(s.key===o)return s.promise;if(t.byteLength===0)throw new Error("DRACODecoder: Unable to re-decode a buffer with different settings. Buffer has already been transferred.")}var l=this.currentTaskId++,u=t.byteLength,c,d=new Promise(function(_,h){r.getWorker().then(function(f){c=f,f.setCosts(l,u),f.addCurrentLoad(u),f.setCallback(l,_,h),f.decode(l,e,t)}).catch(function(f){h(f)})});return d.finally(function(){c&&l&&c.releaseTask(l)}),this.taskCache.set(t,{key:o,promise:d}),d},n}(),se;(function(n){n[n.RGBA_ASTC_4X4_KHR=37808]="RGBA_ASTC_4X4_KHR",n[n.RGBA_ASTC_5X4_KHR=37809]="RGBA_ASTC_5X4_KHR",n[n.RGBA_ASTC_5X5_KHR=37810]="RGBA_ASTC_5X5_KHR",n[n.RGBA_ASTC_6X5_KHR=37811]="RGBA_ASTC_6X5_KHR",n[n.RGBA_ASTC_6X6_KHR=37812]="RGBA_ASTC_6X6_KHR",n[n.RGBA_ASTC_8X5_KHR=37813]="RGBA_ASTC_8X5_KHR",n[n.RGBA_ASTC_8X6_KHR=37814]="RGBA_ASTC_8X6_KHR",n[n.RGBA_ASTC_8X8_KHR=37815]="RGBA_ASTC_8X8_KHR",n[n.RGBA_ASTC_10X5_KHR=37816]="RGBA_ASTC_10X5_KHR",n[n.RGBA_ASTC_10X6_KHR=37817]="RGBA_ASTC_10X6_KHR",n[n.RGBA_ASTC_10X8_KHR=37818]="RGBA_ASTC_10X8_KHR",n[n.RGBA_ASTC_10X10_KHR=37819]="RGBA_ASTC_10X10_KHR",n[n.RGBA_ASTC_12X10_KHR=37820]="RGBA_ASTC_12X10_KHR",n[n.RGBA_ASTC_12X12_KHR=37821]="RGBA_ASTC_12X12_KHR",n[n.SRGB8_ALPHA8_ASTC_4X4_KHR=37840]="SRGB8_ALPHA8_ASTC_4X4_KHR",n[n.SRGB8_ALPHA8_ASTC_5X4_KHR=37841]="SRGB8_ALPHA8_ASTC_5X4_KHR",n[n.SRGB8_ALPHA8_ASTC_5X5_KHR=37842]="SRGB8_ALPHA8_ASTC_5X5_KHR",n[n.SRGB8_ALPHA8_ASTC_6X5_KHR=37843]="SRGB8_ALPHA8_ASTC_6X5_KHR",n[n.SRGB8_ALPHA8_ASTC_6X6_KHR=37844]="SRGB8_ALPHA8_ASTC_6X6_KHR",n[n.SRGB8_ALPHA8_ASTC_8X5_KHR=37845]="SRGB8_ALPHA8_ASTC_8X5_KHR",n[n.SRGB8_ALPHA8_ASTC_8X6_KHR=37846]="SRGB8_ALPHA8_ASTC_8X6_KHR",n[n.SRGB8_ALPHA8_ASTC_8X8_KHR=37847]="SRGB8_ALPHA8_ASTC_8X8_KHR",n[n.SRGB8_ALPHA8_ASTC_10X5_KHR=37848]="SRGB8_ALPHA8_ASTC_10X5_KHR",n[n.SRGB8_ALPHA8_ASTC_10X6_KHR=37849]="SRGB8_ALPHA8_ASTC_10X6_KHR",n[n.SRGB8_ALPHA8_ASTC_10X8_KHR=37850]="SRGB8_ALPHA8_ASTC_10X8_KHR",n[n.SRGB8_ALPHA8_ASTC_10X10_KHR=37851]="SRGB8_ALPHA8_ASTC_10X10_KHR",n[n.SRGB8_ALPHA8_ASTC_12X10_KHR=37852]="SRGB8_ALPHA8_ASTC_12X10_KHR",n[n.SRGB8_ALPHA8_ASTC_12X12_KHR=37853]="SRGB8_ALPHA8_ASTC_12X12_KHR",n[n.RGB_ETC1_WEBGL=36196]="RGB_ETC1_WEBGL",n[n.R11_EAC=37488]="R11_EAC",n[n.SIGNED_R11_EAC=37489]="SIGNED_R11_EAC",n[n.RG11_EAC=37490]="RG11_EAC",n[n.SIGNED_RG11_EAC=37491]="SIGNED_RG11_EAC",n[n.RGB8_ETC2=37492]="RGB8_ETC2",n[n.SRGB8_ETC2=37493]="SRGB8_ETC2",n[n.RGB8_PUNCHTHROUGH_ALPHA1_ETC2=37494]="RGB8_PUNCHTHROUGH_ALPHA1_ETC2",n[n.SRGB8_PUNCHTHROUGH_ALPHA1_ETC2=37495]="SRGB8_PUNCHTHROUGH_ALPHA1_ETC2",n[n.RGBA8_ETC2_EAC=37496]="RGBA8_ETC2_EAC",n[n.SRGB8_ALPHA8_ETC2_EAC=37497]="SRGB8_ALPHA8_ETC2_EAC",n[n.RGB_PVRTC_4BPPV1_IMG=35840]="RGB_PVRTC_4BPPV1_IMG",n[n.RGB_PVRTC_2BPPV1_IMG=35841]="RGB_PVRTC_2BPPV1_IMG",n[n.RGBA_PVRTC_4BPPV1_IMG=35842]="RGBA_PVRTC_4BPPV1_IMG",n[n.RGBA_PVRTC_2BPPV1_IMG=35843]="RGBA_PVRTC_2BPPV1_IMG",n[n.RGB_S3TC_DXT1_EXT=33776]="RGB_S3TC_DXT1_EXT",n[n.RGBA_S3TC_DXT1_EXT=33777]="RGBA_S3TC_DXT1_EXT",n[n.RGBA_S3TC_DXT3_EXT=33778]="RGBA_S3TC_DXT3_EXT",n[n.RGBA_S3TC_DXT5_EXT=33779]="RGBA_S3TC_DXT5_EXT"})(se||(se={}));function Vf(n,i){for(var a=0;a<i.length;a++){var t=i[a];t.enumerable=t.enumerable||!1,t.configurable=!0,"value"in t&&(t.writable=!0),Object.defineProperty(n,t.key,t)}}function Ls(n,i,a){return i&&Vf(n.prototype,i),a&&Vf(n,a),n}function mn(n,i){return i!=null&&typeof Symbol<"u"&&i[Symbol.hasInstance]?!!i[Symbol.hasInstance](n):n instanceof i}var ES=function(){function n(a){this._scale=new W;var t=a.width,e=a.height;this._webCanvas=a,this._width=t,this._height=e}var i=n.prototype;return i.resizeByClientSize=function(t){t===void 0&&(t=window.devicePixelRatio);var e=this._webCanvas;(typeof OffscreenCanvas>"u"||!mn(e,OffscreenCanvas))&&(this.width=e.clientWidth*t,this.height=e.clientHeight*t)},i.setScale=function(t,e){this._scale.set(t,e),this.scale=this._scale},Ls(n,[{key:"width",get:function(){return this._width},set:function(t){this._width!==t&&(this._webCanvas.width=t,this._width=t)}},{key:"height",get:function(){return this._height},set:function(t){this._height!==t&&(this._webCanvas.height=t,this._height=t)}},{key:"scale",get:function(){var t=this._webCanvas;return(typeof OffscreenCanvas>"u"||!mn(t,OffscreenCanvas))&&this._scale.set(t.clientWidth*devicePixelRatio/t.width,t.clientHeight*devicePixelRatio/t.height),this._scale},set:function(t){var e=this._webCanvas;(typeof OffscreenCanvas>"u"||!mn(e,OffscreenCanvas))&&(e.style.transformOrigin="left top",e.style.transform="scale("+t.x+", "+t.y+")")}}]),n}();function Ed(n,i){return Ed=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t},Ed(n,i)}function PS(n,i){return Ed(n,i)}function Vu(n,i){if(typeof i!="function"&&i!==null)throw new TypeError("Super expression must either be null or a function");n.prototype=Object.create(i&&i.prototype,{constructor:{value:n,writable:!0,configurable:!0}}),i&&PS(n,i)}function Pd(){return Pd=Object.assign||function(n){for(var i=1;i<arguments.length;i++){var a=arguments[i];for(var t in a)Object.prototype.hasOwnProperty.call(a,t)&&(n[t]=a[t])}return n},Pd.apply(this,arguments)}function U0(){return Pd.apply(this,arguments)}var bS=function(){function n(a){this._rhi=a,this.capabilityList=new Map,this._init(),this._compatibleAllInterface()}var i=n.prototype;return i.canIUse=function(t){return this.capabilityList.get(t)},i.canIUseCompressedTextureInternalFormat=function(t){var e=se.RGBA_ASTC_4X4_KHR,r=se.RGBA_ASTC_12X12_KHR,o=se.SRGB8_ALPHA8_ASTC_4X4_KHR,s=se.SRGB8_ALPHA8_ASTC_12X12_KHR,l=se.RGB_ETC1_WEBGL,u=se.R11_EAC,c=se.SRGB8_ALPHA8_ETC2_EAC,d=se.RGB_PVRTC_4BPPV1_IMG,_=se.RGBA_PVRTC_2BPPV1_IMG,h=se.RGB_S3TC_DXT1_EXT,f=se.RGBA_S3TC_DXT5_EXT;return t>=e&&r<=r||t>=o&&t<=s?this.canIUse(Z.astc):t===l?this.canIUse(Z.etc1):t>=u&&t<=c?this.canIUse(Z.etc):t>=d&&t<=_?this.canIUse(Z.pvrtc):t>=h&&t<=f?this.canIUse(Z.s3tc):!1},i._init=function(){var t=this.capabilityList,e=this.rhi.isWebGL2,r=this.rhi.requireExtension.bind(this.rhi),o=Z.shaderVertexID,s=Z.standardDerivatives,l=Z.shaderTextureLod,u=Z.elementIndexUint,c=Z.depthTexture,d=Z.vertexArrayObject,_=Z.instancedArrays,h=Z.multipleSample,f=Z.drawBuffers,g=Z.astc,y=Z.astc_webkit,p=Z.etc,v=Z.etc_webkit,m=Z.etc1,x=Z.etc1_webkit,S=Z.pvrtc,C=Z.pvrtc_webkit,A=Z.s3tc,T=Z.s3tc_webkit,E=Z.textureFloat,P=Z.textureHalfFloat,b=Z.textureFloatLinear,M=Z.textureHalfFloatLinear,F=Z.WEBGL_colorBufferFloat,I=Z.colorBufferFloat,L=Z.colorBufferHalfFloat,V=Z.textureFilterAnisotropic;t.set(o,e),t.set(s,e||!!r(s)),t.set(l,e||!!r(l)),t.set(u,e||!!r(u)),t.set(c,e||!!r(c)),t.set(d,e||!!r(d)),t.set(_,e||!!r(_)),t.set(h,e),t.set(f,e||!!r(f)),t.set(E,e||!!r(E)),t.set(P,e||!!r(P)),t.set(b,!!r(b)),t.set(M,e||!!r(M)),t.set(I,e&&!!r(I)||!!r(F)),t.set(L,e&&!!r(I)||!!r(L)),t.set(V,!!r(V)),t.set(g,!!(r(g)||r(y))),t.set(p,!!(r(p)||r(v))),t.set(m,!!(r(m)||r(x))),t.set(S,!!(r(S)||r(C))),t.set(A,!!(r(A)||r(T)))},i._compatibleInterface=function(t,e){var r=this.rhi,o=r.gl,s=null;if(s=r.requireExtension(t))for(var l in e){var u=e[l],c=s[u];c!=null&&c.bind?o[l]=c.bind(s):o[l]=c}},i._compatibleAllInterface=function(){var t=Z.depthTexture,e=Z.vertexArrayObject,r=Z.instancedArrays,o=Z.drawBuffers,s=Z.textureFilterAnisotropic,l=Z.textureHalfFloat,u=Z.colorBufferHalfFloat,c=Z.WEBGL_colorBufferFloat,d=this.rhi.isWebGL2;if(!d){this._compatibleInterface(t,{UNSIGNED_INT_24_8:"UNSIGNED_INT_24_8_WEBGL"}),this._compatibleInterface(e,{createVertexArray:"createVertexArrayOES",deleteVertexArray:"deleteVertexArrayOES",isVertexArray:"isVertexArrayOES",bindVertexArray:"bindVertexArrayOES"}),this._compatibleInterface(r,{drawArraysInstanced:"drawArraysInstancedANGLE",drawElementsInstanced:"drawElementsInstancedANGLE",vertexAttribDivisor:"vertexAttribDivisorANGLE"}),this._compatibleInterface(o,{MAX_DRAW_BUFFERS:"MAX_DRAW_BUFFERS_WEBGL"});var _={};if(this.canIUse(Z.drawBuffers)){for(var h=this.maxDrawBuffers,f=0;f<h;f++)f!=0&&(_["COLOR_ATTACHMENT"+f]="COLOR_ATTACHMENT"+f+"_WEBGL"),_["DRAW_BUFFER"+f]="DRAW_BUFFER"+f+"_WEBGL";this._compatibleInterface(o,U0({drawBuffers:"drawBuffersWEBGL"},_))}this._compatibleInterface(l,{HALF_FLOAT:"HALF_FLOAT_OES"}),this._compatibleInterface(u,{RGBA16F:"RBGA16F_EXT"}),this._compatibleInterface(c,{RGBA32F:"RBGA32F_EXT"})}this._compatibleInterface(s,{TEXTURE_MAX_ANISOTROPY_EXT:"TEXTURE_MAX_ANISOTROPY_EXT"})},Ls(n,[{key:"maxTextureSize",get:function(){return this.rhi.renderStates.getParameter(this.rhi.gl.MAX_TEXTURE_SIZE)}},{key:"canUseFloatTextureBlendShape",get:function(){return this.canIUse(Z.shaderVertexID)&&this.canIUse(Z.textureFloat)&&this.rhi.renderStates.getParameter(this.rhi.gl.MAX_VERTEX_TEXTURE_IMAGE_UNITS)>0}},{key:"canIUseMoreJoints",get:function(){return this.canIUse(Z.textureFloat)&&this.rhi.renderStates.getParameter(this.rhi.gl.MAX_VERTEX_TEXTURE_IMAGE_UNITS)>0}},{key:"maxDrawBuffers",get:function(){return this._maxDrawBuffers||(this.canIUse(Z.drawBuffers)?this._maxDrawBuffers=this._rhi.gl.getParameter(this._rhi.gl.MAX_DRAW_BUFFERS):this._maxDrawBuffers=1),this._maxDrawBuffers}},{key:"maxAnisoLevel",get:function(){if(!this._maxAnisoLevel){var t=this._rhi.requireExtension(Z.textureFilterAnisotropic);this._maxAnisoLevel=t?this._rhi.gl.getParameter(t.MAX_TEXTURE_MAX_ANISOTROPY_EXT):1}return this._maxAnisoLevel}},{key:"maxAntiAliasing",get:function(){if(!this._maxAntiAliasing){var t=this._rhi.gl,e=this.canIUse(Z.multipleSample);this._maxAntiAliasing=e?t.getParameter(t.MAX_SAMPLES):1}return this._maxAntiAliasing}},{key:"rhi",get:function(){return this._rhi}}]),n}(),MS=function(){function n(a){this.rhi=a,this._requireResult={}}var i=n.prototype;return i.requireExtension=function(t){return this._requireResult[t]!==void 0?this._requireResult[t]:(this._requireResult[t]=this.rhi.gl.getExtension(t),this._requireResult[t])},n}(),RS=function(){function n(a,t){this.attribLocArray=[],this.vao=new Map,this._primitive=t,this.canUseInstancedArrays=a.canIUse(Z.instancedArrays),this._useVao=a.canIUse(Z.vertexArrayObject),this.gl=a.gl}var i=n.prototype;return i.draw=function(t,e){var r=this.gl,o=this._primitive,s=this._useVao&&o._enableVAO;if(s){this.vao.has(t.id)||this.registerVAO(t);var l=this.vao.get(t.id);r.bindVertexArray(l)}else this.bindBufferAndAttrib(t);var u=o._indexBufferBinding,c=o._instanceCount,d=o._glIndexType,_=o._glIndexByteCount,h=e.topology,f=e.start,g=e.count;if(c)if(this.canUseInstancedArrays)if(u)if(this._useVao)r.drawElementsInstanced(h,g,d,f*_,c);else{var p=u.buffer._nativeBuffer;r.bindBuffer(r.ELEMENT_ARRAY_BUFFER,p),r.drawElementsInstanced(h,g,d,f*_,c),r.bindBuffer(r.ELEMENT_ARRAY_BUFFER,null)}else r.drawArraysInstanced(h,f,g,c);else we.error("ANGLE_instanced_arrays extension is not supported");else if(u)if(s)r.drawElements(h,g,d,f*_);else{var y=u.buffer._nativeBuffer;r.bindBuffer(r.ELEMENT_ARRAY_BUFFER,y),r.drawElements(h,g,d,f*_),r.bindBuffer(r.ELEMENT_ARRAY_BUFFER,null)}else r.drawArrays(h,f,g);this._useVao?r.bindVertexArray(null):this.disableAttrib()},i.destroy=function(){if(this._useVao){var t=this.gl;this.vao.forEach(function(e){t.deleteVertexArray(e)}),this.vao.clear()}},i.bindBufferAndAttrib=function(t){var e=this.gl,r=this._primitive,o=r._vertexBufferBindings;this.attribLocArray.length=0;var s=t.attributeLocation,l=r._vertexElementMap,u,c;for(var d in s){var _=s[d];if(_!==-1){var h=l[d];if(h){var f=o[h.bindingIndex],g=f.buffer,y=f.stride;u=g._nativeBuffer,c!==u&&(c=u,e.bindBuffer(e.ARRAY_BUFFER,u)),e.enableVertexAttribArray(_);var p=h._glElementInfo;e.vertexAttribPointer(_,p.size,p.type,p.normalized,y,h.offset),this.canUseInstancedArrays&&e.vertexAttribDivisor(_,h.instanceStepRate),this.attribLocArray.push(_)}else we.warn("vertex attribute not found: "+d)}}e.bindBuffer(e.ARRAY_BUFFER,null)},i.disableAttrib=function(){for(var t=this.gl,e=0,r=this.attribLocArray.length;e<r;e++)t.disableVertexAttribArray(this.attribLocArray[e])},i.registerVAO=function(t){var e=this.gl,r=e.createVertexArray();e.bindVertexArray(r);var o=this._primitive._indexBufferBinding;o&&e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,o.buffer._nativeBuffer),this.bindBufferAndAttrib(t),e.bindVertexArray(null),e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,null),this.disableAttrib(),this.vao.set(t.id,r)},n}(),FS=function(){function n(a){this._parameters={},this._gl=a,this._parameters={},this._parameters[a.MAX_COMBINED_TEXTURE_IMAGE_UNITS]=a.getParameter(a.MAX_COMBINED_TEXTURE_IMAGE_UNITS),this._parameters[a.MAX_VERTEX_UNIFORM_VECTORS]=a.getParameter(a.MAX_VERTEX_UNIFORM_VECTORS),this._parameters[a.MAX_VERTEX_ATTRIBS]=a.getParameter(a.MAX_VERTEX_ATTRIBS),this._parameters[a.MAX_VERTEX_TEXTURE_IMAGE_UNITS]=a.getParameter(a.MAX_VERTEX_TEXTURE_IMAGE_UNITS),this._parameters[a.MAX_TEXTURE_SIZE]=a.getParameter(a.MAX_TEXTURE_SIZE),a.blendFuncSeparate(a.ONE,a.ZERO,a.ONE,a.ZERO),a.blendEquationSeparate(a.FUNC_ADD,a.FUNC_ADD),a.colorMask(!0,!0,!0,!0),a.blendColor(0,0,0,0),a.disable(a.SAMPLE_ALPHA_TO_COVERAGE),a.enable(a.DEPTH_TEST),a.depthFunc(a.LESS),a.depthMask(!0),a.disable(a.STENCIL_TEST),a.stencilFuncSeparate(a.FRONT,a.ALWAYS,0,255),a.stencilFuncSeparate(a.BACK,a.ALWAYS,0,255),a.stencilOpSeparate(a.FRONT,a.KEEP,a.KEEP,a.KEEP),a.stencilOpSeparate(a.BACK,a.KEEP,a.KEEP,a.KEEP),a.stencilMask(255),a.enable(a.CULL_FACE),a.cullFace(a.BACK),a.disable(a.POLYGON_OFFSET_FILL),a.polygonOffset(0,0)}var i=n.prototype;return i.getParameter=function(t){return this._parameters[t]},n}(),bt=function(){function n(a,t,e){this._texture=t,this._rhi=a,this._gl=a.gl,this._isWebGL2=a.isWebGL2,this._target=e,this._glTexture=this._gl.createTexture()}var i=n.prototype;return i.destroy=function(){this._gl.deleteTexture(this._glTexture),this._texture=null,this._glTexture=null,this._formatDetail=null},i.setUseDepthCompareMode=function(t){var e=this._gl;e.texParameteri(this._target,e.TEXTURE_COMPARE_MODE,t?e.COMPARE_REF_TO_TEXTURE:e.NONE)},i.generateMipmaps=function(){(this._texture.width!==1||this._texture.height!==1)&&(this._bind(),this._gl.generateMipmap(this._target))},i._bind=function(){this._rhi.bindTexture(this)},i._init=function(t){var e=this._gl,r=this._isWebGL2,o=this._formatDetail,s=o.internalFormat,l=o.baseFormat,u=o.dataType,c=this._texture,d=c.mipmapCount,_=c.width,h=c.height,f=c._isDepthTexture;if(this._bind(),r&&!(l===e.LUMINANCE_ALPHA||l===e.ALPHA))e.texStorage2D(this._target,d,s,_,h);else if(t)for(var v=0;v<d;v++)for(var m=Math.max(1,_>>v),x=0;x<6;x++)e.texImage2D(e.TEXTURE_CUBE_MAP_POSITIVE_X+x,v,s,m,m,0,l,u,null);else if(f)e.texImage2D(this._target,0,s,_,h,0,l,u,null);else for(var g=0;g<d;g++){var y=Math.max(1,_>>g),p=Math.max(1,h>>g);e.texImage2D(this._target,g,s,y,p,0,l,u,null)}},i._getPixelBuffer=function(t,e,r,o,s,l,u){var c=this._gl,d=this._formatDetail,_=d.baseFormat,h=d.dataType;c.bindFramebuffer(c.FRAMEBUFFER,this._getReadFrameBuffer()),l>0&&!this._isWebGL2&&(l=0,we.error("mipLevel only take effect in WebGL2.0")),t!=null?c.framebufferTexture2D(c.FRAMEBUFFER,c.COLOR_ATTACHMENT0,c.TEXTURE_CUBE_MAP_POSITIVE_X+t,this._glTexture,l):c.framebufferTexture2D(c.FRAMEBUFFER,c.COLOR_ATTACHMENT0,c.TEXTURE_2D,this._glTexture,l),c.readPixels(e,r,o,s,_,h,u),c.bindFramebuffer(c.FRAMEBUFFER,null)},i._setWrapMode=function(t,e){var r=this._gl,o=this._isWebGL2,s=this._target,l=this._texture,u=l.width,c=l.height;switch(!o&&t!==Vt.Clamp&&(!n._isPowerOf2(u)||!n._isPowerOf2(c))&&(we.warn("non-power-2 texture is not supported for REPEAT or MIRRORED_REPEAT in WebGL1,and has automatically downgraded to CLAMP_TO_EDGE"),t=Vt.Clamp),t){case Vt.Clamp:r.texParameteri(s,e,r.CLAMP_TO_EDGE);break;case Vt.Repeat:r.texParameteri(s,e,r.REPEAT);break;case Vt.Mirror:r.texParameteri(s,e,r.MIRRORED_REPEAT);break}},i._getReadFrameBuffer=function(){var t=this._rhi._readFrameBuffer;return t||(this._rhi._readFrameBuffer=t=this._gl.createFramebuffer()),t},n._isPowerOf2=function(t){return(t&t-1)===0},n._getFormatDetail=function(t,e,r){switch(t){case j.R8G8B8:return{internalFormat:r?e.RGB8:e.RGB,baseFormat:e.RGB,dataType:e.UNSIGNED_BYTE,isCompressed:!1};case j.R8G8B8A8:return{internalFormat:r?e.RGBA8:e.RGBA,baseFormat:e.RGBA,dataType:e.UNSIGNED_BYTE,isCompressed:!1};case j.R4G4B4A4:return{internalFormat:r?e.RGBA4:e.RGBA,baseFormat:e.RGBA,dataType:e.UNSIGNED_SHORT_4_4_4_4,isCompressed:!1};case j.R5G5B5A1:return{internalFormat:r?e.RGB5_A1:e.RGBA,baseFormat:e.RGBA,dataType:e.UNSIGNED_SHORT_5_5_5_1,isCompressed:!1};case j.R5G6B5:return{internalFormat:r?e.RGB565:e.RGB,baseFormat:e.RGB,dataType:e.UNSIGNED_SHORT_5_6_5,isCompressed:!1};case j.Alpha8:return{internalFormat:e.ALPHA,baseFormat:e.ALPHA,dataType:e.UNSIGNED_BYTE,isCompressed:!1};case j.LuminanceAlpha:return{internalFormat:e.LUMINANCE_ALPHA,baseFormat:e.LUMINANCE_ALPHA,dataType:e.UNSIGNED_BYTE,isCompressed:!1};case j.R16G16B16A16:return{internalFormat:r?e.RGBA16F:e.RGBA,baseFormat:e.RGBA,dataType:e.HALF_FLOAT,isCompressed:!1};case j.R32G32B32A32:return{internalFormat:r?e.RGBA32F:e.RGBA,baseFormat:e.RGBA,dataType:e.FLOAT,isCompressed:!1};case j.DXT1:return{internalFormat:se.RGB_S3TC_DXT1_EXT,isCompressed:!0};case j.DXT5:return{internalFormat:se.RGBA_S3TC_DXT5_EXT,isCompressed:!0};case j.ETC1_RGB:return{internalFormat:se.RGB_ETC1_WEBGL,isCompressed:!0};case j.ETC2_RGB:return{internalFormat:se.RGB8_ETC2,isCompressed:!0};case j.ETC2_RGBA5:return{internalFormat:se.RGB8_PUNCHTHROUGH_ALPHA1_ETC2,isCompressed:!0};case j.ETC2_RGBA8:return{internalFormat:se.RGBA8_ETC2_EAC,isCompressed:!0};case j.PVRTC_RGB2:return{internalFormat:se.RGB_PVRTC_2BPPV1_IMG,isCompressed:!0};case j.PVRTC_RGBA2:return{internalFormat:se.RGBA_PVRTC_2BPPV1_IMG,isCompressed:!0};case j.PVRTC_RGB4:return{internalFormat:se.RGB_PVRTC_4BPPV1_IMG,isCompressed:!0};case j.PVRTC_RGBA4:return{internalFormat:se.RGBA_PVRTC_4BPPV1_IMG,isCompressed:!0};case j.ASTC_4x4:return{internalFormat:se.RGBA_ASTC_4X4_KHR,isCompressed:!0};case j.ASTC_5x5:return{internalFormat:se.RGBA_ASTC_5X5_KHR,isCompressed:!0};case j.ASTC_6x6:return{internalFormat:se.RGBA_ASTC_6X6_KHR,isCompressed:!0};case j.ASTC_8x8:return{internalFormat:se.RGBA_ASTC_8X8_KHR,isCompressed:!0};case j.ASTC_10x10:return{internalFormat:se.RGBA_ASTC_10X10_KHR,isCompressed:!0};case j.ASTC_12x12:return{internalFormat:se.RGBA_ASTC_12X12_KHR,isCompressed:!0};case j.Depth:return{internalFormat:r?e.DEPTH_COMPONENT32F:e.DEPTH_COMPONENT,baseFormat:e.DEPTH_COMPONENT,dataType:r?e.FLOAT:e.UNSIGNED_SHORT,isCompressed:!1,attachment:e.DEPTH_ATTACHMENT};case j.DepthStencil:return{internalFormat:r?e.DEPTH32F_STENCIL8:e.DEPTH_STENCIL,baseFormat:e.DEPTH_STENCIL,dataType:r?e.FLOAT_32_UNSIGNED_INT_24_8_REV:e.UNSIGNED_INT_24_8,isCompressed:!1,attachment:e.DEPTH_STENCIL_ATTACHMENT};case j.Depth16:return{internalFormat:r?e.DEPTH_COMPONENT16:e.DEPTH_COMPONENT,baseFormat:e.DEPTH_COMPONENT,dataType:e.UNSIGNED_SHORT,isCompressed:!1,attachment:e.DEPTH_ATTACHMENT};case j.Depth24Stencil8:return{internalFormat:r?e.DEPTH24_STENCIL8:e.DEPTH_STENCIL,baseFormat:e.DEPTH_STENCIL,dataType:e.UNSIGNED_INT_24_8,isCompressed:!1,attachment:e.DEPTH_STENCIL_ATTACHMENT};case j.Depth24:return{internalFormat:e.DEPTH_COMPONENT24,baseFormat:e.DEPTH_COMPONENT,dataType:e.UNSIGNED_INT,isCompressed:!1,attachment:e.DEPTH_ATTACHMENT};case j.Depth32:return{internalFormat:e.DEPTH_COMPONENT32F,baseFormat:e.DEPTH_COMPONENT,dataType:e.FLOAT,isCompressed:!1,attachment:e.DEPTH_ATTACHMENT};case j.Depth32Stencil8:return{internalFormat:e.DEPTH32F_STENCIL8,baseFormat:e.DEPTH_STENCIL,dataType:e.FLOAT_32_UNSIGNED_INT_24_8_REV,isCompressed:!1,attachment:e.DEPTH_STENCIL_ATTACHMENT};default:throw new Error("this TextureFormat is not supported in Oasis Engine: "+t)}},n._getRenderBufferDepthFormatDetail=function(t,e,r){switch(t){case At.Depth:return{internalFormat:r?e.DEPTH_COMPONENT32F:e.DEPTH_COMPONENT16,baseFormat:e.DEPTH_COMPONENT,dataType:r?e.FLOAT:e.UNSIGNED_SHORT,isCompressed:!1,attachment:e.DEPTH_ATTACHMENT};case At.DepthStencil:return{internalFormat:r?e.DEPTH32F_STENCIL8:e.DEPTH_STENCIL,baseFormat:e.DEPTH_STENCIL,dataType:r?e.FLOAT_32_UNSIGNED_INT_24_8_REV:e.UNSIGNED_INT_24_8,isCompressed:!1,attachment:e.DEPTH_STENCIL_ATTACHMENT};case At.Stencil:return{internalFormat:e.STENCIL_INDEX8,baseFormat:e.STENCIL_ATTACHMENT,dataType:e.UNSIGNED_BYTE,isCompressed:!1,attachment:e.STENCIL_ATTACHMENT};case At.Depth16:return{internalFormat:e.DEPTH_COMPONENT16,baseFormat:e.DEPTH_COMPONENT,dataType:e.UNSIGNED_SHORT,isCompressed:!1,attachment:e.DEPTH_ATTACHMENT};case At.Depth24Stencil8:return{internalFormat:r?e.DEPTH24_STENCIL8:e.DEPTH_STENCIL,baseFormat:e.DEPTH_STENCIL,dataType:e.UNSIGNED_INT_24_8,isCompressed:!1,attachment:e.DEPTH_STENCIL_ATTACHMENT};case At.Depth24:return{internalFormat:e.DEPTH_COMPONENT24,baseFormat:e.DEPTH_COMPONENT,dataType:e.UNSIGNED_INT,isCompressed:!1,attachment:e.DEPTH_ATTACHMENT};case At.Depth32:return{internalFormat:e.DEPTH_COMPONENT32F,baseFormat:e.DEPTH_COMPONENT,dataType:e.FLOAT,isCompressed:!1,attachment:e.DEPTH_ATTACHMENT};case At.Depth32Stencil8:return{internalFormat:e.DEPTH32F_STENCIL8,baseFormat:e.DEPTH_STENCIL,dataType:e.FLOAT_32_UNSIGNED_INT_24_8_REV,isCompressed:!1,attachment:e.DEPTH_STENCIL_ATTACHMENT};default:throw new Error("this TextureFormat is not supported in Oasis Engine: "+t)}},n._supportTextureFormat=function(t,e){switch(t){case j.R16G16B16A16:if(!e.canIUse(Z.textureHalfFloat))return!1;break;case j.R32G32B32A32:if(!e.canIUse(Z.textureFloat))return!1;break;case j.Depth16:case j.Depth24Stencil8:case j.Depth:case j.DepthStencil:if(!e.canIUse(Z.depthTexture))return!1;break;case j.Depth24:case j.Depth32:case j.Depth32Stencil8:return e.isWebGL2}return!0},n._supportRenderBufferColorFormat=function(t,e){var r=!0;switch(t){case j.R16G16B16A16:(!e.canIUse(Z.colorBufferHalfFloat)||!e.canIUse(Z.textureHalfFloat))&&(r=!1);break;case j.R32G32B32A32:(!e.canIUse(Z.colorBufferFloat)||!e.canIUse(Z.textureFloat))&&(r=!1);break}return r},n._supportRenderBufferDepthFormat=function(t,e){if(!e.isWebGL2)switch(t){case At.Depth24:case At.Depth32:case At.Depth32Stencil8:return!1}return!0},Ls(n,[{key:"wrapModeU",set:function(t){this._bind(),this._setWrapMode(t,this._gl.TEXTURE_WRAP_S)}},{key:"wrapModeV",set:function(t){this._bind(),this._setWrapMode(t,this._gl.TEXTURE_WRAP_T)}},{key:"filterMode",set:function(t){var e=this._gl,r=this._target,o=this._texture._mipmap;switch(this._bind(),t){case $t.Point:e.texParameteri(r,e.TEXTURE_MAG_FILTER,e.NEAREST),e.texParameteri(r,e.TEXTURE_MIN_FILTER,o?e.NEAREST_MIPMAP_NEAREST:e.NEAREST);break;case $t.Bilinear:e.texParameteri(r,e.TEXTURE_MAG_FILTER,e.LINEAR),e.texParameteri(r,e.TEXTURE_MIN_FILTER,o?e.LINEAR_MIPMAP_NEAREST:e.LINEAR);break;case $t.Trilinear:e.texParameteri(r,e.TEXTURE_MAG_FILTER,e.LINEAR),e.texParameteri(r,e.TEXTURE_MIN_FILTER,o?e.LINEAR_MIPMAP_LINEAR:e.LINEAR);break}}},{key:"anisoLevel",set:function(t){var e=this._gl;this._bind(),e.texParameterf(this._target,e.TEXTURE_MAX_ANISOTROPY_EXT,t)}},{key:"depthCompareFunction",set:function(t){this._bind();var e=this._gl;switch(t){case Dn.Never:e.texParameteri(this._target,e.TEXTURE_COMPARE_FUNC,e.NEVER);break;case Dn.Less:e.texParameteri(this._target,e.TEXTURE_COMPARE_FUNC,e.LESS);break;case Dn.Equal:e.texParameteri(this._target,e.TEXTURE_COMPARE_FUNC,e.EQUAL);break;case Dn.LessEqual:e.texParameteri(this._target,e.TEXTURE_COMPARE_FUNC,e.LEQUAL);break;case Dn.Greater:e.texParameteri(this._target,e.TEXTURE_COMPARE_FUNC,e.GREATER);break;case Dn.NotEqual:e.texParameteri(this._target,e.TEXTURE_COMPARE_FUNC,e.NOTEQUAL);break;case Dn.GreaterEqual:e.texParameteri(this._target,e.TEXTURE_COMPARE_FUNC,e.GEQUAL);break;case Dn.Always:e.texParameteri(this._target,e.TEXTURE_COMPARE_FUNC,e.ALWAYS);break}}}]),n}(),DS=function(){function n(a,t){this._MSAAColorRenderBuffers=[],this._curMipLevel=0,this._gl=a.gl,this._isWebGL2=a.isWebGL2,this._target=t;for(var e=t._colorTextures,r=t._depth,o=t.width,s=t.height,l=mn(r,yr),u=0,c=e.length;u<c;u++){var d=e[u]._format;if(!bt._supportRenderBufferColorFormat(d,a))throw new Error("TextureFormat is not supported:"+j[d]+" in RenderTarget")}if(!l&&!bt._supportRenderBufferDepthFormat(r,a))throw new Error("TextureFormat is not supported:"+j[r]+" in RenderTarget");if(e.length>1&&!a.canIUse(Z.drawBuffers))throw new Error("MRT is not supported");if(e.some(function(h){return h.width!==o||h.height!==s}))throw new Error("ColorTexture's size must as same as RenderTarget");if(l&&(r.width!==o||r.height!==s))throw new Error("DepthTexture's size must as same as RenderTarget");if(e.length>1&&e.some(function(h){return mn(h,yn)}))throw new Error("MRT+Cube+[,MSAA] is not supported");var _=a.capability.maxAntiAliasing;t.antiAliasing>_&&(we.warn("MSAA antiAliasing exceeds the limit and is automatically downgraded to:"+_),t._antiAliasing=_),this._frameBuffer=this._gl.createFramebuffer(),this._bindMainFBO(),t.antiAliasing>1&&(this._MSAAFrameBuffer=this._gl.createFramebuffer(),this._bindMSAAFBO())}var i=n.prototype;return i.setRenderTargetInfo=function(t,e){var r=this,o=r._gl,s=r._target,l=s.depthTexture,u=s.getColorTexture(0),c=e!==this._curMipLevel;if(o.bindFramebuffer(o.FRAMEBUFFER,this._frameBuffer),u){var d=mn(u,yn);(c||d)&&o.framebufferTexture2D(o.FRAMEBUFFER,o.COLOR_ATTACHMENT0,d?o.TEXTURE_CUBE_MAP_POSITIVE_X+t:o.TEXTURE_2D,u._platformTexture._glTexture,e)}if(l){var _=mn(l,yn);if(c||_){var h=l._platformTexture;o.framebufferTexture2D(o.FRAMEBUFFER,h._formatDetail.attachment,_?o.TEXTURE_CUBE_MAP_POSITIVE_X+t:o.TEXTURE_2D,h._glTexture,e)}}else if(c){var f=bt._getRenderBufferDepthFormatDetail(s._depth,o,this._isWebGL2).internalFormat;o.bindRenderbuffer(o.RENDERBUFFER,this._depthRenderBuffer),o.renderbufferStorage(o.RENDERBUFFER,f,s.width>>e,s.height>>e)}this._curMipLevel=e,this._activeRenderTarget()},i.blitRenderTarget=function(){if(this._MSAAFrameBuffer){var t=this._gl,e=t.COLOR_BUFFER_BIT|(this._target.depthTexture?t.DEPTH_BUFFER_BIT:0),r=this._target,o=r.colorTextureCount,s=r.width,l=r.height;t.bindFramebuffer(t.READ_FRAMEBUFFER,this._MSAAFrameBuffer),t.bindFramebuffer(t.DRAW_FRAMEBUFFER,this._frameBuffer);for(var u=0;u<o;u++){var c=t.COLOR_ATTACHMENT0+u;this._blitDrawBuffers[u]=c,t.readBuffer(c),t.drawBuffers(this._blitDrawBuffers),t.blitFramebuffer(0,0,s,l,0,0,s,l,e,t.NEAREST),this._blitDrawBuffers[u]=t.NONE}t.bindFramebuffer(t.FRAMEBUFFER,null)}},i.destroy=function(){var t=this._gl;this._frameBuffer&&t.deleteFramebuffer(this._frameBuffer),this._depthRenderBuffer&&t.deleteRenderbuffer(this._depthRenderBuffer),this._MSAAFrameBuffer&&t.deleteFramebuffer(this._MSAAFrameBuffer),this._MSAADepthRenderBuffer&&t.deleteRenderbuffer(this._MSAADepthRenderBuffer);for(var e=0;e<this._MSAAColorRenderBuffers.length;e++)t.deleteRenderbuffer(this._MSAAColorRenderBuffers[e]);this._frameBuffer=null,this._depthRenderBuffer=null,this._MSAAFrameBuffer=null,this._MSAAColorRenderBuffers.length=0,this._MSAADepthRenderBuffer=null},i._activeRenderTarget=function(){var t=this._gl;this._MSAAFrameBuffer?t.bindFramebuffer(t.FRAMEBUFFER,this._MSAAFrameBuffer):t.bindFramebuffer(t.FRAMEBUFFER,this._frameBuffer)},i._bindMainFBO=function(){var t=this._gl,e=this._isWebGL2,r=this._target,o=r._depth,s=r.colorTextureCount,l=r.width,u=r.height,c=new Array(s);t.bindFramebuffer(t.FRAMEBUFFER,this._frameBuffer);for(var d=0;d<s;d++){var _=this._target.getColorTexture(d),h=t.COLOR_ATTACHMENT0+d;c[d]=h,mn(_,yn)||t.framebufferTexture2D(t.FRAMEBUFFER,h,t.TEXTURE_2D,_._platformTexture._glTexture,0)}if(s>1&&t.drawBuffers(c),this._oriDrawBuffers=c,o!==null){if(mn(o,yr)&&!mn(o,yn)){var f=o._platformTexture;t.framebufferTexture2D(t.FRAMEBUFFER,f._formatDetail.attachment,t.TEXTURE_2D,f._glTexture,0)}else if(this._target.antiAliasing<=1){var g=bt._getRenderBufferDepthFormatDetail(o,t,e),y=g.internalFormat,p=g.attachment,v=t.createRenderbuffer();this._depthRenderBuffer=v,t.bindRenderbuffer(t.RENDERBUFFER,v),t.renderbufferStorage(t.RENDERBUFFER,y,l,u),t.framebufferRenderbuffer(t.FRAMEBUFFER,p,t.RENDERBUFFER,v)}}t.bindFramebuffer(t.FRAMEBUFFER,null),t.bindRenderbuffer(t.RENDERBUFFER,null)},i._bindMSAAFBO=function(){var t=this._gl,e=this._isWebGL2,r=t.createRenderbuffer(),o=this._target,s=o._depth,l=o.colorTextureCount,u=o.antiAliasing,c=o.width,d=o.height;this._blitDrawBuffers=new Array(l),this._MSAADepthRenderBuffer=r,t.bindFramebuffer(t.FRAMEBUFFER,this._MSAAFrameBuffer);for(var _=0;_<l;_++){var h=t.createRenderbuffer();this._MSAAColorRenderBuffers[_]=h,this._blitDrawBuffers[_]=t.NONE,t.bindRenderbuffer(t.RENDERBUFFER,h),t.renderbufferStorageMultisample(t.RENDERBUFFER,u,this._target.getColorTexture(_)._platformTexture._formatDetail.internalFormat,c,d),t.framebufferRenderbuffer(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0+_,t.RENDERBUFFER,h)}if(t.drawBuffers(this._oriDrawBuffers),s!==null){var f=mn(s,yr)?s._platformTexture._formatDetail:bt._getRenderBufferDepthFormatDetail(s,t,e),g=f.internalFormat,y=f.attachment;t.bindRenderbuffer(t.RENDERBUFFER,r),t.renderbufferStorageMultisample(t.RENDERBUFFER,u,g,c,d),t.framebufferRenderbuffer(t.FRAMEBUFFER,y,t.RENDERBUFFER,r)}this._checkFrameBuffer(),t.bindFramebuffer(t.FRAMEBUFFER,null),t.bindRenderbuffer(t.RENDERBUFFER,null)},i._checkFrameBuffer=function(){var t=this._gl,e=this._isWebGL2,r=t.checkFramebufferStatus(t.FRAMEBUFFER);switch(r){case t.FRAMEBUFFER_INCOMPLETE_ATTACHMENT:throw new Error("The attachment types are mismatched or not all framebuffer attachment points are framebuffer attachment complete");case t.FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT:throw new Error("There is no attachment");case t.FRAMEBUFFER_INCOMPLETE_DIMENSIONS:throw new Error(" Height and width of the attachment are not the same.");case t.FRAMEBUFFER_UNSUPPORTED:throw new Error("The format of the attachment is not supported or if depth and stencil attachments are not the same renderbuffer")}if(e&&r===t.FRAMEBUFFER_INCOMPLETE_MULTISAMPLE)throw new Error("The values of gl.RENDERBUFFER_SAMPLES are different among attached renderbuffers, or are non-zero if the attached images are a mix of renderbuffers and textures.")},n}(),BS=function(n){Vu(i,n);function i(t,e){var r;r=n.call(this,t,e,t.gl.TEXTURE_2D)||this,r._compressedMipFilled=0;var o=e.format,s=e._mipmap,l=e.width,u=e.height,c=r._isWebGL2;if(!bt._supportTextureFormat(o,t))throw new Error("Texture format is not supported:"+j[o]);return s&&!c&&(!bt._isPowerOf2(l)||!bt._isPowerOf2(u))&&(we.warn("non-power-2 texture is not supported for mipmap in WebGL1,and has automatically downgraded to non-mipmap"),e._mipmap=!1,e._mipmapCount=e._getMipmapCount()),r._formatDetail=bt._getFormatDetail(o,r._gl,c),r._formatDetail.isCompressed&&!c||r._init(!1),r}var a=i.prototype;return a.setPixelBuffer=function(e,r,o,s,l,u){r===void 0&&(r=0);var c=this._gl,d=this._isWebGL2,_=this._formatDetail,h=_.internalFormat,f=_.baseFormat,g=_.dataType,y=_.isCompressed,p=Math.max(1,this._texture.width>>r),v=Math.max(1,this._texture.height>>r);if(l=l||p-o,u=u||v-s,this._bind(),c.pixelStorei(c.UNPACK_FLIP_Y_WEBGL,0),c.pixelStorei(c.UNPACK_PREMULTIPLY_ALPHA_WEBGL,0),y){var m=1<<r;d||this._compressedMipFilled&m?c.compressedTexSubImage2D(this._target,r,o,s,l,u,h,e):(c.compressedTexImage2D(this._target,r,h,l,u,0,e),this._compressedMipFilled|=m)}else c.texSubImage2D(this._target,r,o,s,l,u,f,g,e)},a.setImageSource=function(e,r,o,s,l,u){var c=this._gl,d=this._formatDetail,_=d.baseFormat,h=d.dataType;this._bind(),c.pixelStorei(c.UNPACK_FLIP_Y_WEBGL,+o),c.pixelStorei(c.UNPACK_PREMULTIPLY_ALPHA_WEBGL,+s),c.texSubImage2D(this._target,r,l||0,u||0,_,h,e)},a.getPixelBuffer=function(e,r,o,s,l,u){if(this._formatDetail.isCompressed)throw new Error("Unable to read compressed texture");n.prototype._getPixelBuffer.call(this,null,e,r,o,s,l,u)},i}(bt),IS=function(n){Vu(i,n);function i(t,e){var r;r=n.call(this,t,e,t.gl.TEXTURE_2D_ARRAY)||this;var o=e.format,s=e.width,l=e.height,u=e.length,c=e.mipmapCount;if(!r._isWebGL2)throw new Error("Texture2D Array is not supported in WebGL1.0");if(!bt._supportTextureFormat(o,t))throw new Error("Texture format is not supported:"+j[o]);return r._bind(),r._formatDetail=bt._getFormatDetail(o,r._gl,!0),r._gl.texStorage3D(r._target,c,r._formatDetail.internalFormat,s,l,u),r}var a=i.prototype;return a.setPixelBuffer=function(e,r,o,s,l,u,c,d){var _=this,h=_._target,f=_._gl,g=this._formatDetail,y=g.internalFormat,p=g.baseFormat,v=g.dataType,m=g.isCompressed;u=u||Math.max(1,this._texture.width>>o)-s,c=c||Math.max(1,this._texture.height>>o)-l,d=d||this._texture.length,this._bind(),f.pixelStorei(f.UNPACK_FLIP_Y_WEBGL,0),f.pixelStorei(f.UNPACK_PREMULTIPLY_ALPHA_WEBGL,0),m?f.compressedTexSubImage3D(h,o,s,l,e,u,c,d,y,r):f.texSubImage3D(h,o,s,l,e,u,c,d,p,v,r)},a.setImageSource=function(e,r,o,s,l,u,c){var d=this._gl,_=this._formatDetail,h=_.baseFormat,f=_.dataType;this._bind(),d.pixelStorei(d.UNPACK_FLIP_Y_WEBGL,+s),d.pixelStorei(d.UNPACK_PREMULTIPLY_ALPHA_WEBGL,+l),d.texSubImage3D(this._target,o,u,c,e,r.width,r.height,1,h,f,r)},a.getPixelBuffer=function(e,r,o,s,l,u,c){var d=this,_=d._gl,h=d._formatDetail;if(h.isCompressed)throw new Error("Unable to read compressed texture");_.bindFramebuffer(_.FRAMEBUFFER,this._getReadFrameBuffer()),_.framebufferTextureLayer(_.FRAMEBUFFER,_.COLOR_ATTACHMENT0,this._glTexture,u,e),_.readPixels(r,o,s,l,h.baseFormat,h.dataType,c),_.bindFramebuffer(_.FRAMEBUFFER,null)},i}(bt),LS=function(n){Vu(i,n);function i(t,e){var r;r=n.call(this,t,e,t.gl.TEXTURE_CUBE_MAP)||this,r._compressedFaceFilled=[0,0,0,0,0,0];var o=e.format,s=e._mipmap,l=e.width,u=r._isWebGL2;if(!bt._supportTextureFormat(o,t))throw new Error("Texture format is not supported:"+j[o]);return s&&!u&&!bt._isPowerOf2(l)&&(we.warn("non-power-2 texture is not supported for mipmap in WebGL1,and has automatically downgraded to non-mipmap"),e._mipmap=!1,e._mipmapCount=e._getMipmapCount()),r._formatDetail=bt._getFormatDetail(o,r._gl,u),r._formatDetail.isCompressed&&!u||r._init(!0),r}var a=i.prototype;return a.setPixelBuffer=function(e,r,o,s,l,u,c){var d=this._gl,_=this._isWebGL2,h=this._formatDetail,f=h.internalFormat,g=h.baseFormat,y=h.dataType,p=h.isCompressed,v=Math.max(1,this._texture.width>>o);if(u=u||v-s,c=c||v-l,this._bind(),d.pixelStorei(d.UNPACK_FLIP_Y_WEBGL,0),d.pixelStorei(d.UNPACK_PREMULTIPLY_ALPHA_WEBGL,0),p){var m=1<<o;_||this._compressedFaceFilled[e]&m?d.compressedTexSubImage2D(d.TEXTURE_CUBE_MAP_POSITIVE_X+e,o,s,l,u,c,f,r):(d.compressedTexImage2D(d.TEXTURE_CUBE_MAP_POSITIVE_X+e,o,f,u,c,0,r),this._compressedFaceFilled[e]|=m)}else d.texSubImage2D(d.TEXTURE_CUBE_MAP_POSITIVE_X+e,o,s,l,u,c,g,y,r)},a.setImageSource=function(e,r,o,s,l,u,c){var d=this._gl,_=this._formatDetail,h=_.baseFormat,f=_.dataType;this._bind(),d.pixelStorei(d.UNPACK_FLIP_Y_WEBGL,+s),d.pixelStorei(d.UNPACK_PREMULTIPLY_ALPHA_WEBGL,+l),d.texSubImage2D(d.TEXTURE_CUBE_MAP_POSITIVE_X+e,o,u||0,c||0,h,f,r)},a.getPixelBuffer=function(e,r,o,s,l,u,c){if(this._formatDetail.isCompressed)throw new Error("Unable to read compressed texture");n.prototype._getPixelBuffer.call(this,e,r,o,s,l,u,c)},i}(bt),Uf;(function(n){n[n.Auto=0]="Auto",n[n.WebGL2=1]="WebGL2",n[n.WebGL1=2]="WebGL1"})(Uf||(Uf={}));var zS=function(){function n(a){a===void 0&&(a={}),this._enableGlobalDepthBias=!1,this._activeTextures=new Array(32),this._lastViewport=new he(null,null,null,null),this._lastScissor=new he(null,null,null,null),this._lastClearColor=new ne(null,null,null,null),this._scissorEnable=!1;var t=U0({webGLMode:0,alpha:!1,stencil:!0,_forceFlush:!1},a);if(Ji.platform===On.IPhone||Ji.platform===On.IPad){var e=Ji.operatingSystem.match(/(\d+).?(\d+)?.?(\d+)?/);if(e){var r=parseInt(e[1]),o=parseInt(e[2]);r===15&&o>=0&&o<=4&&(t._forceFlush=!0)}}this._options=t}var i=n.prototype;return i.init=function(t){var e=this._options,r=this._webCanvas=t._webCanvas,o=e.webGLMode,s;if((o==0||o==1)&&(s=r.getContext("webgl2",e),!s&&(typeof OffscreenCanvas>"u"||!mn(r,OffscreenCanvas))&&(s=r.getContext("experimental-webgl2",e)),this._isWebGL2=!0,s&&!s.deleteQuery&&(this._isWebGL2=!1)),s||(o==0||o==2)&&(s=r.getContext("webgl",e),!s&&(typeof OffscreenCanvas>"u"||!mn(r,OffscreenCanvas))&&(s=r.getContext("experimental-webgl",e)),this._isWebGL2=!1),!s)throw new Error("Get GL Context FAILED.");this._gl=s,this._activeTextureID=s.TEXTURE0,this._renderStates=new FS(s),this._extensions=new MS(this),this._capability=new bS(this),s.activeTexture(s.TEXTURE0);var l=s.getExtension("WEBGL_debug_renderer_info");l!=null&&(this._renderer=s.getParameter(l.UNMASKED_RENDERER_WEBGL))},i.createPlatformPrimitive=function(t){return new RS(this,t)},i.createPlatformTexture2D=function(t){return new BS(this,t)},i.createPlatformTexture2DArray=function(t){return new IS(this,t)},i.createPlatformTextureCube=function(t){return new LS(this,t)},i.createPlatformRenderTarget=function(t){return new DS(this,t)},i.requireExtension=function(t){return this._extensions.requireExtension(t)},i.canIUse=function(t){return this.capability.canIUse(t)},i.canIUseCompressedTextureInternalFormat=function(t){return this.capability.canIUseCompressedTextureInternalFormat(t)},i.viewport=function(t,e,r,o){var s=this,l=s._gl,u=s._lastViewport;(t!==u.x||e!==u.y||r!==u.z||o!==u.w)&&(l.viewport(t,e,r,o),u.set(t,e,r,o))},i.scissor=function(t,e,r,o){var s=this,l=s._gl,u=s._lastScissor;if(t!==u.x||e!==u.y||r!==u.z||o!==u.w){var c=this,d=c._webCanvas;t===0&&e===0&&r===d.width&&o===d.height?this._scissorEnable&&(l.disable(l.SCISSOR_TEST),this._scissorEnable=!1):(this._scissorEnable||(l.enable(l.SCISSOR_TEST),this._scissorEnable=!0),l.scissor(t,e,r,o)),u.set(t,e,r,o)}},i.colorMask=function(t,e,r,o){this._gl.colorMask(t,e,r,o)},i.clearRenderTarget=function(t,e,r){var o=this._gl,s=t._lastRenderState,l=s.blendState.targetBlendState,u=s.depthState,c=s.stencilState,d=0;if(e&Kt.Color){d|=o.COLOR_BUFFER_BIT;var _=this._lastClearColor,h=r.r,f=r.g,g=r.b,y=r.a;r&&(h!==_.r||f!==_.g||g!==_.b||y!==_.a)&&(o.clearColor(h,f,g,y),_.set(h,f,g,y)),l.colorWriteMask!==Zn.All&&(o.colorMask(!0,!0,!0,!0),l.colorWriteMask=Zn.All)}e&Kt.Depth&&(d|=o.DEPTH_BUFFER_BIT,u.writeEnabled!==!0&&(o.depthMask(!0),u.writeEnabled=!0)),e&Kt.Stencil&&(d|=o.STENCIL_BUFFER_BIT,c.writeMask!==255&&(o.stencilMask(255),c.writeMask=255)),o.clear(d)},i.drawPrimitive=function(t,e,r){t?t._draw(r,e):we.error("draw primitive failed.")},i.activeRenderTarget=function(t,e,r){var o=this._gl;if(t){var s;(s=t._platformRenderTarget)==null||s._activeRenderTarget();var l=t.width>>r,u=t.height>>r;this.viewport(0,0,l,u),this.scissor(0,0,l,u)}else{o.bindFramebuffer(o.FRAMEBUFFER,null);var c=o.drawingBufferWidth,d=o.drawingBufferHeight,_=c*e.z,h=d*e.w,f=e.x*c,g=d-e.y*d-h;this.viewport(f,g,_,h),this.scissor(f,g,_,h)}},i.activeTexture=function(t){this._activeTextureID!==t&&(this._gl.activeTexture(t),this._activeTextureID=t)},i.bindTexture=function(t){var e=this._activeTextureID-this._gl.TEXTURE0;this._activeTextures[e]!==t&&(this._gl.bindTexture(t._target,t._glTexture),this._activeTextures[e]=t)},i.setGlobalDepthBias=function(t,e){var r=this._gl,o=t!==0||e!==0;o?(r.enable(r.POLYGON_OFFSET_FILL),r.polygonOffset(e,t)):r.disable(r.POLYGON_OFFSET_FILL),this._enableGlobalDepthBias=o},i.flush=function(){this._gl.flush()},i.destroy=function(){},Ls(n,[{key:"isWebGL2",get:function(){return this._isWebGL2}},{key:"renderer",get:function(){return this._renderer}},{key:"gl",get:function(){return this._gl}},{key:"renderStates",get:function(){return this._renderStates}},{key:"capability",get:function(){return this._capability}},{key:"canIUseMoreJoints",get:function(){return this.capability.canIUseMoreJoints}}]),n}(),OS=function(n){Vu(i,n);function i(a,t){var e=new ES(typeof a=="string"?document.getElementById(a):a),r=new zS(t);return n.call(this,e,r)}return Ls(i,[{key:"canvas",get:function(){return this._canvas}}]),i}(Hr);function bd(){return bd=Object.assign||function(n){for(var i=1;i<arguments.length;i++){var a=arguments[i];for(var t in a)Object.prototype.hasOwnProperty.call(a,t)&&(n[t]=a[t])}return n},bd.apply(this,arguments)}function Wn(){return bd.apply(this,arguments)}function Md(n,i){return Md=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t},Md(n,i)}function k0(n,i){return Md(n,i)}function xe(n,i){if(typeof i!="function"&&i!==null)throw new TypeError("Super expression must either be null or a function");n.prototype=Object.create(i&&i.prototype,{constructor:{value:n,writable:!0,configurable:!0}}),i&&k0(n,i)}function Te(n,i,a,t){var e=arguments.length,r=e<3?i:t===null?t=Object.getOwnPropertyDescriptor(i,a):t,o;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(n,i,a,t);else for(var s=n.length-1;s>=0;s--)(o=n[s])&&(r=(e<3?o(r):e>3?o(i,a,r):o(i,a))||r);return e>3&&r&&Object.defineProperty(i,a,r),r}function J_(n,i){var a={label:0,sent:function(){if(r[0]&1)throw r[1];return r[1]},trys:[],ops:[]},t,e,r,o;return o={next:s(0),throw:s(1),return:s(2)},typeof Symbol=="function"&&(o[Symbol.iterator]=function(){return this}),o;function s(u){return function(c){return l([u,c])}}function l(u){if(t)throw new TypeError("Generator is already executing.");for(;o&&(o=0,u[0]&&(a=0)),a;)try{if(t=1,e&&(r=u[0]&2?e.return:u[0]?e.throw||((r=e.return)&&r.call(e),0):e.next)&&!(r=r.call(e,u[1])).done)return r;switch(e=0,r&&(u=[u[0]&2,r.value]),u[0]){case 0:case 1:r=u;break;case 4:return a.label++,{value:u[1],done:!1};case 5:a.label++,e=u[1],u=[0];continue;case 7:u=a.ops.pop(),a.trys.pop();continue;default:if(r=a.trys,!(r=r.length>0&&r[r.length-1])&&(u[0]===6||u[0]===2)){a=0;continue}if(u[0]===3&&(!r||u[1]>r[0]&&u[1]<r[3])){a.label=u[1];break}if(u[0]===6&&a.label<r[1]){a.label=r[1],r=u;break}if(r&&a.label<r[2]){a.label=r[2],a.ops.push(u);break}r[2]&&a.ops.pop(),a.trys.pop();continue}u=i.call(n,a)}catch(c){u=[6,c],e=0}finally{t=r=0}if(u[0]&5)throw u[1];return{value:u[0]?u[1]:void 0,done:!0}}}var kf=function(n){xe(i,n);function i(){return n.apply(this,arguments)}var a=i.prototype;return a.load=function(e,r){var o=this;return new Ae(function(s,l){o.request(e.url,Wn({},e,{type:"json"})).then(function(u){var c=new q_,d=u.layers,_=[];d.forEach(function(h,f){var g=h.name,y=h.blendingMode,p=h.weight,v=h.stateMachine,m=new Q_(g);if(m.blendingMode=y,m.weight=p,v){var x=v.states,S=m.stateMachine=new $_;x.forEach(function(C,A){var T=C.name,E=C.speed,P=C.wrapMode,b=C.clipStartNormalizedTime,M=C.clipEndNormalizedTime,F=C.isDefaultState,I=C.clip,L=S.addState(T);F&&(S.defaultState=L),L.speed=E,L.wrapMode=P,L.clipStartTime=b,L.clipEndTime=M,I&&_.push(new Promise(function(V){r.getResourceByRef(I).then(function(U){V({layerIndex:f,stateIndex:A,clip:U})})}))}),x.forEach(function(C){var A=C.name,T=C.transitions;T.forEach(function(E){var P=E.targetStateName,b=E.duration,M=E.offset,F=E.exitTime,I=S.findStateByName(A),L=S.findStateByName(P),V=new Y_;V.destinationState=L,V.duration=b,V.exitTime=F,V.offset=M,I.addTransition(V)})})}c.addLayer(m)}),Promise.all(_).then(function(h){h.forEach(function(f){var g=f.layerIndex,y=f.stateIndex,p=f.clip;c.layers[g].stateMachine.states[y].clip=p}),s(c)})}).catch(l)})},i}(Oe);kf=Te([lt(Xe.AnimatorController,["json"],!1)],kf);function NS(n){return/^data:(.+?);base64,/.test(n)}var Hf=function(n){xe(i,n);function i(){return n.apply(this,arguments)}var a=i.prototype;return a.load=function(e){var r=e.url;return NS(r)?new Ae(function(o){var s=r.slice(13+RegExp.$1.length),l=Uint8Array.from(atob(s),function(u){return u.charCodeAt(0)});o(l.buffer)}):this.request(r,Wn({},e,{type:"arraybuffer"}))},i}(Oe);Hf=Te([lt(Xe.Buffer,["bin","r3bin"],!1)],Hf);var Gf=function(n){xe(i,n);function i(){return n.apply(this,arguments)}var a=i.prototype;return a.load=function(e,r){var o=this;return new Ae(function(s,l){o.request(e.url,{type:"arraybuffer"}).then(function(u){var c,d=new Float32Array(u,0,27),_=27*4,h=(c=new Uint16Array(u,_,1))==null?void 0:c[0],f=new yn(r.engine,h);f.filterMode=$t.Trilinear;for(var g=f.mipmapCount,y=_+2,p=0;p<g;p++)for(var v=h>>p,m=0;m<6;m++){var x=v*v*4,S=new Uint8Array(u,y,x);y+=x,f.setPixelBuffer(an.PositiveX+m,S,p)}var C=new Xn,A=new N1;C.diffuseMode=ro.SphericalHarmonics,A.copyFromArray(d),C.diffuseSphericalHarmonics=A,C.specularTexture=f,C.specularTextureDecodeRGBM=!0,s(C)}).catch(function(u){l(u)})})},i}(Oe);Gf=Te([lt(Xe.Env,["env"])],Gf);function Wf(n,i,a,t,e,r,o){try{var s=n[r](o),l=s.value}catch(u){a(u);return}s.done?i(l):Promise.resolve(l).then(t,e)}function Z_(n){return function(){var i=this,a=arguments;return new Promise(function(t,e){var r=n.apply(i,a);function o(l){Wf(r,t,e,o,s,"next",l)}function s(l){Wf(r,t,e,o,s,"throw",l)}o(void 0)})}}var Xf=function(n){xe(i,n);function i(){return n.apply(this,arguments)}var a=i.prototype;return a.load=function(e,r){var o=this;return new Ae(function(s,l){o.request(e.url,{type:"json"}).then(function(u){var c=u.fontName,d=u.fontUrl;if(d)o._registerFont(c,d).then(function(){var h=new ia(r.engine,c);s(h)}).catch(function(h){l("load font "+d+" fail")});else{var _=new ia(r.engine,c);s(_)}}).catch(function(u){l(u)})})},a._registerFont=function(e,r){return Z_(function(){var o;return J_(this,function(s){switch(s.label){case 0:return o=new FontFace(e,"url("+r+")"),[4,o.load()];case 1:return s.sent(),document.fonts.add(o),[2]}})})()},i}(Oe);Xf=Te([lt(Xe.Font,["font"],!1)],Xf);var VS=function(){function n(a){this.hasSkinned=!1,this.chainPromises=[],this.accessorBufferCache={},this.texturesPromiseInfo=new va,this.materialsPromiseInfo=new va,this.meshesPromiseInfo=new va,this.animationClipsPromiseInfo=new va,this.defaultSceneRootPromiseInfo=new va,this.masterPromiseInfo=new va,this.promiseMap={};var t=this.promiseMap;t[""+a+"?q=textures"]=this._initPromiseInfo(this.texturesPromiseInfo),t[""+a+"?q=materials"]=this._initPromiseInfo(this.materialsPromiseInfo),t[""+a+"?q=meshes"]=this._initPromiseInfo(this.meshesPromiseInfo),t[""+a+"?q=animations"]=this._initPromiseInfo(this.animationClipsPromiseInfo),t[""+a+"?q=defaultSceneRoot"]=this._initPromiseInfo(this.defaultSceneRootPromiseInfo),t[""+a]=this._initPromiseInfo(this.masterPromiseInfo)}var i=n.prototype;return i._initPromiseInfo=function(t){var e=new Ae(function(r,o,s,l){t.resolve=r,t.reject=o,t.setProgress=s,t.onCancel=l});return t.promise=e,e},n}(),vc=function(i,a,t){this.data=i,this.interleaved=a,this.stride=t,this.vertexBindingInfos={}},va=function(){},it;(function(n){n[n.BYTE=5120]="BYTE",n[n.UNSIGNED_BYTE=5121]="UNSIGNED_BYTE",n[n.SHORT=5122]="SHORT",n[n.UNSIGNED_SHORT=5123]="UNSIGNED_SHORT",n[n.UNSIGNED_INT=5125]="UNSIGNED_INT",n[n.FLOAT=5126]="FLOAT"})(it||(it={}));var vr;(function(n){n.SCALAR="SCALAR",n.VEC2="VEC2",n.VEC3="VEC3",n.VEC4="VEC4",n.MAT2="MAT2",n.MAT3="MAT3",n.MAT4="MAT4"})(vr||(vr={}));var fr;(function(n){n.TRANSLATION="translation",n.ROTATION="rotation",n.SCALE="scale",n.WEIGHTS="weights"})(fr||(fr={}));var Ba;(function(n){n.Linear="LINEAR",n.Step="STEP",n.CubicSpine="CUBICSPLINE"})(Ba||(Ba={}));var cu;(function(n){n.PERSPECTIVE="perspective",n.ORTHOGRAPHIC="orthographic"})(cu||(cu={}));var jf;(function(n){n.JPEG="image/jpeg",n.PNG="image/png"})(jf||(jf={}));var Xo;(function(n){n.OPAQUE="OPAQUE",n.MASK="MASK",n.BLEND="BLEND"})(Xo||(Xo={}));var Rd;(function(n){n[n.NEAREST=9728]="NEAREST",n[n.LINEAR=9729]="LINEAR"})(Rd||(Rd={}));var Fd;(function(n){n[n.NEAREST=9728]="NEAREST",n[n.LINEAR=9729]="LINEAR",n[n.NEAREST_MIPMAP_NEAREST=9984]="NEAREST_MIPMAP_NEAREST",n[n.LINEAR_MIPMAP_NEAREST=9985]="LINEAR_MIPMAP_NEAREST",n[n.NEAREST_MIPMAP_LINEAR=9986]="NEAREST_MIPMAP_LINEAR",n[n.LINEAR_MIPMAP_LINEAR=9987]="LINEAR_MIPMAP_LINEAR"})(Fd||(Fd={}));var jo;(function(n){n[n.CLAMP_TO_EDGE=33071]="CLAMP_TO_EDGE",n[n.MIRRORED_REPEAT=33648]="MIRRORED_REPEAT",n[n.REPEAT=10497]="REPEAT"})(jo||(jo={}));var ge=function(){function n(){}return n.floatBufferToVector2Array=function(a){for(var t=a.length,e=new Array(t/2),r=0;r<t;r+=2)e[r/2]=new W(a[r],a[r+1]);return e},n.floatBufferToVector3Array=function(a){for(var t=a.length,e=new Array(t/3),r=0;r<t;r+=3)e[r/3]=new w(a[r],a[r+1],a[r+2]);return e},n.floatBufferToVector4Array=function(a){for(var t=a.length,e=new Array(t/4),r=0;r<t;r+=4)e[r/4]=new he(a[r],a[r+1],a[r+2],a[r+3]);return e},n.floatBufferToColorArray=function(a,t){var e=a.length,r=new Array(e/(t?3:4));if(t)for(var o=0;o<e;o+=3)r[o/3]=new ne(a[o],a[o+1],a[o+2],1);else for(var s=0;s<e;s+=4)r[s/4]=new ne(a[s],a[s+1],a[s+2],a[s+3]);return r},n.decodeText=function(a){if(typeof TextDecoder<"u")return new TextDecoder().decode(a);for(var t="",e=0,r=a.length;e<r;e++)t+=String.fromCharCode(a[e]);return decodeURIComponent(encodeURIComponent(t))},n.getAccessorTypeSize=function(a){switch(a){case vr.SCALAR:return 1;case vr.VEC2:return 2;case vr.VEC3:return 3;case vr.VEC4:return 4;case vr.MAT2:return 4;case vr.MAT3:return 9;case vr.MAT4:return 16}},n.getComponentType=function(a){switch(a){case it.BYTE:return Int8Array;case it.UNSIGNED_BYTE:return Uint8Array;case it.SHORT:return Int16Array;case it.UNSIGNED_SHORT:return Uint16Array;case it.UNSIGNED_INT:return Uint32Array;case it.FLOAT:return Float32Array}},n.getNormalizedComponentScale=function(a){switch(a){case it.BYTE:return 1/127;case it.UNSIGNED_BYTE:return 1/255;case it.SHORT:return 1/32767;case it.UNSIGNED_SHORT:return 1/65535;default:throw new Error("Oasis.GLTFLoader: Unsupported normalized accessor component type.")}},n.getAccessorBuffer=function(a,t,e){var r=a.buffers,o=t.bufferViews,s=e.componentType,l=o[e.bufferView],u=r[l.buffer],c=l.byteOffset||0,d=e.byteOffset||0,_=n.getComponentType(s),h=n.getAccessorTypeSize(e.type),f=_.BYTES_PER_ELEMENT,g=h*f,y=e.count,p=l.byteStride,v;if(p!==void 0&&p!==g){var m=Math.floor(d/p),x=e.bufferView+":"+s+":"+m+":"+y,S=a.accessorBufferCache;if(v=S[x],!v){var C=c+m*p,A=y*(p/f),T=new _(u,C,A);S[x]=v=new vc(T,!0,p)}}else{var E=c+d,P=y*h,b=new _(u,E,P);v=new vc(b,!1,g)}if(e.sparse){var M=n.processingSparseData(t,e,r,v.data);v=new vc(M,!1,v.stride)}return v},n.getAccessorData=function(a,t,e){var r=a.bufferViews,o=r[t.bufferView],s=e[o.buffer],l=t.hasOwnProperty("byteOffset")?t.byteOffset:0,u=o.hasOwnProperty("byteOffset")?o.byteOffset:0,c=l+u,d=n.getAccessorTypeSize(t.type),_=d*t.count,h,f=(h=o.byteStride)!=null?h:0,g=n.getComponentType(t.componentType),y;if(f){var p=d*g.BYTES_PER_ELEMENT;y=new Uint8Array(t.count*p);for(var v=new Uint8Array(s,u,o.byteLength),m=0;m<t.count;m++)for(var x=0;x<p;x++)y[m*p+x]=v[m*f+l+x]}else y=new Uint8Array(s.slice(c,c+_*g.BYTES_PER_ELEMENT));var S=new g(y.buffer);if(t.sparse)for(var C=t.sparse,A=C.count,T=C.indices,E=C.values,P=r[T.bufferView],b=r[E.bufferView],M=e[P.buffer],F=e[b.buffer],I,L,V=((I=T.byteOffset)!=null?I:0)+((L=P.byteOffset)!=null?L:0),U=P.byteLength,D,R,N=((D=E.byteOffset)!=null?D:0)+((R=b.byteOffset)!=null?R:0),X=b.byteLength,q=n.getComponentType(T.componentType),te=new q(M,V,U/q.BYTES_PER_ELEMENT),ie=new g(F,N,X/g.BYTES_PER_ELEMENT),ce=0;ce<A;ce++)for(var le=te[ce],ae=0;ae<d;ae++)S[le*d+ae]=ie[ce*d+ae];return S},n.getBufferViewData=function(a,t){var e=a.buffer,r=a.byteOffset,o=r===void 0?0:r,s=a.byteLength,l=t[e];return l.slice(o,o+s)},n.processingSparseData=function(a,t,e,r){for(var o=a.bufferViews,s=n.getAccessorTypeSize(t.type),l=n.getComponentType(t.componentType),u=r.slice(),c=t.sparse,d=c.count,_=c.indices,h=c.values,f=o[_.bufferView],g=o[h.bufferView],y=e[f.buffer],p=e[g.buffer],v,m,x=((v=_.byteOffset)!=null?v:0)+((m=f.byteOffset)!=null?m:0),S=f.byteLength,C,A,T=((C=h.byteOffset)!=null?C:0)+((A=g.byteOffset)!=null?A:0),E=g.byteLength,P=n.getComponentType(_.componentType),b=new P(y,x,S/P.BYTES_PER_ELEMENT),M=new l(p,T,E/l.BYTES_PER_ELEMENT),F=0;F<d;F++)for(var I=b[F],L=0;L<s;L++)u[I*s+L]=M[F*s+L];return u},n.getIndexFormat=function(a){switch(a){case it.UNSIGNED_BYTE:return pt.UInt8;case it.UNSIGNED_SHORT:return pt.UInt16;case it.UNSIGNED_INT:return pt.UInt32}},n.getElementFormat=function(a,t,e){if(e===void 0&&(e=!1),a==it.FLOAT)switch(t){case 1:return re.Float;case 2:return re.Vector2;case 3:return re.Vector3;case 4:return re.Vector4}if(a==it.SHORT)switch(t){case 2:return e?re.NormalizedShort2:re.Short2;case 3:case 4:return e?re.NormalizedShort4:re.Short4}if(a==it.UNSIGNED_SHORT)switch(t){case 2:return e?re.NormalizedUShort2:re.UShort2;case 3:case 4:return e?re.NormalizedUShort4:re.UShort4}if(a==it.BYTE)switch(t){case 2:case 3:case 4:return e?re.NormalizedByte4:re.Byte4}if(a==it.UNSIGNED_BYTE)switch(t){case 2:case 3:case 4:return e?re.NormalizedUByte4:re.UByte4}},n.loadImageBuffer=function(a,t){return new Promise(function(e,r){var o=new window.Blob([a],{type:t}),s=new Image;s.onerror=function(){r(new Error("Failed to load image buffer"))},s.onload=function(){requestAnimationFrame(function(){e(s),s.onload=null,s.onerror=null,s.onabort=null})},s.crossOrigin="anonymous",s.src=URL.createObjectURL(o)})},n.isAbsoluteUrl=function(a){return/^(?:http|blob|data:|\/)/.test(a)},n.parseRelativeUrl=function(a,t){if(n.isAbsoluteUrl(t))return t;var e=t.charAt(0);return e==="."?n._formatRelativePath(t+t):a.substring(0,a.lastIndexOf("/")+1)+t},n.parseGLB=function(a){var t=4,e=1179937895,r=12,o={JSON:1313821514,BIN:5130562},s=new DataView(a),l={magic:s.getUint32(0,!0),version:s.getUint32(t,!0),length:s.getUint32(2*t,!0)};if(l.magic!==e)return console.error("Invalid glb magic number. Expected 0x46546C67, found 0x"+l.magic.toString(16)),null;var u=s.getUint32(r,!0),c=s.getUint32(r+t,!0);if(c!==o.JSON)return console.error("Invalid glb chunk type. Expected 0x4E4F534A, found 0x"+c.toString(16)),null;for(var d=new Uint8Array(a,r+2*t,u),_=JSON.parse(n.decodeText(d)),h=[],f=r+2*t+u;f<l.length;){if(u=s.getUint32(f,!0),c=s.getUint32(f+t,!0),c!==o.BIN)return console.error("Invalid glb chunk type. Expected 0x004E4942, found 0x"+c.toString(16)),null;var g=f+2*t,y=a.slice(g,g+u);h.push(y),f+=u+2*t}return{gltf:_,buffers:h}},n._formatRelativePath=function(a){for(var t=a.split("/"),e=0,r=t.length;e<r;e++)t[e]==".."&&(t.splice(e-1,2),e-=2);return t.join("/")},n}();function Dd(n,i){(i==null||i>n.length)&&(i=n.length);for(var a=0,t=new Array(i);a<i;a++)t[a]=n[a];return t}function US(n){if(Array.isArray(n))return Dd(n)}function kS(n){if(typeof Symbol<"u"&&n[Symbol.iterator]!=null||n["@@iterator"]!=null)return Array.from(n)}function HS(){throw new TypeError("Invalid attempt to spread non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function H0(n,i){if(n){if(typeof n=="string")return Dd(n,i);var a=Object.prototype.toString.call(n).slice(8,-1);if(a==="Object"&&n.constructor&&(a=n.constructor.name),a==="Map"||a==="Set")return Array.from(a);if(a==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a))return Dd(n,i)}}function Yf(n){return US(n)||kS(n)||H0(n)||HS()}var $e=function(){function n(){}return n.parseEngineResource=function(a,t,e,r){for(var o=arguments.length,s=new Array(o>4?o-4:0),l=4;l<o;l++)s[l-4]=arguments[l];var u=n._extensionParsers[a];if(u!=null&&u.length)for(var c=0;c<u.length;c++){var d;(d=u[c]).parseEngineResource.apply(d,[t,e,r].concat(Yf(s)))}},n.createEngineResource=function(a,t,e){for(var r=arguments.length,o=new Array(r>3?r-3:0),s=3;s<r;s++)o[s-3]=arguments[s];var l=n._extensionParsers[a];if(l!=null&&l.length){var u;return(u=l[0]).createEngineResource.apply(u,[t,e].concat(Yf(o)))}},n.hasExtensionParser=function(a){var t=n._extensionParsers[a];return!!(t!=null&&t.length)},n.initialize=function(a){var t=n._extensionParsers[a];if(t!=null&&t.length)for(var e=0;e<t.length;e++)t[e].initialize()},n._addExtensionParser=function(a,t){n._extensionParsers[a]||(n._extensionParsers[a]=[]),n._extensionParsers[a].push(t)},n}();$e._extensionParsers={};function jr(n){return function(i){var a=new i;$e._addExtensionParser(n,a)}}var Yr=function(){function n(){}var i=n.prototype;return i.initialize=function(){},i.parseEngineResource=function(t,e,r){for(var o=arguments.length,s=new Array(o>3?o-3:0),l=3;l<o;l++)s[l-3]=arguments[l]},i.createEngineResource=function(t,e){for(var r=arguments.length,o=new Array(r>2?r-2:0),s=2;s<r;s++)o[s-2]=arguments[s];return null},n}(),Yo=function(n){xe(i,n);function i(){return n.apply(this,arguments)}var a=i.prototype;return a.initialize=function(){Yo._decoder||(Yo._decoder=new TS)},a.createEngineResource=function(e,r,o){var s=r.gltf,l=r.buffers,u=s.bufferViews,c=s.accessors,d=e.bufferView,_=e.attributes,h={},f={};for(var g in _)h[g]=_[g];for(var y in o.attributes)if(_[y]!==void 0){var p=c[o.attributes[y]];f[y]=ge.getComponentType(p.componentType).name}var v=c[o.indices],m=ge.getComponentType(v.componentType).name,x={attributeIDs:h,attributeTypes:f,useUniqueIDs:!0,indexType:m},S=ge.getBufferViewData(u[d],l);return Yo._decoder.decode(S,x).then(function(C){return C})},i}(Yr);Yo=Te([jr("KHR_draco_mesh_compression")],Yo);function qf(n,i){return i!=null&&typeof Symbol<"u"&&i[Symbol.hasInstance]?!!i[Symbol.hasInstance](n):n instanceof i}var Qf=function(n){xe(i,n);function i(){return n.apply(this,arguments)}var a=i.prototype;return a.parseEngineResource=function(e,r,o){var s=e.color,l=e.intensity,u=l===void 0?1:l,c=e.type,d=e.range,_=e.spot,h=o.glTFResource,f;if(c==="directional"?f=r.addComponent(xr):c==="point"?f=r.addComponent(wr):c==="spot"&&(f=r.addComponent(_n)),s&&f.color.set(s[0],s[1],s[2],1),f.intensity=u,d&&!qf(f,xr)&&(f.distance=d),_&&qf(f,_n)){var g=_.innerConeAngle,y=g===void 0?0:g,p=_.outerConeAngle,v=p===void 0?Math.PI/4:p;f.angle=y,f.penumbra=v-y}h.lights||(h.lights=[]),h.lights.push(f)},i}(Yr);Qf=Te([jr("KHR_lights_punctual")],Qf);var ka=function(n){xe(i,n);function i(){return n.apply(this,arguments)}var a=i.prototype;return a.parse=function(e){var r=e.gltf,o=e.glTFResource,s=o.engine,l=o.textures;if(r.materials){for(var u=e.materialsPromiseInfo,c=[],d=0;d<r.materials.length;d++){var _=r.materials[d],h=_.extensions,f=h===void 0?{}:h,g=_.pbrMetallicRoughness,y=_.normalTexture,p=_.occlusionTexture,v=_.emissiveTexture,m=_.emissiveFactor,x=_.alphaMode,S=_.alphaCutoff,C=_.doubleSided,A=_.name,T=A===void 0?"":A,E=f.KHR_materials_unlit,P=f.KHR_materials_pbrSpecularGlossiness,b=f.KHR_materials_clearcoat,M=f.OASIS_materials_remap,F=null;if(E?F=$e.createEngineResource("KHR_materials_unlit",E,e):P?F=$e.createEngineResource("KHR_materials_pbrSpecularGlossiness",P,e):F=new co(s),F.name=T,b&&$e.parseEngineResource("KHR_materials_clearcoat",b,F,e),g){var I=g.baseColorFactor,L=g.baseColorTexture,V=g.metallicFactor,U=g.roughnessFactor,D=g.metallicRoughnessTexture;if(I&&(F.baseColor=new ne(ne.linearToGammaSpace(I[0]),ne.linearToGammaSpace(I[1]),ne.linearToGammaSpace(I[2]),I[3])),L&&(F.baseTexture=l[L.index],i._parseTextureTransform(F,L.extensions,e)),!E&&!P){var R=F;R.metallic=V??1,R.roughness=U??1,D&&(R.roughnessMetallicTexture=l[D.index],i._parseTextureTransform(F,D.extensions,e))}}if(!E){var N=F;if(v&&(N.emissiveTexture=l[v.index],i._parseTextureTransform(F,v.extensions,e)),m&&(N.emissiveColor=new ne(ne.linearToGammaSpace(m[0]),ne.linearToGammaSpace(m[1]),ne.linearToGammaSpace(m[2]))),y){var X=y.index,q=y.scale;N.normalTexture=l[X],i._parseTextureTransform(F,y.extensions,e),q!==void 0&&(N.normalTextureIntensity=q)}if(p){var te=p.index,ie=p.strength,ce=p.texCoord;N.occlusionTexture=l[te],i._parseTextureTransform(F,p.extensions,e),ie!==void 0&&(N.occlusionTextureIntensity=ie),ce===Si.UV1?N.occlusionTextureCoord=Si.UV1:ce>Si.UV1&&we.warn("Occlusion texture uv coordinate must be UV0 or UV1.")}}if(M){var le;r.extensions=(le=r.extensions)!=null?le:{};var ae;r.extensions.OASIS_materials_remap=(ae=r.extensions.OASIS_materials_remap)!=null?ae:{},r.extensions.OASIS_materials_remap[d]=$e.createEngineResource("OASIS_materials_remap",M,e)}switch(C?F.renderFace=Ir.Double:F.renderFace=Ir.Front,x){case Xo.OPAQUE:F.isTransparent=!1;break;case Xo.BLEND:F.isTransparent=!0;break;case Xo.MASK:F.alphaCutoff=S??.5;break}c[d]=F}return o.materials=c,u.resolve(c),u.promise}},i._parseTextureTransform=function(e,r,o){r===void 0&&(r={});var s=r.KHR_texture_transform;s&&$e.parseEngineResource("KHR_texture_transform",s,e,o)},i}($e),$f=function(n){xe(i,n);function i(){return n.apply(this,arguments)}var a=i.prototype;return a.parseEngineResource=function(e,r,o){var s=o.glTFResource.textures,l=e.clearcoatFactor,u=l===void 0?0:l,c=e.clearcoatTexture,d=e.clearcoatRoughnessFactor,_=d===void 0?0:d,h=e.clearcoatRoughnessTexture,f=e.clearcoatNormalTexture;r.clearCoat=u,r.clearCoatRoughness=_,c&&(r.clearCoatTexture=s[c.index],ka._parseTextureTransform(r,c.extensions,o)),h&&(r.clearCoatRoughnessTexture=s[h.index],ka._parseTextureTransform(r,h.extensions,o)),f&&(r.clearCoatNormalTexture=s[f.index],ka._parseTextureTransform(r,f.extensions,o))},i}(Yr);$f=Te([jr("KHR_materials_clearcoat")],$f);var Kf=function(n){xe(i,n);function i(){return n.apply(this,arguments)}var a=i.prototype;return a.createEngineResource=function(e,r){var o=r.glTFResource,s=o.engine,l=o.textures,u=new ca(s),c=e.diffuseFactor,d=e.diffuseTexture,_=e.specularFactor,h=e.glossinessFactor,f=e.specularGlossinessTexture;return c&&(u.baseColor=new ne(ne.linearToGammaSpace(c[0]),ne.linearToGammaSpace(c[1]),ne.linearToGammaSpace(c[2]),c[3])),d&&(u.baseTexture=l[d.index],ka._parseTextureTransform(u,d.extensions,r)),_&&(u.specularColor=new ne(ne.linearToGammaSpace(_[0]),ne.linearToGammaSpace(_[1]),ne.linearToGammaSpace(_[2]))),h!==void 0&&(u.glossiness=h),f&&(u.specularGlossinessTexture=l[f.index],ka._parseTextureTransform(u,f.extensions,r)),u},i}(Yr);Kf=Te([jr("KHR_materials_pbrSpecularGlossiness")],Kf);var Jf=function(n){xe(i,n);function i(){return n.apply(this,arguments)}var a=i.prototype;return a.createEngineResource=function(e,r){var o=r.glTFResource.engine,s=new aa(o);return s},i}(Yr);Jf=Te([jr("KHR_materials_unlit")],Jf);var Zf=function(n){xe(i,n);function i(){return n.apply(this,arguments)}var a=i.prototype;return a.parseEngineResource=function(e,r,o){for(var s=o.gltf,l=s.extensions,u=l.KHR_materials_variants,c=u.variants,d=o.glTFResource,_=e.mappings,h=0;h<_.length;h++){var f=_[h],g=f.material,y=f.variants;d.variants||(d.variants=[]),d.variants.push({renderer:r,material:d.materials[g],variants:y.map(function(p){return c[p].name})})}},i}(Yr);Zf=Te([jr("KHR_materials_variants")],Zf);var ev=function(n){xe(i,n);function i(){return n.apply(this,arguments)}return i}(Yr);ev=Te([jr("KHR_mesh_quantization")],ev);var tv=function(n){xe(i,n);function i(){return n.apply(this,arguments)}var a=i.prototype;return a.parseEngineResource=function(e,r,o){var s=e.offset,l=e.rotation,u=e.scale,c=e.texCoord;s&&(r.tilingOffset.z=s[0],r.tilingOffset.w=s[1]),u&&(r.tilingOffset.x=u[0],r.tilingOffset.y=u[1]),l&&we.warn("rotation in KHR_texture_transform is not supported now"),c&&we.warn("texCoord in KHR_texture_transform is not supported now")},i}(Yr);tv=Te([jr("KHR_texture_transform")],tv);var nv=function(n){xe(i,n);function i(){return n.apply(this,arguments)}var a=i.prototype;return a.createEngineResource=function(e,r){var o=r.glTFResource.engine;return o.resourceManager.getResourceByRef(e)},i}(Yr);nv=Te([jr("OASIS_materials_remap")],nv);function eh(n,i){var a=typeof Symbol<"u"&&n[Symbol.iterator]||n["@@iterator"];if(a)return(a=a.call(n)).next.bind(a);if(Array.isArray(n)||(a=H0(n))||i&&n&&typeof n.length=="number"){a&&(n=a);var t=0;return function(){return t>=n.length?{done:!0}:{done:!1,value:n[t++]}}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var GS=function(n){xe(i,n);function i(){return n.apply(this,arguments)}var a=i.prototype;return a.parse=function(e){var r=e.gltf;e.buffers;var o=e.glTFResource,s=o.entities,l=r.animations,u=r.accessors;if(l){for(var c=e.animationClipsPromiseInfo,d=l.length,_=new Array(d),h=new Array(d),f=0;f<d;f++){for(var g=l[f],y=g.channels,p=g.samplers,v=g.name,m=v===void 0?"AnimationClip"+f:v,x=new j_(m),S=new Array,C=0,A=p.length;C<A;C++){var T=p[C],E=u[T.input],P=u[T.output],b=ge.getAccessorBuffer(e,r,E).data,M=ge.getAccessorBuffer(e,r,P).data;if(P.normalized){for(var F=ge.getNormalizedComponentScale(P.componentType),I=new Float32Array(M.length),L=0,V=M.length;L<V;L++)I[L]=M[L]*F;M=I}var U=M.length/b.length,D,R=(D=T.interpolation)!=null?D:Ba.Linear,N=void 0;switch(R){case Ba.CubicSpine:N=Tt.CubicSpine;break;case Ba.Step:N=Tt.Step;break;case Ba.Linear:N=Tt.Linear;break}b[b.length-1],S.push({type:P.type,interpolation:N,input:b,output:M,outputSize:U})}for(var X=0,q=y.length;X<q;X++){for(var te=y[X],ie=te.target,ce=s[ie.node],le="",ae=ce;ae.parent;)le=le===""?""+ae.name:ae.name+"/"+le,ae=ae.parent;var Ee=void 0,Ne=void 0;switch(ie.path){case fr.TRANSLATION:Ee=fe,Ne="position";break;case fr.ROTATION:Ee=fe,Ne="rotationQuaternion";break;case fr.SCALE:Ee=fe,Ne="scale";break;case fr.WEIGHTS:Ee=ut,Ne="blendShapeWeights";break}var tt=this._addCurve(ie.path,te,S);x.addCurveBinding(le,Ee,Ne,tt)}_[f]=x,h[f]={name:m,index:f}}return o.animations=_,o._animationsIndices=h,c.resolve(_),c.promise}},a._addCurve=function(e,r,o){var s=o[r.sampler],l=s.input,u=s.output,c=s.outputSize;switch(e){case fr.TRANSLATION:case fr.SCALE:{for(var d=new ws,_=d.interpolation=s.interpolation,h=0,f=0,g=l.length;f<g;f++){var y=new In;y.time=l[f],_===Tt.CubicSpine?(y.inTangent=new w(u[h++],u[h++],u[h++]),y.value=new w(u[h++],u[h++],u[h++]),y.outTangent=new w(u[h++],u[h++],u[h++])):y.value=new w(u[h++],u[h++],u[h++]),d.addKey(y)}return d}case fr.ROTATION:{for(var p=new io,v=p.interpolation=s.interpolation,m=0,x=0,S=l.length;x<S;x++){var C=new In;C.time=l[x],v===Tt.CubicSpine?(C.inTangent=new he(u[m++],u[m++],u[m++],u[m++]),C.value=new ve(u[m++],u[m++],u[m++],u[m++]),C.outTangent=new he(u[m++],u[m++],u[m++],u[m++])):C.value=new ve(u[m++],u[m++],u[m++],u[m++]),p.addKey(C)}return p}case fr.WEIGHTS:{var A=new xs;A.interpolation=s.interpolation;for(var T=0,E=0,P=l.length;E<P;E++){var b=new In;b.time=l[E],A.interpolation===Tt.CubicSpine?(b.inTangent=Array.from(u.subarray(T,T+c)),T+=c,b.value=u.subarray(T,T+c),T+=c,b.outTangent=Array.from(u.subarray(T,T+c)),T+=c):(b.value=u.subarray(T,T+c),T+=c),A.addKey(b)}return A}}},i}($e),WS=function(n){xe(i,n);function i(){return n.apply(this,arguments)}var a=i.prototype;return a.parse=function(e){var r=e.glTFResource,o=r.url;return this._isGLB(o)?wi(o,{type:"arraybuffer"}).then(ge.parseGLB).then(function(s){var l=s.gltf,u=s.buffers;e.gltf=l,e.buffers=u}):wi(o,{type:"json"}).then(function(s){return e.gltf=s,Promise.all(s.buffers.map(function(l){return wi(ge.parseRelativeUrl(o,l.uri),{type:"arraybuffer"})})).then(function(l){e.buffers=l})})},a._isGLB=function(e){var r=e.lastIndexOf(".");return e.substring(r+1,r+4)==="glb"},i}($e),G0=function(n){xe(i,n);function i(){return n.apply(this,arguments)}var a=i.prototype;return a.parse=function(e){var r=e.glTFResource,o=e.gltf.nodes,s=r.engine;if(o){for(var l=[],u=0;u<o.length;u++){var c=o[u],d=c.matrix,_=c.translation,h=c.rotation,f=c.scale,g=new Fr(s,c.name||""+i._defaultName+u),y=g.transform;if(d){var p=y.localMatrix;p.copyFromArray(d),y.localMatrix=p}else _&&y.setPosition(_[0],_[1],_[2]),h&&y.setRotationQuaternion(h[0],h[1],h[2],h[3]),f&&y.setScale(f[0],f[1],f[2]);l[u]=g}r.entities=l,this._buildEntityTree(e,r),this._createSceneRoots(e,r)}},a._buildEntityTree=function(e,r){for(var o=e.gltf.nodes,s=r.entities,l=0;l<o.length;l++){var u=o[l].children,c=s[l];if(u)for(var d=0;d<u.length;d++){var _=s[u[d]];c.addChild(_)}}},a._createSceneRoots=function(e,r){var o=e.gltf,s=o.scene,l=s===void 0?0:s,u=o.scenes,c=r.engine,d=r.entities;if(u){for(var _=[],h=0;h<u.length;h++){var f=u[h].nodes;if(f)if(f.length===1)_[h]=d[f[0]];else{for(var g=new Fr(c,"GLTF_ROOT"),y=0;y<f.length;y++)g.addChild(d[f[y]]);_[h]=g}}r.sceneRoots=_,r.defaultSceneRoot=_[l]}},i}($e);G0._defaultName="_GLTF_ENTITY_";var W0=function(n){xe(i,n);function i(){return n.apply(this,arguments)}var a=i.prototype;return a.parse=function(e){var r=function(f){for(var g=function(m){var x=y.primitives[m],S=x.extensions,C=S===void 0?{}:S,A=C.KHR_draco_mesh_compression;p[m]=new Promise(function(T){var E=new Et(c,y.name||m+"");A?$e.createEngineResource("KHR_draco_mesh_compression",A,e,x).then(function(P){return o._parseMeshFromGLTFPrimitiveDraco(E,y,x,s,function(b){for(var M=0;M<P.attributes.length;M++)if(P.attributes[M].name===b)return P.attributes[M].array;return null},function(b,M){throw"BlendShape animation is not supported when using draco."},function(){return P.index.array},e.keepMeshData)}).then(T):o._parseMeshFromGLTFPrimitive(e,E,y,x,s,function(P){return null},function(P,b){var M=x.targets[b],F=M[P];if(F){var I=s.accessors[F];return ge.getAccessorData(s,I,l)}else return null},function(){var P=s.accessors[x.indices];return ge.getAccessorData(s,P,l)},e.keepMeshData).then(T)})},y=s.meshes[f],p=[],v=0;v<y.primitives.length;v++)g(v);_[f]=Promise.all(p)},o=this,s=e.gltf,l=e.buffers,u=e.glTFResource,c=u.engine;if(s.meshes){for(var d=e.meshesPromiseInfo,_=[],h=0;h<s.meshes.length;h++)r(h);return Ae.all(_).then(function(f){u.meshes=f,d.resolve(f)}).catch(d.reject),d.promise}},a._parseMeshFromGLTFPrimitive=function(e,r,o,s,l,u,c,d,_){var h=l.accessors;e.buffers;var f=s.attributes,g=s.targets,y=s.indices,p=s.mode,v=r.engine,m=new Array,x,S=0;for(var C in f){var A=h[f[C]],T=ge.getAccessorBuffer(e,l,A),E=ge.getAccessorTypeSize(A.type),P=A.count,b=T.data,M=void 0,F=r.instanceId,I=T.vertexBindingInfos,L=ge.getElementFormat(A.componentType,E,A.normalized);if(T.interleaved){var V=A.byteOffset||0,U=T.stride,D=V%U;if(I[F]===void 0){M=new ke(C,D,L,S);var R=T.vertxBuffer;R||(R=new ir(v,Pn.VertexBuffer,b.byteLength,mt.Static),R.setData(b),T.vertxBuffer=R),r.setVertexBufferBinding(R,U,S),I[F]=S++}else M=new ke(C,D,L,I[F])}else{M=new ke(C,0,L,S);var N=new ir(v,Pn.VertexBuffer,b.byteLength,mt.Static);N.setData(b),r.setVertexBufferBinding(N,T.stride,S),I[F]=S++}if(m.push(M),C==="POSITION"){x=P;var X=r.bounds,q=X.min,te=X.max;if(A.min&&A.max)q.copyFromArray(A.min),te.copyFromArray(A.max);else{var ie=i._tempVector3;q.set(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),te.set(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE);for(var ce=b.length/P,le=0;le<P;le++){var ae=le*ce;ie.copyFromArray(b,ae),w.min(q,ie,q),w.max(te,ie,te)}}if(A.normalized){var Ee=ge.getNormalizedComponentScale(A.componentType);q.scale(Ee),te.scale(Ee)}}}if(r.setVertexElements(m),y!==void 0){var Ne=l.accessors[y],tt=d();r.setIndices(tt),r.addSubMesh(0,Ne.count,p)}else r.addSubMesh(0,x,p);return g&&this._createBlendShape(r,o,g,c),r.uploadData(!_),Promise.resolve(r)},a._createBlendShape=function(e,r,o,s){for(var l=r.extras?r.extras.targetNames:null,u=0,c=o.length;u<c;u++){var d=l?l[u]:"blendShape"+u,_=s("POSITION",u),h=s("NORMAL",u),f=s("TANGENT",u),g=_?ge.floatBufferToVector3Array(_):null,y=h?ge.floatBufferToVector3Array(h):null,p=f?ge.floatBufferToVector3Array(f):null,v=new G_(d);v.addFrame(1,g,y,p),e.addBlendShape(v)}},a._parseMeshFromGLTFPrimitiveDraco=function(e,r,o,s,l,u,c,d){var _=o.attributes,h=o.targets,f=o.indices,g=o.mode,y,p=s.accessors,v=p[_.POSITION],m=l("POSITION"),x=ge.floatBufferToVector3Array(m);e.setPositions(x);var S=e.bounds;if(y=v.count,v.min&&v.max)S.min.copyFromArray(v.min),S.max.copyFromArray(v.max);else{var C=i._tempVector3,A=S.min,T=S.max;A.set(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),T.set(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE);for(var E=m.length/y,P=0;P<y;P++){var b=P*E;C.copyFromArray(m,b),w.min(A,C,A),w.max(T,C,T)}}for(var M in _)if(M!=="POSITION"){var F=l(M);switch(M){case"NORMAL":var I=ge.floatBufferToVector3Array(F);e.setNormals(I);break;case"TEXCOORD_0":var L=ge.floatBufferToVector2Array(F);e.setUVs(L,0);break;case"TEXCOORD_1":var V=ge.floatBufferToVector2Array(F);e.setUVs(V,1);break;case"TEXCOORD_2":var U=ge.floatBufferToVector2Array(F);e.setUVs(U,2);break;case"TEXCOORD_3":var D=ge.floatBufferToVector2Array(F);e.setUVs(D,3);break;case"TEXCOORD_4":var R=ge.floatBufferToVector2Array(F);e.setUVs(R,4);break;case"TEXCOORD_5":var N=ge.floatBufferToVector2Array(F);e.setUVs(N,5);break;case"TEXCOORD_6":var X=ge.floatBufferToVector2Array(F);e.setUVs(X,6);break;case"TEXCOORD_7":var q=ge.floatBufferToVector2Array(F);e.setUVs(q,7);break;case"COLOR_0":var te=ge.floatBufferToColorArray(F,p[_.COLOR_0].type===vr.VEC3);e.setColors(te);break;case"TANGENT":var ie=ge.floatBufferToVector4Array(F);e.setTangents(ie);break;case"JOINTS_0":var ce=ge.floatBufferToVector4Array(F);e.setBoneIndices(ce);break;case"WEIGHTS_0":var le=ge.floatBufferToVector4Array(F);e.setBoneWeights(le);break}}if(f!==void 0){var ae=s.accessors[f],Ee=c();e.setIndices(Ee),e.addSubMesh(0,ae.count,g)}else e.addSubMesh(0,y,g);return h&&this._createBlendShape(e,r,h,u),e.uploadData(!d),Promise.resolve(e)},i}($e);W0._tempVector3=new w;var XS=function(n){xe(i,n);function i(){return n.apply(this,arguments)}var a=i.prototype;return a.parse=function(e){var r=e.glTFResource,o=e.gltf,s=r.entities,l=o.nodes,u=o.cameras;if(l){for(var c=e.defaultSceneRootPromiseInfo,d=[],_=0;_<l.length;_++){var h=l[_],f=h.camera,g=h.mesh,y=h.extensions,p=y===void 0?{}:y,v=p.KHR_lights_punctual,m=s[_];if(f!==void 0&&this._createCamera(r,u[f],m),g!==void 0&&d.push(this._createRenderer(e,h,m)),v){var x=v.light,S=o.extensions.KHR_lights_punctual.lights;$e.parseEngineResource("KHR_lights_punctual",S[x],m,e)}}return r.defaultSceneRoot&&this._createAnimator(e),o.extensions&&delete o.extensions.OASIS_materials_remap,Ae.all(d).then(function(){return c.resolve(r.defaultSceneRoot)}).catch(c.reject),c.promise}},a._createCamera=function(e,r,o){var s=r.orthographic,l=r.perspective,u=r.type,c=o.addComponent(Pe);if(u===cu.ORTHOGRAPHIC){var d=s.xmag,_=s.ymag,h=s.zfar,f=s.znear;c.isOrthographic=!0,f!==void 0&&(c.nearClipPlane=f),h!==void 0&&(c.farClipPlane=h),c.orthographicSize=Math.max(_??0,d??0)/2}else if(u===cu.PERSPECTIVE){var g=l.aspectRatio,y=l.yfov,p=l.zfar,v=l.znear;g!==void 0&&(c.aspectRatio=g),y!==void 0&&(c.fieldOfView=y*180/Math.PI),p!==void 0&&(c.farClipPlane=p),v!==void 0&&(c.nearClipPlane=v)}e.cameras||(e.cameras=[]),e.cameras.push(c),c.enabled=!1},a._createRenderer=function(e,r,o){for(var s=function(C){var A=_[g][C],T=void 0;if(y!==void 0||m){e.hasSkinned=!0;var E=o.addComponent(ut);E.mesh=A,y!==void 0&&(E.skin=f[y]),m&&(E.blendShapeWeights=new Float32Array(m)),T=E}else T=o.addComponent(et),T.mesh=A;var P=v[C].material,b=u.extensions&&u.extensions.OASIS_materials_remap;if(b&&b[P])x.push(b[P].then(function(U){T.setMaterial(U)}));else{var M=(h==null?void 0:h[P])||i._getDefaultMaterial(d);T.setMaterial(M)}var F=v[C],I=F.extensions,L=I===void 0?{}:I,V=L.KHR_materials_variants;V&&$e.parseEngineResource("KHR_materials_variants",V,T,e)},l=e.glTFResource,u=e.gltf,c=u.meshes,d=l.engine,_=l.meshes,h=l.materials,f=l.skins,g=r.mesh,y=r.skin,p=c[g],v=p.primitives,m=r.weights||p.weights,x=[],S=0;S<v.length;S++)s(S);return Promise.all(x)},a._createAnimator=function(e){if(!(!e.hasSkinned&&!e.glTFResource.animations)){var r=e.glTFResource,o=r.defaultSceneRoot,s=r.animations,l=o.addComponent(sr),u=new q_,c=new Q_("layer"),d=new $_;if(u.addLayer(c),l.animatorController=u,c.stateMachine=d,s)for(var _=0;_<s.length;_++){var h=s[_],f=h.name,g=d.makeUniqueStateName(f);g!==f&&console.warn("AnimatorState name is existed, name: "+f+" reset to "+g);var y=d.addState(g);y.clip=h}}},i._getDefaultMaterial=function(e){return i._defaultMaterial||(i._defaultMaterial=new uo(e)),i._defaultMaterial},i}($e),jS=function(n){xe(i,n);function i(){return n.apply(this,arguments)}var a=i.prototype;return a.parse=function(e){var r=e.glTFResource,o=e.gltf;e.buffers;var s=r.entities,l=o.skins;if(l){for(var u=l.length,c=new Array(u),d=0;d<u;d++){var _=l[d],h=_.inverseBindMatrices,f=_.skeleton,g=_.joints,y=_.name,p=y===void 0?"SKIN_"+d:y,v=g.length,m=new b0(p);m.inverseBindMatrices.length=v;for(var x=o.accessors[h],S=ge.getAccessorBuffer(e,o,x).data,C=0;C<v;C++){var A=new J;A.copyFromArray(S,C*16),m.inverseBindMatrices[C]=A}for(var T=0;T<v;T++)m.joints[T]=s[g[T]].name;if(f!==void 0)m.skeleton=s[f].name;else{var E=this._findSkeletonRootBone(g,s);if(E)m.skeleton=E.name;else throw"Failed to find skeleton root bone."}c[d]=m}r.skins=c}},a._findSkeletonRootBone=function(e,r){for(var o={},s=eh(e),l;!(l=s()).done;){for(var u=l.value,c=new Array,d=r[u];d;)c.unshift(d),d=d.parent;o[u]=c}for(var _=null,h=0;;h++){var f=o[e[0]];if(h>=f.length)return _;for(var g=f[h],y=1,p=e.length;y<p;y++)if(f=o[e[y]],h>=f.length||g!==f[h])return _;_=g}},i}($e),X0=function(n){xe(i,n);function i(){return n.apply(this,arguments)}var a=i.prototype;return a.parse=function(e){var r=this,o=e.glTFResource,s=e.gltf,l=e.buffers,u=o.engine,c=o.url;if(s.textures){var d=e.texturesPromiseInfo;return Ae.all(s.textures.map(function(_,h){var f=_.sampler,g=_.source,y=g===void 0?0:g,p=_.name,v=s.images[y],m=v.uri,x=v.bufferView,S=v.mimeType,C=v.name;if(m){var A=m.lastIndexOf("."),T=m.substring(A+1),E=T.startsWith("ktx")?Xe.KTX:Xe.Texture2D;return u.resourceManager.load({url:ge.parseRelativeUrl(c,m),type:E}).then(function(M){return M.name||(M.name=p||C||"texture_"+A),f!==void 0&&r._parseSampler(M,s.samplers[f]),M})}else{var P=s.bufferViews[x],b=ge.getBufferViewData(P,l);return ge.loadImageBuffer(b,S).then(function(M){var F=new dn(u,M.width,M.height);return F.setImageSource(M),F.generateMipmaps(),F.name=p||C||"texture_"+h,f!==void 0&&r._parseSampler(F,s.samplers[f]),F})}})).then(function(_){o.textures=_,d.resolve(_)}).catch(d.reject),d.promise}},a._parseSampler=function(e,r){var o=r.magFilter,s=r.minFilter,l=r.wrapS,u=r.wrapT;(o||s)&&(o===Rd.NEAREST?e.filterMode=$t.Point:s<=Fd.LINEAR_MIPMAP_NEAREST?e.filterMode=$t.Bilinear:e.filterMode=$t.Trilinear),l&&(e.wrapModeU=i._wrapMap[l]),u&&(e.wrapModeV=i._wrapMap[u])},i}($e),Po;X0._wrapMap=(Po={},Po[jo.CLAMP_TO_EDGE]=Vt.Clamp,Po[jo.MIRRORED_REPEAT]=Vt.Mirror,Po[jo.REPEAT]=Vt.Repeat,Po);var YS=function(n){xe(i,n);function i(){return n.apply(this,arguments)}var a=i.prototype;return a.parse=function(e){var r=e.gltf,o=r.asset.version,s=r.extensionsUsed,l=r.extensionsRequired,u=Number(o);if(!(u>=2&&u<3))throw"Only support gltf 2.x.";if(s){we.info("extensionsUsed: ",s);for(var c=0;c<s.length;c++)$e.hasExtensionParser(s[c])||we.warn("Extension "+s[c]+" is not implemented, you can customize this extension in gltf.")}if(l){we.info("extensionsRequired: "+l);for(var d=0;d<l.length;d++){var _=l[d];$e.hasExtensionParser(_)?$e.initialize(_):we.error("GLTF parser has not supported required extension "+_+".")}}},i}($e),Bd=function(){function n(a){var t=this;this._pipes=[],a.forEach(function(e,r){t._pipes[r]=new e})}var i=n.prototype;return i.parse=function(t){var e=this,r=t.glTFResource,o;return new Ae(function(s,l){e._pipes.forEach(function(u){o?(o=o.then(function(){return u.parse(t)}),o.cancel&&t.chainPromises.push(o)):o=u.parse(t)}),o&&o.then(function(){s(r)}).catch(l)})},n}();Bd.defaultPipeline=new Bd([WS,YS,X0,ka,W0,G0,jS,GS,XS]);var qS=function(n){xe(i,n);function i(t,e){var r;return r=n.call(this,t)||this,r.url=e,r}var a=i.prototype;return a.destroy=function(){this._destroyed||(n.prototype.destroy.call(this),this.defaultSceneRoot.destroy(),this.textures=null,this.materials=null,this.meshes=null,this.skins=null,this.animations=null,this.entities=null,this.cameras=null,this.lights=null,this.sceneRoots=null,this.variants=null)},i}(ar),rv=function(n){xe(i,n);function i(){return n.apply(this,arguments)}var a=i.prototype;return a.load=function(e,r){var o,s=e.url,l=new VS(s),u=new qS(r.engine,s),c=l.masterPromiseInfo;l.glTFResource=u;var d;return l.keepMeshData=(d=(o=e.params)==null?void 0:o.keepMeshData)!=null?d:!1,c.onCancel(function(){for(var _=l.chainPromises,h=eh(_),f;!(f=h()).done;){var g=f.value;g.cancel()}}),Bd.defaultPipeline.parse(l).then(c.resolve).catch(function(_){console.error(_),c.reject("Error loading glTF model from "+s+" .")}),l.promiseMap},i}(Oe);rv=Te([lt(Xe.Prefab,["gltf","glb"])],rv);var ue,pa=Math.PI,qo=(ue=function(n){xe(i,n);function i(){return n.apply(this,arguments)}var a=i.prototype;return a.load=function(e,r){var o=this;return new Ae(function(s,l){var u=r.engine;o.request(e.url,{type:"arraybuffer"}).then(function(c){for(var d=new Uint8Array(c),_=qo._parseHeader(d),h=_.width,f=_.height,g=_.dataPosition,y=qo._readPixels(d.subarray(g),h,f),p=f>>1,v=qo._convertToCubemap(y,h,f,p),m=new yn(u,p),x=0;x<6;x++)m.setPixelBuffer(an.PositiveX+x,v[x],0);m.generateMipmaps(),s(m)}).catch(l)})},i._convertToCubemap=function(e,r,o,s){if(!e)throw"ConvertPanoramaToCubemap: input cannot be null";if(e.length!=r*o*4)throw"ConvertPanoramaToCubemap: input size is wrong";var l=this._createCubemapData(s,this._faceRight,e,r,o),u=this._createCubemapData(s,this._faceLeft,e,r,o),c=this._createCubemapData(s,this._faceUp,e,r,o),d=this._createCubemapData(s,this._faceBottom,e,r,o),_=this._createCubemapData(s,this._faceFront,e,r,o),h=this._createCubemapData(s,this._faceBack,e,r,o);return[l,u,c,d,_,h]},i._createCubemapData=function(e,r,o,s,l){for(var u=new Uint8ClampedArray(e*e*4),c=this._tempVector3.set(0,0,0).add(r[1]).subtract(r[0]).scale(1/e),d=this._temp2Vector3.set(0,0,0).add(r[3]).subtract(r[2]).scale(1/e),_=1/e,h=0,f=0;f<e;f++){for(var g=this._temp3Vector3.set(0,0,0).add(r[0]),y=this._temp4Vector3.set(0,0,0).add(r[2]),p=0;p<e;p++){var v=this._temp5Vector3.set(0,0,0).add(y).subtract(g).scale(h).add(g);v.normalize();var m=this._calcProjectionSpherical(v,o,s,l);this._RGBEToLinear(m),this._linearToRGBM(m,5);var x=f*e*4+p*4;u[x]=m.r,u[x+1]=m.g,u[x+2]=m.b,u[x+3]=m.a,g.add(c),y.add(d)}h+=_}return u},i._calcProjectionSpherical=function(e,r,o,s){for(var l=Math.atan2(e.z,-e.x),u=Math.acos(e.y);l<-pa;)l+=2*pa;for(;l>pa;)l-=2*pa;var c=l/pa,d=u/pa;c=c*.5+.5;var _=Math.round(c*o);_<0?_=0:_>=o&&(_=o-1);var h=Math.round(d*s);h<0?h=0:h>=s&&(h=s-1);var f=s-h-1,g=f*o*4+_*4,y=r[g],p=r[g+1],v=r[g+2],m=r[g+3];return new ne(y,p,v,m)},i._readStringLine=function(e,r){for(var o="",s="",l=r;l<e.length-r&&(s=String.fromCharCode(e[l]),s!=`
`);l++)o+=s;return o},i._parseHeader=function(e){var r=0,o=0,s=this._readStringLine(e,0);if(s[0]!="#"||s[1]!="?")throw"Bad HDR Format.";var l=!1,u=!1,c=0;do c+=s.length+1,s=this._readStringLine(e,c),s=="FORMAT=32-bit_rle_rgbe"?u=!0:s.length==0&&(l=!0);while(!l);if(!u)throw"HDR Bad header format, unsupported FORMAT";c+=s.length+1,s=this._readStringLine(e,c);var d=/^\-Y (.*) \+X (.*)$/g,_=d.exec(s);if(!_||_.length<3)throw"HDR Bad header format, no size";if(o=parseInt(_[2]),r=parseInt(_[1]),o<8||o>32767)throw"HDR Bad header format, unsupported size";return c+=s.length+1,{height:r,width:o,dataPosition:c}},i._readPixels=function(e,r,o){for(var s=r,l=e.byteLength,u=new Uint8Array(4*r*o),c=0,d=0,_=4*s,h=new Uint8Array(4),f=new Uint8Array(_),g=o;g>0&&d<l;){if(h[0]=e[d++],h[1]=e[d++],h[2]=e[d++],h[3]=e[d++],h[0]!=2||h[1]!=2||(h[2]<<8|h[3])!=s)throw"HDR Bad header format, wrong scan line width";for(var y=0,p=void 0;y<_&&d<l;){p=e[d++];var v=p>128;if(v&&(p-=128),p===0||y+p>_)throw"HDR Bad Format, bad scanline data (run)";if(v)for(var m=e[d++],x=0;x<p;x++)f[y++]=m;else f.set(e.subarray(d,d+p),y),y+=p,d+=p}for(var S=s,C=0;C<S;C++){var A=0;u[c]=f[C+A],A+=s,u[c+1]=f[C+A],A+=s,u[c+2]=f[C+A],A+=s,u[c+3]=f[C+A],c+=4}g--}return u},i._RGBEToLinear=function(e){var r=Math.pow(2,e.a-128)/255;e.r*=r,e.g*=r,e.b*=r,e.a=1},i._linearToRGBM=function(e,r){var o=Math.max(e.r,Math.max(e.g,e.b)),s=Math.min(o/r,1);s=Math.ceil(s*255);var l=65025/(s*r);e.r*=l,e.g*=l,e.b*=l,e.a*=s},i}(Oe),ue._rightBottomBack=new w(1,-1,-1),ue._rightBottomFront=new w(1,-1,1),ue._rightUpBack=new w(1,1,-1),ue._rightUpFront=new w(1,1,1),ue._leftBottomBack=new w(-1,-1,-1),ue._leftBottomFront=new w(-1,-1,1),ue._leftUpBack=new w(-1,1,-1),ue._leftUpFront=new w(-1,1,1),ue._faceRight=[ue._rightBottomBack,ue._rightBottomFront,ue._rightUpBack,ue._rightUpFront],ue._faceLeft=[ue._leftBottomFront,ue._leftBottomBack,ue._leftUpFront,ue._leftUpBack],ue._faceUp=[ue._leftBottomFront,ue._rightBottomFront,ue._leftBottomBack,ue._rightBottomBack],ue._faceBottom=[ue._leftUpBack,ue._rightUpBack,ue._leftUpFront,ue._rightUpFront],ue._faceFront=[ue._leftBottomBack,ue._rightBottomBack,ue._leftUpBack,ue._rightUpBack],ue._faceBack=[ue._rightBottomFront,ue._leftBottomFront,ue._rightUpFront,ue._leftUpFront],ue._tempVector3=new w,ue._temp2Vector3=new w,ue._temp3Vector3=new w,ue._temp4Vector3=new w,ue._temp5Vector3=new w,ue);qo=Te([lt(Xe.HDR,["hdr"])],qo);var iv=function(n){xe(i,n);function i(){return n.apply(this,arguments)}var a=i.prototype;return a.load=function(e){return this.request(e.url,Wn({},e,{type:"json"}))},i}(Oe);iv=Te([lt(Xe.JSON,["json"],!1)],iv);var QS=12+13*4,$S=0;function KS(n,i){for(var a=[],t=QS+n.bytesOfKeyValueData,e=n.pixelWidth,r=n.pixelHeight,o=i?n.numberOfMipmapLevels:1,s=0;s<o;s++){var l=new Int32Array(n.buffer,t,1)[0];t+=4;for(var u=0;u<n.numberOfFaces;u++){var c=new Uint8Array(n.buffer,t,l);a.push({data:c,width:e,height:r}),t+=l,t+=3-(l+3)%4}e=Math.max(1,e*.5),r=Math.max(1,r*.5)}return a}function JS(n){if(n.byteLength>=12){var i=new Uint8Array(n,0,12);if(i[0]===171&&i[1]===75&&i[2]===84&&i[3]===88&&i[4]===32&&i[5]===49&&i[6]===49&&i[7]===187&&i[8]===13&&i[9]===10&&i[10]===26&&i[11]===10)return!0}return!1}function ZS(n){switch(n){case se.RGB_S3TC_DXT1_EXT:return j.DXT1;case se.RGBA_S3TC_DXT5_EXT:return j.DXT5;case se.RGB_ETC1_WEBGL:return j.ETC1_RGB;case se.RGB8_ETC2:return j.ETC2_RGB;case se.RGB8_PUNCHTHROUGH_ALPHA1_ETC2:return j.ETC2_RGBA5;case se.RGBA8_ETC2_EAC:return j.ETC2_RGBA8;case se.RGB_PVRTC_2BPPV1_IMG:return j.PVRTC_RGB2;case se.RGBA_PVRTC_2BPPV1_IMG:return j.PVRTC_RGBA2;case se.RGB_PVRTC_4BPPV1_IMG:return j.PVRTC_RGB4;case se.RGBA_PVRTC_4BPPV1_IMG:return j.PVRTC_RGBA4;case se.RGBA_ASTC_4X4_KHR:return j.ASTC_4x4;case se.RGBA_ASTC_5X5_KHR:return j.ASTC_5x5;case se.RGBA_ASTC_6X6_KHR:return j.ASTC_6x6;case se.RGBA_ASTC_8X8_KHR:return j.ASTC_8x8;case se.RGBA_ASTC_10X10_KHR:return j.ASTC_10x10;case se.RGBA_ASTC_12X12_KHR:return j.ASTC_12x12;default:var i=se[n];throw new Error("this format is not supported in Oasis Engine: "+i)}}var j0={parse:function(i,a,t,e){if(e===void 0&&(e=!1),!JS(i))throw new Error("khronosTextureContainerParser: invalid KTX file, texture missing KTX identifier");var r=Uint32Array.BYTES_PER_ELEMENT,o=new DataView(i,12,13*r),s=o.getUint32(0,!0),l=s===67305985,u={buffer:i,glType:o.getUint32(1*r,l),glTypeSize:o.getUint32(2*r,l),glFormat:o.getUint32(3*r,l),glInternalFormat:o.getUint32(4*r,l),glBaseInternalFormat:o.getUint32(5*r,l),pixelWidth:o.getUint32(6*r,l),pixelHeight:o.getUint32(7*r,l),pixelDepth:o.getUint32(8*r,l),numberOfArrayElements:o.getUint32(9*r,l),numberOfFaces:o.getUint32(10*r,l),numberOfMipmapLevels:o.getUint32(11*r,l),bytesOfKeyValueData:o.getUint32(12*r,l),loadType:$S};if(u.glType!==0)throw new Error("only compressed formats currently supported");if(u.numberOfMipmapLevels=Math.max(1,u.numberOfMipmapLevels),u.pixelHeight===0||u.pixelDepth!==0)throw new Error("only 2D textures currently supported");if(u.numberOfArrayElements!==0)throw new Error("texture arrays not currently supported");if(u.numberOfFaces!==a)throw new Error("number of faces expected"+a+", but found "+u.numberOfFaces);return t&&(u.mipmaps=KS(u,!0)),e&&(u.engineFormat=ZS(u.glInternalFormat)),u}};function eC(n){var i=j0.parse(n,1,!0,!0);return{mipmaps:i.mipmaps,engineFormat:i.engineFormat,internalFormat:i.glInternalFormat,width:i.pixelWidth,height:i.pixelHeight}}function tC(n){for(var i=[],a,t,e,r,o=0;o<n.length;o++){var s=j0.parse(n[o],1,!0,!0);i.push(s.mipmaps),o===0&&(e=s.pixelWidth,r=s.pixelHeight,a=s.glInternalFormat,t=s.engineFormat)}return{mipmapsFaces:i,engineFormat:t,internalFormat:a,width:e,height:r}}var av=function(n){xe(i,n);function i(){return n.apply(this,arguments)}var a=i.prototype;return a.load=function(e,r){var o=this;return new Ae(function(s,l){Promise.all(e.urls.map(function(u){return o.request(u,Wn({},e,{type:"arraybuffer"}))})).then(function(u){for(var c=tC(u),d=c.width,_=c.mipmapsFaces,h=c.engineFormat,f=_[0].length>1,g=new yn(r.engine,d,h,f),y=0;y<6;y++)for(var p=_[y].length,v=0;v<p;v++){var m=_[y][v],x=m.data,S=m.width,C=m.height;g.setPixelBuffer(an.PositiveX+y,x,v,0,0,S,C)}s(g)}).catch(function(u){l(u)})})},i}(Oe);av=Te([lt(Xe.KTXCube,[])],av);var ov=function(n){xe(i,n);function i(){return n.apply(this,arguments)}var a=i.prototype;return a.load=function(e,r){var o=this;return new Ae(function(s,l){o.request(e.url,Wn({},e,{type:"arraybuffer"})).then(function(u){for(var c=eC(u),d=c.width,_=c.height,h=c.mipmaps,f=c.engineFormat,g=h.length>1,y=new dn(r.engine,d,_,f,g),p=0;p<h.length;p++){var v=h[p],m=v.width,x=v.height,S=v.data;y.setPixelBuffer(S,p,0,0,m,x)}s(y)}).catch(function(u){l(u)})})},i}(Oe);ov=Te([lt(Xe.KTX,["ktx"])],ov);var sv=function(n){xe(i,n);function i(){return n.apply(this,arguments)}var a=i.prototype;return a.load=function(e,r){var o=this;return new Ae(function(s,l){o.request(e.url,Wn({},e,{type:"json"})).then(function(u){var c=function(b){var M=f[b],F=M.type,I=M.value;switch(F){case"Vector2":m.setVector2(b,new W(I.x,I.y));break;case"Vector3":m.setVector3(b,new w(I.x,I.y,I.z));break;case"Vector4":m.setVector4(b,new he(I.x,I.y,I.z,I.w));break;case"Color":m.setColor(b,new ne(I.r,I.g,I.b,I.a));break;case"Float":m.setFloat(b,I);break;case"Texture":v.push(r.getResourceByRef(I).then(function(L){m.setTexture(b,L)}));break}},d=r.engine,_=u.name,h=u.shader,f=u.shaderData,g=u.macros,y=u.renderState,p;switch(h){case"pbr":p=new co(d);break;case"pbr-specular":p=new ca(d);break;case"unlit":p=new aa(d);break;case"blinn-phong":p=new uo(d);break;case"bake-pbr":p=new jn(d,B.find("bake-pbr"));break}p.name=_;var v=new Array,m=p.shaderData;for(var x in f)c(x);for(var S=0,C=g.length;S<C;S++){var A=g[S],T=A.name,E=A.value;E==null?m.enableMacro(T):m.enableMacro(T,E)}for(var P in y)p[P]=y[P];return Promise.all(v).then(function(){s(p)})}).catch(l)})},i}(Oe);sv=Te([lt(Xe.Material,["json"])],sv);function lv(n,i){for(var a=0;a<i.length;a++){var t=i[a];t.enumerable=t.enumerable||!1,t.configurable=!0,"value"in t&&(t.writable=!0),Object.defineProperty(n,t.key,t)}}function Y0(n,i,a){return i&&lv(n.prototype,i),a&&lv(n,a),n}var q0=function(){function n(a,t,e,r){t===void 0&&(t=0),r===void 0&&(r=!0),this.buffer=a,this._dataView=new DataView(a),this._littleEndian=r,this._offset=t}var i=n.prototype;return i.nextUint8=function(){var t=this._dataView.getUint8(this._offset);return this._offset+=1,t},i.nextUint16=function(){var t=this._dataView.getUint16(this._offset,this._littleEndian);return this._offset+=2,t},i.nextUint32=function(){var t=this._dataView.getUint32(this._offset,this._littleEndian);return this._offset+=4,t},i.nextInt32=function(){var t=this._dataView.getInt32(this._offset,this._littleEndian);return this._offset+=4,t},i.nextInt32Array=function(t){var e=new Int32Array(this.buffer,this._offset,t);return this._offset+=4*t,e},i.nextFloat32=function(){var t=this._dataView.getFloat32(this._offset,this._littleEndian);return this._offset+=4,t},i.nextFloat32Array=function(t){var e=new Float32Array(this.buffer,this._offset,t);return this._offset+=4*t,e},i.nextUint32Array=function(t){var e=new Uint32Array(this.buffer,this._offset,t);return this._offset+=4*t,e},i.nextUint8Array=function(t){var e=new Uint8Array(this.buffer,this._offset,t);return this._offset+=t,e},i.nextUint64=function(){var t=this._dataView.getUint32(this._offset,this._littleEndian),e=this._dataView.getUint32(this._offset+4,this._littleEndian),r=t+Math.pow(2,32)*e;return this._offset+=8,r},i.nextStr=function(){var t=this.nextUint16(),e=new Uint8Array(this.buffer,this._offset,t);return this._offset+=t,ge.decodeText(e)},i.nextImageData=function(t){return this.buffer.slice(this._offset)},i.nextImagesData=function(t){for(var e=new Array(t),r=0;r<t;r++){var o=this._dataView.getUint32(this._offset,this._littleEndian);e[r]=o,this._offset+=4}for(var s=[],l=0;l<t;l++){var u=e[l],c=this.buffer.slice(this._offset,this._offset+u);this._offset+=u,s.push(c)}return s},i.skip=function(t){return this._offset+=t,this},i.scan=function(t,e){e===void 0&&(e=0);for(var r=this._offset,o=0;this._dataView.getUint8(this._offset)!==e&&o<t;)o++,this._offset++;return o<t&&this._offset++,new Uint8Array(this._dataView.buffer,this._dataView.byteOffset+r,o)},Y0(n,[{key:"offset",get:function(){return this._offset}}]),n}();q0.imageMapping={0:"image/png",1:"image/jpg",2:"image/webp",3:"ktx"};var Q0={};function th(n){return function(i){Q0[n]=i}}var nC=function(){function n(){this.totalLength=0,this.version=0,this.type="",this.name="",this.headerLength=0}return n.decode=function(a){var t=new DataView(a),e=t.getUint32(0,!0),r=t.getUint8(4),o=t.getUint16(5,!0),s=new Uint8Array(a,7,o),l=t.getUint16(7+o,!0),u=new Uint8Array(a,9+o,l),c=ge.decodeText(u),d=ge.decodeText(s),_=new n;return _.totalLength=e,_.name=c,_.type=d,_.version=r,_.headerLength=u.byteLength+s.byteLength+9,_},Y0(n,[{key:"dataLength",get:function(){return this.totalLength-this.headerLength}}]),n}(),uv=function(){function n(){}return n.decode=function(a,t){return new Promise(function(e){var r=new Et(a),o=t.nextStr(),s=JSON.parse(o);s.bounds&&r.bounds.copyFrom(s.bounds);var l=Math.ceil(t.offset/4)*4,u=new Float32Array(t.buffer,s.positions.start+l,(s.positions.end-s.positions.start)/4),c=u.length/3,d=ul(u,c);if(r.setPositions(d),s.normals){var _=new Float32Array(t.buffer,s.normals.start+l,(s.normals.end-s.normals.start)/4),h=ul(_,c);r.setNormals(h)}if(s.uvs){var f=new Float32Array(t.buffer,s.uvs.start+l,(s.uvs.end-s.uvs.start)/4);r.setUVs(ei(f,c))}if(s.uv1){var g=new Float32Array(t.buffer,s.uv1.start+l,(s.uv1.end-s.uv1.start)/4);r.setUVs(ei(g,c),1)}if(s.uv2){var y=new Float32Array(t.buffer,s.uv2.start+l,(s.uv2.end-s.uv2.start)/4);r.setUVs(ei(y,c),2)}if(s.uv3){var p=new Float32Array(t.buffer,s.uv3.start+l,(s.uv3.end-s.uv3.start)/4);r.setUVs(ei(p,c),3)}if(s.uv4){var v=new Float32Array(t.buffer,s.uv4.start+l,(s.uv4.end-s.uv4.start)/4);r.setUVs(ei(v,c),4)}if(s.uv5){var m=new Float32Array(t.buffer,s.uv5.start+l,(s.uv5.end-s.uv5.start)/4);r.setUVs(ei(m,c),5)}if(s.uv6){var x=new Float32Array(t.buffer,s.uv6.start+l,(s.uv6.end-s.uv6.start)/4);r.setUVs(ei(x,c),6)}if(s.uv7){var S=new Float32Array(t.buffer,s.uv7.start+l,(s.uv7.end-s.uv7.start)/4);r.setUVs(ei(S,c),7)}if(s.colors){var C=new Float32Array(t.buffer,s.colors.start+l,(s.colors.end-s.colors.start)/4);r.setColors(rC(C,c))}if(s.boneWeights){var A=new Float32Array(t.buffer,s.boneWeights.start+l,(s.boneWeights.end-s.boneWeights.start)/4);r.setBoneWeights(pc(A,c))}if(s.boneIndices){var T=new Float32Array(t.buffer,s.boneIndices.start+l,(s.boneIndices.end-s.boneIndices.start)/4);r.setBoneIndices(pc(T,c))}if(s.blendShapes&&s.blendShapes.forEach(function(P){var b=new G_(P.name);P.frames.forEach(function(M){var F=new Float32Array(t.buffer,M.deltaPosition.start+l,(M.deltaPosition.end-M.deltaPosition.start)/4),I=F.length/3,L=ul(F,I);if(M.deltaNormals){var V=new Float32Array(t.buffer,M.deltaNormals.start+l,(M.deltaNormals.end-M.deltaNormals.start)/4);ul(V,I)}if(M.deltaTangents){var U=new Float32Array(t.buffer,M.deltaTangents.start+l,(M.deltaTangents.end-M.deltaTangents.start)/4);pc(U,I)}b.addFrame(M.weight,L)}),r.addBlendShape(b)}),s.indices){var E=null;s.indices.type===0?E=new Uint16Array(t.buffer,s.indices.start+l,(s.indices.end-s.indices.start)/2):E=new Uint32Array(t.buffer,s.indices.start+l,(s.indices.end-s.indices.start)/4),r.setIndices(E)}s.subMeshes.forEach(function(P){return r.addSubMesh(P)}),r.uploadData(!1),e(r)})},n}();uv=Te([th("Mesh")],uv);function rC(n,i){for(var a=new Array(i),t=0;t<i;t++)a[t]=new ne(n[t*4],n[t*4+1],n[t*4+2],n[t*4+3]);return a}function pc(n,i){for(var a=new Array(i),t=0;t<i;t++)a[t]=new he(n[t*4],n[t*4+1],n[t*4+2],n[t*4+3]);return a}function ul(n,i){for(var a=new Array(i),t=0;t<i;t++)a[t]=new w(n[t*3],n[t*3+1],n[t*3+2]);return a}function ei(n,i){for(var a=new Array(i),t=0;t<i;t++)a[t]=new W(n[t*2],n[t*2+1]);return a}var cv=function(){function n(){}return n.decode=function(a,t){return new Promise(function(e,r){var o=t.nextStr(),s=!!t.nextUint8(),l=t.nextUint8(),u=t.nextUint8(),c=t.nextUint8(),d=t.nextUint8(),_=t.nextUint8(),h=t.nextUint16(),f=t.nextUint16(),g=t.nextUint8(),y=t.nextUint8(),p=t.nextImagesData(y),v=new dn(a,h,f,_,s);if(v.filterMode=l,v.anisoLevel=u,v.wrapModeU=c,v.wrapModeV=d,g){var m=new Uint8Array(p[0]);if(v.setPixelBuffer(m),s){v.generateMipmaps();for(var x=1;x<y;x++){var S=new Uint8Array(p[x]);v.setPixelBuffer(S,x)}}a.resourceManager._objectPool[o]=v,e(v)}else{var C=new window.Blob([p[0]]),A=new Image;A.onload=function(){v.setImageSource(A);var T=0,E=function(){T++,T>=y&&e(v)};if(E(),s){var P=function(M){var F=new window.Blob([p[M]]),I=new Image;I.onload=function(){v.setImageSource(I,M),E()},I.src=URL.createObjectURL(F)};v.generateMipmaps();for(var b=1;b<y;b++)P(b)}},A.src=URL.createObjectURL(C)}})},n}();cv=Te([th("Texture2D")],cv);function iC(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch{return!1}}function Pl(n,i,a){return iC()?Pl=Reflect.construct:Pl=function(e,r,o){var s=[null];s.push.apply(s,r);var l=Function.bind.apply(e,s),u=new l;return o&&k0(u,o.prototype),u},Pl.apply(null,arguments)}function aC(n,i,a){return Pl.apply(null,arguments)}var du=function(){function n(){}return n.registerCustomParseComponent=function(a,t){this.customParseComponentHandles[a]=t},n.parseEntity=function(a,t){return n.getEntityByConfig(a,t).then(function(e){var r;e.isActive=(r=a.isActive)!=null?r:!0;var o=a.position,s=a.rotation,l=a.scale;return o&&e.transform.position.copyFrom(o),s&&e.transform.rotation.copyFrom(s),l&&e.transform.scale.copyFrom(l),e})},n.getEntityByConfig=function(a,t){var e=a.assetRefId;if(e)return t.resourceManager.getResourceByRef({refId:e,key:a.key,isClone:a.isClone}).then(function(o){return o.name=a.name,o});var r=new Fr(t,a.name);return Promise.resolve(r)},n.parseClassObject=function(a,t,e){e===void 0&&(e=t.resourceManager);var r=Oe.getClass(a.class),o,s=(o=a.constructParams)!=null?o:[],l=aC(r,[].concat(s));return this.parsePropsAndMethods(l,a,t,e)},n.parseBasicType=function(a,t,e){e===void 0&&(e=t.resourceManager);var r=this;return Array.isArray(a)?Promise.all(a.map(function(o){return r.parseBasicType(o,t,e)})):typeof a=="object"&&a!=null?this._isClass(a)?this.parseClassObject(a,t,e):this._isRef(a)?e.getResourceByRef(a):Promise.resolve(a):Promise.resolve(a)},n.parsePropsAndMethods=function(a,t,e,r){r===void 0&&(r=e.resourceManager);var o=this,s=[];if(t.methods)for(var l in t.methods)for(var u=t.methods[l],c=0,d=u.length;c<d;c++){var _=u[c],h=this.parseMethod(a,l,_,e,r);s.push(h)}if(t.props){var f=this,g=function(p){var v=t.props[p],m=f.parseBasicType(v,e).then(function(x){return a[p]=x});s.push(m)};for(var y in t.props)g(y)}return Promise.all(s).then(function(){var p=o.customParseComponentHandles[a.constructor.name];return p?p(a,t,e):a})},n.parseMethod=function(a,t,e,r,o){o===void 0&&(o=r.resourceManager);var s=this;return Promise.all(e.map(function(l){return s.parseBasicType(l,r,o)})).then(function(l){var u;return(u=a)[t].apply(u,l)})},n._isClass=function(a){return a.class!=null},n._isRef=function(a){return a.refId!=null},n}();du.customParseComponentHandles=new Map;var oC=function(){function n(){}return n.parseChildren=function(a,t,e){var r=a.get(e).children;if(r&&r.length>0)for(var o=t.get(e),s=0;s<r.length;s++){var l=r[s],u=t.get(l);o.addChild(u),this.parseChildren(a,t,l)}},n}(),sC={Transform:fe,Animator:sr,DirectLight:xr,Camera:Pe,MeshRenderer:et,ParticleRenderer:Nu,PointLight:wr,SpotLight:_n,Script:Ft,SpriteMask:hn,SpriteRenderer:en,TextRenderer:Ye},dv;(function(n){n[n.Float=0]="Float",n[n.FloatArray=1]="FloatArray",n[n.Vector2=2]="Vector2",n[n.Vector3=3]="Vector3",n[n.Vector4=4]="Vector4",n[n.Quaternion=5]="Quaternion",n[n.Color=6]="Color",n[n.Array=7]="Array",n[n.Boolean=8]="Boolean"})(dv||(dv={}));var _v=function(){function n(){}return n.decode=function(a,t){return new Promise(function(e){for(var r=t.nextStr(),o=new j_(r),s=t.nextUint16(),l=0;l<s;++l){var u=new X_;u.time=t.nextFloat32(),u.functionName=t.nextStr(),u.parameter=JSON.parse(t.nextStr()).val,o.addEvent(u)}for(var c=t.nextUint16(),d=0;d<c;++d){var _=t.nextStr(),h=t.nextStr(),f=sC[h],g=t.nextStr(),y=void 0,p=t.nextUint8(),v=t.nextUint16(),m=t.nextStr();switch(m){case"AnimationFloatCurve":{y=y||new su,y.interpolation=p;for(var x=0;x<v;++x){var S=new In;S.time=t.nextFloat32(),S.value=t.nextFloat32(),S.inTangent=t.nextFloat32(),S.outTangent=t.nextFloat32(),y.addKey(S)}break}case"AnimationArrayCurve":{y=y||new au,y.interpolation=p;for(var C=0;C<v;++C){var A=new In;A.time=t.nextFloat32();var T=t.nextUint16();A.value=Array.from(t.nextFloat32Array(T)),A.inTangent=Array.from(t.nextFloat32Array(T)),A.outTangent=Array.from(t.nextFloat32Array(T)),y.addKey(A)}break}case"AnimationFloatArrayCurve":{y=y||new xs,y.interpolation=p;for(var E=0;E<v;++E){var P=new In;P.time=t.nextFloat32();var b=t.nextUint16();P.value=t.nextFloat32Array(b),P.inTangent=Array.from(t.nextFloat32Array(b)),P.outTangent=Array.from(t.nextFloat32Array(b)),y.addKey(P)}break}case"AnimationVector2Curve":{y=y||new lu,y.interpolation=p;for(var M=0;M<v;++M){var F=new In;F.time=t.nextFloat32(),F.value=new W(t.nextFloat32(),t.nextFloat32()),F.inTangent=new W(t.nextFloat32(),t.nextFloat32()),F.outTangent=new W(t.nextFloat32(),t.nextFloat32()),y.addKey(F)}break}case"AnimationVector3Curve":{y=y||new ws,y.interpolation=p;for(var I=0;I<v;++I){var L=new In;L.time=t.nextFloat32(),L.value=new w(t.nextFloat32(),t.nextFloat32(),t.nextFloat32()),L.inTangent=new w(t.nextFloat32(),t.nextFloat32(),t.nextFloat32()),L.outTangent=new w(t.nextFloat32(),t.nextFloat32(),t.nextFloat32()),y.addKey(L)}break}case"AnimationVector4Curve":{y=y||new uu,y.interpolation=p;var V=new In;V.time=t.nextFloat32(),V.value=new he(t.nextFloat32(),t.nextFloat32(),t.nextFloat32(),t.nextFloat32()),V.inTangent=new he(t.nextFloat32(),t.nextFloat32(),t.nextFloat32(),t.nextFloat32()),V.outTangent=new he(t.nextFloat32(),t.nextFloat32(),t.nextFloat32(),t.nextFloat32()),y.addKey(V);break}case"AnimationColorCurve":{y=y||new ou,y.interpolation=p;for(var U=0;U<v;++U){var D=new In;D.time=t.nextFloat32(),D.value=new ne(t.nextFloat32(),t.nextFloat32(),t.nextFloat32(),t.nextFloat32()),D.inTangent=new he(t.nextFloat32(),t.nextFloat32(),t.nextFloat32(),t.nextFloat32()),D.outTangent=new he(t.nextFloat32(),t.nextFloat32(),t.nextFloat32(),t.nextFloat32()),y.addKey(D)}break}case"AnimationQuaternionCurve":{y=y||new io,y.interpolation=p;for(var R=0;R<v;++R){var N=new In;N.time=t.nextFloat32(),N.value=new ve(t.nextFloat32(),t.nextFloat32(),t.nextFloat32(),t.nextFloat32()),N.inTangent=new he(t.nextFloat32(),t.nextFloat32(),t.nextFloat32(),t.nextFloat32()),N.outTangent=new he(t.nextFloat32(),t.nextFloat32(),t.nextFloat32(),t.nextFloat32()),y.addKey(N)}break}}o.addCurveBinding(_,f,g,y)}e(o)})},n}();_v=Te([th("AnimationClip")],_v);var lC=function(){function n(a,t){this.originalData=a,this.scene=t,this.entityMap=new Map,this.components=new Map,this.assets=new Map,this.entityConfigMap=new Map,this.rootIds=[]}var i=n.prototype;return i.destroy=function(){this.entityMap.clear(),this.components.clear(),this.assets.clear(),this.entityConfigMap.clear(),this.rootIds.length=0},n}(),uC=function(){function n(a){var t=this;this.context=a,this._engine=this.context.scene.engine,this._organizeEntities=this._organizeEntities.bind(this),this._parseComponents=this._parseComponents.bind(this),this._clearAndResolveScene=this._clearAndResolveScene.bind(this),this.promise=new Promise(function(e,r){t._reject=r,t._resolve=e})}var i=n.prototype;return i.start=function(){this._parseEntities().then(this._organizeEntities).then(this._parseComponents).then(this._clearAndResolveScene).then(this._resolve).catch(this._reject)},i._parseEntities=function(){var t=this.context.originalData.entities,e=this.context.entityConfigMap,r=this.context.entityMap,o=this.context.rootIds,s=this._engine,l=t.map(function(u){return e.set(u.id,u),u.parent||o.push(u.id),du.parseEntity(u,s)});return Promise.all(l).then(function(u){for(var c=0,d=u.length;c<d;c++)r.set(t[c].id,u[c]);return u})},i._organizeEntities=function(){for(var t=this.context,e=t.entityConfigMap,r=t.entityMap,o=t.scene,s=t.rootIds,l=eh(s),u;!(u=l()).done;){var c=u.value;oC.parseChildren(e,r,c)}for(var d=s.map(function(h){return r.get(h)}),_=0;_<d.length;_++)o.addRootEntity(d[_])},i._parseComponents=function(){for(var t=this.context.originalData.entities,e=this.context.entityMap,r=0,o=t.length;r<o;r++)for(var s=t[r],l=e.get(s.id),u=0;u<s.components.length;u++){var c=s.components[u],d=c.refId?c.refId:c.class,_=void 0;d==="Animator"&&(_=l.getComponent(Oe.getClass(d))),_=_||l.addComponent(Oe.getClass(d)),du.parsePropsAndMethods(_,c,l.engine)}},i._clearAndResolveScene=function(){var t=this.context.scene;return this.context.destroy(),t},n.parse=function(t,e){var r=new Is(t),o=new lC(e,r),s=new n(o);return s.start(),s.promise},n}(),hv=function(n){xe(i,n);function i(){return n.apply(this,arguments)}var a=i.prototype;return a.load=function(e,r){var o=this;return new Ae(function(s,l){o.request(e.url,{type:"arraybuffer"}).then(function(u){nh(u,r.engine).then(function(c){s(c)})})})},i}(Oe);hv=Te([lt("Mesh",["prefab"],!0)],hv);var fv=function(n){xe(i,n);function i(){return n.apply(this,arguments)}var a=i.prototype;return a.load=function(e,r){var o=this;return new Ae(function(s){o.request(e.url,{type:"arraybuffer"}).then(function(l){nh(l,r.engine).then(function(u){s(u)})})})},i}(Oe);fv=Te([lt("EditorTexture2D",["prefab"],!0)],fv);function nh(n,i){var a=nC.decode(n),t=new q0(n,a.headerLength,a.dataLength);return Q0[a.type].decode(i,t).then(function(e){return e.name=a.name,e})}var vv=function(n){xe(i,n);function i(){return n.apply(this,arguments)}var a=i.prototype;return a.load=function(e,r){var o=this;return new Ae(function(s,l){o.request(e.url,Wn({},e,{type:"arraybuffer"})).then(function(u){return nh(u,r.engine)}).then(function(u){s(u)}).catch(l)})},i}(Oe);vv=Te([lt(Xe.Mesh,["mesh"])],vv);var pv=function(n){xe(i,n);function i(){return n.apply(this,arguments)}var a=i.prototype;return a.load=function(e,r){var o=this;return new Ae(function(s,l){var u=e.url;o._registerFont(u,u).then(function(){var c=new ia(r.engine,u);s(c)}).catch(function(c){l("load font "+u+" fail")})})},a._registerFont=function(e,r){return Z_(function(){var o;return J_(this,function(s){switch(s.label){case 0:return o=new FontFace(e,"url("+r+")"),[4,o.load()];case 1:return s.sent(),document.fonts.add(o),[2]}})})()},i}(Oe);pv=Te([lt(Xe.SourceFont,["ttf","otf","woff"],!1)],pv);var gv=function(n){xe(i,n);function i(){var t;return t=n.apply(this,arguments)||this,t._tempRect=new fd,t._tempVec2=new W,t}var a=i.prototype;return a.load=function(e,r){var o=this;return new Ae(function(s,l,u,c){var d=[];c(function(){for(var h=0;h<d.length;h++)d[h].cancel()});var _=o.request(e.url,Wn({},e,{type:"json"}));d.push(_),_.then(function(h){var f=h.atlasItems,g=h.format,y=f.length,p=Ae.all(f.map(function(v){var m=v.img;return o.request(ge.parseRelativeUrl(e.url,m),Wn({},e,{type:"image"}))}));return d.push(p),p.then(function(v){for(var m=r.engine,x=o._tempRect,S=o._tempVec2,C=new I0(m),A=0;A<y;A++){var T=v[A],E=T.width,P=T.height,b=new dn(m,E,P,g);b.setImageSource(T),b.generateMipmaps();for(var M=f[A],F=M.sprites,I=1/E,L=1/P,V=F.length-1;V>=0;V--){var U=F[V],D=U.region,R=U.atlasRegionOffset,N=U.atlasRegion,X=U.id,q=U.pivot,te=new W_(m,b,D?x.set(D.x,D.y,D.w,D.h):void 0,q?S.set(q.x,q.y):void 0,void 0,U.name);if(te.atlasRegion.set(N.x*I,N.y*L,N.w*I,N.h*L),U.atlasRotated&&(te.atlasRotated=!0),R){var ie=R.x,ce=R.y,le=R.z,ae=R.w;te.atlasRegionOffset.set(ie*I,ce*L,le*I,ae*L)}X!==void 0&&(te._assetID=X),C._addSprite(te)}}s(C)})}).catch(function(h){l(h)})})},i}(Oe);gv=Te([lt(Xe.SpriteAtlas,["atlas"],!1)],gv);var mv=function(n){xe(i,n);function i(){return n.apply(this,arguments)}var a=i.prototype;return a.load=function(e,r){var o=this;return new Ae(function(s,l){o.request(e.url,Wn({},e,{type:"json"})).then(function(u){r.getResourceByRef(u.texture).then(function(c){var d=new W_(r.engine,c);d.region=u.region,d.pivot=u.pivot,s(d)})}).catch(l)})},i}(Oe);mv=Te([lt(Xe.Sprite,["sprite"],!1)],mv);var yv=function(n){xe(i,n);function i(){return n.apply(this,arguments)}var a=i.prototype;return a.load=function(e,r){var o=this;return new Ae(function(s,l){o.request(e.url,Wn({},e,{type:"image"})).then(function(u){var c,d=(c=e.params)!=null?c:{},_=new dn(r.engine,u.width,u.height,d.format,d.mipmap);if(_._platformTexture){if(_.setImageSource(u),_.generateMipmaps(),e.url.indexOf("data:")!==0){var h=e.url.split("/");_.name=h[h.length-1]}s(_)}}).catch(function(u){l(u)})})},i}(Oe);yv=Te([lt(Xe.Texture2D,["png","jpg","webp","jpeg"])],yv);var xv=function(n){xe(i,n);function i(){return n.apply(this,arguments)}var a=i.prototype;return a.load=function(e,r){var o=this;return new Ae(function(s,l){Promise.all(e.urls.map(function(u){return o.request(u,Wn({},e,{type:"image"}))})).then(function(u){var c=u[0],d=c.width,_=c.height;if(d!==_){console.error("The cube texture must have the same width and height");return}var h=new yn(r.engine,d);if(h._platformTexture){for(var f=0;f<6;f++)h.setImageSource(an.PositiveX+f,u[f],0);h.generateMipmaps(),s(h)}}).catch(function(u){l(u)})})},i}(Oe);xv=Te([lt(Xe.TextureCube,[""])],xv);var wv=function(n){xe(i,n);function i(){return n.apply(this,arguments)}var a=i.prototype;return a.load=function(e,r){var o=this,s=r.engine;return new Ae(function(l,u){o.request(e.url,{type:"json"}).then(function(c){return s.resourceManager.initVirtualResources(c.files),uC.parse(s,c).then(function(d){var _=c.scene.ambient,h=Promise.resolve();_.ambientLight?h=r.getResourceByRef(c.scene.ambient.ambientLight).then(function(y){d.ambientLight=y,d.ambientLight.diffuseIntensity=_.diffuseIntensity,d.ambientLight.specularIntensity=_.specularIntensity}):(d.ambientLight.diffuseIntensity=_.diffuseIntensity,d.ambientLight.specularIntensity=_.specularIntensity,d.ambientLight.diffuseSolidColor.copyFrom(_.diffuseSolidColor));var f=c.scene.background;d.background.mode=f.mode;var g=Promise.resolve();switch(d.background.mode){case Cn.SolidColor:d.background.solidColor.copyFrom(f.color);break;case Cn.Sky:f.sky&&(g=r.getResourceByRef(f.sky).then(function(y){var p=d.background.sky,v=new K_(s);v.textureCubeMap=y.specularTexture,v.textureDecodeRGBM=!0,p.material=v,p.mesh=to.createCuboid(s,1,1,1)}));break;case Cn.Texture:f.texture&&(g=r.getResourceByRef(f.texture).then(function(y){d.background.texture=y}));break}return Promise.all([h,g]).then(function(){l(d)})})}).catch(u)})},i}(Oe);wv=Te([lt(Xe.Scene,["prefab"],!0)],wv);du.registerCustomParseComponent("TextRenderer",Z_(function(n,i,a){var t;return J_(this,function(e){return t=i.props,t.font||(n.font=ia.createFromOS(a,t.fontFamily||"Arial")),[2,n]})}));var cC="0.9.0-beta.66";console.log("oasis engine version: "+cC);for(var Sv in zf)Oe.registerClass(Sv,zf[Sv]);function Cv(n,i){for(var a=0;a<i.length;a++){var t=i[a];t.enumerable=t.enumerable||!1,t.configurable=!0,"value"in t&&(t.writable=!0),Object.defineProperty(n,fC(t.key),t)}}function dC(n,i,a){return i&&Cv(n.prototype,i),a&&Cv(n,a),Object.defineProperty(n,"prototype",{writable:!1}),n}function _C(n,i){n.prototype=Object.create(i.prototype),n.prototype.constructor=n,Id(n,i)}function Id(n,i){return Id=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},Id(n,i)}function hC(n,i){if(typeof n!="object"||n===null)return n;var a=n[Symbol.toPrimitive];if(a!==void 0){var t=a.call(n,i||"default");if(typeof t!="object")return t;throw new TypeError("@@toPrimitive must return a primitive value.")}return(i==="string"?String:Number)(n)}function fC(n){var i=hC(n,"string");return typeof i=="symbol"?i:String(i)}var de;(function(n){n[n.None=0]="None",n[n.ROTATE=1]="ROTATE",n[n.ZOOM=2]="ZOOM",n[n.PAN=4]="PAN",n[n.All=7]="All"})(de||(de={}));function zs(){return function(n){}}var Av,Tv;Av=zs(),Av(Tv=function(){function n(){}return n.onUpdateHandler=function(a){return a.isKeyHeldDown(Me.ArrowLeft)||a.isKeyHeldDown(Me.KeyA)||a.isKeyHeldDown(Me.ArrowUp)||a.isKeyHeldDown(Me.KeyW)||a.isKeyHeldDown(Me.ArrowDown)||a.isKeyHeldDown(Me.KeyS)||a.isKeyHeldDown(Me.ArrowRight)||a.isKeyHeldDown(Me.KeyD)?de.PAN:de.None},n.onUpdateDelta=function(a,t){var e=a.movementSpeed,r=a.input;t.x=t.y=t.z=0,(r.isKeyHeldDown(Me.ArrowLeft)||r.isKeyHeldDown(Me.KeyA))&&(t.x-=e),(r.isKeyHeldDown(Me.ArrowRight)||r.isKeyHeldDown(Me.KeyD))&&(t.x+=e),(r.isKeyHeldDown(Me.ArrowUp)||r.isKeyHeldDown(Me.KeyW))&&(t.z-=e),(r.isKeyHeldDown(Me.ArrowDown)||r.isKeyHeldDown(Me.KeyS))&&(t.z+=e)},n}());var Ev,Pv,ga,ri;(function(n){n[n.Moving=0]="Moving",n[n.Distance=1]="Distance",n[n.None=2]="None"})(ri||(ri={}));Ev=zs(),Ev(Pv=(ga=function(){function n(){}return n.onUpdateHandler=function(a){if(++this._frameIndex,a.pointers.length===1)if(a.isPointerHeldDown(qt.Primary))this._updateType(de.ROTATE,ri.Moving);else{var t=a.pointers[0].deltaPosition;(t.x!==0||t.y!==0)&&a.isPointerUp(qt.Primary)?this._updateType(de.ROTATE,ri.Moving):this._updateType(de.None,ri.None)}else this._updateType(de.None,ri.None);return this._handlerType},n.onUpdateDelta=function(a,t){var e=this._frameIndex;switch(this._deltaType){case ri.Moving:if(this._lastUsefulFrameIndex===e-1){var r=a.input.pointers[0].deltaPosition;t.x=r.x,t.y=r.y}else t.x=0,t.y=0;break}this._lastUsefulFrameIndex=e},n._updateType=function(a,t){(this._handlerType!==a||this._deltaType!==t)&&(this._handlerType=a,this._deltaType=t,this._lastUsefulFrameIndex=-1)},n}(),ga._deltaType=ri.Moving,ga._handlerType=de.None,ga._frameIndex=0,ga._lastUsefulFrameIndex=-1,ga));var bv=H.zeroTolerance,Ha=function(){function n(a,t,e){this.radius=a,this.phi=t,this.theta=e,this._matrix=new J,this._matrixInv=new J,this.radius=a!==void 0?a:1,this.phi=t!==void 0?t:0,this.theta=e!==void 0?e:0}var i=n.prototype;return i.makeSafe=function(){var t=Math.floor(this.phi/Math.PI);return this.phi=H.clamp(this.phi,t*Math.PI+bv,(t+1)*Math.PI-bv),this},i.set=function(t,e,r){return this.radius=t,this.phi=e,this.theta=r,this},i.setYAxis=function(t){var e=n._xAxis,r=n._yAxis,o=n._zAxis;w.equals(e.set(1,0,0),r.copyFrom(t).normalize())&&e.set(0,1,0),w.cross(e,r,o),o.normalize(),w.cross(r,o,e);var s=this._matrix.elements;s[0]=e.x,s[1]=e.y,s[2]=e.z,s[4]=r.x,s[5]=r.y,s[6]=r.z,s[8]=o.x,s[9]=o.y,s[10]=o.z;var l=this._matrixInv.elements;l[0]=e.x,l[4]=e.y,l[8]=e.z,l[1]=r.x,l[5]=r.y,l[9]=r.z,l[2]=o.x,l[6]=o.y,l[10]=o.z},i.setFromVec3=function(t,e){return e===void 0&&(e=!1),t.transformNormal(this._matrixInv),this.radius=t.length(),this.radius===0?(this.theta=0,this.phi=0):e?(this.phi=2*Math.PI-Math.acos(H.clamp(t.y/this.radius,-1,1)),this.theta=Math.atan2(-t.x,-t.z)):(this.phi=Math.acos(H.clamp(t.y/this.radius,-1,1)),this.theta=Math.atan2(t.x,t.z)),this},i.setToVec3=function(t){var e=this.radius,r=this.phi,o=this.theta,s=Math.sin(r)*e;return this.phi-=Math.floor(this.phi/Math.PI/2)*Math.PI*2,t.set(s*Math.sin(o),e*Math.cos(r),s*Math.cos(o)),t.transformNormal(this._matrix),this.phi>Math.PI},n}();Ha._xAxis=new w;Ha._yAxis=new w;Ha._zAxis=new w;var Mv,Rv,gc=(Mv=zs(),Mv(Rv=function(){function n(){}return n.onUpdateHandler=function(a){return a.isKeyHeldDown(Me.ArrowLeft)||a.isKeyHeldDown(Me.ArrowRight)||a.isKeyHeldDown(Me.ArrowUp)||a.isKeyHeldDown(Me.ArrowDown)?de.PAN:de.None},n.onUpdateDelta=function(a,t){var e=a.keyPanSpeed,r=a.input;t.x=t.y=0,r.isKeyHeldDown(Me.ArrowLeft)&&(t.x+=e),r.isKeyHeldDown(Me.ArrowRight)&&(t.x-=e),r.isKeyHeldDown(Me.ArrowUp)&&(t.y+=e),r.isKeyHeldDown(Me.ArrowDown)&&(t.y-=e)},n}())||Rv),Fv,Dv,Li,Lt;(function(n){n[n.Moving=0]="Moving",n[n.Distance=1]="Distance",n[n.None=2]="None"})(Lt||(Lt={}));var vC=(Fv=zs(),Fv(Dv=(Li=function(){function n(){}return n.onUpdateHandler=function(a){++this._frameIndex;var t=a.pointers;switch(t.length){case 1:if(a.isPointerHeldDown(qt.Secondary))this._updateType(de.PAN,Lt.Moving);else if(a.isPointerHeldDown(qt.Auxiliary))this._updateType(de.ZOOM,Lt.Moving);else if(a.isPointerHeldDown(qt.Primary))this._updateType(de.ROTATE,Lt.Moving);else{var e=a.pointers[0].deltaPosition;e.x!==0&&e.y!==0?a.isPointerUp(qt.Secondary)?this._updateType(de.PAN,Lt.Moving):a.isPointerUp(qt.Auxiliary)?this._updateType(de.ZOOM,Lt.Moving):a.isPointerUp(qt.Primary)?this._updateType(de.ROTATE,Lt.Moving):this._updateType(de.None,Lt.None):this._updateType(de.None,Lt.None)}break;case 2:this._updateType(de.ZOOM,Lt.Distance);break;case 3:this._updateType(de.PAN,Lt.Moving);break;default:this._updateType(de.None,Lt.None);break}return this._handlerType},n.onUpdateDelta=function(a,t){var e=this._frameIndex;switch(this._deltaType){case Lt.Moving:if(t.x=0,t.y=0,this._lastUsefulFrameIndex===e-1){for(var r=a.input.pointers,o=r.length,s=o-1;s>=0;s--){var l=r[s].deltaPosition;t.x+=l.x,t.y+=l.y}t.x/=o,t.y/=o}break;case Lt.Distance:var u=a.input.pointers,c=u[0],d=u[1],_=W.distance(c.position,d.position);this._lastUsefulFrameIndex===e-1?t.set(0,this._distanceOfPointers-_,0):t.set(0,0,0),this._distanceOfPointers=_;break}this._lastUsefulFrameIndex=e},n._updateType=function(a,t){(this._handlerType!==a||this._deltaType!==t)&&(this._handlerType=a,this._deltaType=t,this._lastUsefulFrameIndex=-1)},n}(),Li._deltaType=Lt.None,Li._handlerType=de.None,Li._frameIndex=0,Li._lastUsefulFrameIndex=-1,Li._distanceOfPointers=0,Li))||Dv),Bv,Iv,pC=(Bv=zs(),Bv(Iv=function(){function n(){}return n.onUpdateHandler=function(a){var t=a.wheelDelta;return t.x===0&&t.y===0&&t.z===0?de.None:de.ZOOM},n.onUpdateDelta=function(a,t){t.copyFrom(a.input.wheelDelta)},n}())||Iv),gC=function(n){_C(i,n);function i(){for(var t,e=arguments.length,r=new Array(e),o=0;o<e;o++)r[o]=arguments[o];return t=n.call.apply(n,[this].concat(r))||this,t.canvas=void 0,t.input=void 0,t.inputDevices=[gc,vC,pC],t.camera=void 0,t.cameraTransform=void 0,t.autoRotate=!1,t.autoRotateSpeed=Math.PI,t.enableDamping=!0,t.rotateSpeed=1,t.zoomSpeed=1,t.keyPanSpeed=7,t.dampingFactor=.1,t.zoomFactor=.2,t.minDistance=.1,t.maxDistance=1/0,t.minZoom=0,t.maxZoom=1/0,t.minPolarAngle=1,t.maxPolarAngle=179/180*Math.PI,t.minAzimuthAngle=-1/0,t.maxAzimuthAngle=1/0,t._enableKeys=!0,t._up=new w(0,1,0),t._target=new w,t._atTheBack=!1,t._spherical=new Ha,t._sphericalDelta=new Ha,t._sphericalDump=new Ha,t._zoomFrag=0,t._scale=1,t._panOffset=new w,t._tempVec3=new w,t._enableHandler=de.All,t}var a=i.prototype;return a.onAwake=function(){var e=this.engine,r=this.entity;this.canvas=e.canvas,this.input=e.inputManager,this.camera=r.getComponent(Pe),this.cameraTransform=r.transform,this._spherical.setYAxis(this._up),this._atTheBack=!1},a.onUpdate=function(e){debugger;this._updateInputDelta(e),this._updateTransform()},a._updateInputDelta=function(e){for(var r=de.None,o=this._tempVec3,s=this._enableHandler,l=this.inputDevices,u=this.input,c=l.length-1;c>=0;c--){var d=l[c],_=d.onUpdateHandler(u);if(_&s)switch(r|=_,d.onUpdateDelta(this,o),_){case de.ROTATE:this._rotate(o);break;case de.ZOOM:this._zoom(o);break;case de.PAN:this._pan(o);break}}var h=this._sphericalDump,f=this._sphericalDelta;if(this.enableDamping&&(s&de.ZOOM&&r^de.ZOOM&&(this._zoomFrag*=1-this.zoomFactor),s&de.ROTATE&&r^de.ROTATE&&(f.theta=h.theta*=1-this.dampingFactor,f.phi=h.phi*=1-this.dampingFactor)),r===de.None&&this.autoRotate){var g=this.autoRotateSpeed/1e3*e;f.theta-=g}},a._rotate=function(e){var r=2*Math.PI*e.x/this.canvas.width*this.rotateSpeed;this._sphericalDelta.theta-=r;var o=2*Math.PI*e.y/this.canvas.height*this.rotateSpeed;this._sphericalDelta.phi-=o,this.enableDamping&&(this._sphericalDump.theta=-r,this._sphericalDump.phi=-o)},a._zoom=function(e){e.y>0?this._scale/=Math.pow(.95,this.zoomSpeed):e.y<0&&(this._scale*=Math.pow(.95,this.zoomSpeed))},a._pan=function(e){var r=this.cameraTransform,o=r.worldMatrix.elements,s=this.canvas.height,l=w.distance(r.position,this.target)*(this.camera.fieldOfView/2)*(Math.PI/180),u=-2*e.x*(l/s),c=2*e.y*(l/s);this._panOffset.x+=o[0]*u+o[4]*c,this._panOffset.y+=o[1]*u+o[5]*c,this._panOffset.z+=o[2]*u+o[6]*c},a._updateTransform=function(){var e=this.cameraTransform,r=this.target,o=this._tempVec3,s=this._spherical,l=this._sphericalDelta,u=this._panOffset;w.subtract(e.position,r,o),s.setFromVec3(o,this._atTheBack),s.theta+=l.theta,s.phi+=l.phi,s.theta=Math.max(this.minAzimuthAngle,Math.min(this.maxAzimuthAngle,s.theta)),s.phi=Math.max(this.minPolarAngle,Math.min(this.maxPolarAngle,s.phi)),s.makeSafe(),this._scale!==1&&(this._zoomFrag=s.radius*(this._scale-1)),s.radius+=this._zoomFrag,s.radius=Math.max(this.minDistance,Math.min(this.maxDistance,s.radius)),this._atTheBack=s.setToVec3(o),w.add(r.add(u),o,e.worldPosition),e.lookAt(r,o.copyFrom(this.up).scale(this._atTheBack?-1:1)),this._zoomFrag=0,this._scale=1,l.set(0,0,0),u.set(0,0,0)},dC(i,[{key:"enableKeys",get:function(){return this._enableKeys},set:function(e){if(this._enableKeys!==e){this._enableKeys=e;var r=this.inputDevices;if(e)r.push(gc);else for(var o=r.length-1;o>=0;o--)if(r[o]===gc){r.splice(o,1);break}}}},{key:"up",get:function(){return this._up},set:function(e){this._up.copyFrom(e),this._spherical.setYAxis(e),this._atTheBack=!1}},{key:"target",get:function(){return this._target},set:function(e){this._target.copyFrom(e),this._atTheBack=!1}},{key:"enableRotate",get:function(){return(this._enableHandler&de.ROTATE)!==0},set:function(e){e?this._enableHandler|=de.ROTATE:this._enableHandler&=~de.ROTATE}},{key:"enableZoom",get:function(){return(this._enableHandler&de.ZOOM)!==0},set:function(e){e?this._enableHandler|=de.ZOOM:this._enableHandler&=~de.ZOOM}},{key:"enablePan",get:function(){return(this._enableHandler&de.PAN)!==0},set:function(e){e?this._enableHandler|=de.PAN:this._enableHandler&=~de.PAN}}]),i}(Ft),mC=`#define GLSLIFY 1
#include <common>
uniform vec3 u_colorId;void main(){gl_FragColor=vec4(u_colorId,1.0);}`,yC=`#define GLSLIFY 1
#include <common>
#include <common_vert>
#include <blendShape_input>
void main(){
#include <begin_position_vert>
#include <begin_normal_vert>
#include <blendShape_vert>
#include <skinning_vert>
#include <position_vert>
}`;B.create("framebuffer-picker-color",yC,mC);function Lv(n,i){for(var a=0;a<i.length;a++){var t=i[a];t.enumerable=t.enumerable||!1,t.configurable=!0,"value"in t&&(t.writable=!0),Object.defineProperty(n,SC(t.key),t)}}function $0(n,i,a){return i&&Lv(n.prototype,i),a&&Lv(n,a),Object.defineProperty(n,"prototype",{writable:!1}),n}function xC(n,i){n.prototype=Object.create(i.prototype),n.prototype.constructor=n,Ld(n,i)}function Ld(n,i){return Ld=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},Ld(n,i)}function wC(n,i){if(typeof n!="object"||n===null)return n;var a=n[Symbol.toPrimitive];if(a!==void 0){var t=a.call(n,i||"default");if(typeof t!="object")return t;throw new TypeError("@@toPrimitive must return a primitive value.")}return(i==="string"?String:Number)(n)}function SC(n){var i=wC(n,"string");return typeof i=="symbol"?i:String(i)}var It=function(){function n(){}return n.createCuboidWireframe=function(a,t,e,r,o,s,l){var u=a/2,c=t/2,d=e/2;r.push(new w(-u,c,-d)),r.push(new w(u,c,-d)),r.push(new w(u,c,d)),r.push(new w(-u,c,d)),r.push(new w(-u,-c,-d)),r.push(new w(u,-c,-d)),r.push(new w(u,-c,d)),r.push(new w(-u,-c,d)),r.push(new w(-u,c,-d)),r.push(new w(-u,c,d)),r.push(new w(-u,-c,d)),r.push(new w(-u,-c,-d)),r.push(new w(u,c,-d)),r.push(new w(u,c,d)),r.push(new w(u,-c,d)),r.push(new w(u,-c,-d)),r.push(new w(-u,c,d)),r.push(new w(u,c,d)),r.push(new w(u,-c,d)),r.push(new w(-u,-c,d)),r.push(new w(-u,c,-d)),r.push(new w(u,c,-d)),r.push(new w(u,-c,-d)),r.push(new w(-u,-c,-d)),s[l++]=o,s[l++]=o+1,s[l++]=o+1,s[l++]=o+2,s[l++]=o+2,s[l++]=o+3,s[l++]=o+3,s[l++]=o,s[l++]=o+4,s[l++]=o+5,s[l++]=o+5,s[l++]=o+6,s[l++]=o+6,s[l++]=o+7,s[l++]=o+7,s[l++]=o+4,s[l++]=o+8,s[l++]=o+9,s[l++]=o+9,s[l++]=o+10,s[l++]=o+10,s[l++]=o+11,s[l++]=o+11,s[l++]=o+8,s[l++]=o+12,s[l++]=o+13,s[l++]=o+13,s[l++]=o+14,s[l++]=o+14,s[l++]=o+15,s[l++]=o+15,s[l++]=o+12,s[l++]=o+16,s[l++]=o+17,s[l++]=o+17,s[l++]=o+18,s[l++]=o+18,s[l++]=o+19,s[l++]=o+19,s[l++]=o+16,s[l++]=o+20,s[l++]=o+21,s[l++]=o+21,s[l++]=o+22,s[l++]=o+22,s[l++]=o+23,s[l++]=o+23,s[l++]=o+20},n.createSphereWireframe=function(a,t,e,r,o){var s=new w;n.createCircleWireframe(a,0,s,t,e,r,o),n.createCircleWireframe(a,1,s,t,e+n.circleVertexCount,r,o+n.circleIndexCount),n.createCircleWireframe(a,2,s,t,e+n.circleVertexCount*2,r,o+n.circleIndexCount*2)},n.createConeWireframe=function(a,t,e,r,o,s){var l=new w;l.y=-t,n.createCircleWireframe(a,1,l,e,r,o,s),e.push(new w),e.push(new w(-a,-t,0)),e.push(new w(a,-t,0)),e.push(new w(0,-t,a)),e.push(new w(0,-t,-a));var u=r+n.circleVertexCount;s+=n.circleIndexCount,o[s++]=u,o[s++]=u+1,o[s++]=u,o[s++]=u+2,o[s++]=u,o[s++]=u+3,o[s++]=u,o[s++]=u+4},n.createUnboundCylinderWireframe=function(a,t,e,r,o){var s=5,l=new w;n.createCircleWireframe(a,1,l,t,e,r,o);var u=e+n.circleVertexCount;o+=n.circleIndexCount;for(var c=0;c<8;c++){var d=H.degreeToRadian(45*c);t.push(new w(a*Math.cos(d),0,a*Math.sin(d))),t.push(new w(a*Math.cos(d),-s,a*Math.sin(d))),r[o+c*2]=u+2*c,r[o+c*2+1]=u+2*c+1}},n.createCapsuleWireframe=function(a,t,e,r,o,s){var l=n.circleIndexCount,u=n.circleVertexCount,c=new w,d=t/2;c.y=d,n.createCircleWireframe(a,1,c,e,r,o,s),c.y=-d,n.createCircleWireframe(a,1,c,e,r+u,o,s+l),n.createEllipticWireframe(a,d,2,e,r+u*2,o,s+l*2),n.createEllipticWireframe(a,d,0,e,r+u*3,o,s+l*2+n.ellipticIndexCount)},n.createCircleWireframe=function(a,t,e,r,o,s,l){for(var u=n.circleVertexCount,c=Math.PI*2,d=1/u,_=0;_<u;++_){var h=_*d,f=h*c;switch(t){case 0:r.push(new w(e.x,a*Math.cos(f)+e.y,a*Math.sin(f)+e.z));break;case 1:r.push(new w(a*Math.cos(f)+e.x,e.y,a*Math.sin(f)+e.z));break;case 2:r.push(new w(a*Math.cos(f)+e.x,a*Math.sin(f)+e.y,e.z));break}var g=_+o;_<u-1?(s[l+2*_]=g,s[l+2*_+1]=g+1):(s[l+2*_]=g,s[l+2*_+1]=o)}},n.createEllipticWireframe=function(a,t,e,r,o,s,l){for(var u=n.circleVertexCount,c=Math.PI*2,d=1/u,_=0;_<u;++_){var h=_*d,f=h*c;switch(e){case 0:r.push(new w(0,a*Math.sin(f)+t,a*Math.cos(f)));break;case 1:r.push(new w(a*Math.cos(f),t,a*Math.sin(f)));break;case 2:r.push(new w(a*Math.cos(f),a*Math.sin(f)+t,0));break}_==u/2&&(t=-t);var g=_+o;_<u-1?(s[l+2*_]=g,s[l+2*_+1]=g+1):(s[l+2*_]=g,s[l+2*_+1]=o)}},$0(n,null,[{key:"cuboidIndexCount",get:function(){return 48}},{key:"sphereIndexCount",get:function(){return n.circleIndexCount*3}},{key:"coneIndexCount",get:function(){return n.circleIndexCount+8}},{key:"unboundCylinderIndexCount",get:function(){return n.circleIndexCount+16}},{key:"capsuleIndexCount",get:function(){return(n.circleIndexCount+n.ellipticIndexCount)*2}},{key:"circleIndexCount",get:function(){return n.circleVertexCount*2}},{key:"ellipticIndexCount",get:function(){return n.circleVertexCount*2}}]),n}();It.circleVertexCount=40;var zv,Ov,Ar;zv=ua(et),zv(Ov=(Ar=function(n){xC(i,n);function i(){for(var t,e=arguments.length,r=new Array(e),o=0;o<e;o++)r[o]=arguments[o];return t=n.call.apply(n,[this].concat(r))||this,t._cameraPositions=[new w,new w,new w,new w,new w,new w,new w,new w],t._localPositions=[],t._globalPositions=[],t._indices=null,t._indicesCount=0,t._boundsIndicesCount=0,t._supportUint32Array=void 0,t._wireframeRenderers=[],t._wireframeElements=[],t._renderer=void 0,t._material=void 0,t._mesh=void 0,t}i._getPositionFromPool=function(e){var r,o=i._positionPool;return e<o.length?r=o[e]:(r=new w,i._positionPool.push(r)),r};var a=i.prototype;return a.clear=function(){this._wireframeRenderers.length=0,this._wireframeElements.length=0,this._localPositions.length=0,this._globalPositions.length=0,this._indicesCount=0,this._mesh.subMesh.count=0},a.addEntityWireframe=function(e,r){if(r===void 0&&(r=!0),r){var o=new Array;e.getComponentsIncludeChildren(Pe,o);for(var s=0,l=o.length;s<l;s++)this.addCameraWireframe(o[s]);var u=o.length;e.getComponentsIncludeChildren(_n,o);for(var c=u,d=o.length;c<d;c++)this.addSpotLightWireframe(o[c]);u=o.length,e.getComponentsIncludeChildren(xr,o);for(var _=u,h=o.length;_<h;_++)this.addDirectLightWireframe(o[_]);u=o.length,e.getComponentsIncludeChildren(wr,o);for(var f=u,g=o.length;f<g;f++)this.addPointLightWireframe(o[f]);u=o.length,e.getComponentsIncludeChildren(Tn,o);for(var y=u,p=o.length;y<p;y++)this.addCollideWireframe(o[y])}else{var v=e.getComponent(Pe);v&&this.addCameraWireframe(v);var m=e.getComponent(_n);m&&this.addSpotLightWireframe(m);var x=e.getComponent(xr);x&&this.addDirectLightWireframe(x);var S=e.getComponent(wr);S&&this.addPointLightWireframe(S);var C=e.getComponent(Tn);C&&this.addCollideWireframe(C)}},a.addCameraWireframe=function(e){var r=e.entity.transform,o=e.projectionMatrix.clone();o.invert();var s=this._localPositions,l=s.length;this._wireframeElements.push(new zi(r,l));for(var u=i._ndcPosition,c=0;c<4;c++){var d=this._cameraPositions[c];d.copyFrom(u[c]),d.transformCoordinate(o),s.push(d)}for(var _=0;_<4;_++){var h=this._cameraPositions[_+4];h.copyFrom(u[_]),h.z=1,h.transformCoordinate(o),s.push(h)}this._growthIndexMemory(24);var f=this._indices;f[this._indicesCount++]=l,f[this._indicesCount++]=l+1,f[this._indicesCount++]=l+1,f[this._indicesCount++]=l+2,f[this._indicesCount++]=l+2,f[this._indicesCount++]=l+3,f[this._indicesCount++]=l+3,f[this._indicesCount++]=l,f[this._indicesCount++]=l,f[this._indicesCount++]=l+4,f[this._indicesCount++]=l+1,f[this._indicesCount++]=l+5,f[this._indicesCount++]=l+2,f[this._indicesCount++]=l+6,f[this._indicesCount++]=l+3,f[this._indicesCount++]=l+7,f[this._indicesCount++]=l+4,f[this._indicesCount++]=l+5,f[this._indicesCount++]=l+5,f[this._indicesCount++]=l+6,f[this._indicesCount++]=l+6,f[this._indicesCount++]=l+7,f[this._indicesCount++]=l+7,f[this._indicesCount++]=l+4},a.addSpotLightWireframe=function(e){var r=e.distance,o=Math.tan(e.angle/2)*r,s=this._localPositions,l=s.length,u=It.coneIndexCount;this._growthIndexMemory(u);var c=this._indices;It.createConeWireframe(o,r,s,l,c,this._indicesCount),this._indicesCount+=u,this._rotateAroundX(l),this._wireframeElements.push(new zi(e.entity.transform,l))},a.addPointLightWireframe=function(e){var r=this._localPositions,o=r.length,s=It.sphereIndexCount;this._growthIndexMemory(s);var l=this._indices;It.createSphereWireframe(e.distance,r,o,l,this._indicesCount),this._indicesCount+=s,this._wireframeElements.push(new zi(e.entity.transform,o))},a.addDirectLightWireframe=function(e){var r=this._localPositions,o=r.length,s=It.unboundCylinderIndexCount;this._growthIndexMemory(s);var l=this._indices;It.createUnboundCylinderWireframe(1,r,o,l,this._indicesCount),this._indicesCount+=s,this._rotateAroundX(o),this._wireframeElements.push(new zi(e.entity.transform,o))},a.addRendererWireframe=function(e){this._boundsIndicesCount+=It.cuboidIndexCount,this._wireframeRenderers.push(e)},a.addCollideWireframe=function(e){for(var r=e.shapes,o=0,s=r.length;o<s;o++){var l=r[o];l instanceof w0?this.addBoxColliderShapeWireframe(l):l instanceof S0?this.addSphereColliderShapeWireframe(l):l instanceof C0&&this.addCapsuleColliderShapeWireframe(l)}},a.addBoxColliderShapeWireframe=function(e){var r=e.collider.entity.transform,o=r.lossyWorldScale,s=e.position,l=e.rotation,u=e.size,c=i._tempVector,d=i._tempRotation,_=this._localPositions,h=_.length,f=It.cuboidIndexCount;this._growthIndexMemory(f);var g=this._indices;It.createCuboidWireframe(o.x*u.x,o.y*u.y,o.z*u.z,_,h,g,this._indicesCount),ve.rotationYawPitchRoll(l.x,l.y,l.z,d),this._localRotation(h,d),w.multiply(s,o,c),this._localTranslate(h,c),this._indicesCount+=f,this._wireframeElements.push(new zi(r,h))},a.addSphereColliderShapeWireframe=function(e){var r=e.collider.entity.transform,o=r.lossyWorldScale,s=e.position,l=e.rotation,u=e.radius,c=i._tempVector,d=i._tempRotation,_=this._localPositions,h=_.length,f=It.sphereIndexCount;this._growthIndexMemory(f);var g=this._indices;It.createSphereWireframe(Math.max(o.x,o.y,o.z)*u,_,h,g,this._indicesCount),ve.rotationYawPitchRoll(l.x,l.y,l.z,d),this._localRotation(h,d),w.multiply(s,o,c),this._localTranslate(h,c),this._indicesCount+=f,this._wireframeElements.push(new zi(r,h))},a.addCapsuleColliderShapeWireframe=function(e){var r=e.collider.entity.transform,o=r.lossyWorldScale,s=Math.max(o.x,o.y,o.z),l=e.radius,u=e.height,c=e.upAxis,d=e.position,_=e.rotation,h=i._tempVector,f=i._tempRotation,g=i._tempAxis,y=i._halfSqrt,p=this._localPositions,v=p.length,m=It.capsuleIndexCount;this._growthIndexMemory(m);var x=this._indices;switch(It.createCapsuleWireframe(s*l,s*u,p,v,x,this._indicesCount),c){case $i.X:g.set(0,0,y,y);break;case $i.Y:g.set(0,0,0,1);break;case $i.Z:g.set(y,0,0,y)}ve.rotationYawPitchRoll(_.x,_.y,_.z,f),ve.multiply(f,g,f),this._localRotation(v,f),w.multiply(d,o,h),this._localTranslate(v,h),this._indicesCount+=m,this._wireframeElements.push(new zi(r,v))},a.onAwake=function(){var e=this.engine,r=new Et(e),o=new aa(e),s=this.entity.getComponent(et),l=e._hardwareRenderer.canIUse(Z.elementIndexUint);r._enableVAO=!1,r.addSubMesh(0,this._indicesCount,Ti.Lines),s.mesh=r,s.setMaterial(o),this._mesh=r,this._material=o,this._renderer=s,this._indices=l?new Uint32Array(128):new Uint16Array(128),this._supportUint32Array=l},a.onEnable=function(){this._renderer.enabled=!0},a.onDisable=function(){this._renderer.enabled=!1},a.onUpdate=function(e){var r=this._mesh,o=this._localPositions,s=this._globalPositions,l=this._wireframeElements,u=this._wireframeRenderers,c=this._indices,d=o.length;s.length=d;for(var _=0,h=!1,f=0,g=l.length;f<g;f++){var y=l[f],p=y.transformRanges,v=f<g-1?l[f+1].transformRanges:d;if(y.updateFlag.flag){var m=y.transform,x=i._tempMatrix;J.rotationTranslation(m.worldRotationQuaternion,m.worldPosition,x);for(var S=p;S<v;S++){var C=o[_],A=i._getPositionFromPool(_);w.transformCoordinate(C,x,A),s[_]=A,_++}y.updateFlag.flag=!1,h=!0}else _+=v-p}this._growthIndexMemory(this._boundsIndicesCount);for(var T=this._indicesCount,E=0;E<u.length;E++){var P=u[E],b=P.bounds,M=i._tempVector;b.getExtent(M);var F=s.length;It.createCuboidWireframe(M.x*2,M.y*2,M.z*2,s,F,c,T),b.getCenter(M);for(var I=F;I<s.length;I++){var L=s[I];L.add(M)}T+=It.cuboidIndexCount}(u.length>0||h)&&(r.setPositions(s),r.setIndices(this._indices),r.uploadData(!1),r.subMesh.count=T)},a._growthIndexMemory=function(e){var r=this._indices,o=this._indicesCount+e;if(o>r.length){var s=this._supportUint32Array?4294967295:65535;if(o>s)throw Error("The vertex count is over limit.");var l=this._supportUint32Array?new Uint32Array(o):new Uint16Array(o);l.set(r),this._indices=l}},a._localTranslate=function(e,r){for(var o=this._localPositions,s=e;s<o.length;s++){var l=o[s];l.add(r)}},a._localRotation=function(e,r){for(var o=this._localPositions,s=e;s<o.length;s++){var l=o[s];w.transformByQuat(l,r,l)}},a._rotateAroundX=function(e){for(var r=this._localPositions,o=e;o<r.length;o++){var s=r[o],l=s.y,u=s.z;s.z=l,s.y=-u}},$0(i,[{key:"baseColor",get:function(){return this._material.baseColor},set:function(e){this._material.baseColor=e}}]),i}(Ft),Ar._positionPool=[],Ar._ndcPosition=[new w(-1,1,-1),new w(1,1,-1),new w(1,-1,-1),new w(-1,-1,-1)],Ar._tempMatrix=new J,Ar._tempVector=new w,Ar._tempRotation=new ve,Ar._tempAxis=new ve,Ar._halfSqrt=.70710678118655,Ar));var zi=function(i,a){this.transform=i,this.transformRanges=a,this.updateFlag=void 0,this.updateFlag=i.registerWorldChangeFlag()};B.create("skeleton-viewer",`
  attribute vec3 POSITION;
  attribute vec3 NORMAL;

  uniform mat4 u_MVPMat;
  uniform mat4 u_normalMat;

  varying vec3 v_normal;

  void main(){
      gl_Position = u_MVPMat * vec4( POSITION , 1.0 );;
      v_normal = normalize( mat3(u_normalMat) * NORMAL );
  }`,`
      uniform vec3 u_colorMin;
      uniform vec3 u_colorMax;
      varying vec3 v_normal;

      void main(){
        float ndl = dot(v_normal, vec3(0, 1, 0)) * 0.5 + 0.5;
        vec3 diffuse = mix(u_colorMin, u_colorMax, ndl);
        gl_FragColor = vec4(diffuse, 1.0);
      }
      `);B.getPropertyByName("u_lightDir");B.getPropertyByName("u_planarHeight");B.getPropertyByName("u_planarShadowColor");B.getPropertyByName("u_planarShadowFalloff");var CC=new Bu(`
    attribute vec4 POSITION;
    varying vec4 color;

    uniform vec3 u_lightDir;
    uniform float u_planarHeight;
    uniform vec4 u_planarShadowColor;
    uniform float u_planarShadowFalloff;

    uniform mat4 u_modelMat;
    uniform mat4 u_VPMat;

    #ifdef O3_HAS_SKIN
      attribute vec4 JOINTS_0;
      attribute vec4 WEIGHTS_0;

      #ifdef O3_USE_JOINT_TEXTURE
        uniform sampler2D u_jointSampler;
        uniform float u_jointCount;
        mat4 getJointMatrix(sampler2D smp, float index) {
            float base = index / u_jointCount;
            float hf = 0.5 / u_jointCount;
            float v = base + hf;

            vec4 m0 = texture2D(smp, vec2(0.125, v ));
            vec4 m1 = texture2D(smp, vec2(0.375, v ));
            vec4 m2 = texture2D(smp, vec2(0.625, v ));
            vec4 m3 = texture2D(smp, vec2(0.875, v ));

            return mat4(m0, m1, m2, m3);
        }
      #else
          uniform mat4 u_jointMatrix[ O3_JOINTS_NUM ];
      #endif
    #endif

    vec3 ShadowProjectPos(vec4 vertPos) {
      vec3 shadowPos;

      // get the world space coordinates of the vertex
      vec3 worldPos = (u_modelMat * vertPos).xyz;
      
      // world space coordinates of the shadow (the part below the ground is unchanged)
      shadowPos.y = min(worldPos.y , u_planarHeight);
      shadowPos.xz = worldPos.xz - u_lightDir.xz * max(0.0, worldPos.y - u_planarHeight) / u_lightDir.y;

      return shadowPos;
    }

    void main() {
     vec4 position = vec4(POSITION.xyz, 1.0 );
      #ifdef O3_HAS_SKIN
          #ifdef O3_USE_JOINT_TEXTURE
              mat4 skinMatrix =
                  WEIGHTS_0.x * getJointMatrix(u_jointSampler, JOINTS_0.x ) +
                  WEIGHTS_0.y * getJointMatrix(u_jointSampler, JOINTS_0.y ) +
                  WEIGHTS_0.z * getJointMatrix(u_jointSampler, JOINTS_0.z ) +
                  WEIGHTS_0.w * getJointMatrix(u_jointSampler, JOINTS_0.w );
          #else
              mat4 skinMatrix =
                  WEIGHTS_0.x * u_jointMatrix[ int( JOINTS_0.x ) ] +
                  WEIGHTS_0.y * u_jointMatrix[ int( JOINTS_0.y ) ] +
                  WEIGHTS_0.z * u_jointMatrix[ int( JOINTS_0.z ) ] +
                  WEIGHTS_0.w * u_jointMatrix[ int( JOINTS_0.w ) ];
          #endif
          position = skinMatrix * position;
      #endif

      // get the shadow's world space coordinates
      vec3 shadowPos = ShadowProjectPos(position);

      // convert to clip space
      gl_Position = u_VPMat * vec4(shadowPos, 1.0);

      // get the world coordinates of the center point
      vec3 center = vec3(u_modelMat[3].x, u_planarHeight, u_modelMat[3].z);
      // calculate shadow falloff
      float falloff = 0.5 - clamp(distance(shadowPos , center) * u_planarShadowFalloff, 0.0, 1.0);

      // shadow color
      color = u_planarShadowColor;
      color.a *= falloff;
    }
    `,`
    varying vec4 color;
    void main() {
       gl_FragColor = color;
    }
    `);B.create("planarShadowShader",[B.find("pbr").passes[0],CC]);var Nv;(function(n){n[n.Round=0]="Round",n[n.Butt=1]="Butt",n[n.Square=2]="Square"})(Nv||(Nv={}));var Vv;(function(n){n[n.Miter=0]="Miter",n[n.Round=1]="Round",n[n.Bevel=2]="Bevel"})(Vv||(Vv={}));var AC=`
attribute vec2 a_pos;
attribute vec2 a_normal;
attribute vec2 a_data;

uniform mat4 u_MVPMat;
uniform float u_width;

varying vec2 v_origin;
varying vec2 v_position;
varying float v_direction;
varying float v_part;

void main() {
    v_direction = a_data.x;
    v_part = a_data.y;
    float layer_index = 1.0;

    v_origin = a_pos;
    vec2 position = a_pos + a_normal * u_width;
    v_position = position;
    gl_Position = u_MVPMat * vec4(position, 0.0, 1);
}
  `,TC=`
precision highp float;

uniform vec4 u_color;
uniform int u_join;
uniform int u_cap;
uniform float u_width;

varying vec2 v_origin;
varying vec2 v_position;
varying float v_direction;
varying float v_part;

float IS_CAP = 0.0;

void main() {
    vec4 finalColor;
    if (u_cap == 0 && v_part == IS_CAP) {
      if (distance(v_position, v_origin) > u_width) {
        discard;
      }
    }
    if (u_join == 1 && v_part > 1.0) {
      if (distance(v_position, v_origin) > u_width) {
        discard;
      }
    }

    gl_FragColor = u_color;
}

  `;B.create("line",AC,TC);var EC=`
attribute vec2 a_pos;
attribute vec2 a_normal;
attribute vec2 a_data;
attribute float a_lengthsofar;

uniform mat4 u_MVPMat;
uniform float u_width;
uniform vec2 u_dash;

varying vec2 v_origin;
varying vec2 v_position;
varying float v_direction;
varying float v_part;
varying vec2 v_tex;

void main() {
    v_direction = a_data.x;
    v_part = a_data.y;
    float layer_index = 1.0;


    v_origin = a_pos;

    float texcoord_y = 0.0;

    texcoord_y = a_lengthsofar / (u_dash.x + u_dash.y);
    if (v_direction == 1.0) {
        v_tex = vec2(1.0, texcoord_y);
    } else {
        v_tex = vec2(0.0, texcoord_y);
    }
    vec2 position = a_pos + a_normal * u_width;
    v_position = position;
    gl_Position = u_MVPMat * vec4(position, 0.0, 1);
}
  `,PC=`
precision highp float;

uniform vec4 u_color;
uniform int u_join;
uniform int u_cap;
uniform float u_width;
uniform sampler2D u_texture;

varying vec2 v_origin;
varying vec2 v_position;
varying float v_direction;
varying float v_part;
varying vec2 v_tex;

float IS_CAP = 0.0;

void main() {
    vec4 finalColor;
    if (u_cap == 0 && v_part == IS_CAP) {
      if (distance(v_position, v_origin) > u_width) {
        discard;
      }
    }
    if (u_join == 1 && v_part > 1.5) {
      if (distance(v_position, v_origin) > u_width) {
        discard;
      }
    }
    vec4 textureColor = texture2D(u_texture, v_tex);
    if (textureColor.a <= 0.5) {
      gl_FragColor = vec4(u_color.rgb, 0.0);
    } else {
      gl_FragColor = u_color;
    }
}
`;B.create("dash",EC,PC);function K0(n){this.message=n}K0.prototype=new Error;K0.prototype.name="InvalidCharacterError";var Uv;(function(n){n[n.translate=1]="translate",n[n.rotate=2]="rotate",n[n.scale=4]="scale",n[n.all=15]="all"})(Uv||(Uv={}));var kv;(function(n){n[n.Pivot=0]="Pivot",n[n.Center=1]="Center"})(kv||(kv={}));var Hv;(function(n){n[n.Local=0]="Local",n[n.Global=1]="Global"})(Hv||(Hv={}));new ve;new w;var Gv;(function(n){n[n.x=0]="x",n[n.y=1]="y",n[n.z=2]="z",n[n.xy=3]="xy",n[n.yz=4]="yz",n[n.xz=5]="xz",n[n.xyz=6]="xyz"})(Gv||(Gv={}));new w(1,0,0),new w(0,1,0),new w(0,0,1),new w(1,1,0),new w(0,1,1),new w(1,0,1),new w(1,1,1);new Le(new w(1,0,0),0),new Le(new w(0,1,0),0),new Le(new w(0,0,1),0),new Le(new w(0,0,1),0),new Le(new w(1,0,0),0),new Le(new w(0,1,0),0);var Wv;(function(n){n[n.None=0]="None",n[n.AnchorDirty=1]="AnchorDirty",n[n.CoordinateDirty=2]="CoordinateDirty",n[n.All=3]="All"})(Wv||(Wv={}));new w;new J;new J;new sn;function Xv(n,i){for(var a=0;a<i.length;a++){var t=i[a];t.enumerable=t.enumerable||!1,t.configurable=!0,"value"in t&&(t.writable=!0),Object.defineProperty(n,FC(t.key),t)}}function bC(n,i,a){return i&&Xv(n.prototype,i),a&&Xv(n,a),Object.defineProperty(n,"prototype",{writable:!1}),n}function MC(n,i){n.prototype=Object.create(i.prototype),n.prototype.constructor=n,zd(n,i)}function zd(n,i){return zd=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},zd(n,i)}function RC(n,i){if(typeof n!="object"||n===null)return n;var a=n[Symbol.toPrimitive];if(a!==void 0){var t=a.call(n,i||"default");if(typeof t!="object")return t;throw new TypeError("@@toPrimitive must return a primitive value.")}return(i==="string"?String:Number)(n)}function FC(n){var i=RC(n,"string");return typeof i=="symbol"?i:String(i)}var DC=`#define GLSLIFY 1
uniform vec3 u_outlineColor;uniform sampler2D u_texture;uniform vec2 u_texSize;varying vec2 v_uv;float luminance(vec4 color){return 0.2125*color.r+0.7154*color.g+0.0721*color.b;}float sobel(){float Gx[9];Gx[0]=-1.0;Gx[1]=0.0;Gx[2]=1.0;Gx[3]=-2.0;Gx[4]=0.0;Gx[5]=2.0;Gx[6]=-1.0;Gx[7]=0.0;Gx[8]=1.0;float Gy[9];Gy[0]=-1.0;Gy[1]=-2.0;Gy[2]=-1.0;Gy[3]=0.0;Gy[4]=0.0;Gy[5]=0.0;Gy[6]=1.0;Gy[7]=2.0;Gy[8]=1.0;float texColor;float edgeX=0.0;float edgeY=0.0;vec2 uv[9];uv[0]=v_uv+u_texSize.xy*vec2(-1,-1);uv[1]=v_uv+u_texSize.xy*vec2(0,-1);uv[2]=v_uv+u_texSize.xy*vec2(1,-1);uv[3]=v_uv+u_texSize.xy*vec2(-1,0);uv[4]=v_uv+u_texSize.xy*vec2(0,0);uv[5]=v_uv+u_texSize.xy*vec2(1,0);uv[6]=v_uv+u_texSize.xy*vec2(-1,1);uv[7]=v_uv+u_texSize.xy*vec2(0,1);uv[8]=v_uv+u_texSize.xy*vec2(1,1);for(int i=0;i<9;i++){texColor=luminance(texture2D(u_texture,uv[i]));edgeX+=texColor*Gx[i];edgeY+=texColor*Gy[i];}return abs(edgeX)+abs(edgeY);}vec4 linearToGamma(vec4 linearIn){return vec4(pow(linearIn.rgb,vec3(1.0/2.2)),linearIn.a);}void main(){float sobelFactor=step(1.0,sobel());gl_FragColor=mix(vec4(0),vec4(u_outlineColor,1.0),sobelFactor);
#ifndef OASIS_COLORSPACE_GAMMA
gl_FragColor=linearToGamma(gl_FragColor);
#endif
}`,BC=`#define GLSLIFY 1
attribute vec3 POSITION;attribute vec2 TEXCOORD_0;varying vec2 v_uv;void main(){gl_Position=vec4(POSITION.xzy,1.0);gl_Position.y*=-1.0;v_uv=TEXCOORD_0;v_uv.y=1.0-v_uv.y;}`,jv,Yv,cl;jv=ua(Pe),jv(Yv=(cl=function(n){MC(i,n),i._traverseEntity=function(e,r){r(e);for(var o=e.children.length-1;o>=0;o--)this._traverseEntity(e.children[o],r)};function i(t){var e;e=n.call(this,t)||this,e._outlineMaterial=void 0,e._replaceMaterial=void 0,e._renderTarget=void 0,e._screenEntity=void 0,e._size=1,e._clearColor=new ne(1,1,1,1),e._replaceColor=new ne(1,0,0,1),e._outlineMainColor=new ne(.95,.35,.14,1),e._outlineSubColor=new ne(.16,.67,.89,1),e._layer=Ut.Layer11,e._outlineEntities=[],e._renderers=[],e._materialMap=[],e._layerMap=[];var r=e.engine,o=new xt(r,B.find("outline-postprocess-shader")),s=new aa(r),l=e.entity.createChild("screen"),u=l.addComponent(et);return s.baseColor=e._replaceColor,l.layer=e._layer,l.isActive=!1,u.mesh=to.createPlane(r,2,2),u.setMaterial(o),o.isTransparent=!0,e._outlineMaterial=o,e._replaceMaterial=s,e._screenEntity=l,e.size=e._size,e}var a=i.prototype;return a.clear=function(){this._outlineEntities.length=0},a.addEntity=function(e){this._outlineEntities.indexOf(e)===-1&&this._outlineEntities.push(e)},a.onEndRender=function(e){var r=this._outlineEntities;if(r.length){var o=r.length===1&&r[0].childCount>0;if(o){var s=r[0];this._renderEntity(e,this.mainColor,s),this._renderEntity(e,this.subColor,null,s.children)}else this._renderEntity(e,this.mainColor,null,r)}},a.onDestroy=function(){this._renderTarget.getColorTexture().destroy(!0),this._renderTarget.destroy(),this._screenEntity.destroy(),this._outlineEntities=null,this._renderers=null,this._materialMap=null,this._layerMap=null},a._renderEntity=function(e,r,o,s){var l=this,u=e.scene,c=e.clearFlags,d=e.cullingMask,_=e.enableFrustumCulling,h=u.background.solidColor,f=u.background.mode,g=this._renderers,y=this._materialMap,p=this._layerMap;if(y.length=0,p.length=0,o){o.getComponents(et,g);for(var v=g.length-1;v>=0;v--){var m=g[v];y.push({renderer:m,material:m.getMaterial()}),m.setMaterial(this._replaceMaterial)}p.push({entity:o,layer:o.layer}),o.layer=this._layer}else if(s)for(var x=s.length-1;x>=0;x--){var S=s[x];g.length=0,S.getComponentsIncludeChildren(et,g);for(var C=g.length-1;C>=0;C--){var A=g[C];y.push({renderer:A,material:A.getMaterial()}),A.setMaterial(this._replaceMaterial)}i._traverseEntity(S,function(V){p.push({entity:V,layer:V.layer}),V.layer=l._layer})}this._screenEntity.isActive=!1,e.renderTarget=this._renderTarget,u.background.solidColor=this._clearColor,u.background.mode=Cn.SolidColor,e.cullingMask=this._layer,this._outlineMaterial.shaderData.setColor(i._outlineColorProp,r),e.render(),this._screenEntity.isActive=!0,e.renderTarget=null,e.clearFlags=Kt.None,e.enableFrustumCulling=!1;for(var T=y.length-1;T>=0;T--){var E=y[T],P=E.material,b=E.renderer;b.setMaterial(P)}for(var M=p.length-1;M>=0;M--){var F=p[M],I=F.entity,L=F.layer;I.layer=L}e.render(),this._screenEntity.isActive=!1,e.clearFlags=c,e.enableFrustumCulling=_,e.cullingMask=d,u.background.solidColor=h,u.background.mode=f},bC(i,[{key:"mainColor",get:function(){return this._outlineMainColor},set:function(e){var r=this._outlineMainColor;e!==r&&r.copyFrom(e)}},{key:"subColor",get:function(){return this._outlineSubColor},set:function(e){var r=this._outlineSubColor;e!==r&&r.copyFrom(e)}},{key:"size",get:function(){return this._size},set:function(e){e=Math.max(1,Math.min(e,6)),this._size=e,this._renderTarget&&(this._renderTarget.getColorTexture().destroy(!0),this._renderTarget.destroy());var r=this.engine.canvas,o=r.width,s=r.height,l=o/e,u=s/e,c=new dn(this.engine,l,u),d=new Ka(this.engine,l,u,c);this._outlineMaterial.shaderData.setTexture("u_texture",c),this._outlineMaterial.shaderData.setVector2(i._texSizeProp,new W(1/l,1/u)),c.wrapModeU=c.wrapModeV=Vt.Clamp,this._renderTarget=d}}]),i}(Ft),cl._outlineColorProp=B.getPropertyByName("u_outlineColor"),cl._texSizeProp=B.getPropertyByName("u_texSize"),cl));B.create("outline-postprocess-shader",BC,DC);B.getPropertyByName("u_far");B.getPropertyByName("u_near");B.getPropertyByName("u_primaryScale");B.getPropertyByName("u_secondaryScale");B.getPropertyByName("u_gridIntensity");B.getPropertyByName("u_axisIntensity");B.getPropertyByName("u_flipProgress");B.create("grid",`
#include <common>
#include <common_vert>
uniform mat4 u_viewInvMat;

varying vec3 nearPoint;
varying vec3 farPoint;

vec3 UnprojectPoint(float x, float y, float z, mat4 viewInvMat, mat4 projInvMat) {
    vec4 unprojectedPoint =  viewInvMat * projInvMat * vec4(x, y, z, 1.0);
    return unprojectedPoint.xyz / unprojectedPoint.w;
}

void main() {
    float tol = 0.0001;
    mat4 viewInvMat = u_viewInvMat;
    if (abs(viewInvMat[3][1]) < tol) {
        viewInvMat[3][1] = tol;
    }
    mat4 projInvMat = INVERSE_MAT(u_projMat);

    nearPoint = UnprojectPoint(POSITION.x, POSITION.y, -1.0, viewInvMat, projInvMat);// unprojecting on the near plane
    farPoint = UnprojectPoint(POSITION.x, POSITION.y, 1.0, viewInvMat, projInvMat);// unprojecting on the far plane
    gl_Position = vec4(POSITION, 1.0);// using directly the clipped coordinates
}`,`
#include <transform_declare>

uniform float u_far;
uniform float u_near;
uniform float u_primaryScale;
uniform float u_secondaryScale;
uniform float u_gridIntensity;
uniform float u_axisIntensity;
uniform float u_flipProgress;

varying vec3 nearPoint;
varying vec3 farPoint;
  
vec4 grid(vec3 fragPos3D, float scale, bool drawAxis) {
    vec2 coord = mix(fragPos3D.xz, fragPos3D.xy, u_flipProgress) * scale;
    vec2 derivative = fwidth(coord);
    vec2 grid = abs(fract(coord - 0.5) - 0.5) / derivative;
    float line = min(grid.x, grid.y);
    float minimumz = min(derivative.y, 1.0);
    float minimumx = min(derivative.x, 1.0);
    vec4 color = vec4(u_gridIntensity, u_gridIntensity, u_gridIntensity, 1.0 - min(line, 1.0));
    // z-axis
    if (fragPos3D.x > -u_axisIntensity * minimumx && fragPos3D.x < u_axisIntensity * minimumx)
        color.z = 1.0;
    // x-axis or y-axis
    float xy = mix(fragPos3D.z, fragPos3D.y, u_flipProgress);
    if (xy > -u_axisIntensity * minimumz && xy < u_axisIntensity * minimumz)
        color.x = 1.0;
    return color;
}

float computeDepth(vec3 pos) {
    vec4 clip_space_pos = u_projMat * u_viewMat * vec4(pos.xyz, 1.0);
    // map to 0-1
    return (clip_space_pos.z / clip_space_pos.w) * 0.5 + 0.5;
}

float computeLinearDepth(vec3 pos) {
    vec4 clip_space_pos = u_projMat * u_viewMat * vec4(pos.xyz, 1.0);
    float clip_space_depth = clip_space_pos.z / clip_space_pos.w;
    float linearDepth = (2.0 * u_near * u_far) / (u_far + u_near - clip_space_depth * (u_far - u_near));
    return linearDepth / u_far;// normalize
}

void main() {
    float ty = -nearPoint.y / (farPoint.y - nearPoint.y);
    float tz = -nearPoint.z / (farPoint.z - nearPoint.z);
    float t = mix(ty, tz, u_flipProgress);
    vec3 fragPos3D = nearPoint + t * (farPoint - nearPoint);

    gl_FragDepth = computeDepth(fragPos3D);

    float linearDepth = computeLinearDepth(fragPos3D);
    float fading = max(0.0, (0.5 - linearDepth));

    // adding multiple resolution for the grid
    gl_FragColor = (grid(fragPos3D, u_primaryScale, true) + grid(fragPos3D, u_secondaryScale, true));
    gl_FragColor.a *= fading;
}
`);new w;new ve;new W;new w;new w;new J;new w;var qv;(function(n){n[n.Wireframe=0]="Wireframe",n[n.Normal=1]="Normal",n[n.Tangent=2]="Tangent",n[n.BiTangent=3]="BiTangent"})(qv||(qv={}));var J0=`
   uniform sampler2D u_verticesSampler;
   uniform float u_verticesTextureWidth;
   uniform float u_verticesTextureHeight;
   
   uniform sampler2D u_indicesSampler;
   uniform float u_indicesTextureWidth;
   uniform float u_indicesTextureHeight;
   
   vec4 getVertexElement(float row, float col) {
        return texture2D(u_verticesSampler, vec2((col + 0.5) / u_verticesTextureWidth, (row + 0.5) / u_verticesTextureHeight));
   }
   
   vec3 getIndicesElement(float row, float col) {
        return texture2D(u_indicesSampler, vec2((col + 0.5) / u_indicesTextureWidth, (row + 0.5) / u_indicesTextureHeight )).xyz;
   }
   
   vec2 getVec2(inout vec4[ELEMENT_COUNT] rows, inout int row_index, inout int value_index) {
        row_index += (value_index+1)/4;
        value_index = (value_index+1)%4;
        float x = rows[row_index][value_index];
        
        row_index += (value_index+1)/4;
        value_index = (value_index+1)%4;
        float y = rows[row_index][value_index];
        
        return vec2(x, y);
   }
   
   vec3 getVec3(inout vec4[ELEMENT_COUNT] rows, inout int row_index, inout int value_index) {
        row_index += (value_index+1)/4;
        value_index = (value_index+1)%4;
        float x = rows[row_index][value_index];
        
        row_index += (value_index+1)/4;
        value_index = (value_index+1)%4;
        float y = rows[row_index][value_index];
        
        row_index += (value_index+1)/4;
        value_index = (value_index+1)%4;
        float z = rows[row_index][value_index];
        return vec3(x, y, z);
   }
   
   vec4 getVec4(inout vec4[ELEMENT_COUNT] rows, inout int row_index, inout int value_index) {
        row_index += (value_index+1)/4;
        value_index = (value_index+1)%4;
        float x = rows[row_index][value_index];
        
        row_index += (value_index+1)/4;
        value_index = (value_index+1)%4;
        float y = rows[row_index][value_index];
        
        row_index += (value_index+1)/4;
        value_index = (value_index+1)%4;
        float z = rows[row_index][value_index];
        
        row_index += (value_index+1)/4;
        value_index = (value_index+1)%4;
        float w = rows[row_index][value_index];
        return vec4(x, y, z, w);
   }
`,Z0=`
        int row = pointIndex * ELEMENT_COUNT / int(u_verticesTextureWidth);
        int col = pointIndex * ELEMENT_COUNT % int(u_verticesTextureWidth);
        
        vec4 rows[ELEMENT_COUNT];
        for( int i = 0; i < ELEMENT_COUNT; i++ ) {
            rows[i] = getVertexElement(float(row), float(col + i));
        }
        
        vec3 POSITION = vec3(rows[0].x, rows[0].y, rows[0].z);        
        int row_index = 0;
        int value_index = 2;
#ifdef O3_HAS_NORMAL 
        vec3 NORMAL = getVec3(rows, row_index, value_index);
#endif

#ifdef O3_HAS_VERTEXCOLOR
        vec4 COLOR_0 = getVec4(rows, row_index, value_index);
#endif

#ifdef O3_HAS_WEIGHT
        vec4 WEIGHTS_0 = getVec4(rows, row_index, value_index);
#endif

#ifdef O3_HAS_JOINT
        vec4 JOINTS_0 = getVec4(rows, row_index, value_index);
#endif

#ifdef O3_HAS_TANGENT
        vec4 TANGENT = getVec4(rows, row_index, value_index);
#endif

#ifdef O3_HAS_UV
        vec2 TEXCOORD_0 = getVec2(rows, row_index, value_index);
#endif
`;B.create("tbnShader",`
#include <common>
   uniform float u_lineScale;
   uniform mat4 u_VPMat;
   uniform mat4 u_worldMatrix;
   uniform mat4 u_worldNormal;

#ifdef O3_HAS_SKIN
#ifdef O3_USE_JOINT_TEXTURE
    uniform sampler2D u_jointSampler;
    uniform float u_jointCount;

    mat4 getJointMatrix(sampler2D smp, float index) {
        float base = index / u_jointCount;
        float hf = 0.5 / u_jointCount;
        float v = base + hf;

        vec4 m0 = texture2D(smp, vec2(0.125, v ));
        vec4 m1 = texture2D(smp, vec2(0.375, v ));
        vec4 m2 = texture2D(smp, vec2(0.625, v ));
        vec4 m3 = texture2D(smp, vec2(0.875, v ));

        return mat4(m0, m1, m2, m3);
    }
#else
    uniform mat4 u_jointMatrix[ O3_JOINTS_NUM ];
#endif
#endif

`+J0+`

void main() {
    int pointIndex = gl_VertexID / 2;
    `+Z0+`

    #include <begin_position_vert>
    #include <begin_normal_vert>
    #include <skinning_vert>

    gl_Position = u_worldMatrix * position; 
    
#if defined(SHOW_NORMAL) && defined(O3_HAS_NORMAL)
    if (gl_VertexID % 2 == 1) {
        vec3 normalW = normalize( mat3(u_worldNormal) * normal.xyz );
        gl_Position.xyz += normalize(normalW) * u_lineScale;
    }
#endif

#if defined(SHOW_TANGENT) && defined(O3_HAS_TANGENT)
    if (gl_VertexID % 2 == 1) {
        vec3 tangentW = normalize( mat3(u_worldNormal) * tangent.xyz );
        gl_Position.xyz += normalize(tangentW) * u_lineScale;
    }
#endif

#if defined(SHOW_BITANGENT) && defined(O3_HAS_TANGENT) && defined(O3_HAS_NORMAL)
    if (gl_VertexID % 2 == 1) {
        vec3 normalW = normalize( mat3(u_worldNormal) * normal.xyz );
        vec3 tangentW = normalize( mat3(u_worldNormal) * tangent.xyz );
        vec3 bitangentW = cross( normalW, tangentW ) * tangent.w;
        gl_Position.xyz += normalize(bitangentW) * u_lineScale;
    }
#endif
    
    gl_Position = u_VPMat * gl_Position; 
}
`,`
uniform vec4 u_baseColor;
void main() {
    gl_FragColor = u_baseColor;
}
`);B.create("wireframeShader",`
#include <common>
   uniform float u_lineScale;
   uniform mat4 u_VPMat;
   uniform mat4 u_worldMatrix;
   uniform mat4 u_worldNormal;

#ifdef O3_HAS_SKIN
#ifdef O3_USE_JOINT_TEXTURE
    uniform sampler2D u_jointSampler;
    uniform float u_jointCount;

    mat4 getJointMatrix(sampler2D smp, float index) {
        float base = index / u_jointCount;
        float hf = 0.5 / u_jointCount;
        float v = base + hf;

        vec4 m0 = texture2D(smp, vec2(0.125, v ));
        vec4 m1 = texture2D(smp, vec2(0.375, v ));
        vec4 m2 = texture2D(smp, vec2(0.625, v ));
        vec4 m3 = texture2D(smp, vec2(0.875, v ));

        return mat4(m0, m1, m2, m3);
    }
#else
    uniform mat4 u_jointMatrix[ O3_JOINTS_NUM ];
#endif
#endif

`+J0+`

varying vec3 v_baryCenter;

void main() {
    int indicesIndex = gl_VertexID / 3;
    int indicesRow = indicesIndex / int(u_indicesTextureWidth);
    int indicesCol = indicesIndex % int(u_indicesTextureWidth);
    vec3 triangleIndices = getIndicesElement(float(indicesRow), float(indicesCol));
    int subIndex = gl_VertexID % 3;
    v_baryCenter = vec3(0.0);
    v_baryCenter[subIndex] = 1.0;
    
    int pointIndex = int(triangleIndices[subIndex]);
    `+Z0+`

    #include <begin_position_vert>
    #include <begin_normal_vert>
    #include <skinning_vert>
    
    gl_Position = u_worldMatrix * position; 
    gl_Position = u_VPMat * gl_Position; 
}
`,`
varying vec3 v_baryCenter;

float edgeFactor(){
    vec3 d = fwidth(v_baryCenter);
    vec3 a3 = smoothstep(vec3(0.0), d * 1.5, v_baryCenter);
    return min(min(a3.x, a3.y), a3.z);
}

uniform vec4 u_baseColor;
void main() {
    if (gl_FrontFacing) {
        gl_FragColor = vec4(u_baseColor.xyz, 1.0 - edgeFactor());
    } else {
        // fade back face
        gl_FragColor = vec4(u_baseColor.xyz, (1.0 - edgeFactor()) * 0.3);
    }
}
`);B.getMacroByName("O3_HAS_WEIGHT");B.getMacroByName("O3_HAS_JOINT");B.getPropertyByName("u_verticesSampler");B.getPropertyByName("u_verticesTextureHeight");B.getPropertyByName("u_verticesTextureWidth");B.getPropertyByName("u_indicesSampler");B.getPropertyByName("u_indicesTextureHeight");B.getPropertyByName("u_indicesTextureWidth");B.getPropertyByName("u_lineScale");B.getPropertyByName("u_worldMatrix");B.getPropertyByName("u_worldNormal");var IC="0.9.0-beta.4";console.log("oasis engine toolkit version: "+IC);function LC(n){if(n&&!(typeof window>"u")){var i=document.createElement("style");return i.setAttribute("type","text/css"),i.innerHTML=n,document.head.appendChild(i),n}}function Ia(n,i){var a=n.__state.conversionName.toString(),t=Math.round(n.r),e=Math.round(n.g),r=Math.round(n.b),o=n.a,s=Math.round(n.h),l=n.s.toFixed(1),u=n.v.toFixed(1);if(i||a==="THREE_CHAR_HEX"||a==="SIX_CHAR_HEX"){for(var c=n.hex.toString(16);c.length<6;)c="0"+c;return"#"+c}else{if(a==="CSS_RGB")return"rgb("+t+","+e+","+r+")";if(a==="CSS_RGBA")return"rgba("+t+","+e+","+r+","+o+")";if(a==="HEX")return"0x"+n.hex.toString(16);if(a==="RGB_ARRAY")return"["+t+","+e+","+r+"]";if(a==="RGBA_ARRAY")return"["+t+","+e+","+r+","+o+"]";if(a==="RGB_OBJ")return"{r:"+t+",g:"+e+",b:"+r+"}";if(a==="RGBA_OBJ")return"{r:"+t+",g:"+e+",b:"+r+",a:"+o+"}";if(a==="HSV_OBJ")return"{h:"+s+",s:"+l+",v:"+u+"}";if(a==="HSVA_OBJ")return"{h:"+s+",s:"+l+",v:"+u+",a:"+o+"}"}return"unknown format"}var Qv=Array.prototype.forEach,bo=Array.prototype.slice,k={BREAK:{},extend:function(i){return this.each(bo.call(arguments,1),function(a){var t=this.isObject(a)?Object.keys(a):[];t.forEach(function(e){this.isUndefined(a[e])||(i[e]=a[e])}.bind(this))},this),i},defaults:function(i){return this.each(bo.call(arguments,1),function(a){var t=this.isObject(a)?Object.keys(a):[];t.forEach(function(e){this.isUndefined(i[e])&&(i[e]=a[e])}.bind(this))},this),i},compose:function(){var i=bo.call(arguments);return function(){for(var a=bo.call(arguments),t=i.length-1;t>=0;t--)a=[i[t].apply(this,a)];return a[0]}},each:function(i,a,t){if(i){if(Qv&&i.forEach&&i.forEach===Qv)i.forEach(a,t);else if(i.length===i.length+0){var e=void 0,r=void 0;for(e=0,r=i.length;e<r;e++)if(e in i&&a.call(t,i[e],e)===this.BREAK)return}else for(var o in i)if(a.call(t,i[o],o)===this.BREAK)return}},defer:function(i){setTimeout(i,0)},debounce:function(i,a,t){var e=void 0;return function(){var r=this,o=arguments;function s(){e=null,t||i.apply(r,o)}var l=t||!e;clearTimeout(e),e=setTimeout(s,a),l&&i.apply(r,o)}},toArray:function(i){return i.toArray?i.toArray():bo.call(i)},isUndefined:function(i){return i===void 0},isNull:function(i){return i===null},isNaN:function(n){function i(a){return n.apply(this,arguments)}return i.toString=function(){return n.toString()},i}(function(n){return isNaN(n)}),isArray:Array.isArray||function(n){return n.constructor===Array},isObject:function(i){return i===Object(i)},isNumber:function(i){return i===i+0},isString:function(i){return i===i+""},isBoolean:function(i){return i===!1||i===!0},isFunction:function(i){return i instanceof Function}},zC=[{litmus:k.isString,conversions:{THREE_CHAR_HEX:{read:function(i){var a=i.match(/^#([A-F0-9])([A-F0-9])([A-F0-9])$/i);return a===null?!1:{space:"HEX",hex:parseInt("0x"+a[1].toString()+a[1].toString()+a[2].toString()+a[2].toString()+a[3].toString()+a[3].toString(),0)}},write:Ia},SIX_CHAR_HEX:{read:function(i){var a=i.match(/^#([A-F0-9]{6})$/i);return a===null?!1:{space:"HEX",hex:parseInt("0x"+a[1].toString(),0)}},write:Ia},CSS_RGB:{read:function(i){var a=i.match(/^rgb\(\s*(\S+)\s*,\s*(\S+)\s*,\s*(\S+)\s*\)/);return a===null?!1:{space:"RGB",r:parseFloat(a[1]),g:parseFloat(a[2]),b:parseFloat(a[3])}},write:Ia},CSS_RGBA:{read:function(i){var a=i.match(/^rgba\(\s*(\S+)\s*,\s*(\S+)\s*,\s*(\S+)\s*,\s*(\S+)\s*\)/);return a===null?!1:{space:"RGB",r:parseFloat(a[1]),g:parseFloat(a[2]),b:parseFloat(a[3]),a:parseFloat(a[4])}},write:Ia}}},{litmus:k.isNumber,conversions:{HEX:{read:function(i){return{space:"HEX",hex:i,conversionName:"HEX"}},write:function(i){return i.hex}}}},{litmus:k.isArray,conversions:{RGB_ARRAY:{read:function(i){return i.length!==3?!1:{space:"RGB",r:i[0],g:i[1],b:i[2]}},write:function(i){return[i.r,i.g,i.b]}},RGBA_ARRAY:{read:function(i){return i.length!==4?!1:{space:"RGB",r:i[0],g:i[1],b:i[2],a:i[3]}},write:function(i){return[i.r,i.g,i.b,i.a]}}}},{litmus:k.isObject,conversions:{RGBA_OBJ:{read:function(i){return k.isNumber(i.r)&&k.isNumber(i.g)&&k.isNumber(i.b)&&k.isNumber(i.a)?{space:"RGB",r:i.r,g:i.g,b:i.b,a:i.a}:!1},write:function(i){return{r:i.r,g:i.g,b:i.b,a:i.a}}},RGB_OBJ:{read:function(i){return k.isNumber(i.r)&&k.isNumber(i.g)&&k.isNumber(i.b)?{space:"RGB",r:i.r,g:i.g,b:i.b}:!1},write:function(i){return{r:i.r,g:i.g,b:i.b}}},HSVA_OBJ:{read:function(i){return k.isNumber(i.h)&&k.isNumber(i.s)&&k.isNumber(i.v)&&k.isNumber(i.a)?{space:"HSV",h:i.h,s:i.s,v:i.v,a:i.a}:!1},write:function(i){return{h:i.h,s:i.s,v:i.v,a:i.a}}},HSV_OBJ:{read:function(i){return k.isNumber(i.h)&&k.isNumber(i.s)&&k.isNumber(i.v)?{space:"HSV",h:i.h,s:i.s,v:i.v}:!1},write:function(i){return{h:i.h,s:i.s,v:i.v}}}}}],Mo=void 0,dl=void 0,Od=function(){dl=!1;var i=arguments.length>1?k.toArray(arguments):arguments[0];return k.each(zC,function(a){if(a.litmus(i))return k.each(a.conversions,function(t,e){if(Mo=t.read(i),dl===!1&&Mo!==!1)return dl=Mo,Mo.conversionName=e,Mo.conversion=t,k.BREAK}),k.BREAK}),dl},$v=void 0,_u={hsv_to_rgb:function(i,a,t){var e=Math.floor(i/60)%6,r=i/60-Math.floor(i/60),o=t*(1-a),s=t*(1-r*a),l=t*(1-(1-r)*a),u=[[t,l,o],[s,t,o],[o,t,l],[o,s,t],[l,o,t],[t,o,s]][e];return{r:u[0]*255,g:u[1]*255,b:u[2]*255}},rgb_to_hsv:function(i,a,t){var e=Math.min(i,a,t),r=Math.max(i,a,t),o=r-e,s=void 0,l=void 0;if(r!==0)l=o/r;else return{h:NaN,s:0,v:0};return i===r?s=(a-t)/o:a===r?s=2+(t-i)/o:s=4+(i-a)/o,s/=6,s<0&&(s+=1),{h:s*360,s:l,v:r/255}},rgb_to_hex:function(i,a,t){var e=this.hex_with_component(0,2,i);return e=this.hex_with_component(e,1,a),e=this.hex_with_component(e,0,t),e},component_from_hex:function(i,a){return i>>a*8&255},hex_with_component:function(i,a,t){return t<<($v=a*8)|i&~(255<<$v)}},OC=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(n){return typeof n}:function(n){return n&&typeof Symbol=="function"&&n.constructor===Symbol&&n!==Symbol.prototype?"symbol":typeof n},lr=function(n,i){if(!(n instanceof i))throw new TypeError("Cannot call a class as a function")},ur=function(){function n(i,a){for(var t=0;t<a.length;t++){var e=a[t];e.enumerable=e.enumerable||!1,e.configurable=!0,"value"in e&&(e.writable=!0),Object.defineProperty(i,e.key,e)}}return function(i,a,t){return a&&n(i.prototype,a),t&&n(i,t),i}}(),Ei=function n(i,a,t){i===null&&(i=Function.prototype);var e=Object.getOwnPropertyDescriptor(i,a);if(e===void 0){var r=Object.getPrototypeOf(i);return r===null?void 0:n(r,a,t)}else{if("value"in e)return e.value;var o=e.get;return o===void 0?void 0:o.call(t)}},Fi=function(n,i){if(typeof i!="function"&&i!==null)throw new TypeError("Super expression must either be null or a function, not "+typeof i);n.prototype=Object.create(i&&i.prototype,{constructor:{value:n,enumerable:!1,writable:!0,configurable:!0}}),i&&(Object.setPrototypeOf?Object.setPrototypeOf(n,i):n.__proto__=i)},Di=function(n,i){if(!n)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return i&&(typeof i=="object"||typeof i=="function")?i:n},yt=function(){function n(){if(lr(this,n),this.__state=Od.apply(this,arguments),this.__state===!1)throw new Error("Failed to interpret color arguments");this.__state.a=this.__state.a||1}return ur(n,[{key:"toString",value:function(){return Ia(this)}},{key:"toHexString",value:function(){return Ia(this,!0)}},{key:"toOriginal",value:function(){return this.__state.conversion.write(this)}}]),n}();function rh(n,i,a){Object.defineProperty(n,i,{get:function(){return this.__state.space==="RGB"?this.__state[i]:(yt.recalculateRGB(this,i,a),this.__state[i])},set:function(e){this.__state.space!=="RGB"&&(yt.recalculateRGB(this,i,a),this.__state.space="RGB"),this.__state[i]=e}})}function ih(n,i){Object.defineProperty(n,i,{get:function(){return this.__state.space==="HSV"?this.__state[i]:(yt.recalculateHSV(this),this.__state[i])},set:function(t){this.__state.space!=="HSV"&&(yt.recalculateHSV(this),this.__state.space="HSV"),this.__state[i]=t}})}yt.recalculateRGB=function(n,i,a){if(n.__state.space==="HEX")n.__state[i]=_u.component_from_hex(n.__state.hex,a);else if(n.__state.space==="HSV")k.extend(n.__state,_u.hsv_to_rgb(n.__state.h,n.__state.s,n.__state.v));else throw new Error("Corrupted color state")};yt.recalculateHSV=function(n){var i=_u.rgb_to_hsv(n.r,n.g,n.b);k.extend(n.__state,{s:i.s,v:i.v}),k.isNaN(i.h)?k.isUndefined(n.__state.h)&&(n.__state.h=0):n.__state.h=i.h};yt.COMPONENTS=["r","g","b","h","s","v","hex","a"];rh(yt.prototype,"r",2);rh(yt.prototype,"g",1);rh(yt.prototype,"b",0);ih(yt.prototype,"h");ih(yt.prototype,"s");ih(yt.prototype,"v");Object.defineProperty(yt.prototype,"a",{get:function(){return this.__state.a},set:function(i){this.__state.a=i}});Object.defineProperty(yt.prototype,"hex",{get:function(){return this.__state.space!=="HEX"&&(this.__state.hex=_u.rgb_to_hex(this.r,this.g,this.b),this.__state.space="HEX"),this.__state.hex},set:function(i){this.__state.space="HEX",this.__state.hex=i}});var da=function(){function n(i,a){lr(this,n),this.initialValue=i[a],this.domElement=document.createElement("div"),this.object=i,this.property=a,this.__onChange=void 0,this.__onFinishChange=void 0}return ur(n,[{key:"onChange",value:function(a){return this.__onChange=a,this}},{key:"onFinishChange",value:function(a){return this.__onFinishChange=a,this}},{key:"setValue",value:function(a){return this.object[this.property]=a,this.__onChange&&this.__onChange.call(this,a),this.updateDisplay(),this}},{key:"getValue",value:function(){return this.object[this.property]}},{key:"updateDisplay",value:function(){return this}},{key:"isModified",value:function(){return this.initialValue!==this.getValue()}}]),n}(),NC={HTMLEvents:["change"],MouseEvents:["click","mousemove","mousedown","mouseup","mouseover"],KeyboardEvents:["keydown"]},em={};k.each(NC,function(n,i){k.each(n,function(a){em[a]=i})});var VC=/(\d+(\.\d+)?)px/;function _r(n){if(n==="0"||k.isUndefined(n))return 0;var i=n.match(VC);return k.isNull(i)?0:parseFloat(i[1])}var z={makeSelectable:function(i,a){i===void 0||i.style===void 0||(i.onselectstart=a?function(){return!1}:function(){},i.style.MozUserSelect=a?"auto":"none",i.style.KhtmlUserSelect=a?"auto":"none",i.unselectable=a?"on":"off")},makeFullscreen:function(i,a,t){var e=t,r=a;k.isUndefined(r)&&(r=!0),k.isUndefined(e)&&(e=!0),i.style.position="absolute",r&&(i.style.left=0,i.style.right=0),e&&(i.style.top=0,i.style.bottom=0)},fakeEvent:function(i,a,t,e){var r=t||{},o=em[a];if(!o)throw new Error("Event type "+a+" not supported.");var s=document.createEvent(o);switch(o){case"MouseEvents":{var l=r.x||r.clientX||0,u=r.y||r.clientY||0;s.initMouseEvent(a,r.bubbles||!1,r.cancelable||!0,window,r.clickCount||1,0,0,l,u,!1,!1,!1,!1,0,null);break}case"KeyboardEvents":{var c=s.initKeyboardEvent||s.initKeyEvent;k.defaults(r,{cancelable:!0,ctrlKey:!1,altKey:!1,shiftKey:!1,metaKey:!1,keyCode:void 0,charCode:void 0}),c(a,r.bubbles||!1,r.cancelable,window,r.ctrlKey,r.altKey,r.shiftKey,r.metaKey,r.keyCode,r.charCode);break}default:{s.initEvent(a,r.bubbles||!1,r.cancelable||!0);break}}k.defaults(s,e),i.dispatchEvent(s)},bind:function(i,a,t,e){var r=e||!1;return i.addEventListener?i.addEventListener(a,t,r):i.attachEvent&&i.attachEvent("on"+a,t),z},unbind:function(i,a,t,e){var r=e||!1;return i.removeEventListener?i.removeEventListener(a,t,r):i.detachEvent&&i.detachEvent("on"+a,t),z},addClass:function(i,a){if(i.className===void 0)i.className=a;else if(i.className!==a){var t=i.className.split(/ +/);t.indexOf(a)===-1&&(t.push(a),i.className=t.join(" ").replace(/^\s+/,"").replace(/\s+$/,""))}return z},removeClass:function(i,a){if(a)if(i.className===a)i.removeAttribute("class");else{var t=i.className.split(/ +/),e=t.indexOf(a);e!==-1&&(t.splice(e,1),i.className=t.join(" "))}else i.className=void 0;return z},hasClass:function(i,a){return new RegExp("(?:^|\\s+)"+a+"(?:\\s+|$)").test(i.className)||!1},getWidth:function(i){var a=getComputedStyle(i);return _r(a["border-left-width"])+_r(a["border-right-width"])+_r(a["padding-left"])+_r(a["padding-right"])+_r(a.width)},getHeight:function(i){var a=getComputedStyle(i);return _r(a["border-top-width"])+_r(a["border-bottom-width"])+_r(a["padding-top"])+_r(a["padding-bottom"])+_r(a.height)},getOffset:function(i){var a=i,t={left:0,top:0};if(a.offsetParent)do t.left+=a.offsetLeft,t.top+=a.offsetTop,a=a.offsetParent;while(a);return t},isActive:function(i){return i===document.activeElement&&(i.type||i.href)}},tm=function(n){Fi(i,n);function i(a,t){lr(this,i);var e=Di(this,(i.__proto__||Object.getPrototypeOf(i)).call(this,a,t)),r=e;e.__prev=e.getValue(),e.__checkbox=document.createElement("input"),e.__checkbox.setAttribute("type","checkbox");function o(){r.setValue(!r.__prev)}return z.bind(e.__checkbox,"change",o,!1),e.domElement.appendChild(e.__checkbox),e.updateDisplay(),e}return ur(i,[{key:"setValue",value:function(t){var e=Ei(i.prototype.__proto__||Object.getPrototypeOf(i.prototype),"setValue",this).call(this,t);return this.__onFinishChange&&this.__onFinishChange.call(this,this.getValue()),this.__prev=this.getValue(),e}},{key:"updateDisplay",value:function(){return this.getValue()===!0?(this.__checkbox.setAttribute("checked","checked"),this.__checkbox.checked=!0,this.__prev=!0):(this.__checkbox.checked=!1,this.__prev=!1),Ei(i.prototype.__proto__||Object.getPrototypeOf(i.prototype),"updateDisplay",this).call(this)}}]),i}(da),UC=function(n){Fi(i,n);function i(a,t,e){lr(this,i);var r=Di(this,(i.__proto__||Object.getPrototypeOf(i)).call(this,a,t)),o=e,s=r;if(r.__select=document.createElement("select"),k.isArray(o)){var l={};k.each(o,function(u){l[u]=u}),o=l}return k.each(o,function(u,c){var d=document.createElement("option");d.innerHTML=c,d.setAttribute("value",u),s.__select.appendChild(d)}),r.updateDisplay(),z.bind(r.__select,"change",function(){var u=this.options[this.selectedIndex].value;s.setValue(u)}),r.domElement.appendChild(r.__select),r}return ur(i,[{key:"setValue",value:function(t){var e=Ei(i.prototype.__proto__||Object.getPrototypeOf(i.prototype),"setValue",this).call(this,t);return this.__onFinishChange&&this.__onFinishChange.call(this,this.getValue()),e}},{key:"updateDisplay",value:function(){return z.isActive(this.__select)?this:(this.__select.value=this.getValue(),Ei(i.prototype.__proto__||Object.getPrototypeOf(i.prototype),"updateDisplay",this).call(this))}}]),i}(da),kC=function(n){Fi(i,n);function i(a,t){lr(this,i);var e=Di(this,(i.__proto__||Object.getPrototypeOf(i)).call(this,a,t)),r=e;function o(){r.setValue(r.__input.value)}function s(){r.__onFinishChange&&r.__onFinishChange.call(r,r.getValue())}return e.__input=document.createElement("input"),e.__input.setAttribute("type","text"),z.bind(e.__input,"keyup",o),z.bind(e.__input,"change",o),z.bind(e.__input,"blur",s),z.bind(e.__input,"keydown",function(l){l.keyCode===13&&this.blur()}),e.updateDisplay(),e.domElement.appendChild(e.__input),e}return ur(i,[{key:"updateDisplay",value:function(){return z.isActive(this.__input)||(this.__input.value=this.getValue()),Ei(i.prototype.__proto__||Object.getPrototypeOf(i.prototype),"updateDisplay",this).call(this)}}]),i}(da);function Kv(n){var i=n.toString();return i.indexOf(".")>-1?i.length-i.indexOf(".")-1:0}var nm=function(n){Fi(i,n);function i(a,t,e){lr(this,i);var r=Di(this,(i.__proto__||Object.getPrototypeOf(i)).call(this,a,t)),o=e||{};return r.__min=o.min,r.__max=o.max,r.__step=o.step,k.isUndefined(r.__step)?r.initialValue===0?r.__impliedStep=1:r.__impliedStep=Math.pow(10,Math.floor(Math.log(Math.abs(r.initialValue))/Math.LN10))/10:r.__impliedStep=r.__step,r.__precision=Kv(r.__impliedStep),r}return ur(i,[{key:"setValue",value:function(t){var e=t;return this.__min!==void 0&&e<this.__min?e=this.__min:this.__max!==void 0&&e>this.__max&&(e=this.__max),this.__step!==void 0&&e%this.__step!==0&&(e=Math.round(e/this.__step)*this.__step),Ei(i.prototype.__proto__||Object.getPrototypeOf(i.prototype),"setValue",this).call(this,e)}},{key:"min",value:function(t){return this.__min=t,this}},{key:"max",value:function(t){return this.__max=t,this}},{key:"step",value:function(t){return this.__step=t,this.__impliedStep=t,this.__precision=Kv(t),this}}]),i}(da);function HC(n,i){var a=Math.pow(10,i);return Math.round(n*a)/a}var hu=function(n){Fi(i,n);function i(a,t,e){lr(this,i);var r=Di(this,(i.__proto__||Object.getPrototypeOf(i)).call(this,a,t,e));r.__truncationSuspended=!1;var o=r,s=void 0;function l(){var f=parseFloat(o.__input.value);k.isNaN(f)||o.setValue(f)}function u(){o.__onFinishChange&&o.__onFinishChange.call(o,o.getValue())}function c(){u()}function d(f){var g=s-f.clientY;o.setValue(o.getValue()+g*o.__impliedStep),s=f.clientY}function _(){z.unbind(window,"mousemove",d),z.unbind(window,"mouseup",_),u()}function h(f){z.bind(window,"mousemove",d),z.bind(window,"mouseup",_),s=f.clientY}return r.__input=document.createElement("input"),r.__input.setAttribute("type","text"),z.bind(r.__input,"change",l),z.bind(r.__input,"blur",c),z.bind(r.__input,"mousedown",h),z.bind(r.__input,"keydown",function(f){f.keyCode===13&&(o.__truncationSuspended=!0,this.blur(),o.__truncationSuspended=!1,u())}),r.updateDisplay(),r.domElement.appendChild(r.__input),r}return ur(i,[{key:"updateDisplay",value:function(){return this.__input.value=this.__truncationSuspended?this.getValue():HC(this.getValue(),this.__precision),Ei(i.prototype.__proto__||Object.getPrototypeOf(i.prototype),"updateDisplay",this).call(this)}}]),i}(nm);function Jv(n,i,a,t,e){return t+(e-t)*((n-i)/(a-i))}var Nd=function(n){Fi(i,n);function i(a,t,e,r,o){lr(this,i);var s=Di(this,(i.__proto__||Object.getPrototypeOf(i)).call(this,a,t,{min:e,max:r,step:o})),l=s;s.__background=document.createElement("div"),s.__foreground=document.createElement("div"),z.bind(s.__background,"mousedown",u),z.bind(s.__background,"touchstart",_),z.addClass(s.__background,"slider"),z.addClass(s.__foreground,"slider-fg");function u(g){document.activeElement.blur(),z.bind(window,"mousemove",c),z.bind(window,"mouseup",d),c(g)}function c(g){g.preventDefault();var y=l.__background.getBoundingClientRect();return l.setValue(Jv(g.clientX,y.left,y.right,l.__min,l.__max)),!1}function d(){z.unbind(window,"mousemove",c),z.unbind(window,"mouseup",d),l.__onFinishChange&&l.__onFinishChange.call(l,l.getValue())}function _(g){g.touches.length===1&&(z.bind(window,"touchmove",h),z.bind(window,"touchend",f),h(g))}function h(g){var y=g.touches[0].clientX,p=l.__background.getBoundingClientRect();l.setValue(Jv(y,p.left,p.right,l.__min,l.__max))}function f(){z.unbind(window,"touchmove",h),z.unbind(window,"touchend",f),l.__onFinishChange&&l.__onFinishChange.call(l,l.getValue())}return s.updateDisplay(),s.__background.appendChild(s.__foreground),s.domElement.appendChild(s.__background),s}return ur(i,[{key:"updateDisplay",value:function(){var t=(this.getValue()-this.__min)/(this.__max-this.__min);return this.__foreground.style.width=t*100+"%",Ei(i.prototype.__proto__||Object.getPrototypeOf(i.prototype),"updateDisplay",this).call(this)}}]),i}(nm),rm=function(n){Fi(i,n);function i(a,t,e){lr(this,i);var r=Di(this,(i.__proto__||Object.getPrototypeOf(i)).call(this,a,t)),o=r;return r.__button=document.createElement("div"),r.__button.innerHTML=e===void 0?"Fire":e,z.bind(r.__button,"click",function(s){return s.preventDefault(),o.fire(),!1}),z.addClass(r.__button,"button"),r.domElement.appendChild(r.__button),r}return ur(i,[{key:"fire",value:function(){this.__onChange&&this.__onChange.call(this),this.getValue().call(this.object),this.__onFinishChange&&this.__onFinishChange.call(this,this.getValue())}}]),i}(da),Vd=function(n){Fi(i,n);function i(a,t){lr(this,i);var e=Di(this,(i.__proto__||Object.getPrototypeOf(i)).call(this,a,t));e.__color=new yt(e.getValue()),e.__temp=new yt(0);var r=e;e.domElement=document.createElement("div"),z.makeSelectable(e.domElement,!1),e.__selector=document.createElement("div"),e.__selector.className="selector",e.__saturation_field=document.createElement("div"),e.__saturation_field.className="saturation-field",e.__field_knob=document.createElement("div"),e.__field_knob.className="field-knob",e.__field_knob_border="2px solid ",e.__hue_knob=document.createElement("div"),e.__hue_knob.className="hue-knob",e.__hue_field=document.createElement("div"),e.__hue_field.className="hue-field",e.__input=document.createElement("input"),e.__input.type="text",e.__input_textShadow="0 1px 1px ",z.bind(e.__input,"keydown",function(g){g.keyCode===13&&d.call(this)}),z.bind(e.__input,"blur",d),z.bind(e.__selector,"mousedown",function(){z.addClass(this,"drag").bind(window,"mouseup",function(){z.removeClass(r.__selector,"drag")})}),z.bind(e.__selector,"touchstart",function(){z.addClass(this,"drag").bind(window,"touchend",function(){z.removeClass(r.__selector,"drag")})});var o=document.createElement("div");k.extend(e.__selector.style,{width:"122px",height:"102px",padding:"3px",backgroundColor:"#222",boxShadow:"0px 1px 3px rgba(0,0,0,0.3)"}),k.extend(e.__field_knob.style,{position:"absolute",width:"12px",height:"12px",border:e.__field_knob_border+(e.__color.v<.5?"#fff":"#000"),boxShadow:"0px 1px 3px rgba(0,0,0,0.5)",borderRadius:"12px",zIndex:1}),k.extend(e.__hue_knob.style,{position:"absolute",width:"15px",height:"2px",borderRight:"4px solid #fff",zIndex:1}),k.extend(e.__saturation_field.style,{width:"100px",height:"100px",border:"1px solid #555",marginRight:"3px",display:"inline-block",cursor:"pointer"}),k.extend(o.style,{width:"100%",height:"100%",background:"none"}),Zv(o,"top","rgba(0,0,0,0)","#000"),k.extend(e.__hue_field.style,{width:"15px",height:"100px",border:"1px solid #555",cursor:"ns-resize",position:"absolute",top:"3px",right:"3px"}),WC(e.__hue_field),k.extend(e.__input.style,{outline:"none",textAlign:"center",color:"#fff",border:0,fontWeight:"bold",textShadow:e.__input_textShadow+"rgba(0,0,0,0.7)"}),z.bind(e.__saturation_field,"mousedown",s),z.bind(e.__saturation_field,"touchstart",s),z.bind(e.__field_knob,"mousedown",s),z.bind(e.__field_knob,"touchstart",s),z.bind(e.__hue_field,"mousedown",l),z.bind(e.__hue_field,"touchstart",l);function s(g){h(g),z.bind(window,"mousemove",h),z.bind(window,"touchmove",h),z.bind(window,"mouseup",u),z.bind(window,"touchend",u)}function l(g){f(g),z.bind(window,"mousemove",f),z.bind(window,"touchmove",f),z.bind(window,"mouseup",c),z.bind(window,"touchend",c)}function u(){z.unbind(window,"mousemove",h),z.unbind(window,"touchmove",h),z.unbind(window,"mouseup",u),z.unbind(window,"touchend",u),_()}function c(){z.unbind(window,"mousemove",f),z.unbind(window,"touchmove",f),z.unbind(window,"mouseup",c),z.unbind(window,"touchend",c),_()}function d(){var g=Od(this.value);g!==!1?(r.__color.__state=g,r.setValue(r.__color.toOriginal())):this.value=r.__color.toString()}function _(){r.__onFinishChange&&r.__onFinishChange.call(r,r.__color.toOriginal())}e.__saturation_field.appendChild(o),e.__selector.appendChild(e.__field_knob),e.__selector.appendChild(e.__saturation_field),e.__selector.appendChild(e.__hue_field),e.__hue_field.appendChild(e.__hue_knob),e.domElement.appendChild(e.__input),e.domElement.appendChild(e.__selector),e.updateDisplay();function h(g){g.type.indexOf("touch")===-1&&g.preventDefault();var y=r.__saturation_field.getBoundingClientRect(),p=g.touches&&g.touches[0]||g,v=p.clientX,m=p.clientY,x=(v-y.left)/(y.right-y.left),S=1-(m-y.top)/(y.bottom-y.top);return S>1?S=1:S<0&&(S=0),x>1?x=1:x<0&&(x=0),r.__color.v=S,r.__color.s=x,r.setValue(r.__color.toOriginal()),!1}function f(g){g.type.indexOf("touch")===-1&&g.preventDefault();var y=r.__hue_field.getBoundingClientRect(),p=g.touches&&g.touches[0]||g,v=p.clientY,m=1-(v-y.top)/(y.bottom-y.top);return m>1?m=1:m<0&&(m=0),r.__color.h=m*360,r.setValue(r.__color.toOriginal()),!1}return e}return ur(i,[{key:"updateDisplay",value:function(){var t=Od(this.getValue());if(t!==!1){var e=!1;k.each(yt.COMPONENTS,function(s){if(!k.isUndefined(t[s])&&!k.isUndefined(this.__color.__state[s])&&t[s]!==this.__color.__state[s])return e=!0,{}},this),e&&k.extend(this.__color.__state,t)}k.extend(this.__temp.__state,this.__color.__state),this.__temp.a=1;var r=this.__color.v<.5||this.__color.s>.5?255:0,o=255-r;k.extend(this.__field_knob.style,{marginLeft:100*this.__color.s-7+"px",marginTop:100*(1-this.__color.v)-7+"px",backgroundColor:this.__temp.toHexString(),border:this.__field_knob_border+"rgb("+r+","+r+","+r+")"}),this.__hue_knob.style.marginTop=(1-this.__color.h/360)*100+"px",this.__temp.s=1,this.__temp.v=1,Zv(this.__saturation_field,"left","#fff",this.__temp.toHexString()),this.__input.value=this.__color.toString(),k.extend(this.__input.style,{backgroundColor:this.__color.toHexString(),color:"rgb("+r+","+r+","+r+")",textShadow:this.__input_textShadow+"rgba("+o+","+o+","+o+",.7)"})}}]),i}(da),GC=["-moz-","-o-","-webkit-","-ms-",""];function Zv(n,i,a,t){n.style.background="",k.each(GC,function(e){n.style.cssText+="background: "+e+"linear-gradient("+i+", "+a+" 0%, "+t+" 100%); "})}function WC(n){n.style.background="",n.style.cssText+="background: -moz-linear-gradient(top,  #ff0000 0%, #ff00ff 17%, #0000ff 34%, #00ffff 50%, #00ff00 67%, #ffff00 84%, #ff0000 100%);",n.style.cssText+="background: -webkit-linear-gradient(top,  #ff0000 0%,#ff00ff 17%,#0000ff 34%,#00ffff 50%,#00ff00 67%,#ffff00 84%,#ff0000 100%);",n.style.cssText+="background: -o-linear-gradient(top,  #ff0000 0%,#ff00ff 17%,#0000ff 34%,#00ffff 50%,#00ff00 67%,#ffff00 84%,#ff0000 100%);",n.style.cssText+="background: -ms-linear-gradient(top,  #ff0000 0%,#ff00ff 17%,#0000ff 34%,#00ffff 50%,#00ff00 67%,#ffff00 84%,#ff0000 100%);",n.style.cssText+="background: linear-gradient(top,  #ff0000 0%,#ff00ff 17%,#0000ff 34%,#00ffff 50%,#00ff00 67%,#ffff00 84%,#ff0000 100%);"}var XC={load:function(i,a){var t=a||document,e=t.createElement("link");e.type="text/css",e.rel="stylesheet",e.href=i,t.getElementsByTagName("head")[0].appendChild(e)},inject:function(i,a){var t=a||document,e=document.createElement("style");e.type="text/css",e.innerHTML=i;var r=t.getElementsByTagName("head")[0];try{r.appendChild(e)}catch{}}},jC=`<div id="dg-save" class="dg dialogue">

  Here's the new load parameter for your <code>GUI</code>'s constructor:

  <textarea id="dg-new-constructor"></textarea>

  <div id="dg-save-locally">

    <input id="dg-local-storage" type="checkbox"/> Automatically save
    values to <code>localStorage</code> on exit.

    <div id="dg-local-explain">The values saved to <code>localStorage</code> will
      override those passed to <code>dat.GUI</code>'s constructor. This makes it
      easier to work incrementally, but <code>localStorage</code> is fragile,
      and your friends may not see the same values you do.

    </div>

  </div>

</div>`,YC=function(i,a){var t=i[a];return k.isArray(arguments[2])||k.isObject(arguments[2])?new UC(i,a,arguments[2]):k.isNumber(t)?k.isNumber(arguments[2])&&k.isNumber(arguments[3])?k.isNumber(arguments[4])?new Nd(i,a,arguments[2],arguments[3],arguments[4]):new Nd(i,a,arguments[2],arguments[3]):k.isNumber(arguments[4])?new hu(i,a,{min:arguments[2],max:arguments[3],step:arguments[4]}):new hu(i,a,{min:arguments[2],max:arguments[3]}):k.isString(t)?new kC(i,a):k.isFunction(t)?new rm(i,a,""):k.isBoolean(t)?new tm(i,a):null};function qC(n){setTimeout(n,1e3/60)}var QC=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||qC,$C=function(){function n(){lr(this,n),this.backgroundElement=document.createElement("div"),k.extend(this.backgroundElement.style,{backgroundColor:"rgba(0,0,0,0.8)",top:0,left:0,display:"none",zIndex:"1000",opacity:0,WebkitTransition:"opacity 0.2s linear",transition:"opacity 0.2s linear"}),z.makeFullscreen(this.backgroundElement),this.backgroundElement.style.position="fixed",this.domElement=document.createElement("div"),k.extend(this.domElement.style,{position:"fixed",display:"none",zIndex:"1001",opacity:0,WebkitTransition:"-webkit-transform 0.2s ease-out, opacity 0.2s linear",transition:"transform 0.2s ease-out, opacity 0.2s linear"}),document.body.appendChild(this.backgroundElement),document.body.appendChild(this.domElement);var i=this;z.bind(this.backgroundElement,"click",function(){i.hide()})}return ur(n,[{key:"show",value:function(){var a=this;this.backgroundElement.style.display="block",this.domElement.style.display="block",this.domElement.style.opacity=0,this.domElement.style.webkitTransform="scale(1.1)",this.layout(),k.defer(function(){a.backgroundElement.style.opacity=1,a.domElement.style.opacity=1,a.domElement.style.webkitTransform="scale(1)"})}},{key:"hide",value:function(){var a=this,t=function e(){a.domElement.style.display="none",a.backgroundElement.style.display="none",z.unbind(a.domElement,"webkitTransitionEnd",e),z.unbind(a.domElement,"transitionend",e),z.unbind(a.domElement,"oTransitionEnd",e)};z.bind(this.domElement,"webkitTransitionEnd",t),z.bind(this.domElement,"transitionend",t),z.bind(this.domElement,"oTransitionEnd",t),this.backgroundElement.style.opacity=0,this.domElement.style.opacity=0,this.domElement.style.webkitTransform="scale(1.1)"}},{key:"layout",value:function(){this.domElement.style.left=window.innerWidth/2-z.getWidth(this.domElement)/2+"px",this.domElement.style.top=window.innerHeight/2-z.getHeight(this.domElement)/2+"px"}}]),n}(),KC=LC(`.dg ul{list-style:none;margin:0;padding:0;width:100%;clear:both}.dg.ac{position:fixed;top:0;left:0;right:0;height:0;z-index:0}.dg:not(.ac) .main{overflow:hidden}.dg.main{-webkit-transition:opacity .1s linear;-o-transition:opacity .1s linear;-moz-transition:opacity .1s linear;transition:opacity .1s linear}.dg.main.taller-than-window{overflow-y:auto}.dg.main.taller-than-window .close-button{opacity:1;margin-top:-1px;border-top:1px solid #2c2c2c}.dg.main ul.closed .close-button{opacity:1 !important}.dg.main:hover .close-button,.dg.main .close-button.drag{opacity:1}.dg.main .close-button{-webkit-transition:opacity .1s linear;-o-transition:opacity .1s linear;-moz-transition:opacity .1s linear;transition:opacity .1s linear;border:0;line-height:19px;height:20px;cursor:pointer;text-align:center;background-color:#000}.dg.main .close-button.close-top{position:relative}.dg.main .close-button.close-bottom{position:absolute}.dg.main .close-button:hover{background-color:#111}.dg.a{float:right;margin-right:15px;overflow-y:visible}.dg.a.has-save>ul.close-top{margin-top:0}.dg.a.has-save>ul.close-bottom{margin-top:27px}.dg.a.has-save>ul.closed{margin-top:0}.dg.a .save-row{top:0;z-index:1002}.dg.a .save-row.close-top{position:relative}.dg.a .save-row.close-bottom{position:fixed}.dg li{-webkit-transition:height .1s ease-out;-o-transition:height .1s ease-out;-moz-transition:height .1s ease-out;transition:height .1s ease-out;-webkit-transition:overflow .1s linear;-o-transition:overflow .1s linear;-moz-transition:overflow .1s linear;transition:overflow .1s linear}.dg li:not(.folder){cursor:auto;height:27px;line-height:27px;padding:0 4px 0 5px}.dg li.folder{padding:0;border-left:4px solid rgba(0,0,0,0)}.dg li.title{cursor:pointer;margin-left:-4px}.dg .closed li:not(.title),.dg .closed ul li,.dg .closed ul li>*{height:0;overflow:hidden;border:0}.dg .cr{clear:both;padding-left:3px;height:27px;overflow:hidden}.dg .property-name{cursor:default;float:left;clear:left;width:40%;overflow:hidden;text-overflow:ellipsis}.dg .cr.function .property-name{width:100%}.dg .c{float:left;width:60%;position:relative}.dg .c input[type=text]{border:0;margin-top:4px;padding:3px;width:100%;float:right}.dg .has-slider input[type=text]{width:30%;margin-left:0}.dg .slider{float:left;width:66%;margin-left:-5px;margin-right:0;height:19px;margin-top:4px}.dg .slider-fg{height:100%}.dg .c input[type=checkbox]{margin-top:7px}.dg .c select{margin-top:5px}.dg .cr.function,.dg .cr.function .property-name,.dg .cr.function *,.dg .cr.boolean,.dg .cr.boolean *{cursor:pointer}.dg .cr.color{overflow:visible}.dg .selector{display:none;position:absolute;margin-left:-9px;margin-top:23px;z-index:10}.dg .c:hover .selector,.dg .selector.drag{display:block}.dg li.save-row{padding:0}.dg li.save-row .button{display:inline-block;padding:0px 6px}.dg.dialogue{background-color:#222;width:460px;padding:15px;font-size:13px;line-height:15px}#dg-new-constructor{padding:10px;color:#222;font-family:Monaco, monospace;font-size:10px;border:0;resize:none;box-shadow:inset 1px 1px 1px #888;word-wrap:break-word;margin:12px 0;display:block;width:440px;overflow-y:scroll;height:100px;position:relative}#dg-local-explain{display:none;font-size:11px;line-height:17px;border-radius:3px;background-color:#333;padding:8px;margin-top:10px}#dg-local-explain code{font-size:10px}#dat-gui-save-locally{display:none}.dg{color:#eee;font:11px 'Lucida Grande', sans-serif;text-shadow:0 -1px 0 #111}.dg.main::-webkit-scrollbar{width:5px;background:#1a1a1a}.dg.main::-webkit-scrollbar-corner{height:0;display:none}.dg.main::-webkit-scrollbar-thumb{border-radius:5px;background:#676767}.dg li:not(.folder){background:#1a1a1a;border-bottom:1px solid #2c2c2c}.dg li.save-row{line-height:25px;background:#dad5cb;border:0}.dg li.save-row select{margin-left:5px;width:108px}.dg li.save-row .button{margin-left:5px;margin-top:1px;border-radius:2px;font-size:9px;line-height:7px;padding:4px 4px 5px 4px;background:#c5bdad;color:#fff;text-shadow:0 1px 0 #b0a58f;box-shadow:0 -1px 0 #b0a58f;cursor:pointer}.dg li.save-row .button.gears{background:#c5bdad url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAsAAAANCAYAAAB/9ZQ7AAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAQJJREFUeNpiYKAU/P//PwGIC/ApCABiBSAW+I8AClAcgKxQ4T9hoMAEUrxx2QSGN6+egDX+/vWT4e7N82AMYoPAx/evwWoYoSYbACX2s7KxCxzcsezDh3evFoDEBYTEEqycggWAzA9AuUSQQgeYPa9fPv6/YWm/Acx5IPb7ty/fw+QZblw67vDs8R0YHyQhgObx+yAJkBqmG5dPPDh1aPOGR/eugW0G4vlIoTIfyFcA+QekhhHJhPdQxbiAIguMBTQZrPD7108M6roWYDFQiIAAv6Aow/1bFwXgis+f2LUAynwoIaNcz8XNx3Dl7MEJUDGQpx9gtQ8YCueB+D26OECAAQDadt7e46D42QAAAABJRU5ErkJggg==) 2px 1px no-repeat;height:7px;width:8px}.dg li.save-row .button:hover{background-color:#bab19e;box-shadow:0 -1px 0 #b0a58f}.dg li.folder{border-bottom:0}.dg li.title{padding-left:16px;background:#000 url(data:image/gif;base64,R0lGODlhBQAFAJEAAP////Pz8////////yH5BAEAAAIALAAAAAAFAAUAAAIIlI+hKgFxoCgAOw==) 6px 10px no-repeat;cursor:pointer;border-bottom:1px solid rgba(255,255,255,0.2)}.dg .closed li.title{background-image:url(data:image/gif;base64,R0lGODlhBQAFAJEAAP////Pz8////////yH5BAEAAAIALAAAAAAFAAUAAAIIlGIWqMCbWAEAOw==)}.dg .cr.boolean{border-left:3px solid #806787}.dg .cr.color{border-left:3px solid}.dg .cr.function{border-left:3px solid #e61d5f}.dg .cr.number{border-left:3px solid #2FA1D6}.dg .cr.number input[type=text]{color:#2FA1D6}.dg .cr.string{border-left:3px solid #1ed36f}.dg .cr.string input[type=text]{color:#1ed36f}.dg .cr.function:hover,.dg .cr.boolean:hover{background:#111}.dg .c input[type=text]{background:#303030;outline:none}.dg .c input[type=text]:hover{background:#3c3c3c}.dg .c input[type=text]:focus{background:#494949;color:#fff}.dg .c .slider{background:#303030;cursor:ew-resize}.dg .c .slider-fg{background:#2FA1D6;max-width:100%}.dg .c .slider:hover{background:#3c3c3c}.dg .c .slider:hover .slider-fg{background:#44abda}
`);XC.inject(KC);var ep="dg",tp=72,np=20,Ts="Default",Lo=function(){try{return!!window.localStorage}catch{return!1}}(),Qo=void 0,rp=!0,ma=void 0,mc=!1,im=[],De=function n(i){var a=this,t=i||{};this.domElement=document.createElement("div"),this.__ul=document.createElement("ul"),this.domElement.appendChild(this.__ul),z.addClass(this.domElement,ep),this.__folders={},this.__controllers=[],this.__rememberedObjects=[],this.__rememberedObjectIndecesToControllers=[],this.__listening=[],t=k.defaults(t,{closeOnTop:!1,autoPlace:!0,width:n.DEFAULT_WIDTH}),t=k.defaults(t,{resizable:t.autoPlace,hideable:t.autoPlace}),k.isUndefined(t.load)?t.load={preset:Ts}:t.preset&&(t.load.preset=t.preset),k.isUndefined(t.parent)&&t.hideable&&im.push(this),t.resizable=k.isUndefined(t.parent)&&t.resizable,t.autoPlace&&k.isUndefined(t.scrollable)&&(t.scrollable=!0);var e=Lo&&localStorage.getItem(ya(this,"isLocal"))==="true",r=void 0,o=void 0;if(Object.defineProperties(this,{parent:{get:function(){return t.parent}},scrollable:{get:function(){return t.scrollable}},autoPlace:{get:function(){return t.autoPlace}},closeOnTop:{get:function(){return t.closeOnTop}},preset:{get:function(){return a.parent?a.getRoot().preset:t.load.preset},set:function(_){a.parent?a.getRoot().preset=_:t.load.preset=_,t2(this),a.revert()}},width:{get:function(){return t.width},set:function(_){t.width=_,Hd(a,_)}},name:{get:function(){return t.name},set:function(_){t.name=_,o&&(o.innerHTML=t.name)}},closed:{get:function(){return t.closed},set:function(_){t.closed=_,t.closed?z.addClass(a.__ul,n.CLASS_CLOSED):z.removeClass(a.__ul,n.CLASS_CLOSED),this.onResize(),a.__closeButton&&(a.__closeButton.innerHTML=_?n.TEXT_OPEN:n.TEXT_CLOSED)}},load:{get:function(){return t.load}},useLocalStorage:{get:function(){return e},set:function(_){Lo&&(e=_,_?z.bind(window,"unload",r):z.unbind(window,"unload",r),localStorage.setItem(ya(a,"isLocal"),_))}}}),k.isUndefined(t.parent)){if(this.closed=t.closed||!1,z.addClass(this.domElement,n.CLASS_MAIN),z.makeSelectable(this.domElement,!1),Lo&&e){a.useLocalStorage=!0;var s=localStorage.getItem(ya(this,"gui"));s&&(t.load=JSON.parse(s))}this.__closeButton=document.createElement("div"),this.__closeButton.innerHTML=n.TEXT_CLOSED,z.addClass(this.__closeButton,n.CLASS_CLOSE_BUTTON),t.closeOnTop?(z.addClass(this.__closeButton,n.CLASS_CLOSE_TOP),this.domElement.insertBefore(this.__closeButton,this.domElement.childNodes[0])):(z.addClass(this.__closeButton,n.CLASS_CLOSE_BOTTOM),this.domElement.appendChild(this.__closeButton)),z.bind(this.__closeButton,"click",function(){a.closed=!a.closed})}else{t.closed===void 0&&(t.closed=!0);var l=document.createTextNode(t.name);z.addClass(l,"controller-name"),o=ah(a,l);var u=function(_){return _.preventDefault(),a.closed=!a.closed,!1};z.addClass(this.__ul,n.CLASS_CLOSED),z.addClass(o,"title"),z.bind(o,"click",u),t.closed||(this.closed=!1)}t.autoPlace&&(k.isUndefined(t.parent)&&(rp&&(ma=document.createElement("div"),z.addClass(ma,ep),z.addClass(ma,n.CLASS_AUTO_PLACE_CONTAINER),document.body.appendChild(ma),rp=!1),ma.appendChild(this.domElement),z.addClass(this.domElement,n.CLASS_AUTO_PLACE)),this.parent||Hd(a,t.width)),this.__resizeHandler=function(){a.onResizeDebounced()},z.bind(window,"resize",this.__resizeHandler),z.bind(this.__ul,"webkitTransitionEnd",this.__resizeHandler),z.bind(this.__ul,"transitionend",this.__resizeHandler),z.bind(this.__ul,"oTransitionEnd",this.__resizeHandler),this.onResize(),t.resizable&&e2(this),r=function(){Lo&&localStorage.getItem(ya(a,"isLocal"))==="true"&&localStorage.setItem(ya(a,"gui"),JSON.stringify(a.getSaveObject()))},this.saveToLocalStorageIfPossible=r;function c(){var d=a.getRoot();d.width+=1,k.defer(function(){d.width-=1})}t.parent||c()};De.toggleHide=function(){mc=!mc,k.each(im,function(n){n.domElement.style.display=mc?"none":""})};De.CLASS_AUTO_PLACE="a";De.CLASS_AUTO_PLACE_CONTAINER="ac";De.CLASS_MAIN="main";De.CLASS_CONTROLLER_ROW="cr";De.CLASS_TOO_TALL="taller-than-window";De.CLASS_CLOSED="closed";De.CLASS_CLOSE_BUTTON="close-button";De.CLASS_CLOSE_TOP="close-top";De.CLASS_CLOSE_BOTTOM="close-bottom";De.CLASS_DRAG="drag";De.DEFAULT_WIDTH=245;De.TEXT_CLOSED="Close Controls";De.TEXT_OPEN="Open Controls";De._keydownHandler=function(n){document.activeElement.type!=="text"&&(n.which===tp||n.keyCode===tp)&&De.toggleHide()};z.bind(window,"keydown",De._keydownHandler,!1);k.extend(De.prototype,{add:function(i,a){return $o(this,i,a,{factoryArgs:Array.prototype.slice.call(arguments,2)})},addColor:function(i,a){return $o(this,i,a,{color:!0})},remove:function(i){this.__ul.removeChild(i.__li),this.__controllers.splice(this.__controllers.indexOf(i),1);var a=this;k.defer(function(){a.onResize()})},destroy:function(){if(this.parent)throw new Error("Only the root GUI should be removed with .destroy(). For subfolders, use gui.removeFolder(folder) instead.");this.autoPlace&&ma.removeChild(this.domElement);var i=this;k.each(this.__folders,function(a){i.removeFolder(a)}),z.unbind(window,"keydown",De._keydownHandler,!1),ip(this)},addFolder:function(i){if(this.__folders[i]!==void 0)throw new Error('You already have a folder in this GUI by the name "'+i+'"');var a={name:i,parent:this};a.autoPlace=this.autoPlace,this.load&&this.load.folders&&this.load.folders[i]&&(a.closed=this.load.folders[i].closed,a.load=this.load.folders[i]);var t=new De(a);this.__folders[i]=t;var e=ah(this,t.domElement);return z.addClass(e,"folder"),t},removeFolder:function(i){this.__ul.removeChild(i.domElement.parentElement),delete this.__folders[i.name],this.load&&this.load.folders&&this.load.folders[i.name]&&delete this.load.folders[i.name],ip(i);var a=this;k.each(i.__folders,function(t){i.removeFolder(t)}),k.defer(function(){a.onResize()})},open:function(){this.closed=!1},close:function(){this.closed=!0},hide:function(){this.domElement.style.display="none"},show:function(){this.domElement.style.display=""},onResize:function(){var i=this.getRoot();if(i.scrollable){var a=z.getOffset(i.__ul).top,t=0;k.each(i.__ul.childNodes,function(e){i.autoPlace&&e===i.__save_row||(t+=z.getHeight(e))}),window.innerHeight-a-np<t?(z.addClass(i.domElement,De.CLASS_TOO_TALL),i.__ul.style.height=window.innerHeight-a-np+"px"):(z.removeClass(i.domElement,De.CLASS_TOO_TALL),i.__ul.style.height="auto")}i.__resize_handle&&k.defer(function(){i.__resize_handle.style.height=i.__ul.offsetHeight+"px"}),i.__closeButton&&(i.__closeButton.style.width=i.width+"px")},onResizeDebounced:k.debounce(function(){this.onResize()},50),remember:function(){if(k.isUndefined(Qo)&&(Qo=new $C,Qo.domElement.innerHTML=jC),this.parent)throw new Error("You can only call remember on a top level GUI.");var i=this;k.each(Array.prototype.slice.call(arguments),function(a){i.__rememberedObjects.length===0&&ZC(i),i.__rememberedObjects.indexOf(a)===-1&&i.__rememberedObjects.push(a)}),this.autoPlace&&Hd(this,this.width)},getRoot:function(){for(var i=this;i.parent;)i=i.parent;return i},getSaveObject:function(){var i=this.load;return i.closed=this.closed,this.__rememberedObjects.length>0&&(i.preset=this.preset,i.remembered||(i.remembered={}),i.remembered[this.preset]=_l(this)),i.folders={},k.each(this.__folders,function(a,t){i.folders[t]=a.getSaveObject()}),i},save:function(){this.load.remembered||(this.load.remembered={}),this.load.remembered[this.preset]=_l(this),Ud(this,!1),this.saveToLocalStorageIfPossible()},saveAs:function(i){this.load.remembered||(this.load.remembered={},this.load.remembered[Ts]=_l(this,!0)),this.load.remembered[i]=_l(this),this.preset=i,kd(this,i,!0),this.saveToLocalStorageIfPossible()},revert:function(i){k.each(this.__controllers,function(a){this.getRoot().load.remembered?am(i||this.getRoot(),a):a.setValue(a.initialValue),a.__onFinishChange&&a.__onFinishChange.call(a,a.getValue())},this),k.each(this.__folders,function(a){a.revert(a)}),i||Ud(this.getRoot(),!1)},listen:function(i){var a=this.__listening.length===0;this.__listening.push(i),a&&om(this.__listening)},updateDisplay:function(){k.each(this.__controllers,function(i){i.updateDisplay()}),k.each(this.__folders,function(i){i.updateDisplay()})}});function ah(n,i,a){var t=document.createElement("li");return i&&t.appendChild(i),a?n.__ul.insertBefore(t,a):n.__ul.appendChild(t),n.onResize(),t}function ip(n){z.unbind(window,"resize",n.__resizeHandler),n.saveToLocalStorageIfPossible&&z.unbind(window,"unload",n.saveToLocalStorageIfPossible)}function Ud(n,i){var a=n.__preset_select[n.__preset_select.selectedIndex];i?a.innerHTML=a.value+"*":a.innerHTML=a.value}function JC(n,i,a){if(a.__li=i,a.__gui=n,k.extend(a,{options:function(o){if(arguments.length>1){var s=a.__li.nextElementSibling;return a.remove(),$o(n,a.object,a.property,{before:s,factoryArgs:[k.toArray(arguments)]})}if(k.isArray(o)||k.isObject(o)){var l=a.__li.nextElementSibling;return a.remove(),$o(n,a.object,a.property,{before:l,factoryArgs:[o]})}},name:function(o){return a.__li.firstElementChild.firstElementChild.innerHTML=o,a},listen:function(){return a.__gui.listen(a),a},remove:function(){return a.__gui.remove(a),a}}),a instanceof Nd){var t=new hu(a.object,a.property,{min:a.__min,max:a.__max,step:a.__step});k.each(["updateDisplay","onChange","onFinishChange","step","min","max"],function(r){var o=a[r],s=t[r];a[r]=t[r]=function(){var l=Array.prototype.slice.call(arguments);return s.apply(t,l),o.apply(a,l)}}),z.addClass(i,"has-slider"),a.domElement.insertBefore(t.domElement,a.domElement.firstElementChild)}else if(a instanceof hu){var e=function(o){if(k.isNumber(a.__min)&&k.isNumber(a.__max)){var s=a.__li.firstElementChild.firstElementChild.innerHTML,l=a.__gui.__listening.indexOf(a)>-1;a.remove();var u=$o(n,a.object,a.property,{before:a.__li.nextElementSibling,factoryArgs:[a.__min,a.__max,a.__step]});return u.name(s),l&&u.listen(),u}return o};a.min=k.compose(e,a.min),a.max=k.compose(e,a.max)}else a instanceof tm?(z.bind(i,"click",function(){z.fakeEvent(a.__checkbox,"click")}),z.bind(a.__checkbox,"click",function(r){r.stopPropagation()})):a instanceof rm?(z.bind(i,"click",function(){z.fakeEvent(a.__button,"click")}),z.bind(i,"mouseover",function(){z.addClass(a.__button,"hover")}),z.bind(i,"mouseout",function(){z.removeClass(a.__button,"hover")})):a instanceof Vd&&(z.addClass(i,"color"),a.updateDisplay=k.compose(function(r){return i.style.borderLeftColor=a.__color.toString(),r},a.updateDisplay),a.updateDisplay());a.setValue=k.compose(function(r){return n.getRoot().__preset_select&&a.isModified()&&Ud(n.getRoot(),!0),r},a.setValue)}function am(n,i){var a=n.getRoot(),t=a.__rememberedObjects.indexOf(i.object);if(t!==-1){var e=a.__rememberedObjectIndecesToControllers[t];if(e===void 0&&(e={},a.__rememberedObjectIndecesToControllers[t]=e),e[i.property]=i,a.load&&a.load.remembered){var r=a.load.remembered,o=void 0;if(r[n.preset])o=r[n.preset];else if(r[Ts])o=r[Ts];else return;if(o[t]&&o[t][i.property]!==void 0){var s=o[t][i.property];i.initialValue=s,i.setValue(s)}}}}function $o(n,i,a,t){if(i[a]===void 0)throw new Error('Object "'+i+'" has no property "'+a+'"');var e=void 0;if(t.color)e=new Vd(i,a);else{var r=[i,a].concat(t.factoryArgs);e=YC.apply(n,r)}t.before instanceof da&&(t.before=t.before.__li),am(n,e),z.addClass(e.domElement,"c");var o=document.createElement("span");z.addClass(o,"property-name"),o.innerHTML=e.property;var s=document.createElement("div");s.appendChild(o),s.appendChild(e.domElement);var l=ah(n,s,t.before);return z.addClass(l,De.CLASS_CONTROLLER_ROW),e instanceof Vd?z.addClass(l,"color"):z.addClass(l,OC(e.getValue())),JC(n,l,e),n.__controllers.push(e),e}function ya(n,i){return document.location.href+"."+i}function kd(n,i,a){var t=document.createElement("option");t.innerHTML=i,t.value=i,n.__preset_select.appendChild(t),a&&(n.__preset_select.selectedIndex=n.__preset_select.length-1)}function ap(n,i){i.style.display=n.useLocalStorage?"block":"none"}function ZC(n){var i=n.__save_row=document.createElement("li");z.addClass(n.domElement,"has-save"),n.__ul.insertBefore(i,n.__ul.firstChild),z.addClass(i,"save-row");var a=document.createElement("span");a.innerHTML="&nbsp;",z.addClass(a,"button gears");var t=document.createElement("span");t.innerHTML="Save",z.addClass(t,"button"),z.addClass(t,"save");var e=document.createElement("span");e.innerHTML="New",z.addClass(e,"button"),z.addClass(e,"save-as");var r=document.createElement("span");r.innerHTML="Revert",z.addClass(r,"button"),z.addClass(r,"revert");var o=n.__preset_select=document.createElement("select");if(n.load&&n.load.remembered?k.each(n.load.remembered,function(d,_){kd(n,_,_===n.preset)}):kd(n,Ts,!1),z.bind(o,"change",function(){for(var d=0;d<n.__preset_select.length;d++)n.__preset_select[d].innerHTML=n.__preset_select[d].value;n.preset=this.value}),i.appendChild(o),i.appendChild(a),i.appendChild(t),i.appendChild(e),i.appendChild(r),Lo){var s=document.getElementById("dg-local-explain"),l=document.getElementById("dg-local-storage"),u=document.getElementById("dg-save-locally");u.style.display="block",localStorage.getItem(ya(n,"isLocal"))==="true"&&l.setAttribute("checked","checked"),ap(n,s),z.bind(l,"change",function(){n.useLocalStorage=!n.useLocalStorage,ap(n,s)})}var c=document.getElementById("dg-new-constructor");z.bind(c,"keydown",function(d){d.metaKey&&(d.which===67||d.keyCode===67)&&Qo.hide()}),z.bind(a,"click",function(){c.innerHTML=JSON.stringify(n.getSaveObject(),void 0,2),Qo.show(),c.focus(),c.select()}),z.bind(t,"click",function(){n.save()}),z.bind(e,"click",function(){var d=prompt("Enter a new preset name.");d&&n.saveAs(d)}),z.bind(r,"click",function(){n.revert()})}function e2(n){var i=void 0;n.__resize_handle=document.createElement("div"),k.extend(n.__resize_handle.style,{width:"6px",marginLeft:"-3px",height:"200px",cursor:"ew-resize",position:"absolute"});function a(r){return r.preventDefault(),n.width+=i-r.clientX,n.onResize(),i=r.clientX,!1}function t(){z.removeClass(n.__closeButton,De.CLASS_DRAG),z.unbind(window,"mousemove",a),z.unbind(window,"mouseup",t)}function e(r){return r.preventDefault(),i=r.clientX,z.addClass(n.__closeButton,De.CLASS_DRAG),z.bind(window,"mousemove",a),z.bind(window,"mouseup",t),!1}z.bind(n.__resize_handle,"mousedown",e),z.bind(n.__closeButton,"mousedown",e),n.domElement.insertBefore(n.__resize_handle,n.domElement.firstElementChild)}function Hd(n,i){n.domElement.style.width=i+"px",n.__save_row&&n.autoPlace&&(n.__save_row.style.width=i+"px"),n.__closeButton&&(n.__closeButton.style.width=i+"px")}function _l(n,i){var a={};return k.each(n.__rememberedObjects,function(t,e){var r={},o=n.__rememberedObjectIndecesToControllers[e];k.each(o,function(s,l){r[l]=i?s.initialValue:s.getValue()}),a[e]=r}),a}function t2(n){for(var i=0;i<n.__preset_select.length;i++)n.__preset_select[i].value===n.preset&&(n.__preset_select.selectedIndex=i)}function om(n){n.length!==0&&QC.call(window,function(){om(n)}),k.each(n,function(i){i.updateDisplay()})}var n2=De;class r2 extends Ft{constructor(){super(...arguments);Kr(this,"stencilEntity");Kr(this,"planeRenderer");Kr(this,"plane",new he);Kr(this,"tmpVector1",new w(0,1,0));Kr(this,"tmpVector2",new w);Kr(this,"rotation",new w(0,0,0));Kr(this,"originalClearFlag",Kt.All)}setStencilPlaneRenderState(a){const t=a.renderState.stencilState;t.enabled=!0,t.referenceValue=1,t.compareFunctionFront=ye.Always,t.compareFunctionBack=ye.Always,t.passOperationFront=Je.Replace,t.passOperationBack=Je.Replace;const e=a.renderState.depthState;e.writeEnabled=!1,a.shaderData.enableMacro("OASIS_TRANSPARENT")}setMirrorRenderState(a){const t=a.renderState.blendState.targetBlendState;t.enabled=!0,t.sourceAlphaBlendFactor=oe.OneMinusDestinationAlpha,t.sourceColorBlendFactor=oe.OneMinusDestinationAlpha,t.destinationAlphaBlendFactor=oe.DestinationAlpha,t.destinationColorBlendFactor=oe.DestinationAlpha;const e=a.renderState.depthState;e.enabled=!0,e.writeEnabled=!0,a.shaderData.enableMacro("OASIS_TRANSPARENT")}init(a,t,e){const r=new n2;r.add(this.rotation,"x",-180,180,1),r.add(this.rotation,"y",0,100,1),r.add(this.rotation,"z",0,100,1),this.stencilEntity=this.entity.createChild("stencil-entity");const o=this.stencilEntity.addComponent(et);o.mesh=to.createPlane(this.engine,a,t);const s=new aa(this.engine);s.baseColor=new ne(0,1,0,0),o.setMaterial(s),o.priority=-1,this.setStencilPlaneRenderState(s),this.planeRenderer=this.entity.addComponent(et);const{planeRenderer:l}=this;l.mesh=to.createPlane(this.engine,a,t),l.priority=1;const u=new aa(this.engine);l.setMaterial(u),u.baseColor=new ne(1,0,0,0),this.setMirrorRenderState(u);const c=e.entity.addComponent(Ft);c.onBeginRender=this.beginRender.bind(this)}setRenderState(a,t=!1){const e=a.renderState.rasterState,r=a.renderState.stencilState,o=a.renderState.depthState;o.writeEnabled=!0,t?(e.cullMode=kt.Off,r.enabled=!1):(e.cullMode=kt.Off,r.enabled=!0,r.referenceValue=1,r.writeMask=0,r.compareFunctionBack=ye.Equal,r.compareFunctionFront=ye.Equal)}setBackgroundRenderState(a=!1){const t=this.entity.scene.background;let e,r,o;if(t.mode===Cn.Sky){const s=t.sky.material;r=s.renderState.blendState.targetBlendState,e=s.renderState.depthState,o=s.renderState.stencilState}else if(t.mode===Cn.Texture){const s=this.engine._backgroundTextureMaterial;r=s.renderState.blendState.targetBlendState,e=s.renderState.depthState,o=s.renderState.stencilState}else return;a?(r.enabled=!1,e.compareFunction=ye.LessEqual,e.writeEnabled=!0,o.enabled=!1):(r.enabled=!0,r.sourceAlphaBlendFactor=r.sourceColorBlendFactor=oe.OneMinusDestinationAlpha,r.destinationAlphaBlendFactor=r.destinationColorBlendFactor=oe.DestinationAlpha,o.enabled=!0,o.referenceValue=1,o.writeMask=0,o.compareFunctionBack=ye.Equal,o.compareFunctionFront=ye.Equal,e.compareFunction=ye.Always,e.writeEnabled=!1)}onUpdate(a){const{rotation:t}=this;this.entity.transform.setRotation(t.x,t.y,t.z)}beginRender(a){this.updatePlane(),a.clipPlane=this.plane,a.mirrorPlane=this.plane,a.clearFlags=this.originalClearFlag;const t=a.scene.getRootEntity();this.traverseEntity(t,e=>{if([this.entity,this.stencilEntity].includes(e))return;const r=e.getComponent(me),o=r==null?void 0:r.getMaterial();o&&this.setRenderState(o,!1)}),this.entity.layer=Ut.Layer0,this.stencilEntity&&(this.stencilEntity.layer=Ut.Layer0),this.setBackgroundRenderState(),a.drawBackgroundForce=!1,a.render(),a.drawBackgroundForce=!0,this.setBackgroundRenderState(!0),a.clearFlags=Kt.None,a.clipPlane=void 0,a.mirrorPlane=void 0,this.traverseEntity(t,e=>{if([this.entity,this.stencilEntity].includes(e))return;const r=e.getComponent(me),o=r==null?void 0:r.getMaterial();o&&this.setRenderState(o,!0)}),this.entity.layer=Ut.Nothing,this.stencilEntity&&(this.stencilEntity.layer=Ut.Nothing)}updatePlane(){const{position:a,localMatrix:t}=this.entity.transform,{tmpVector1:e,tmpVector2:r}=this;debugger;w.transformNormal(e,t,r),this.plane.x=r.x,this.plane.y=r.y,this.plane.z=r.z,this.plane.w=-r.x*a.x-r.y*a.y-r.z*a.z}traverseEntity(a,t){t(a);for(let e=0;e<a.children.length;e++)this.traverseEntity(a.children[e],t)}onDestroy(){var a,t;(a=this.stencilEntity)==null||a.destroy(),(t=this.planeRenderer)==null||t.destroy(),this.plane=null,this.normal=null}}function i2(){we.enable(),console.log("oasis");const n=new OS("canvas",{alpha:!0});n.canvas.resizeByClientSize();const i=n.sceneManager.activeScene,a=i.createRootEntity(),t=a.createChild("camera"),e=t.addComponent(Pe);t.transform.setPosition(0,0,10);const r=t.addComponent(gC);r.minDistance=3,e.scene.ambientLight.diffuseSolidColor.set(1,1,1,1);const o=a.createChild("mirror");o.addComponent(r2).init(3,3,e),o.transform.setRotation(90,0,0),o.transform.setPosition(0,-1,2);const l=i.background,u=l.sky,c=new K_(n);l.mode=Cn.Sky,u.material=c,u.mesh=to.createCuboid(n,1,1,1),n.resourceManager.load({urls:["https://gw.alipayobjects.com/mdn/rms_475770/afts/img/A*Gi7CTZqKuacAAAAAAAAAAABkARQnAQ","https://gw.alipayobjects.com/mdn/rms_475770/afts/img/A*iRRMQIExwKMAAAAAAAAAAABkARQnAQ","https://gw.alipayobjects.com/mdn/rms_475770/afts/img/A*ZIcPQZo20sAAAAAAAAAAAABkARQnAQ","https://gw.alipayobjects.com/mdn/rms_475770/afts/img/A*SPYuTbHT-KgAAAAAAAAAAABkARQnAQ","https://gw.alipayobjects.com/mdn/rms_475770/afts/img/A*mGUERbY77roAAAAAAAAAAABkARQnAQ","https://gw.alipayobjects.com/mdn/rms_475770/afts/img/A*ilkPS7A1_JsAAAAAAAAAAABkARQnAQ"],type:Xe.TextureCube}).then(d=>{n.resourceManager.load("https://gw.alipayobjects.com/os/bmw-prod/150e44f6-7810-4c45-8029-3575d36aff30.gltf").then(_=>{const{animations:h,defaultSceneRoot:f}=_;a.addChild(f);const g=[];f.getComponentsIncludeChildren(et,g),g.forEach(v=>{const m=v.getMaterial();m&&(m.renderState.depthState.enabled=!0,m.renderState.rasterState.cullMode=kt.Back)}),f.transform.setPosition(0,1,0),f.transform.setRotation(90,0,0);const y=f.clone();y.transform.setPosition(2,1,0),a.addChild(y);const p=f.clone();p.transform.setPosition(0,-3,1),a.addChild(p)}),i.ambientLight.specularTexture=d,c.textureCubeMap=d,console.log("run"),n.run()})}function a2(){return Ko.useEffect(()=>{console.log("effect"),i2()},[]),bl.jsx("canvas",{id:"canvas",style:{width:"100vw",height:"100vh"}})}yc.createRoot(document.getElementById("root")).render(bl.jsx(a2,{}));
